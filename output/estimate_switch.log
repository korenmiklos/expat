--------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/koren/Google Drive/Research/expat/research_design/talk/output/estimate_switch.log
  log type:  text
 opened on:   7 Jan 2019, 18:09:30

. 
. 
. use temp/analysis_sample

. 
. *Dinamika
. scalar Tbefore = 4

. scalar Tduring = 6

. scalar Tafter = 4

. 
. gen byte analysis_window = (tenure>=-Tbefore-1)&(year-first_exit_year<=Tafter)

. 
. global sample_baseline (analysis_window==1)

. global sample_manufacturing $sample_baseline & (manufacturing==1)

. global sample_acquisitions $sample_baseline & (greenfield==0)

. global sample_1990s $sample_acquisitions & (enter_year>=1994 & enter_year<=1999)

. global sample_2000s $sample_acquisitions & (enter_year>=2000)

. global sample_ever_foreign $sample_acquisitions & (ever_foreign==1)

. 
. global samples baseline acquisitions

. 
. global outcomes lnL lnKL lnQL exporter

. global controls foreign i.ind_year i.age_cat

. 
. label var lnL "Employment (log)"

. label var lnKL "Capital per worker (log)"

. label var lnQL "Revenue per worker (log)"

. label var exporter "Firm is an exporter (dummy)"

. 
. egen person_tag = tag(frame_id manager_id)

. egen N = sum(person_tag), by(frame_id)

. gen inverse_weight = 1/N

. 
. * verify founders are not in analysis sample
. foreach X of var during* after* {
  2.         replace `X'=0 if founder==1
  3. }
(0 real changes made)
(132,464 real changes made)
(55,048 real changes made)
(73,335 real changes made)
(81,604 real changes made)
(46,715 real changes made)
(88,449 real changes made)
(96,285 real changes made)
(94,584 real changes made)
(20,057 real changes made)
(10,166 real changes made)
(13,405 real changes made)
(13,063 real changes made)
(15,361 real changes made)
(11,994 real changes made)
(13,939 real changes made)
(17,025 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(70,373 real changes made)
(35,951 real changes made)
(37,925 real changes made)
(38,899 real changes made)
(31,710 real changes made)
(44,472 real changes made)
(52,990 real changes made)
(32,396 real changes made)
(32,892 real changes made)
(19,164 real changes made)
(22,477 real changes made)
(19,915 real changes made)
(25,211 real changes made)
(20,097 real changes made)
(27,732 real changes made)
(15,077 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)

. 
. xtset firm_person year
       panel variable:  firm_person (unbalanced)
        time variable:  year, 1992 to 2016, but with gaps
                delta:  1 unit

. 
. do est_`1'

. local i = 1

. foreach X of var $outcomes {
  2.         xtreg `X' foreign during_?? after_?? i.ind_year i.age_cat if $sample_acquisitions [aw=inverse_weight], i(firm_perso
> n ) fe vce(cluster id)
  3.         local r2_w = `e(r2_w)'
  4.         do regram output/regression/acquisitions_change `i' `X' R2_within "`r2_w'"
  5.         do tree_graph
  6. 
.         local i = `i' + 1
  7. }

Fixed-effects (within) regression               Number of obs      =    354772
Group variable: firm_person                     Number of groups   =     39630

R-sq:  within  = 0.1021                         Obs per group: min =         1
       between = 0.0171                                        avg =       9.0
       overall = 0.0287                                        max =        25

                                                F(82,14528)        =     39.00
corr(u_i, Xb)  = -0.3177                        Prob > F           =    0.0000

                                (Std. Err. adjusted for 14,529 clusters in id)
------------------------------------------------------------------------------
             |               Robust
         lnL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0379434   .0379666     1.00   0.318    -.0364759    .1123627
   during_DD |  -.0484456   .0110231    -4.39   0.000    -.0700522    -.026839
   during_DE |   -.021944   .0588296    -0.37   0.709    -.1372575    .0933695
   during_ED |  -.0308153   .0444937    -0.69   0.489    -.1180285    .0563979
   during_EE |  -.0829118   .0535786    -1.55   0.122    -.1879327    .0221091
    after_DD |  -.2013457   .0205762    -9.79   0.000    -.2416777   -.1610137
    after_DE |  -.1055203   .0687343    -1.54   0.125    -.2402484    .0292077
    after_ED |  -.2016335   .0637346    -3.16   0.002    -.3265613   -.0767056
    after_EE |  -.1569978   .0685384    -2.29   0.022    -.2913418   -.0226539
             |
    ind_year |
          2  |   -.118574   .0249714    -4.75   0.000    -.1675212   -.0696268
          3  |  -.2653035   .0324393    -8.18   0.000    -.3288886   -.2017184
          4  |  -.4020937   .0369153   -10.89   0.000    -.4744524   -.3297349
          5  |  -.5015521   .0417056   -12.03   0.000    -.5833004   -.4198038
          6  |  -.6038306   .0462849   -13.05   0.000    -.6945549   -.5131062
          7  |  -.6639491   .0506852   -13.10   0.000    -.7632986   -.5645996
          8  |  -.6952749   .0546014   -12.73   0.000    -.8023006   -.5882492
          9  |  -.7460064   .0588438   -12.68   0.000    -.8613477   -.6306651
         10  |  -.8094156   .0629405   -12.86   0.000    -.9327871   -.6860442
         11  |  -.8711746   .0667948   -13.04   0.000    -1.002101   -.7402483
         12  |   -.916855   .0708839   -12.93   0.000    -1.055796   -.7779134
         13  |  -.9521468   .0750655   -12.68   0.000    -1.099285   -.8050088
         14  |  -1.005656   .0792242   -12.69   0.000    -1.160945   -.8503665
         15  |  -1.037316   .0832531   -12.46   0.000    -1.200503   -.8741292
         16  |  -1.099849   .0872346   -12.61   0.000     -1.27084   -.9288583
         17  |  -1.149493   .0914092   -12.58   0.000    -1.328666   -.9703189
         18  |   -1.23676   .0954148   -12.96   0.000    -1.423785   -1.049735
         19  |  -1.301064   .0992611   -13.11   0.000    -1.495628   -1.106499
         20  |  -1.351237   .1028477   -13.14   0.000    -1.552831   -1.149642
         21  |   -1.41194   .1063893   -13.27   0.000    -1.620477   -1.203404
         22  |  -1.463443   .1097872   -13.33   0.000     -1.67864   -1.248246
         23  |  -1.506312   .1132025   -13.31   0.000    -1.728203    -1.28442
         24  |  -1.557812   .1170473   -13.31   0.000    -1.787239   -1.328384
         25  |   -1.58558   .1209686   -13.11   0.000    -1.822694   -1.348466
         26  |   .5080391   .0718581     7.07   0.000      .367188    .6488901
         27  |   .3452435   .0675844     5.11   0.000     .2127695    .4777174
         28  |   .2223225   .0654369     3.40   0.001      .094058    .3505871
         29  |   .0859642   .0647677     1.33   0.184    -.0409888    .2129172
         30  |  -.0239537   .0642139    -0.37   0.709    -.1498211    .1019138
         31  |  -.0916648    .065302    -1.40   0.160    -.2196651    .0363354
         32  |  -.1719618   .0660758    -2.60   0.009    -.3014788   -.0424448
         33  |  -.2561056   .0682208    -3.75   0.000    -.3898271   -.1223841
         34  |  -.3278051   .0704712    -4.65   0.000    -.4659376   -.1896726
         35  |  -.3933119    .073118    -5.38   0.000    -.5366324   -.2499913
         36  |  -.4712558   .0756056    -6.23   0.000    -.6194524   -.3230592
         37  |  -.5481697    .078499    -6.98   0.000    -.7020378   -.3943017
         38  |  -.6299148   .0817765    -7.70   0.000    -.7902072   -.4696224
         39  |  -.6960562   .0855035    -8.14   0.000    -.8636539   -.5284584
         40  |   -.730443    .089409    -8.17   0.000     -.905696     -.55519
         41  |  -.7675551   .0927882    -8.27   0.000    -.9494319   -.5856783
         42  |  -.8288293     .09631    -8.61   0.000    -1.017609   -.6400495
         43  |  -.9558353   .1001877    -9.54   0.000    -1.152216   -.7594546
         44  |  -1.004395   .1043848    -9.62   0.000    -1.209003   -.7997879
         45  |    -1.0284   .1081654    -9.51   0.000    -1.240418   -.8163818
         46  |  -1.054951   .1119175    -9.43   0.000    -1.274323   -.8355783
         47  |   -1.08933   .1152248    -9.45   0.000    -1.315185   -.8634744
         48  |  -1.109029   .1188058    -9.33   0.000    -1.341904   -.8761548
         49  |  -1.158313    .122453    -9.46   0.000    -1.398337   -.9182896
         50  |   -1.19243   .1255165    -9.50   0.000    -1.438459    -.946402
             |
     age_cat |
          1  |   .4124312   .0188981    21.82   0.000     .3753886    .4494738
          2  |   .7084369   .0220586    32.12   0.000     .6651993    .7516746
          3  |   .9261581   .0257773    35.93   0.000     .8756313    .9766849
          4  |   1.107286   .0296108    37.39   0.000     1.049245    1.165327
          5  |    1.26346     .03377    37.41   0.000     1.197267    1.329654
          6  |   1.390128   .0380017    36.58   0.000      1.31564    1.464616
          7  |   1.493378   .0423947    35.23   0.000     1.410279    1.576477
          8  |   1.590155   .0468852    33.92   0.000     1.498254    1.682056
          9  |   1.664052   .0512712    32.46   0.000     1.563554     1.76455
         10  |   1.733302   .0556276    31.16   0.000     1.624265    1.842339
         11  |   1.803956   .0600485    30.04   0.000     1.686253    1.921658
         12  |   1.872467   .0644691    29.04   0.000     1.746099    1.998835
         13  |   1.935117   .0688731    28.10   0.000     1.800117    2.070117
         14  |   1.979172   .0734456    26.95   0.000      1.83521    2.123135
         15  |   2.025162   .0779907    25.97   0.000      1.87229    2.178034
         16  |   2.059976   .0825351    24.96   0.000     1.898197    2.221755
         17  |   2.095169   .0871771    24.03   0.000     1.924291    2.266047
         18  |   2.146493   .0915282    23.45   0.000     1.967086      2.3259
         19  |   2.183278   .0963305    22.66   0.000     1.994458    2.372097
         20  |   2.258226   .1048487    21.54   0.000     2.052709    2.463743
         25  |   2.374558   .1185111    20.04   0.000     2.142261    2.606855
         30  |   2.141813   .1538029    13.93   0.000      1.84034    2.443286
         40  |   2.066685   .1723191    11.99   0.000     1.728917    2.404452
         50  |   2.024703   .1735462    11.67   0.000     1.684531    2.364876
             |
       _cons |   3.012931    .046089    65.37   0.000     2.922591    3.103272
-------------+----------------------------------------------------------------
     sigma_u |  1.1395598
     sigma_e |  .64553965
         rho |  .75705878   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. local fmt "%10.5f"

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }
key: R2_within
value: .1021024810407405

. 
. estimates

--------------------------------------------------------------------------------------------------------------------------------
active results
--------------------------------------------------------------------------------------------------------------------------------

Fixed-effects (within) regression               Number of obs     =    354,772
Group variable: firm_person                     Number of groups  =     39,630

R-sq:                                           Obs per group:
     within  = 0.1021                                         min =          1
     between = 0.0171                                         avg =        9.0
     overall = 0.0287                                         max =         25

                                                F(82,14528)       =      39.00
corr(u_i, Xb)  = -0.3177                        Prob > F          =     0.0000

                                (Std. Err. adjusted for 14,529 clusters in id)
------------------------------------------------------------------------------
             |               Robust
         lnL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0379434   .0379666     1.00   0.318    -.0364759    .1123627
   during_DD |  -.0484456   .0110231    -4.39   0.000    -.0700522    -.026839
   during_DE |   -.021944   .0588296    -0.37   0.709    -.1372575    .0933695
   during_ED |  -.0308153   .0444937    -0.69   0.489    -.1180285    .0563979
   during_EE |  -.0829118   .0535786    -1.55   0.122    -.1879327    .0221091
    after_DD |  -.2013457   .0205762    -9.79   0.000    -.2416777   -.1610137
    after_DE |  -.1055203   .0687343    -1.54   0.125    -.2402484    .0292077
    after_ED |  -.2016335   .0637346    -3.16   0.002    -.3265613   -.0767056
    after_EE |  -.1569978   .0685384    -2.29   0.022    -.2913418   -.0226539
             |
    ind_year |
          2  |   -.118574   .0249714    -4.75   0.000    -.1675212   -.0696268
          3  |  -.2653035   .0324393    -8.18   0.000    -.3288886   -.2017184
          4  |  -.4020937   .0369153   -10.89   0.000    -.4744524   -.3297349
          5  |  -.5015521   .0417056   -12.03   0.000    -.5833004   -.4198038
          6  |  -.6038306   .0462849   -13.05   0.000    -.6945549   -.5131062
          7  |  -.6639491   .0506852   -13.10   0.000    -.7632986   -.5645996
          8  |  -.6952749   .0546014   -12.73   0.000    -.8023006   -.5882492
          9  |  -.7460064   .0588438   -12.68   0.000    -.8613477   -.6306651
         10  |  -.8094156   .0629405   -12.86   0.000    -.9327871   -.6860442
         11  |  -.8711746   .0667948   -13.04   0.000    -1.002101   -.7402483
         12  |   -.916855   .0708839   -12.93   0.000    -1.055796   -.7779134
         13  |  -.9521468   .0750655   -12.68   0.000    -1.099285   -.8050088
         14  |  -1.005656   .0792242   -12.69   0.000    -1.160945   -.8503665
         15  |  -1.037316   .0832531   -12.46   0.000    -1.200503   -.8741292
         16  |  -1.099849   .0872346   -12.61   0.000     -1.27084   -.9288583
         17  |  -1.149493   .0914092   -12.58   0.000    -1.328666   -.9703189
         18  |   -1.23676   .0954148   -12.96   0.000    -1.423785   -1.049735
         19  |  -1.301064   .0992611   -13.11   0.000    -1.495628   -1.106499
         20  |  -1.351237   .1028477   -13.14   0.000    -1.552831   -1.149642
         21  |   -1.41194   .1063893   -13.27   0.000    -1.620477   -1.203404
         22  |  -1.463443   .1097872   -13.33   0.000     -1.67864   -1.248246
         23  |  -1.506312   .1132025   -13.31   0.000    -1.728203    -1.28442
         24  |  -1.557812   .1170473   -13.31   0.000    -1.787239   -1.328384
         25  |   -1.58558   .1209686   -13.11   0.000    -1.822694   -1.348466
         26  |   .5080391   .0718581     7.07   0.000      .367188    .6488901
         27  |   .3452435   .0675844     5.11   0.000     .2127695    .4777174
         28  |   .2223225   .0654369     3.40   0.001      .094058    .3505871
         29  |   .0859642   .0647677     1.33   0.184    -.0409888    .2129172
         30  |  -.0239537   .0642139    -0.37   0.709    -.1498211    .1019138
         31  |  -.0916648    .065302    -1.40   0.160    -.2196651    .0363354
         32  |  -.1719618   .0660758    -2.60   0.009    -.3014788   -.0424448
         33  |  -.2561056   .0682208    -3.75   0.000    -.3898271   -.1223841
         34  |  -.3278051   .0704712    -4.65   0.000    -.4659376   -.1896726
         35  |  -.3933119    .073118    -5.38   0.000    -.5366324   -.2499913
         36  |  -.4712558   .0756056    -6.23   0.000    -.6194524   -.3230592
         37  |  -.5481697    .078499    -6.98   0.000    -.7020378   -.3943017
         38  |  -.6299148   .0817765    -7.70   0.000    -.7902072   -.4696224
         39  |  -.6960562   .0855035    -8.14   0.000    -.8636539   -.5284584
         40  |   -.730443    .089409    -8.17   0.000     -.905696     -.55519
         41  |  -.7675551   .0927882    -8.27   0.000    -.9494319   -.5856783
         42  |  -.8288293     .09631    -8.61   0.000    -1.017609   -.6400495
         43  |  -.9558353   .1001877    -9.54   0.000    -1.152216   -.7594546
         44  |  -1.004395   .1043848    -9.62   0.000    -1.209003   -.7997879
         45  |    -1.0284   .1081654    -9.51   0.000    -1.240418   -.8163818
         46  |  -1.054951   .1119175    -9.43   0.000    -1.274323   -.8355783
         47  |   -1.08933   .1152248    -9.45   0.000    -1.315185   -.8634744
         48  |  -1.109029   .1188058    -9.33   0.000    -1.341904   -.8761548
         49  |  -1.158313    .122453    -9.46   0.000    -1.398337   -.9182896
         50  |   -1.19243   .1255165    -9.50   0.000    -1.438459    -.946402
             |
     age_cat |
          1  |   .4124312   .0188981    21.82   0.000     .3753886    .4494738
          2  |   .7084369   .0220586    32.12   0.000     .6651993    .7516746
          3  |   .9261581   .0257773    35.93   0.000     .8756313    .9766849
          4  |   1.107286   .0296108    37.39   0.000     1.049245    1.165327
          5  |    1.26346     .03377    37.41   0.000     1.197267    1.329654
          6  |   1.390128   .0380017    36.58   0.000      1.31564    1.464616
          7  |   1.493378   .0423947    35.23   0.000     1.410279    1.576477
          8  |   1.590155   .0468852    33.92   0.000     1.498254    1.682056
          9  |   1.664052   .0512712    32.46   0.000     1.563554     1.76455
         10  |   1.733302   .0556276    31.16   0.000     1.624265    1.842339
         11  |   1.803956   .0600485    30.04   0.000     1.686253    1.921658
         12  |   1.872467   .0644691    29.04   0.000     1.746099    1.998835
         13  |   1.935117   .0688731    28.10   0.000     1.800117    2.070117
         14  |   1.979172   .0734456    26.95   0.000      1.83521    2.123135
         15  |   2.025162   .0779907    25.97   0.000      1.87229    2.178034
         16  |   2.059976   .0825351    24.96   0.000     1.898197    2.221755
         17  |   2.095169   .0871771    24.03   0.000     1.924291    2.266047
         18  |   2.146493   .0915282    23.45   0.000     1.967086      2.3259
         19  |   2.183278   .0963305    22.66   0.000     1.994458    2.372097
         20  |   2.258226   .1048487    21.54   0.000     2.052709    2.463743
         25  |   2.374558   .1185111    20.04   0.000     2.142261    2.606855
         30  |   2.141813   .1538029    13.93   0.000      1.84034    2.443286
         40  |   2.066685   .1723191    11.99   0.000     1.728917    2.404452
         50  |   2.024703   .1735462    11.67   0.000     1.684531    2.364876
             |
       _cons |   3.012931    .046089    65.37   0.000     2.922591    3.103272
-------------+----------------------------------------------------------------
     sigma_u |  1.1395598
     sigma_e |  .64553965
         rho |  .75705878   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text replace

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b', "`fmt'")) _newline
  6.         file write `output' ("   standard_error: " + string(`se', "`fmt'")) _newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se', "`fmt'")) _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',"pvalue"),colnumb(`coefs',"`X'")]), "`fmt'") _
> newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file

. local fname = e(depvar)

. local title : variable label `fname'

. 
. slopegraph, ///
>         from(0 0 0 0 1 _b[during_DE] 1 _b[during_DE]) ///
>         to(1 _b[during_DD] 1 _b[during_DE] 2 _b[during_ED]+_b[during_DE] 2 _b[during_EE]+_b[during_DE]) ///
>         style(p1 p2 p1 p2) ///
>         label(Local-Local Local-Expat Expat-Local Expat-Expat) ///
>         width_test(during_DD during_DE during_ED during_EE) ///
>         star_test(1==1 during_DE==during_DD 1==1 during_EE==during_ED) ///
>         connect(stepstair) ///
>         format(scheme(538w) xlabel(none) xtitle("") ytitle("") title(`title') legend(off) aspect(.5) plotregion(style(none)) x
> size(16) ysize(10))
number of observations (_N) was 0, now 8
(8 missing values generated)
(8 missing values generated)
(8 missing values generated)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
variable label was str1 now str11
(1 real change made)

 ( 1)  during_DD = 0

       F(  1, 14528) =   19.32
            Prob > F =    0.0000

 ( 1) = 0
       Constraint 1 dropped

       F(  0, 14528) =       .
            Prob > F =         .
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

 ( 1)  during_DE = 0

       F(  1, 14528) =    0.14
            Prob > F =    0.7091

 ( 1)  - during_DD + during_DE = 0

       F(  1, 14528) =    0.20
            Prob > F =    0.6560
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

 ( 1)  during_ED = 0

       F(  1, 14528) =    0.48
            Prob > F =    0.4886

 ( 1) = 0
       Constraint 1 dropped

       F(  0, 14528) =       .
            Prob > F =         .
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

 ( 1)  during_EE = 0

       F(  1, 14528) =    2.39
            Prob > F =    0.1218

 ( 1)  - during_ED + during_EE = 0

       F(  1, 14528) =    0.65
            Prob > F =    0.4216

. 
. graph export output/figure/`fname'_tree.png, width(1600) replace
(file output/figure/lnL_tree.png written in PNG format)

. 
end of do-file

Fixed-effects (within) regression               Number of obs      =    354772
Group variable: firm_person                     Number of groups   =     39630

R-sq:  within  = 0.1726                         Obs per group: min =         1
       between = 0.0591                                        avg =       9.0
       overall = 0.0744                                        max =        25

                                                F(82,14528)        =     75.34
corr(u_i, Xb)  = -0.0412                        Prob > F           =    0.0000

                                (Std. Err. adjusted for 14,529 clusters in id)
------------------------------------------------------------------------------
             |               Robust
        lnKL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0174329   .0490568     0.36   0.722    -.0787247    .1135905
   during_DD |   .0036925   .0128119     0.29   0.773    -.0214205    .0288055
   during_DE |  -.0660919    .073482    -0.90   0.368    -.2101261    .0779422
   during_ED |    -.11504   .0546715    -2.10   0.035    -.2222031    -.007877
   during_EE |  -.1022577   .0658006    -1.55   0.120    -.2312352    .0267198
    after_DD |  -.0172592   .0241126    -0.72   0.474    -.0645229    .0300045
    after_DE |  -.1560054   .0816536    -1.91   0.056    -.3160569     .004046
    after_ED |  -.1525112   .0778179    -1.96   0.050    -.3050442    .0000219
    after_EE |  -.2661664   .0902642    -2.95   0.003    -.4430957   -.0892372
             |
    ind_year |
          2  |    .159086   .0352324     4.52   0.000      .090026    .2281459
          3  |    .815215   .0434632    18.76   0.000     .7300216    .9004083
          4  |   .9929263   .0494461    20.08   0.000     .8960056    1.089847
          5  |   1.165148   .0546373    21.33   0.000     1.058052    1.272244
          6  |   1.411497   .0598385    23.59   0.000     1.294206    1.528788
          7  |   1.701286   .0652065    26.09   0.000     1.573473    1.829099
          8  |   1.914063   .0706214    27.10   0.000     1.775636     2.05249
          9  |   2.058991   .0760605    27.07   0.000     1.909902    2.208079
         10  |   2.204419   .0823675    26.76   0.000     2.042968    2.365869
         11  |   2.362949    .088298    26.76   0.000     2.189874    2.536025
         12  |   2.425586   .0946118    25.64   0.000     2.240135    2.611037
         13  |   2.488693   .1010376    24.63   0.000     2.290646    2.686739
         14  |   2.509152   .1074992    23.34   0.000      2.29844    2.719864
         15  |   2.484737   .1140659    21.78   0.000     2.261153     2.70832
         16  |   2.542915   .1203196    21.13   0.000     2.307073    2.778757
         17  |   2.575338   .1269797    20.28   0.000     2.326442    2.824234
         18  |   2.585626   .1334899    19.37   0.000     2.323969    2.847283
         19  |   2.548864    .139975    18.21   0.000     2.274495    2.823233
         20  |   2.551963   .1462787    17.45   0.000     2.265239    2.838688
         21  |    2.58295   .1517776    17.02   0.000     2.285447    2.880453
         22  |   2.622806   .1572182    16.68   0.000     2.314639    2.930974
         23  |   2.736997   .1626399    16.83   0.000     2.418202    3.055791
         24  |   2.536955   .1689784    15.01   0.000     2.205736    2.868174
         25  |   2.530965   .1751837    14.45   0.000     2.187582    2.874347
         26  |   .4651469   .0842588     5.52   0.000      .299989    .6303048
         27  |   .5896169   .0750713     7.85   0.000     .4424676    .7367663
         28  |   .9110213    .070329    12.95   0.000     .7731676    1.048875
         29  |   1.074007   .0695902    15.43   0.000     .9376018    1.210413
         30  |   1.199504   .0709856    16.90   0.000     1.060363    1.338644
         31  |   1.362515   .0734813    18.54   0.000     1.218482    1.506547
         32  |   1.590568   .0761206    20.90   0.000     1.441362    1.739774
         33  |   1.752184   .0802811    21.83   0.000     1.594823    1.909546
         34  |   1.882979   .0848902    22.18   0.000     1.716583    2.049374
         35  |   2.001321   .0900129    22.23   0.000     1.824885    2.177758
         36  |   2.136602   .0953992    22.40   0.000     1.949607    2.323596
         37  |   2.266796   .1008567    22.48   0.000     2.069105    2.464488
         38  |    2.34005   .1064961    21.97   0.000     2.131304    2.548796
         39  |    2.37069   .1123522    21.10   0.000     2.150465    2.590914
         40  |   2.385227   .1182658    20.17   0.000     2.153411    2.617043
         41  |   2.417433   .1244633    19.42   0.000     2.173469    2.661397
         42  |   2.501425   .1310922    19.08   0.000     2.244467    2.758382
         43  |   2.551101   .1378379    18.51   0.000     2.280921     2.82128
         44  |   2.541721   .1446328    17.57   0.000     2.258223     2.82522
         45  |   2.574813   .1508481    17.07   0.000     2.279131    2.870494
         46  |   2.576104   .1572325    16.38   0.000     2.267909      2.8843
         47  |    2.61457   .1627353    16.07   0.000     2.295589    2.933552
         48  |   2.696315   .1677802    16.07   0.000     2.367444    3.025186
         49  |   2.624693   .1738069    15.10   0.000     2.284009    2.965376
         50  |   2.645674   .1791381    14.77   0.000      2.29454    2.996807
             |
     age_cat |
          1  |   .0926005   .0297439     3.11   0.002     .0342986    .1509024
          2  |   .1384398   .0341134     4.06   0.000     .0715731    .2053064
          3  |   .1496719   .0386443     3.87   0.000     .0739242    .2254195
          4  |    .172587   .0438135     3.94   0.000      .086707     .258467
          5  |   .1635331   .0494334     3.31   0.001     .0666372    .2604289
          6  |   .1377873    .055393     2.49   0.013       .02921    .2463646
          7  |   .1384909   .0615954     2.25   0.025     .0177561    .2592256
          8  |    .134586    .068038     1.98   0.048     .0012229    .2679492
          9  |   .1393738   .0744611     1.87   0.061    -.0065794    .2853271
         10  |   .1349614   .0810539     1.67   0.096    -.0239145    .2938374
         11  |   .1279888   .0877607     1.46   0.145    -.0440333     .300011
         12  |   .1224511   .0942404     1.30   0.194    -.0622721    .3071743
         13  |   .1054846   .1009354     1.05   0.296    -.0923616    .3033307
         14  |   .1111854   .1077235     1.03   0.302    -.0999663    .3223371
         15  |   .1154356   .1145546     1.01   0.314    -.1091059    .3399772
         16  |   .0978523   .1216513     0.80   0.421    -.1405997    .3363043
         17  |   .0846575    .128675     0.66   0.511    -.1675619    .3368769
         18  |   .0944099   .1355873     0.70   0.486    -.1713585    .3601783
         19  |   .0743334   .1427953     0.52   0.603    -.2055636    .3542304
         20  |   .0367956   .1567106     0.23   0.814     -.270377    .3439683
         25  |  -.0245518   .1797461    -0.14   0.891     -.376877    .3277733
         30  |   .0415006   .2207568     0.19   0.851    -.3912109    .4742121
         40  |   .2070921   .2544552     0.81   0.416    -.2916724    .7058567
         50  |   .2654231   .2787721     0.95   0.341    -.2810056    .8118518
             |
       _cons |     3.8061   .0577908    65.86   0.000     3.692823    3.919377
-------------+----------------------------------------------------------------
     sigma_u |  1.7092473
     sigma_e |  .88291533
         rho |  .78937432   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. local fmt "%10.5f"

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }
key: R2_within
value: .1726387991314027

. 
. estimates

--------------------------------------------------------------------------------------------------------------------------------
active results
--------------------------------------------------------------------------------------------------------------------------------

Fixed-effects (within) regression               Number of obs     =    354,772
Group variable: firm_person                     Number of groups  =     39,630

R-sq:                                           Obs per group:
     within  = 0.1726                                         min =          1
     between = 0.0591                                         avg =        9.0
     overall = 0.0744                                         max =         25

                                                F(82,14528)       =      75.34
corr(u_i, Xb)  = -0.0412                        Prob > F          =     0.0000

                                (Std. Err. adjusted for 14,529 clusters in id)
------------------------------------------------------------------------------
             |               Robust
        lnKL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0174329   .0490568     0.36   0.722    -.0787247    .1135905
   during_DD |   .0036925   .0128119     0.29   0.773    -.0214205    .0288055
   during_DE |  -.0660919    .073482    -0.90   0.368    -.2101261    .0779422
   during_ED |    -.11504   .0546715    -2.10   0.035    -.2222031    -.007877
   during_EE |  -.1022577   .0658006    -1.55   0.120    -.2312352    .0267198
    after_DD |  -.0172592   .0241126    -0.72   0.474    -.0645229    .0300045
    after_DE |  -.1560054   .0816536    -1.91   0.056    -.3160569     .004046
    after_ED |  -.1525112   .0778179    -1.96   0.050    -.3050442    .0000219
    after_EE |  -.2661664   .0902642    -2.95   0.003    -.4430957   -.0892372
             |
    ind_year |
          2  |    .159086   .0352324     4.52   0.000      .090026    .2281459
          3  |    .815215   .0434632    18.76   0.000     .7300216    .9004083
          4  |   .9929263   .0494461    20.08   0.000     .8960056    1.089847
          5  |   1.165148   .0546373    21.33   0.000     1.058052    1.272244
          6  |   1.411497   .0598385    23.59   0.000     1.294206    1.528788
          7  |   1.701286   .0652065    26.09   0.000     1.573473    1.829099
          8  |   1.914063   .0706214    27.10   0.000     1.775636     2.05249
          9  |   2.058991   .0760605    27.07   0.000     1.909902    2.208079
         10  |   2.204419   .0823675    26.76   0.000     2.042968    2.365869
         11  |   2.362949    .088298    26.76   0.000     2.189874    2.536025
         12  |   2.425586   .0946118    25.64   0.000     2.240135    2.611037
         13  |   2.488693   .1010376    24.63   0.000     2.290646    2.686739
         14  |   2.509152   .1074992    23.34   0.000      2.29844    2.719864
         15  |   2.484737   .1140659    21.78   0.000     2.261153     2.70832
         16  |   2.542915   .1203196    21.13   0.000     2.307073    2.778757
         17  |   2.575338   .1269797    20.28   0.000     2.326442    2.824234
         18  |   2.585626   .1334899    19.37   0.000     2.323969    2.847283
         19  |   2.548864    .139975    18.21   0.000     2.274495    2.823233
         20  |   2.551963   .1462787    17.45   0.000     2.265239    2.838688
         21  |    2.58295   .1517776    17.02   0.000     2.285447    2.880453
         22  |   2.622806   .1572182    16.68   0.000     2.314639    2.930974
         23  |   2.736997   .1626399    16.83   0.000     2.418202    3.055791
         24  |   2.536955   .1689784    15.01   0.000     2.205736    2.868174
         25  |   2.530965   .1751837    14.45   0.000     2.187582    2.874347
         26  |   .4651469   .0842588     5.52   0.000      .299989    .6303048
         27  |   .5896169   .0750713     7.85   0.000     .4424676    .7367663
         28  |   .9110213    .070329    12.95   0.000     .7731676    1.048875
         29  |   1.074007   .0695902    15.43   0.000     .9376018    1.210413
         30  |   1.199504   .0709856    16.90   0.000     1.060363    1.338644
         31  |   1.362515   .0734813    18.54   0.000     1.218482    1.506547
         32  |   1.590568   .0761206    20.90   0.000     1.441362    1.739774
         33  |   1.752184   .0802811    21.83   0.000     1.594823    1.909546
         34  |   1.882979   .0848902    22.18   0.000     1.716583    2.049374
         35  |   2.001321   .0900129    22.23   0.000     1.824885    2.177758
         36  |   2.136602   .0953992    22.40   0.000     1.949607    2.323596
         37  |   2.266796   .1008567    22.48   0.000     2.069105    2.464488
         38  |    2.34005   .1064961    21.97   0.000     2.131304    2.548796
         39  |    2.37069   .1123522    21.10   0.000     2.150465    2.590914
         40  |   2.385227   .1182658    20.17   0.000     2.153411    2.617043
         41  |   2.417433   .1244633    19.42   0.000     2.173469    2.661397
         42  |   2.501425   .1310922    19.08   0.000     2.244467    2.758382
         43  |   2.551101   .1378379    18.51   0.000     2.280921     2.82128
         44  |   2.541721   .1446328    17.57   0.000     2.258223     2.82522
         45  |   2.574813   .1508481    17.07   0.000     2.279131    2.870494
         46  |   2.576104   .1572325    16.38   0.000     2.267909      2.8843
         47  |    2.61457   .1627353    16.07   0.000     2.295589    2.933552
         48  |   2.696315   .1677802    16.07   0.000     2.367444    3.025186
         49  |   2.624693   .1738069    15.10   0.000     2.284009    2.965376
         50  |   2.645674   .1791381    14.77   0.000      2.29454    2.996807
             |
     age_cat |
          1  |   .0926005   .0297439     3.11   0.002     .0342986    .1509024
          2  |   .1384398   .0341134     4.06   0.000     .0715731    .2053064
          3  |   .1496719   .0386443     3.87   0.000     .0739242    .2254195
          4  |    .172587   .0438135     3.94   0.000      .086707     .258467
          5  |   .1635331   .0494334     3.31   0.001     .0666372    .2604289
          6  |   .1377873    .055393     2.49   0.013       .02921    .2463646
          7  |   .1384909   .0615954     2.25   0.025     .0177561    .2592256
          8  |    .134586    .068038     1.98   0.048     .0012229    .2679492
          9  |   .1393738   .0744611     1.87   0.061    -.0065794    .2853271
         10  |   .1349614   .0810539     1.67   0.096    -.0239145    .2938374
         11  |   .1279888   .0877607     1.46   0.145    -.0440333     .300011
         12  |   .1224511   .0942404     1.30   0.194    -.0622721    .3071743
         13  |   .1054846   .1009354     1.05   0.296    -.0923616    .3033307
         14  |   .1111854   .1077235     1.03   0.302    -.0999663    .3223371
         15  |   .1154356   .1145546     1.01   0.314    -.1091059    .3399772
         16  |   .0978523   .1216513     0.80   0.421    -.1405997    .3363043
         17  |   .0846575    .128675     0.66   0.511    -.1675619    .3368769
         18  |   .0944099   .1355873     0.70   0.486    -.1713585    .3601783
         19  |   .0743334   .1427953     0.52   0.603    -.2055636    .3542304
         20  |   .0367956   .1567106     0.23   0.814     -.270377    .3439683
         25  |  -.0245518   .1797461    -0.14   0.891     -.376877    .3277733
         30  |   .0415006   .2207568     0.19   0.851    -.3912109    .4742121
         40  |   .2070921   .2544552     0.81   0.416    -.2916724    .7058567
         50  |   .2654231   .2787721     0.95   0.341    -.2810056    .8118518
             |
       _cons |     3.8061   .0577908    65.86   0.000     3.692823    3.919377
-------------+----------------------------------------------------------------
     sigma_u |  1.7092473
     sigma_e |  .88291533
         rho |  .78937432   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text replace

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b', "`fmt'")) _newline
  6.         file write `output' ("   standard_error: " + string(`se', "`fmt'")) _newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se', "`fmt'")) _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',"pvalue"),colnumb(`coefs',"`X'")]), "`fmt'") _
> newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file

. local fname = e(depvar)

. local title : variable label `fname'

. 
. slopegraph, ///
>         from(0 0 0 0 1 _b[during_DE] 1 _b[during_DE]) ///
>         to(1 _b[during_DD] 1 _b[during_DE] 2 _b[during_ED]+_b[during_DE] 2 _b[during_EE]+_b[during_DE]) ///
>         style(p1 p2 p1 p2) ///
>         label(Local-Local Local-Expat Expat-Local Expat-Expat) ///
>         width_test(during_DD during_DE during_ED during_EE) ///
>         star_test(1==1 during_DE==during_DD 1==1 during_EE==during_ED) ///
>         connect(stepstair) ///
>         format(scheme(538w) xlabel(none) xtitle("") ytitle("") title(`title') legend(off) aspect(.5) plotregion(style(none)) x
> size(16) ysize(10))
number of observations (_N) was 0, now 8
(8 missing values generated)
(8 missing values generated)
(8 missing values generated)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
variable label was str1 now str11
(1 real change made)

 ( 1)  during_DD = 0

       F(  1, 14528) =    0.08
            Prob > F =    0.7732

 ( 1) = 0
       Constraint 1 dropped

       F(  0, 14528) =       .
            Prob > F =         .
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

 ( 1)  during_DE = 0

       F(  1, 14528) =    0.81
            Prob > F =    0.3684

 ( 1)  - during_DD + during_DE = 0

       F(  1, 14528) =    0.88
            Prob > F =    0.3477
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

 ( 1)  during_ED = 0

       F(  1, 14528) =    4.43
            Prob > F =    0.0354

 ( 1) = 0
       Constraint 1 dropped

       F(  0, 14528) =       .
            Prob > F =         .
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

 ( 1)  during_EE = 0

       F(  1, 14528) =    2.42
            Prob > F =    0.1202

 ( 1)  - during_ED + during_EE = 0

       F(  1, 14528) =    0.03
            Prob > F =    0.8683

. 
. graph export output/figure/`fname'_tree.png, width(1600) replace
(file output/figure/lnKL_tree.png written in PNG format)

. 
end of do-file

Fixed-effects (within) regression               Number of obs      =    354772
Group variable: firm_person                     Number of groups   =     39630

R-sq:  within  = 0.2317                         Obs per group: min =         1
       between = 0.1450                                        avg =       9.0
       overall = 0.1278                                        max =        25

                                                F(82,14528)        =    109.98
corr(u_i, Xb)  = 0.0221                         Prob > F           =    0.0000

                                (Std. Err. adjusted for 14,529 clusters in id)
------------------------------------------------------------------------------
             |               Robust
        lnQL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0728167    .027089     2.69   0.007     .0197188    .1259146
   during_DD |   .0330497   .0076506     4.32   0.000     .0180535    .0480459
   during_DE |   .1627095   .0398757     4.08   0.000     .0845481     .240871
   during_ED |   .1607999   .0327574     4.91   0.000     .0965912    .2250086
   during_EE |   .1982374   .0382111     5.19   0.000     .1233387    .2731361
    after_DD |   .0441492   .0145125     3.04   0.002     .0157029    .0725954
    after_DE |    .269192   .0471668     5.71   0.000     .1767391     .361645
    after_ED |   .2854942    .047103     6.06   0.000     .1931664    .3778221
    after_EE |    .281139   .0492399     5.71   0.000     .1846226    .3776553
             |
    ind_year |
          2  |   .0993455   .0212924     4.67   0.000     .0576097    .1410814
          3  |   .2915302    .025902    11.26   0.000      .240759    .3423015
          4  |   .4900451   .0274897    17.83   0.000     .4361619    .5439284
          5  |   .6554659   .0302491    21.67   0.000     .5961737     .714758
          6  |   .8432125   .0335331    25.15   0.000     .7774833    .9089417
          7  |   .9727126   .0361395    26.92   0.000     .9018747    1.043551
          8  |   1.043097   .0388601    26.84   0.000     .9669266    1.119268
          9  |   1.167159   .0416432    28.03   0.000     1.085533    1.248785
         10  |   1.282946   .0449131    28.57   0.000      1.19491    1.370981
         11  |    1.35051   .0479712    28.15   0.000     1.256481     1.44454
         12  |   1.380024   .0511653    26.97   0.000     1.279734    1.480315
         13  |   1.427045   .0542246    26.32   0.000     1.320758    1.533333
         14  |   1.468602   .0572703    25.64   0.000     1.356345    1.580859
         15  |   1.541914   .0607696    25.37   0.000     1.422798     1.66103
         16  |   1.580561   .0634021    24.93   0.000     1.456285    1.704837
         17  |    1.63781   .0667863    24.52   0.000     1.506901     1.76872
         18  |   1.568976   .0699572    22.43   0.000     1.431851    1.706101
         19  |   1.596602   .0730758    21.85   0.000     1.453364     1.73984
         20  |   1.644346   .0761095    21.61   0.000     1.495162    1.793531
         21  |    1.66596   .0789671    21.10   0.000     1.511174    1.820745
         22  |    1.72156   .0816393    21.09   0.000     1.561537    1.881584
         23  |   1.773918   .0842891    21.05   0.000       1.6087    1.939135
         24  |   1.807141   .0873113    20.70   0.000     1.635999    1.978282
         25  |   1.801281   .0899242    20.03   0.000     1.625018    1.977544
         26  |  -.2540513   .0476035    -5.34   0.000    -.3473603   -.1607424
         27  |  -.1142115   .0450332    -2.54   0.011    -.2024823   -.0259407
         28  |   .0566934   .0432833     1.31   0.190    -.0281474    .1415343
         29  |   .2916127   .0431403     6.76   0.000     .2070522    .3761732
         30  |   .4713586   .0431756    10.92   0.000      .386729    .5559882
         31  |   .6264915   .0443097    14.14   0.000     .5396389    .7133442
         32  |    .778285    .045622    17.06   0.000     .6888602    .8677099
         33  |   .8410018   .0472012    17.82   0.000     .7484815    .9335221
         34  |   .9938938   .0493408    20.14   0.000     .8971796    1.090608
         35  |   1.084367   .0511301    21.21   0.000      .984146    1.184589
         36  |   1.136415   .0537047    21.16   0.000     1.031147    1.241683
         37  |   1.202004   .0562826    21.36   0.000     1.091683    1.312325
         38  |   1.284008   .0588886    21.80   0.000     1.168579    1.399437
         39  |   1.324909   .0616802    21.48   0.000     1.204008     1.44581
         40  |   1.421805   .0652621    21.79   0.000     1.293883    1.549727
         41  |   1.497843    .067498    22.19   0.000     1.365539    1.630148
         42  |    1.57704   .0702375    22.45   0.000     1.439365    1.714714
         43  |   1.553225   .0734003    21.16   0.000     1.409351    1.697099
         44  |   1.593033   .0765451    20.81   0.000     1.442995    1.743071
         45  |    1.66521   .0794691    20.95   0.000      1.50944    1.820979
         46  |   1.667198    .082393    20.23   0.000     1.505697    1.828699
         47  |   1.695369   .0846653    20.02   0.000     1.529414    1.861324
         48  |   1.755596   .0871022    20.16   0.000     1.584864    1.926327
         49  |   1.765838   .0903664    19.54   0.000     1.588709    1.942968
         50  |    1.80467   .0928973    19.43   0.000     1.622579    1.986761
             |
     age_cat |
          1  |   .2546031   .0174008    14.63   0.000     .2204953    .2887108
          2  |   .2554011   .0193391    13.21   0.000      .217494    .2933083
          3  |   .2321917   .0216137    10.74   0.000     .1898262    .2745572
          4  |   .2206894   .0239601     9.21   0.000     .1737245    .2676544
          5  |   .2110255   .0266086     7.93   0.000     .1588694    .2631817
          6  |   .1952877   .0295775     6.60   0.000      .137312    .2532633
          7  |   .2023056   .0326637     6.19   0.000     .1382807    .2663306
          8  |   .1887987   .0358158     5.27   0.000     .1185952    .2590023
          9  |   .1818257   .0389901     4.66   0.000     .1054001    .2582512
         10  |   .1685776   .0422334     3.99   0.000     .0857948    .2513605
         11  |   .1699589   .0455801     3.73   0.000     .0806162    .2593016
         12  |   .1612038   .0489276     3.29   0.001     .0652994    .2571081
         13  |   .1501933   .0522205     2.88   0.004     .0478345    .2525522
         14  |   .1527484   .0555942     2.75   0.006     .0437767    .2617201
         15  |   .1474087   .0590081     2.50   0.012     .0317454    .2630721
         16  |   .1454128   .0623646     2.33   0.020     .0231703    .2676552
         17  |   .1307661   .0659596     1.98   0.047     .0014768    .2600554
         18  |   .1282609   .0694234     1.85   0.065    -.0078179    .2643396
         19  |   .1069868   .0732002     1.46   0.144    -.0364949    .2504685
         20  |   .0743083    .080025     0.93   0.353    -.0825508    .2311674
         25  |   .0343201   .0912792     0.38   0.707    -.1445988     .213239
         30  |   .0302139   .1208771     0.25   0.803    -.2067206    .2671483
         40  |      .0627   .1347967     0.47   0.642    -.2015187    .3269186
         50  |   .0467428   .1475113     0.32   0.751    -.2423982    .3358838
             |
       _cons |   7.509291    .033617   223.38   0.000     7.443397    7.575184
-------------+----------------------------------------------------------------
     sigma_u |  1.1584069
     sigma_e |  .53380699
         rho |  .82484631   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. local fmt "%10.5f"

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }
key: R2_within
value: .2317264050334767

. 
. estimates

--------------------------------------------------------------------------------------------------------------------------------
active results
--------------------------------------------------------------------------------------------------------------------------------

Fixed-effects (within) regression               Number of obs     =    354,772
Group variable: firm_person                     Number of groups  =     39,630

R-sq:                                           Obs per group:
     within  = 0.2317                                         min =          1
     between = 0.1450                                         avg =        9.0
     overall = 0.1278                                         max =         25

                                                F(82,14528)       =     109.98
corr(u_i, Xb)  = 0.0221                         Prob > F          =     0.0000

                                (Std. Err. adjusted for 14,529 clusters in id)
------------------------------------------------------------------------------
             |               Robust
        lnQL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0728167    .027089     2.69   0.007     .0197188    .1259146
   during_DD |   .0330497   .0076506     4.32   0.000     .0180535    .0480459
   during_DE |   .1627095   .0398757     4.08   0.000     .0845481     .240871
   during_ED |   .1607999   .0327574     4.91   0.000     .0965912    .2250086
   during_EE |   .1982374   .0382111     5.19   0.000     .1233387    .2731361
    after_DD |   .0441492   .0145125     3.04   0.002     .0157029    .0725954
    after_DE |    .269192   .0471668     5.71   0.000     .1767391     .361645
    after_ED |   .2854942    .047103     6.06   0.000     .1931664    .3778221
    after_EE |    .281139   .0492399     5.71   0.000     .1846226    .3776553
             |
    ind_year |
          2  |   .0993455   .0212924     4.67   0.000     .0576097    .1410814
          3  |   .2915302    .025902    11.26   0.000      .240759    .3423015
          4  |   .4900451   .0274897    17.83   0.000     .4361619    .5439284
          5  |   .6554659   .0302491    21.67   0.000     .5961737     .714758
          6  |   .8432125   .0335331    25.15   0.000     .7774833    .9089417
          7  |   .9727126   .0361395    26.92   0.000     .9018747    1.043551
          8  |   1.043097   .0388601    26.84   0.000     .9669266    1.119268
          9  |   1.167159   .0416432    28.03   0.000     1.085533    1.248785
         10  |   1.282946   .0449131    28.57   0.000      1.19491    1.370981
         11  |    1.35051   .0479712    28.15   0.000     1.256481     1.44454
         12  |   1.380024   .0511653    26.97   0.000     1.279734    1.480315
         13  |   1.427045   .0542246    26.32   0.000     1.320758    1.533333
         14  |   1.468602   .0572703    25.64   0.000     1.356345    1.580859
         15  |   1.541914   .0607696    25.37   0.000     1.422798     1.66103
         16  |   1.580561   .0634021    24.93   0.000     1.456285    1.704837
         17  |    1.63781   .0667863    24.52   0.000     1.506901     1.76872
         18  |   1.568976   .0699572    22.43   0.000     1.431851    1.706101
         19  |   1.596602   .0730758    21.85   0.000     1.453364     1.73984
         20  |   1.644346   .0761095    21.61   0.000     1.495162    1.793531
         21  |    1.66596   .0789671    21.10   0.000     1.511174    1.820745
         22  |    1.72156   .0816393    21.09   0.000     1.561537    1.881584
         23  |   1.773918   .0842891    21.05   0.000       1.6087    1.939135
         24  |   1.807141   .0873113    20.70   0.000     1.635999    1.978282
         25  |   1.801281   .0899242    20.03   0.000     1.625018    1.977544
         26  |  -.2540513   .0476035    -5.34   0.000    -.3473603   -.1607424
         27  |  -.1142115   .0450332    -2.54   0.011    -.2024823   -.0259407
         28  |   .0566934   .0432833     1.31   0.190    -.0281474    .1415343
         29  |   .2916127   .0431403     6.76   0.000     .2070522    .3761732
         30  |   .4713586   .0431756    10.92   0.000      .386729    .5559882
         31  |   .6264915   .0443097    14.14   0.000     .5396389    .7133442
         32  |    .778285    .045622    17.06   0.000     .6888602    .8677099
         33  |   .8410018   .0472012    17.82   0.000     .7484815    .9335221
         34  |   .9938938   .0493408    20.14   0.000     .8971796    1.090608
         35  |   1.084367   .0511301    21.21   0.000      .984146    1.184589
         36  |   1.136415   .0537047    21.16   0.000     1.031147    1.241683
         37  |   1.202004   .0562826    21.36   0.000     1.091683    1.312325
         38  |   1.284008   .0588886    21.80   0.000     1.168579    1.399437
         39  |   1.324909   .0616802    21.48   0.000     1.204008     1.44581
         40  |   1.421805   .0652621    21.79   0.000     1.293883    1.549727
         41  |   1.497843    .067498    22.19   0.000     1.365539    1.630148
         42  |    1.57704   .0702375    22.45   0.000     1.439365    1.714714
         43  |   1.553225   .0734003    21.16   0.000     1.409351    1.697099
         44  |   1.593033   .0765451    20.81   0.000     1.442995    1.743071
         45  |    1.66521   .0794691    20.95   0.000      1.50944    1.820979
         46  |   1.667198    .082393    20.23   0.000     1.505697    1.828699
         47  |   1.695369   .0846653    20.02   0.000     1.529414    1.861324
         48  |   1.755596   .0871022    20.16   0.000     1.584864    1.926327
         49  |   1.765838   .0903664    19.54   0.000     1.588709    1.942968
         50  |    1.80467   .0928973    19.43   0.000     1.622579    1.986761
             |
     age_cat |
          1  |   .2546031   .0174008    14.63   0.000     .2204953    .2887108
          2  |   .2554011   .0193391    13.21   0.000      .217494    .2933083
          3  |   .2321917   .0216137    10.74   0.000     .1898262    .2745572
          4  |   .2206894   .0239601     9.21   0.000     .1737245    .2676544
          5  |   .2110255   .0266086     7.93   0.000     .1588694    .2631817
          6  |   .1952877   .0295775     6.60   0.000      .137312    .2532633
          7  |   .2023056   .0326637     6.19   0.000     .1382807    .2663306
          8  |   .1887987   .0358158     5.27   0.000     .1185952    .2590023
          9  |   .1818257   .0389901     4.66   0.000     .1054001    .2582512
         10  |   .1685776   .0422334     3.99   0.000     .0857948    .2513605
         11  |   .1699589   .0455801     3.73   0.000     .0806162    .2593016
         12  |   .1612038   .0489276     3.29   0.001     .0652994    .2571081
         13  |   .1501933   .0522205     2.88   0.004     .0478345    .2525522
         14  |   .1527484   .0555942     2.75   0.006     .0437767    .2617201
         15  |   .1474087   .0590081     2.50   0.012     .0317454    .2630721
         16  |   .1454128   .0623646     2.33   0.020     .0231703    .2676552
         17  |   .1307661   .0659596     1.98   0.047     .0014768    .2600554
         18  |   .1282609   .0694234     1.85   0.065    -.0078179    .2643396
         19  |   .1069868   .0732002     1.46   0.144    -.0364949    .2504685
         20  |   .0743083    .080025     0.93   0.353    -.0825508    .2311674
         25  |   .0343201   .0912792     0.38   0.707    -.1445988     .213239
         30  |   .0302139   .1208771     0.25   0.803    -.2067206    .2671483
         40  |      .0627   .1347967     0.47   0.642    -.2015187    .3269186
         50  |   .0467428   .1475113     0.32   0.751    -.2423982    .3358838
             |
       _cons |   7.509291    .033617   223.38   0.000     7.443397    7.575184
-------------+----------------------------------------------------------------
     sigma_u |  1.1584069
     sigma_e |  .53380699
         rho |  .82484631   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text replace

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b', "`fmt'")) _newline
  6.         file write `output' ("   standard_error: " + string(`se', "`fmt'")) _newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se', "`fmt'")) _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',"pvalue"),colnumb(`coefs',"`X'")]), "`fmt'") _
> newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file

. local fname = e(depvar)

. local title : variable label `fname'

. 
. slopegraph, ///
>         from(0 0 0 0 1 _b[during_DE] 1 _b[during_DE]) ///
>         to(1 _b[during_DD] 1 _b[during_DE] 2 _b[during_ED]+_b[during_DE] 2 _b[during_EE]+_b[during_DE]) ///
>         style(p1 p2 p1 p2) ///
>         label(Local-Local Local-Expat Expat-Local Expat-Expat) ///
>         width_test(during_DD during_DE during_ED during_EE) ///
>         star_test(1==1 during_DE==during_DD 1==1 during_EE==during_ED) ///
>         connect(stepstair) ///
>         format(scheme(538w) xlabel(none) xtitle("") ytitle("") title(`title') legend(off) aspect(.5) plotregion(style(none)) x
> size(16) ysize(10))
number of observations (_N) was 0, now 8
(8 missing values generated)
(8 missing values generated)
(8 missing values generated)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
variable label was str1 now str11
(1 real change made)

 ( 1)  during_DD = 0

       F(  1, 14528) =   18.66
            Prob > F =    0.0000

 ( 1) = 0
       Constraint 1 dropped

       F(  0, 14528) =       .
            Prob > F =         .
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

 ( 1)  during_DE = 0

       F(  1, 14528) =   16.65
            Prob > F =    0.0000

 ( 1)  - during_DD + during_DE = 0

       F(  1, 14528) =   10.31
            Prob > F =    0.0013
variable label was str11 now str13
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

 ( 1)  during_ED = 0

       F(  1, 14528) =   24.10
            Prob > F =    0.0000

 ( 1) = 0
       Constraint 1 dropped

       F(  0, 14528) =       .
            Prob > F =         .
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

 ( 1)  during_EE = 0

       F(  1, 14528) =   26.91
            Prob > F =    0.0000

 ( 1)  - during_ED + during_EE = 0

       F(  1, 14528) =    0.67
            Prob > F =    0.4135

. 
. graph export output/figure/`fname'_tree.png, width(1600) replace
(file output/figure/lnQL_tree.png written in PNG format)

. 
end of do-file

Fixed-effects (within) regression               Number of obs      =    354772
Group variable: firm_person                     Number of groups   =     39630

R-sq:  within  = 0.0481                         Obs per group: min =         1
       between = 0.0791                                        avg =       9.0
       overall = 0.0637                                        max =        25

                                                F(82,14528)        =     26.07
corr(u_i, Xb)  = 0.1111                         Prob > F           =    0.0000

                                (Std. Err. adjusted for 14,529 clusters in id)
------------------------------------------------------------------------------
             |               Robust
    exporter |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0222613   .0128295     1.74   0.083     -.002886    .0474087
   during_DD |  -.0082259   .0035819    -2.30   0.022    -.0152468   -.0012049
   during_DE |   .0333417   .0176384     1.89   0.059    -.0012317    .0679152
   during_ED |   .0068981    .015248     0.45   0.651    -.0229899    .0367861
   during_EE |   .0255425   .0191924     1.33   0.183    -.0120771    .0631622
    after_DD |    -.02055   .0062206    -3.30   0.001    -.0327431   -.0083568
    after_DE |    .009262   .0217585     0.43   0.670    -.0333876    .0519115
    after_ED |  -.0267981   .0191952    -1.40   0.163    -.0644232     .010827
    after_EE |   .0150849   .0244429     0.62   0.537    -.0328264    .0629962
             |
    ind_year |
          2  |  -.0174427   .0103593    -1.68   0.092    -.0377482    .0028629
          3  |  -.0351797   .0125064    -2.81   0.005    -.0596938   -.0106656
          4  |  -.0442405   .0133461    -3.31   0.001    -.0704007   -.0180804
          5  |  -.0363036   .0148102    -2.45   0.014    -.0653334   -.0072737
          6  |  -.0452329   .0159499    -2.84   0.005    -.0764967   -.0139691
          7  |  -.0500685   .0171866    -2.91   0.004    -.0837564   -.0163806
          8  |  -.0606517   .0183271    -3.31   0.001     -.096575   -.0247283
          9  |  -.0633006   .0197881    -3.20   0.001    -.1020878   -.0245133
         10  |  -.0631717    .021114    -2.99   0.003    -.1045578   -.0217855
         11  |    -.07066   .0225678    -3.13   0.002    -.1148958   -.0264243
         12  |  -.0716181   .0239411    -2.99   0.003    -.1185457   -.0246904
         13  |  -.0663744   .0255114    -2.60   0.009    -.1163799   -.0163689
         14  |  -.0582034   .0270975    -2.15   0.032     -.111318   -.0050887
         15  |  -.0480815   .0286214    -1.68   0.093     -.104183      .00802
         16  |  -.0350917   .0301261    -1.16   0.244    -.0941427    .0239594
         17  |  -.0203775   .0317243    -0.64   0.521    -.0825613    .0418062
         18  |  -.0165928   .0334012    -0.50   0.619    -.0820635    .0488778
         19  |   -.011814   .0349782    -0.34   0.736    -.0803757    .0567476
         20  |  -.0048402   .0364479    -0.13   0.894    -.0762827    .0666024
         21  |   -.010564   .0378741    -0.28   0.780     -.084802    .0636741
         22  |  -.0038517   .0391979    -0.10   0.922    -.0806847    .0729812
         23  |  -.0076987   .0405842    -0.19   0.850    -.0872489    .0718515
         24  |  -.1164259   .0419989    -2.77   0.006    -.1987491   -.0341026
         25  |   -.151681   .0435767    -3.48   0.001    -.2370969   -.0662652
         26  |  -.0180649   .0253112    -0.71   0.475    -.0676781    .0315482
         27  |  -.0132428   .0223479    -0.59   0.553    -.0570475    .0305619
         28  |    .008257   .0216415     0.38   0.703     -.034163     .050677
         29  |   .0058793   .0213486     0.28   0.783    -.0359667    .0477253
         30  |   .0250196    .021304     1.17   0.240    -.0167389    .0667781
         31  |   .0181889   .0214899     0.85   0.397     -.023934    .0603117
         32  |    .024515   .0220276     1.11   0.266    -.0186618    .0676918
         33  |   .0154815   .0226423     0.68   0.494    -.0289003    .0598632
         34  |     .01533   .0235737     0.65   0.516    -.0308775    .0615374
         35  |   .0262896   .0244712     1.07   0.283     -.021677    .0742563
         36  |   .0263028   .0257795     1.02   0.308    -.0242283    .0768339
         37  |   .0172161   .0269731     0.64   0.523    -.0356546    .0700867
         38  |   .0134274   .0281355     0.48   0.633    -.0417217    .0685765
         39  |   .0175736   .0295926     0.59   0.553    -.0404316    .0755788
         40  |   .0292092    .030794     0.95   0.343    -.0311509    .0895693
         41  |    .045304   .0321455     1.41   0.159    -.0177052    .1083132
         42  |   .0528593   .0335379     1.58   0.115    -.0128791    .1185978
         43  |   .0541699   .0351354     1.54   0.123       -.0147    .1230398
         44  |   .0741899    .036736     2.02   0.043     .0021827    .1461971
         45  |   .0809074   .0382355     2.12   0.034     .0059609    .1558539
         46  |   .0829017   .0398636     2.08   0.038      .004764    .1610395
         47  |   .0944222   .0410672     2.30   0.022     .0139252    .1749191
         48  |   .0845485   .0421171     2.01   0.045     .0019935    .1671034
         49  |  -.1998722   .0437523    -4.57   0.000    -.2856323   -.1141121
         50  |  -.2507117   .0453503    -5.53   0.000     -.339604   -.1618194
             |
     age_cat |
          1  |   .0470442   .0069139     6.80   0.000     .0334921    .0605963
          2  |   .0666071   .0079187     8.41   0.000     .0510854    .0821287
          3  |    .084485   .0090393     9.35   0.000     .0667668    .1022032
          4  |   .1072542   .0103855    10.33   0.000     .0868973    .1276112
          5  |   .1255192   .0117797    10.66   0.000     .1024295    .1486089
          6  |   .1373487   .0133401    10.30   0.000     .1112004    .1634969
          7  |   .1447764   .0149073     9.71   0.000     .1155561    .1739967
          8  |   .1610769   .0165556     9.73   0.000     .1286258     .193528
          9  |   .1621339   .0181767     8.92   0.000     .1265053    .1977625
         10  |   .1671328   .0198363     8.43   0.000     .1282511    .2060145
         11  |   .1760729   .0214681     8.20   0.000     .1339927    .2181532
         12  |    .178231   .0231152     7.71   0.000     .1329222    .2235397
         13  |   .1883616   .0248467     7.58   0.000     .1396589    .2370642
         14  |   .1976403   .0265835     7.43   0.000     .1455332    .2497474
         15  |   .2059527   .0282429     7.29   0.000     .1505931    .2613122
         16  |   .2112014   .0299445     7.05   0.000     .1525064    .2698963
         17  |   .2160999   .0315879     6.84   0.000     .1541836    .2780163
         18  |   .2224335   .0334623     6.65   0.000     .1568431    .2880239
         19  |    .213844   .0353386     6.05   0.000     .1445758    .2831122
         20  |    .224624   .0383463     5.86   0.000     .1494604    .2997876
         25  |   .2459197   .0442292     5.56   0.000     .1592249    .3326145
         30  |   .2454696    .062224     3.94   0.000     .1235026    .3674366
         40  |   .2303503   .0695872     3.31   0.001     .0939504    .3667501
         50  |   .1713635   .0733727     2.34   0.020     .0275438    .3151833
             |
       _cons |   .2017384   .0151209    13.34   0.000     .1720996    .2313773
-------------+----------------------------------------------------------------
     sigma_u |  .38696273
     sigma_e |  .28647726
         rho |  .64596246   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. local fmt "%10.5f"

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }
key: R2_within
value: .0480551965106106

. 
. estimates

--------------------------------------------------------------------------------------------------------------------------------
active results
--------------------------------------------------------------------------------------------------------------------------------

Fixed-effects (within) regression               Number of obs     =    354,772
Group variable: firm_person                     Number of groups  =     39,630

R-sq:                                           Obs per group:
     within  = 0.0481                                         min =          1
     between = 0.0791                                         avg =        9.0
     overall = 0.0637                                         max =         25

                                                F(82,14528)       =      26.07
corr(u_i, Xb)  = 0.1111                         Prob > F          =     0.0000

                                (Std. Err. adjusted for 14,529 clusters in id)
------------------------------------------------------------------------------
             |               Robust
    exporter |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0222613   .0128295     1.74   0.083     -.002886    .0474087
   during_DD |  -.0082259   .0035819    -2.30   0.022    -.0152468   -.0012049
   during_DE |   .0333417   .0176384     1.89   0.059    -.0012317    .0679152
   during_ED |   .0068981    .015248     0.45   0.651    -.0229899    .0367861
   during_EE |   .0255425   .0191924     1.33   0.183    -.0120771    .0631622
    after_DD |    -.02055   .0062206    -3.30   0.001    -.0327431   -.0083568
    after_DE |    .009262   .0217585     0.43   0.670    -.0333876    .0519115
    after_ED |  -.0267981   .0191952    -1.40   0.163    -.0644232     .010827
    after_EE |   .0150849   .0244429     0.62   0.537    -.0328264    .0629962
             |
    ind_year |
          2  |  -.0174427   .0103593    -1.68   0.092    -.0377482    .0028629
          3  |  -.0351797   .0125064    -2.81   0.005    -.0596938   -.0106656
          4  |  -.0442405   .0133461    -3.31   0.001    -.0704007   -.0180804
          5  |  -.0363036   .0148102    -2.45   0.014    -.0653334   -.0072737
          6  |  -.0452329   .0159499    -2.84   0.005    -.0764967   -.0139691
          7  |  -.0500685   .0171866    -2.91   0.004    -.0837564   -.0163806
          8  |  -.0606517   .0183271    -3.31   0.001     -.096575   -.0247283
          9  |  -.0633006   .0197881    -3.20   0.001    -.1020878   -.0245133
         10  |  -.0631717    .021114    -2.99   0.003    -.1045578   -.0217855
         11  |    -.07066   .0225678    -3.13   0.002    -.1148958   -.0264243
         12  |  -.0716181   .0239411    -2.99   0.003    -.1185457   -.0246904
         13  |  -.0663744   .0255114    -2.60   0.009    -.1163799   -.0163689
         14  |  -.0582034   .0270975    -2.15   0.032     -.111318   -.0050887
         15  |  -.0480815   .0286214    -1.68   0.093     -.104183      .00802
         16  |  -.0350917   .0301261    -1.16   0.244    -.0941427    .0239594
         17  |  -.0203775   .0317243    -0.64   0.521    -.0825613    .0418062
         18  |  -.0165928   .0334012    -0.50   0.619    -.0820635    .0488778
         19  |   -.011814   .0349782    -0.34   0.736    -.0803757    .0567476
         20  |  -.0048402   .0364479    -0.13   0.894    -.0762827    .0666024
         21  |   -.010564   .0378741    -0.28   0.780     -.084802    .0636741
         22  |  -.0038517   .0391979    -0.10   0.922    -.0806847    .0729812
         23  |  -.0076987   .0405842    -0.19   0.850    -.0872489    .0718515
         24  |  -.1164259   .0419989    -2.77   0.006    -.1987491   -.0341026
         25  |   -.151681   .0435767    -3.48   0.001    -.2370969   -.0662652
         26  |  -.0180649   .0253112    -0.71   0.475    -.0676781    .0315482
         27  |  -.0132428   .0223479    -0.59   0.553    -.0570475    .0305619
         28  |    .008257   .0216415     0.38   0.703     -.034163     .050677
         29  |   .0058793   .0213486     0.28   0.783    -.0359667    .0477253
         30  |   .0250196    .021304     1.17   0.240    -.0167389    .0667781
         31  |   .0181889   .0214899     0.85   0.397     -.023934    .0603117
         32  |    .024515   .0220276     1.11   0.266    -.0186618    .0676918
         33  |   .0154815   .0226423     0.68   0.494    -.0289003    .0598632
         34  |     .01533   .0235737     0.65   0.516    -.0308775    .0615374
         35  |   .0262896   .0244712     1.07   0.283     -.021677    .0742563
         36  |   .0263028   .0257795     1.02   0.308    -.0242283    .0768339
         37  |   .0172161   .0269731     0.64   0.523    -.0356546    .0700867
         38  |   .0134274   .0281355     0.48   0.633    -.0417217    .0685765
         39  |   .0175736   .0295926     0.59   0.553    -.0404316    .0755788
         40  |   .0292092    .030794     0.95   0.343    -.0311509    .0895693
         41  |    .045304   .0321455     1.41   0.159    -.0177052    .1083132
         42  |   .0528593   .0335379     1.58   0.115    -.0128791    .1185978
         43  |   .0541699   .0351354     1.54   0.123       -.0147    .1230398
         44  |   .0741899    .036736     2.02   0.043     .0021827    .1461971
         45  |   .0809074   .0382355     2.12   0.034     .0059609    .1558539
         46  |   .0829017   .0398636     2.08   0.038      .004764    .1610395
         47  |   .0944222   .0410672     2.30   0.022     .0139252    .1749191
         48  |   .0845485   .0421171     2.01   0.045     .0019935    .1671034
         49  |  -.1998722   .0437523    -4.57   0.000    -.2856323   -.1141121
         50  |  -.2507117   .0453503    -5.53   0.000     -.339604   -.1618194
             |
     age_cat |
          1  |   .0470442   .0069139     6.80   0.000     .0334921    .0605963
          2  |   .0666071   .0079187     8.41   0.000     .0510854    .0821287
          3  |    .084485   .0090393     9.35   0.000     .0667668    .1022032
          4  |   .1072542   .0103855    10.33   0.000     .0868973    .1276112
          5  |   .1255192   .0117797    10.66   0.000     .1024295    .1486089
          6  |   .1373487   .0133401    10.30   0.000     .1112004    .1634969
          7  |   .1447764   .0149073     9.71   0.000     .1155561    .1739967
          8  |   .1610769   .0165556     9.73   0.000     .1286258     .193528
          9  |   .1621339   .0181767     8.92   0.000     .1265053    .1977625
         10  |   .1671328   .0198363     8.43   0.000     .1282511    .2060145
         11  |   .1760729   .0214681     8.20   0.000     .1339927    .2181532
         12  |    .178231   .0231152     7.71   0.000     .1329222    .2235397
         13  |   .1883616   .0248467     7.58   0.000     .1396589    .2370642
         14  |   .1976403   .0265835     7.43   0.000     .1455332    .2497474
         15  |   .2059527   .0282429     7.29   0.000     .1505931    .2613122
         16  |   .2112014   .0299445     7.05   0.000     .1525064    .2698963
         17  |   .2160999   .0315879     6.84   0.000     .1541836    .2780163
         18  |   .2224335   .0334623     6.65   0.000     .1568431    .2880239
         19  |    .213844   .0353386     6.05   0.000     .1445758    .2831122
         20  |    .224624   .0383463     5.86   0.000     .1494604    .2997876
         25  |   .2459197   .0442292     5.56   0.000     .1592249    .3326145
         30  |   .2454696    .062224     3.94   0.000     .1235026    .3674366
         40  |   .2303503   .0695872     3.31   0.001     .0939504    .3667501
         50  |   .1713635   .0733727     2.34   0.020     .0275438    .3151833
             |
       _cons |   .2017384   .0151209    13.34   0.000     .1720996    .2313773
-------------+----------------------------------------------------------------
     sigma_u |  .38696273
     sigma_e |  .28647726
         rho |  .64596246   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text replace

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b', "`fmt'")) _newline
  6.         file write `output' ("   standard_error: " + string(`se', "`fmt'")) _newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se', "`fmt'")) _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',"pvalue"),colnumb(`coefs',"`X'")]), "`fmt'") _
> newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file

. local fname = e(depvar)

. local title : variable label `fname'

. 
. slopegraph, ///
>         from(0 0 0 0 1 _b[during_DE] 1 _b[during_DE]) ///
>         to(1 _b[during_DD] 1 _b[during_DE] 2 _b[during_ED]+_b[during_DE] 2 _b[during_EE]+_b[during_DE]) ///
>         style(p1 p2 p1 p2) ///
>         label(Local-Local Local-Expat Expat-Local Expat-Expat) ///
>         width_test(during_DD during_DE during_ED during_EE) ///
>         star_test(1==1 during_DE==during_DD 1==1 during_EE==during_ED) ///
>         connect(stepstair) ///
>         format(scheme(538w) xlabel(none) xtitle("") ytitle("") title(`title') legend(off) aspect(.5) plotregion(style(none)) x
> size(16) ysize(10))
number of observations (_N) was 0, now 8
(8 missing values generated)
(8 missing values generated)
(8 missing values generated)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
variable label was str1 now str11
(1 real change made)

 ( 1)  during_DD = 0

       F(  1, 14528) =    5.27
            Prob > F =    0.0217

 ( 1) = 0
       Constraint 1 dropped

       F(  0, 14528) =       .
            Prob > F =         .
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

 ( 1)  during_DE = 0

       F(  1, 14528) =    3.57
            Prob > F =    0.0587

 ( 1)  - during_DD + during_DE = 0

       F(  1, 14528) =    5.44
            Prob > F =    0.0197
variable label was str11 now str13
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

 ( 1)  during_ED = 0

       F(  1, 14528) =    0.20
            Prob > F =    0.6510

 ( 1) = 0
       Constraint 1 dropped

       F(  0, 14528) =       .
            Prob > F =         .
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

 ( 1)  during_EE = 0

       F(  1, 14528) =    1.77
            Prob > F =    0.1833

 ( 1)  - during_ED + during_EE = 0

       F(  1, 14528) =    0.62
            Prob > F =    0.4298

. 
. graph export output/figure/`fname'_tree.png, width(1600) replace
(file output/figure/exporter_tree.png written in PNG format)

. 
end of do-file

. 
end of do-file

. 
. log close
      name:  <unnamed>
       log:  /Users/koren/Google Drive/Research/expat/research_design/talk/output/estimate_switch.log
  log type:  text
 closed on:   7 Jan 2019, 18:11:26
--------------------------------------------------------------------------------------------------------------------------------
