----------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/koren/Google Drive/Research/expat/research_design/talk/output/
> estimate_selection.log
  log type:  text
 opened on:  12 Jan 2019, 13:14:46

. 
. 
. use temp/analysis_sample

. 
. *Dinamika
. scalar Tbefore = 4

. scalar Tduring = 6

. scalar Tafter = 4

. 
. gen byte analysis_window = (tenure>=-Tbefore-1)&(year-first_exit_year<=Tafter)

. 
. global sample_baseline (analysis_window==1)

. global sample_manufacturing $sample_baseline & (manufacturing==1)

. global sample_acquisitions $sample_baseline & (greenfield==0)

. global sample_1990s $sample_acquisitions & (enter_year>=1994 & enter_year<=1999)

. global sample_2000s $sample_acquisitions & (enter_year>=2000)

. global sample_ever_foreign $sample_acquisitions & (ever_foreign==1)

. 
. global samples baseline acquisitions

. 
. global outcomes lnL lnKL lnQL exporter

. global controls foreign i.ind_year i.age_cat

. 
. label var lnL "Employment (log)"

. label var lnKL "Capital per worker (log)"

. label var lnQL "Revenue per worker (log)"

. label var exporter "Firm is an exporter (dummy)"

. 
. egen person_tag = tag(frame_id manager_id)

. egen N = sum(person_tag), by(frame_id)

. gen inverse_weight = 1/N

. 
. * verify founders are not in analysis sample
. foreach X of var during* after* {
  2.         replace `X'=0 if founder==1
  3. }
(0 real changes made)
(156,736 real changes made)
(65,411 real changes made)
(81,861 real changes made)
(90,563 real changes made)
(55,334 real changes made)
(105,536 real changes made)
(120,373 real changes made)
(113,200 real changes made)
(17,142 real changes made)
(8,638 real changes made)
(11,993 real changes made)
(11,964 real changes made)
(13,320 real changes made)
(10,192 real changes made)
(11,047 real changes made)
(14,421 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(113,142 real changes made)
(60,285 real changes made)
(57,025 real changes made)
(57,563 real changes made)
(52,066 real changes made)
(74,086 real changes made)
(95,636 real changes made)
(49,280 real changes made)
(20,382 real changes made)
(11,540 real changes made)
(15,163 real changes made)
(13,699 real changes made)
(15,828 real changes made)
(12,017 real changes made)
(15,255 real changes made)
(9,788 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)

. 
. xtset firm_person year
       panel variable:  firm_person (unbalanced)
        time variable:  year, 1992 to 2016, but with gaps
                delta:  1 unit

. 
. do est_`1'

. xtset firm_person year
       panel variable:  firm_person (unbalanced)
        time variable:  year, 1992 to 2016, but with gaps
                delta:  1 unit

. 
. gen byte Fexpat = F.expat==1 if !missing(F.expat)
(89,946 missing values generated)

. 
. keep if $sample_baseline & tenure == -1 & !missing(lag_expat)
(876,325 observations deleted)

. 
. reg Fexpat $outcomes foreign i.ind_year i.age_cat , vce(cluster frame_id)

Linear regression                               Number of obs     =     31,482
                                                F(76, 12052)      =      98.33
                                                Prob > F          =     0.0000
                                                R-squared         =     0.4041
                                                Root MSE          =     .31122

                          (Std. Err. adjusted for 12,053 clusters in frame_id)
------------------------------------------------------------------------------
             |               Robust
      Fexpat |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         lnL |   .0073963   .0020712     3.57   0.000     .0033364    .0114563
        lnKL |   .0040782   .0015122     2.70   0.007     .0011139    .0070424
        lnQL |   .0061874   .0022376     2.77   0.006     .0018012    .0105735
    exporter |   .0312457    .005408     5.78   0.000     .0206452    .0418462
     foreign |   .4839156   .0068799    70.34   0.000       .47043    .4974013
             |
    ind_year |
          2  |  -.0030669   .0193845    -0.16   0.874    -.0410636    .0349298
          3  |  -.0038875   .0195696    -0.20   0.843    -.0422471    .0344721
          4  |   .0024486   .0190948     0.13   0.898    -.0349802    .0398774
          5  |   .0304796   .0187536     1.63   0.104    -.0062805    .0672396
          6  |   .0298301   .0187911     1.59   0.112    -.0070035    .0666636
          7  |   .0441767   .0189515     2.33   0.020     .0070288    .0813247
          8  |    .031335    .018614     1.68   0.092    -.0051514    .0678214
          9  |   .0319071   .0201341     1.58   0.113     -.007559    .0713733
         10  |   .0275688   .0191389     1.44   0.150    -.0099466    .0650842
         11  |   .0352987   .0189213     1.87   0.062    -.0017901    .0723875
         12  |   .0416234   .0176634     2.36   0.018     .0070002    .0762466
         13  |   .0541709   .0174798     3.10   0.002     .0199077    .0884341
         14  |   .0479342   .0183852     2.61   0.009     .0118961    .0839722
         15  |    .048831   .0178009     2.74   0.006     .0139384    .0837236
         16  |    .056239   .0172889     3.25   0.001       .02235    .0901279
         17  |   .0563464   .0188648     2.99   0.003     .0193683    .0933245
         18  |   .0504903   .0191772     2.63   0.008        .0129    .0880807
         19  |   .0527562   .0184736     2.86   0.004      .016545    .0889674
         20  |   .0550774   .0185006     2.98   0.003     .0188132    .0913416
         21  |   .0579204    .019178     3.02   0.003     .0203283    .0955124
         22  |   .0692393   .0206049     3.36   0.001     .0288503    .1096283
         23  |   .0394466   .0193309     2.04   0.041     .0015549    .0773383
         24  |    .104315   .0198101     5.27   0.000     .0654841    .1431459
         26  |  -.0293595    .026037    -1.13   0.260    -.0803962    .0216771
         27  |  -.0269859     .02317    -1.16   0.244     -.072403    .0184311
         28  |   .0105023   .0240524     0.44   0.662    -.0366443     .057649
         29  |  -.0052642   .0227655    -0.23   0.817    -.0498882    .0393598
         30  |   .0428653   .0224351     1.91   0.056    -.0011112    .0868417
         31  |   .0506388    .022963     2.21   0.027     .0056277      .09565
         32  |    .065865   .0227366     2.90   0.004     .0212976    .1104325
         33  |   .0355914   .0223784     1.59   0.112    -.0082739    .0794567
         34  |   .0683401   .0224684     3.04   0.002     .0242984    .1123818
         35  |   .0611147   .0231305     2.64   0.008     .0157752    .1064543
         36  |   .0848759    .022079     3.84   0.000     .0415976    .1281543
         37  |   .0735028   .0212816     3.45   0.001     .0317874    .1152182
         38  |   .0584846   .0202272     2.89   0.004      .018836    .0981332
         39  |   .0708799   .0218078     3.25   0.001     .0281332    .1136267
         40  |   .0979166   .0224954     4.35   0.000     .0538221    .1420112
         41  |   .0768308    .020656     3.72   0.000     .0363416    .1173199
         42  |   .1045801    .023227     4.50   0.000     .0590514    .1501088
         43  |   .0777496   .0246485     3.15   0.002     .0294347    .1260646
         44  |   .1221333   .0221333     5.52   0.000     .0787485    .1655181
         45  |   .1458509   .0236459     6.17   0.000     .0995011    .1922008
         46  |    .116511   .0234245     4.97   0.000     .0705951    .1624268
         47  |   .0878831   .0266332     3.30   0.001     .0356777    .1400885
         48  |   .1120552   .0244249     4.59   0.000     .0641786    .1599319
         49  |   .1483858   .0250149     5.93   0.000     .0993525    .1974191
             |
     age_cat |
          1  |  -.0136124    .013653    -1.00   0.319    -.0403745    .0131497
          2  |  -5.77e-06    .013496    -0.00   1.000      -.02646    .0264485
          3  |  -.0087891   .0137566    -0.64   0.523    -.0357543    .0181761
          4  |  -.0085905   .0139449    -0.62   0.538    -.0359247    .0187437
          5  |  -.0152905   .0142055    -1.08   0.282    -.0431356    .0125547
          6  |  -.0199234   .0146542    -1.36   0.174     -.048648    .0088013
          7  |  -.0280531   .0149979    -1.87   0.061    -.0574515    .0013452
          8  |  -.0350386   .0151722    -2.31   0.021    -.0647785   -.0052987
          9  |  -.0427646   .0154796    -2.76   0.006    -.0731071   -.0124221
         10  |  -.0545455    .015812    -3.45   0.001    -.0855396   -.0235514
         11  |  -.0405257   .0156134    -2.60   0.009    -.0711304    -.009921
         12  |  -.0429519   .0159184    -2.70   0.007    -.0741545   -.0117493
         13  |  -.0353239   .0160844    -2.20   0.028     -.066852   -.0037958
         14  |  -.0496983   .0166488    -2.99   0.003    -.0823326   -.0170641
         15  |  -.0472665   .0167655    -2.82   0.005    -.0801296   -.0144035
         16  |   -.067549   .0176247    -3.83   0.000    -.1020963   -.0330017
         17  |  -.0626095   .0182296    -3.43   0.001    -.0983424   -.0268766
         18  |  -.0746087   .0190486    -3.92   0.000    -.1119471   -.0372703
         19  |   -.055188   .0203451    -2.71   0.007    -.0950676   -.0153083
         20  |  -.0863238   .0162625    -5.31   0.000     -.118201   -.0544466
         25  |    -.05558   .0223462    -2.49   0.013    -.0993821   -.0117779
         30  |  -.0337331   .0136729    -2.47   0.014    -.0605342    -.006932
         40  |  -.0374701   .0150583    -2.49   0.013    -.0669869   -.0079534
         50  |  -.0462767   .0164191    -2.82   0.005    -.0784608   -.0140925
             |
       _cons |  -.1377968   .0263995    -5.22   0.000     -.189544   -.0860495
------------------------------------------------------------------------------

. do regram output/regression/selection 1 Selection

. args tablefile specname speclabel

. 
. local fmt "%10.5f"

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }

. 
. estimates

----------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------

Linear regression                               Number of obs     =     31,482
                                                F(76, 12052)      =      98.33
                                                Prob > F          =     0.0000
                                                R-squared         =     0.4041
                                                Root MSE          =     .31122

                          (Std. Err. adjusted for 12,053 clusters in frame_id)
------------------------------------------------------------------------------
             |               Robust
      Fexpat |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         lnL |   .0073963   .0020712     3.57   0.000     .0033364    .0114563
        lnKL |   .0040782   .0015122     2.70   0.007     .0011139    .0070424
        lnQL |   .0061874   .0022376     2.77   0.006     .0018012    .0105735
    exporter |   .0312457    .005408     5.78   0.000     .0206452    .0418462
     foreign |   .4839156   .0068799    70.34   0.000       .47043    .4974013
             |
    ind_year |
          2  |  -.0030669   .0193845    -0.16   0.874    -.0410636    .0349298
          3  |  -.0038875   .0195696    -0.20   0.843    -.0422471    .0344721
          4  |   .0024486   .0190948     0.13   0.898    -.0349802    .0398774
          5  |   .0304796   .0187536     1.63   0.104    -.0062805    .0672396
          6  |   .0298301   .0187911     1.59   0.112    -.0070035    .0666636
          7  |   .0441767   .0189515     2.33   0.020     .0070288    .0813247
          8  |    .031335    .018614     1.68   0.092    -.0051514    .0678214
          9  |   .0319071   .0201341     1.58   0.113     -.007559    .0713733
         10  |   .0275688   .0191389     1.44   0.150    -.0099466    .0650842
         11  |   .0352987   .0189213     1.87   0.062    -.0017901    .0723875
         12  |   .0416234   .0176634     2.36   0.018     .0070002    .0762466
         13  |   .0541709   .0174798     3.10   0.002     .0199077    .0884341
         14  |   .0479342   .0183852     2.61   0.009     .0118961    .0839722
         15  |    .048831   .0178009     2.74   0.006     .0139384    .0837236
         16  |    .056239   .0172889     3.25   0.001       .02235    .0901279
         17  |   .0563464   .0188648     2.99   0.003     .0193683    .0933245
         18  |   .0504903   .0191772     2.63   0.008        .0129    .0880807
         19  |   .0527562   .0184736     2.86   0.004      .016545    .0889674
         20  |   .0550774   .0185006     2.98   0.003     .0188132    .0913416
         21  |   .0579204    .019178     3.02   0.003     .0203283    .0955124
         22  |   .0692393   .0206049     3.36   0.001     .0288503    .1096283
         23  |   .0394466   .0193309     2.04   0.041     .0015549    .0773383
         24  |    .104315   .0198101     5.27   0.000     .0654841    .1431459
         26  |  -.0293595    .026037    -1.13   0.260    -.0803962    .0216771
         27  |  -.0269859     .02317    -1.16   0.244     -.072403    .0184311
         28  |   .0105023   .0240524     0.44   0.662    -.0366443     .057649
         29  |  -.0052642   .0227655    -0.23   0.817    -.0498882    .0393598
         30  |   .0428653   .0224351     1.91   0.056    -.0011112    .0868417
         31  |   .0506388    .022963     2.21   0.027     .0056277      .09565
         32  |    .065865   .0227366     2.90   0.004     .0212976    .1104325
         33  |   .0355914   .0223784     1.59   0.112    -.0082739    .0794567
         34  |   .0683401   .0224684     3.04   0.002     .0242984    .1123818
         35  |   .0611147   .0231305     2.64   0.008     .0157752    .1064543
         36  |   .0848759    .022079     3.84   0.000     .0415976    .1281543
         37  |   .0735028   .0212816     3.45   0.001     .0317874    .1152182
         38  |   .0584846   .0202272     2.89   0.004      .018836    .0981332
         39  |   .0708799   .0218078     3.25   0.001     .0281332    .1136267
         40  |   .0979166   .0224954     4.35   0.000     .0538221    .1420112
         41  |   .0768308    .020656     3.72   0.000     .0363416    .1173199
         42  |   .1045801    .023227     4.50   0.000     .0590514    .1501088
         43  |   .0777496   .0246485     3.15   0.002     .0294347    .1260646
         44  |   .1221333   .0221333     5.52   0.000     .0787485    .1655181
         45  |   .1458509   .0236459     6.17   0.000     .0995011    .1922008
         46  |    .116511   .0234245     4.97   0.000     .0705951    .1624268
         47  |   .0878831   .0266332     3.30   0.001     .0356777    .1400885
         48  |   .1120552   .0244249     4.59   0.000     .0641786    .1599319
         49  |   .1483858   .0250149     5.93   0.000     .0993525    .1974191
             |
     age_cat |
          1  |  -.0136124    .013653    -1.00   0.319    -.0403745    .0131497
          2  |  -5.77e-06    .013496    -0.00   1.000      -.02646    .0264485
          3  |  -.0087891   .0137566    -0.64   0.523    -.0357543    .0181761
          4  |  -.0085905   .0139449    -0.62   0.538    -.0359247    .0187437
          5  |  -.0152905   .0142055    -1.08   0.282    -.0431356    .0125547
          6  |  -.0199234   .0146542    -1.36   0.174     -.048648    .0088013
          7  |  -.0280531   .0149979    -1.87   0.061    -.0574515    .0013452
          8  |  -.0350386   .0151722    -2.31   0.021    -.0647785   -.0052987
          9  |  -.0427646   .0154796    -2.76   0.006    -.0731071   -.0124221
         10  |  -.0545455    .015812    -3.45   0.001    -.0855396   -.0235514
         11  |  -.0405257   .0156134    -2.60   0.009    -.0711304    -.009921
         12  |  -.0429519   .0159184    -2.70   0.007    -.0741545   -.0117493
         13  |  -.0353239   .0160844    -2.20   0.028     -.066852   -.0037958
         14  |  -.0496983   .0166488    -2.99   0.003    -.0823326   -.0170641
         15  |  -.0472665   .0167655    -2.82   0.005    -.0801296   -.0144035
         16  |   -.067549   .0176247    -3.83   0.000    -.1020963   -.0330017
         17  |  -.0626095   .0182296    -3.43   0.001    -.0983424   -.0268766
         18  |  -.0746087   .0190486    -3.92   0.000    -.1119471   -.0372703
         19  |   -.055188   .0203451    -2.71   0.007    -.0950676   -.0153083
         20  |  -.0863238   .0162625    -5.31   0.000     -.118201   -.0544466
         25  |    -.05558   .0223462    -2.49   0.013    -.0993821   -.0117779
         30  |  -.0337331   .0136729    -2.47   0.014    -.0605342    -.006932
         40  |  -.0374701   .0150583    -2.49   0.013    -.0669869   -.0079534
         50  |  -.0462767   .0164191    -2.82   0.005    -.0784608   -.0140925
             |
       _cons |  -.1377968   .0263995    -5.22   0.000     -.189544   -.0860495
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text repla
> ce

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b', "`fmt'")) _newline
  6.         file write `output' ("   standard_error: " + string(`se', "`fmt'")) _
> newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se', "`fmt'")) 
> _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',
> "pvalue"),colnumb(`coefs',"`X'")]), "`fmt'") _newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file

. 
. reg Fexpat $outcomes foreign lag_expat i.ind_year i.age_cat, vce(cluster frame_i
> d)

Linear regression                               Number of obs     =     31,482
                                                F(77, 12052)      =     150.82
                                                Prob > F          =     0.0000
                                                R-squared         =     0.4446
                                                Root MSE          =     .30046

                          (Std. Err. adjusted for 12,053 clusters in frame_id)
------------------------------------------------------------------------------
             |               Robust
      Fexpat |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         lnL |   .0050167    .001749     2.87   0.004     .0015883     .008445
        lnKL |   .0026627   .0012709     2.10   0.036     .0001714    .0051539
        lnQL |   .0035684   .0018693     1.91   0.056    -.0000957    .0072326
    exporter |    .022223   .0046144     4.82   0.000     .0131779     .031268
     foreign |   .3471997   .0079288    43.79   0.000      .331658    .3627415
   lag_expat |   .2637244   .0107357    24.57   0.000     .2426808    .2847681
             |
    ind_year |
          2  |  -.0041066   .0191133    -0.21   0.830    -.0415717    .0333586
          3  |  -.0047358    .019628    -0.24   0.809    -.0432097    .0337382
          4  |   .0064443   .0179242     0.36   0.719      -.02869    .0415786
          5  |   .0306968   .0182142     1.69   0.092     -.005006    .0663996
          6  |   .0311837   .0188041     1.66   0.097    -.0056754    .0680429
          7  |   .0355986   .0189545     1.88   0.060    -.0015553    .0727526
          8  |   .0129663   .0180602     0.72   0.473    -.0224345    .0483672
          9  |   .0182654    .019313     0.95   0.344    -.0195911    .0561219
         10  |   .0173832   .0182108     0.95   0.340    -.0183129    .0530793
         11  |   .0233728   .0179113     1.30   0.192    -.0117362    .0584819
         12  |   .0342845   .0166494     2.06   0.039     .0016491      .06692
         13  |   .0432358   .0165134     2.62   0.009     .0108669    .0756047
         14  |   .0355249   .0175372     2.03   0.043     .0011491    .0699006
         15  |   .0348873   .0170916     2.04   0.041     .0013851    .0683895
         16  |   .0418028   .0163539     2.56   0.011     .0097466    .0738591
         17  |   .0491511   .0175789     2.80   0.005     .0146936    .0836085
         18  |   .0373657   .0181049     2.06   0.039     .0018772    .0728543
         19  |   .0369677     .01745     2.12   0.034     .0027629    .0711724
         20  |   .0407325   .0175916     2.32   0.021     .0062501    .0752148
         21  |    .040905   .0182703     2.24   0.025     .0050923    .0767178
         22  |   .0431655   .0190369     2.27   0.023     .0058501    .0804809
         23  |   .0272635   .0180845     1.51   0.132    -.0081851    .0627121
         24  |   .0835567   .0190546     4.39   0.000     .0462067    .1209067
         26  |  -.0237671   .0243044    -0.98   0.328    -.0714077    .0238735
         27  |  -.0046061   .0228557    -0.20   0.840    -.0494069    .0401947
         28  |   .0316793   .0239079     1.33   0.185     -.015184    .0785426
         29  |    .004206   .0223136     0.19   0.850    -.0395322    .0479443
         30  |   .0379251    .022043     1.72   0.085    -.0052827     .081133
         31  |   .0467352   .0215926     2.16   0.030     .0044104    .0890601
         32  |   .0469917   .0212166     2.21   0.027     .0054036    .0885797
         33  |    .023947   .0219089     1.09   0.274    -.0189981     .066892
         34  |   .0500909   .0215924     2.32   0.020     .0077662    .0924156
         35  |   .0464423   .0224764     2.07   0.039     .0023849    .0904997
         36  |   .0607076   .0209389     2.90   0.004     .0196641    .1017512
         37  |    .068453   .0202904     3.37   0.001     .0286804    .1082255
         38  |   .0294414   .0190767     1.54   0.123    -.0079519    .0668348
         39  |   .0449002   .0209471     2.14   0.032     .0038405    .0859599
         40  |   .0710996   .0219181     3.24   0.001     .0281367    .1140626
         41  |   .0533994   .0193215     2.76   0.006     .0155261    .0912726
         42  |   .0820554   .0219349     3.74   0.000     .0390595    .1250514
         43  |   .0389497   .0235177     1.66   0.098    -.0071488    .0850482
         44  |   .1022027   .0219451     4.66   0.000     .0591867    .1452187
         45  |   .1125877   .0226491     4.97   0.000     .0681917    .1569836
         46  |   .0860219   .0221625     3.88   0.000     .0425799    .1294639
         47  |   .0577284     .02485     2.32   0.020     .0090185    .1064383
         48  |   .0890872   .0233742     3.81   0.000       .04327    .1349044
         49  |   .1119254   .0232912     4.81   0.000     .0662708      .15758
             |
     age_cat |
          1  |  -.0089038   .0134414    -0.66   0.508    -.0352512    .0174435
          2  |   .0050572   .0132834     0.38   0.703    -.0209804    .0310947
          3  |  -.0031619   .0134989    -0.23   0.815     -.029622    .0232982
          4  |   .0009034   .0136924     0.07   0.947    -.0259358    .0277427
          5  |  -.0048716   .0139726    -0.35   0.727    -.0322601    .0225169
          6  |  -.0104911   .0141341    -0.74   0.458    -.0381962    .0172141
          7  |  -.0129685   .0144753    -0.90   0.370    -.0413424    .0154054
          8  |  -.0172262   .0148088    -1.16   0.245    -.0462538    .0118014
          9  |  -.0248752   .0149083    -1.67   0.095    -.0540978    .0043474
         10  |  -.0294035   .0154039    -1.91   0.056    -.0595977    .0007906
         11  |  -.0157332    .014605    -1.08   0.281    -.0443614    .0128949
         12  |  -.0231559    .015293    -1.51   0.130    -.0531326    .0068208
         13  |  -.0156696    .015642    -1.00   0.316    -.0463304    .0149911
         14  |  -.0274898   .0160903    -1.71   0.088    -.0590294    .0040498
         15  |  -.0234661   .0158535    -1.48   0.139    -.0545415    .0076093
         16  |  -.0453718   .0167078    -2.72   0.007    -.0781217   -.0126219
         17  |  -.0384602   .0177561    -2.17   0.030     -.073265   -.0036554
         18  |  -.0497216   .0185013    -2.69   0.007     -.085987   -.0134561
         19  |  -.0224445   .0193132    -1.16   0.245    -.0603015    .0154125
         20  |  -.0572958   .0150962    -3.80   0.000    -.0868867   -.0277049
         25  |  -.0382311   .0207056    -1.85   0.065    -.0788173    .0023551
         30  |  -.0180183   .0129986    -1.39   0.166    -.0434976    .0074609
         40  |  -.0192364   .0145606    -1.32   0.186    -.0477776    .0093048
         50  |   -.025762    .015322    -1.68   0.093    -.0557956    .0042715
             |
       _cons |  -.0964847   .0239002    -4.04   0.000    -.1433329   -.0496365
------------------------------------------------------------------------------

. do regram output/regression/selection 2 Persistence

. args tablefile specname speclabel

. 
. local fmt "%10.5f"

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }

. 
. estimates

----------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------

Linear regression                               Number of obs     =     31,482
                                                F(77, 12052)      =     150.82
                                                Prob > F          =     0.0000
                                                R-squared         =     0.4446
                                                Root MSE          =     .30046

                          (Std. Err. adjusted for 12,053 clusters in frame_id)
------------------------------------------------------------------------------
             |               Robust
      Fexpat |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         lnL |   .0050167    .001749     2.87   0.004     .0015883     .008445
        lnKL |   .0026627   .0012709     2.10   0.036     .0001714    .0051539
        lnQL |   .0035684   .0018693     1.91   0.056    -.0000957    .0072326
    exporter |    .022223   .0046144     4.82   0.000     .0131779     .031268
     foreign |   .3471997   .0079288    43.79   0.000      .331658    .3627415
   lag_expat |   .2637244   .0107357    24.57   0.000     .2426808    .2847681
             |
    ind_year |
          2  |  -.0041066   .0191133    -0.21   0.830    -.0415717    .0333586
          3  |  -.0047358    .019628    -0.24   0.809    -.0432097    .0337382
          4  |   .0064443   .0179242     0.36   0.719      -.02869    .0415786
          5  |   .0306968   .0182142     1.69   0.092     -.005006    .0663996
          6  |   .0311837   .0188041     1.66   0.097    -.0056754    .0680429
          7  |   .0355986   .0189545     1.88   0.060    -.0015553    .0727526
          8  |   .0129663   .0180602     0.72   0.473    -.0224345    .0483672
          9  |   .0182654    .019313     0.95   0.344    -.0195911    .0561219
         10  |   .0173832   .0182108     0.95   0.340    -.0183129    .0530793
         11  |   .0233728   .0179113     1.30   0.192    -.0117362    .0584819
         12  |   .0342845   .0166494     2.06   0.039     .0016491      .06692
         13  |   .0432358   .0165134     2.62   0.009     .0108669    .0756047
         14  |   .0355249   .0175372     2.03   0.043     .0011491    .0699006
         15  |   .0348873   .0170916     2.04   0.041     .0013851    .0683895
         16  |   .0418028   .0163539     2.56   0.011     .0097466    .0738591
         17  |   .0491511   .0175789     2.80   0.005     .0146936    .0836085
         18  |   .0373657   .0181049     2.06   0.039     .0018772    .0728543
         19  |   .0369677     .01745     2.12   0.034     .0027629    .0711724
         20  |   .0407325   .0175916     2.32   0.021     .0062501    .0752148
         21  |    .040905   .0182703     2.24   0.025     .0050923    .0767178
         22  |   .0431655   .0190369     2.27   0.023     .0058501    .0804809
         23  |   .0272635   .0180845     1.51   0.132    -.0081851    .0627121
         24  |   .0835567   .0190546     4.39   0.000     .0462067    .1209067
         26  |  -.0237671   .0243044    -0.98   0.328    -.0714077    .0238735
         27  |  -.0046061   .0228557    -0.20   0.840    -.0494069    .0401947
         28  |   .0316793   .0239079     1.33   0.185     -.015184    .0785426
         29  |    .004206   .0223136     0.19   0.850    -.0395322    .0479443
         30  |   .0379251    .022043     1.72   0.085    -.0052827     .081133
         31  |   .0467352   .0215926     2.16   0.030     .0044104    .0890601
         32  |   .0469917   .0212166     2.21   0.027     .0054036    .0885797
         33  |    .023947   .0219089     1.09   0.274    -.0189981     .066892
         34  |   .0500909   .0215924     2.32   0.020     .0077662    .0924156
         35  |   .0464423   .0224764     2.07   0.039     .0023849    .0904997
         36  |   .0607076   .0209389     2.90   0.004     .0196641    .1017512
         37  |    .068453   .0202904     3.37   0.001     .0286804    .1082255
         38  |   .0294414   .0190767     1.54   0.123    -.0079519    .0668348
         39  |   .0449002   .0209471     2.14   0.032     .0038405    .0859599
         40  |   .0710996   .0219181     3.24   0.001     .0281367    .1140626
         41  |   .0533994   .0193215     2.76   0.006     .0155261    .0912726
         42  |   .0820554   .0219349     3.74   0.000     .0390595    .1250514
         43  |   .0389497   .0235177     1.66   0.098    -.0071488    .0850482
         44  |   .1022027   .0219451     4.66   0.000     .0591867    .1452187
         45  |   .1125877   .0226491     4.97   0.000     .0681917    .1569836
         46  |   .0860219   .0221625     3.88   0.000     .0425799    .1294639
         47  |   .0577284     .02485     2.32   0.020     .0090185    .1064383
         48  |   .0890872   .0233742     3.81   0.000       .04327    .1349044
         49  |   .1119254   .0232912     4.81   0.000     .0662708      .15758
             |
     age_cat |
          1  |  -.0089038   .0134414    -0.66   0.508    -.0352512    .0174435
          2  |   .0050572   .0132834     0.38   0.703    -.0209804    .0310947
          3  |  -.0031619   .0134989    -0.23   0.815     -.029622    .0232982
          4  |   .0009034   .0136924     0.07   0.947    -.0259358    .0277427
          5  |  -.0048716   .0139726    -0.35   0.727    -.0322601    .0225169
          6  |  -.0104911   .0141341    -0.74   0.458    -.0381962    .0172141
          7  |  -.0129685   .0144753    -0.90   0.370    -.0413424    .0154054
          8  |  -.0172262   .0148088    -1.16   0.245    -.0462538    .0118014
          9  |  -.0248752   .0149083    -1.67   0.095    -.0540978    .0043474
         10  |  -.0294035   .0154039    -1.91   0.056    -.0595977    .0007906
         11  |  -.0157332    .014605    -1.08   0.281    -.0443614    .0128949
         12  |  -.0231559    .015293    -1.51   0.130    -.0531326    .0068208
         13  |  -.0156696    .015642    -1.00   0.316    -.0463304    .0149911
         14  |  -.0274898   .0160903    -1.71   0.088    -.0590294    .0040498
         15  |  -.0234661   .0158535    -1.48   0.139    -.0545415    .0076093
         16  |  -.0453718   .0167078    -2.72   0.007    -.0781217   -.0126219
         17  |  -.0384602   .0177561    -2.17   0.030     -.073265   -.0036554
         18  |  -.0497216   .0185013    -2.69   0.007     -.085987   -.0134561
         19  |  -.0224445   .0193132    -1.16   0.245    -.0603015    .0154125
         20  |  -.0572958   .0150962    -3.80   0.000    -.0868867   -.0277049
         25  |  -.0382311   .0207056    -1.85   0.065    -.0788173    .0023551
         30  |  -.0180183   .0129986    -1.39   0.166    -.0434976    .0074609
         40  |  -.0192364   .0145606    -1.32   0.186    -.0477776    .0093048
         50  |   -.025762    .015322    -1.68   0.093    -.0557956    .0042715
             |
       _cons |  -.0964847   .0239002    -4.04   0.000    -.1433329   -.0496365
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text repla
> ce

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b', "`fmt'")) _newline
  6.         file write `output' ("   standard_error: " + string(`se', "`fmt'")) _
> newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se', "`fmt'")) 
> _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',
> "pvalue"),colnumb(`coefs',"`X'")]), "`fmt'") _newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file

. 
. reg Fexpat $outcomes foreign i.ind_year i.age_cat if lag_expat==0, vce(cluster f
> rame_id)

Linear regression                               Number of obs     =     24,556
                                                F(76, 10907)      =      32.06
                                                Prob > F          =     0.0000
                                                R-squared         =     0.3141
                                                Root MSE          =     .22626

                          (Std. Err. adjusted for 10,908 clusters in frame_id)
------------------------------------------------------------------------------
             |               Robust
      Fexpat |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         lnL |   .0021197   .0015786     1.34   0.179    -.0009746     .005214
        lnKL |   .0032247   .0011406     2.83   0.005     .0009888    .0054606
        lnQL |  -.0002927   .0016951    -0.17   0.863    -.0036153    .0030299
    exporter |    .024281   .0040843     5.94   0.000      .016275    .0322869
     foreign |   .3499579   .0078046    44.84   0.000     .3346595    .3652563
             |
    ind_year |
          2  |   .0000761   .0152552     0.00   0.996    -.0298268     .029979
          3  |   .0119205   .0155121     0.77   0.442     -.018486    .0423271
          4  |  -.0031544   .0148134    -0.21   0.831    -.0321914    .0258825
          5  |   .0224732    .015722     1.43   0.153    -.0083447    .0532911
          6  |   .0415787   .0161173     2.58   0.010     .0099858    .0731717
          7  |   .0412933   .0157832     2.62   0.009     .0103554    .0722312
          8  |   .0100877    .013987     0.72   0.471    -.0173294    .0375048
          9  |   .0180748   .0161674     1.12   0.264    -.0136163    .0497659
         10  |   .0007371    .014783     0.05   0.960    -.0282403    .0297144
         11  |   .0015078   .0143093     0.11   0.916     -.026541    .0295566
         12  |   .0092619   .0138351     0.67   0.503    -.0178575    .0363812
         13  |    .014808    .013628     1.09   0.277    -.0119054    .0415215
         14  |   .0159428   .0145732     1.09   0.274    -.0126232    .0445088
         15  |   .0227052    .014066     1.61   0.107    -.0048666    .0502771
         16  |   .0103549    .013141     0.79   0.431    -.0154039    .0361136
         17  |   .0070032   .0148804     0.47   0.638     -.022165    .0361715
         18  |   .0018145   .0152687     0.12   0.905     -.028115    .0317439
         19  |   .0060369   .0144707     0.42   0.677    -.0223283    .0344022
         20  |   .0170304   .0142679     1.19   0.233    -.0109373    .0449981
         21  |   .0157173   .0145239     1.08   0.279    -.0127522    .0441868
         22  |  -.0004218   .0154116    -0.03   0.978    -.0306313    .0297878
         23  |  -.0010398   .0146433    -0.07   0.943    -.0297435    .0276638
         24  |   .0498129   .0160379     3.11   0.002     .0183757    .0812502
         26  |  -.0099038   .0196864    -0.50   0.615    -.0484927    .0286851
         27  |   .0071318   .0198208     0.36   0.719    -.0317207    .0459842
         28  |   .0255769   .0216154     1.18   0.237    -.0167933    .0679471
         29  |   .0134457   .0191655     0.70   0.483    -.0241221    .0510136
         30  |   .0293651   .0189029     1.55   0.120    -.0076881    .0664182
         31  |   .0179128   .0187314     0.96   0.339    -.0188041    .0546296
         32  |   .0187474   .0193259     0.97   0.332    -.0191349    .0566297
         33  |   .0203978   .0194245     1.05   0.294    -.0176778    .0584735
         34  |   .0276616   .0187754     1.47   0.141    -.0091417    .0644649
         35  |   .0410732   .0202358     2.03   0.042     .0014074    .0807391
         36  |   .0191598   .0186099     1.03   0.303    -.0173189    .0556386
         37  |   .0310899   .0181823     1.71   0.087    -.0045507    .0667305
         38  |  -.0078812   .0157193    -0.50   0.616    -.0386938    .0229315
         39  |   .0175002   .0175655     1.00   0.319    -.0169314    .0519318
         40  |   .0464927   .0194302     2.39   0.017      .008406    .0845793
         41  |   .0049249   .0159776     0.31   0.758     -.026394    .0362439
         42  |   .0313506   .0198542     1.58   0.114    -.0075672    .0702684
         43  |   .0095052   .0196967     0.48   0.629    -.0291039    .0481144
         44  |    .073121   .0204398     3.58   0.000     .0330553    .1131868
         45  |   .0551226   .0206504     2.67   0.008     .0146441    .0956011
         46  |   .0356889   .0195592     1.82   0.068    -.0026506    .0740285
         47  |   .0051717   .0216048     0.24   0.811    -.0371776     .047521
         48  |   .0470197   .0211817     2.22   0.026     .0054997    .0885397
         49  |   .0433407   .0215581     2.01   0.044      .001083    .0855985
             |
     age_cat |
          1  |  -.0160472   .0104578    -1.53   0.125    -.0365463    .0044519
          2  |  -.0052804   .0105153    -0.50   0.616    -.0258922    .0153315
          3  |   -.014068   .0106613    -1.32   0.187    -.0349661    .0068301
          4  |  -.0078322   .0110358    -0.71   0.478    -.0294643    .0137999
          5  |  -.0018771   .0111936    -0.17   0.867    -.0238185    .0200643
          6  |  -.0223984   .0113375    -1.98   0.048     -.044622   -.0001747
          7  |   -.016556   .0121811    -1.36   0.174    -.0404331    .0073211
          8  |  -.0049639   .0122979    -0.40   0.686      -.02907    .0191423
          9  |  -.0130317   .0121036    -1.08   0.282    -.0367568    .0106935
         10  |  -.0132578   .0130721    -1.01   0.311    -.0388814    .0123659
         11  |  -.0179318   .0122315    -1.47   0.143    -.0419078    .0060441
         12  |  -.0128558   .0125089    -1.03   0.304    -.0373755    .0116639
         13  |   .0007733   .0127351     0.06   0.952    -.0241897    .0257364
         14  |  -.0099095   .0137627    -0.72   0.472     -.036887     .017068
         15  |  -.0161833   .0129713    -1.25   0.212    -.0416093    .0092428
         16  |  -.0277817   .0135113    -2.06   0.040    -.0542662   -.0012972
         17  |   -.002964   .0149119    -0.20   0.842    -.0321941    .0262661
         18  |  -.0174126   .0153681    -1.13   0.257    -.0475369    .0127117
         19  |  -.0130463   .0170504    -0.77   0.444    -.0464681    .0203755
         20  |  -.0250688   .0123574    -2.03   0.043    -.0492916   -.0008459
         25  |  -.0158998   .0170677    -0.93   0.352    -.0493556    .0175561
         30  |  -.0070018   .0099728    -0.70   0.483    -.0265503    .0125466
         40  |  -.0124962   .0121225    -1.03   0.303    -.0362585     .011266
         50  |  -.0112098   .0109309    -1.03   0.305    -.0326364    .0102168
             |
       _cons |  -.0376727   .0204575    -1.84   0.066     -.077773    .0024277
------------------------------------------------------------------------------

. do regram output/regression/selection 3 Local

. args tablefile specname speclabel

. 
. local fmt "%10.5f"

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }

. 
. estimates

----------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------

Linear regression                               Number of obs     =     24,556
                                                F(76, 10907)      =      32.06
                                                Prob > F          =     0.0000
                                                R-squared         =     0.3141
                                                Root MSE          =     .22626

                          (Std. Err. adjusted for 10,908 clusters in frame_id)
------------------------------------------------------------------------------
             |               Robust
      Fexpat |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         lnL |   .0021197   .0015786     1.34   0.179    -.0009746     .005214
        lnKL |   .0032247   .0011406     2.83   0.005     .0009888    .0054606
        lnQL |  -.0002927   .0016951    -0.17   0.863    -.0036153    .0030299
    exporter |    .024281   .0040843     5.94   0.000      .016275    .0322869
     foreign |   .3499579   .0078046    44.84   0.000     .3346595    .3652563
             |
    ind_year |
          2  |   .0000761   .0152552     0.00   0.996    -.0298268     .029979
          3  |   .0119205   .0155121     0.77   0.442     -.018486    .0423271
          4  |  -.0031544   .0148134    -0.21   0.831    -.0321914    .0258825
          5  |   .0224732    .015722     1.43   0.153    -.0083447    .0532911
          6  |   .0415787   .0161173     2.58   0.010     .0099858    .0731717
          7  |   .0412933   .0157832     2.62   0.009     .0103554    .0722312
          8  |   .0100877    .013987     0.72   0.471    -.0173294    .0375048
          9  |   .0180748   .0161674     1.12   0.264    -.0136163    .0497659
         10  |   .0007371    .014783     0.05   0.960    -.0282403    .0297144
         11  |   .0015078   .0143093     0.11   0.916     -.026541    .0295566
         12  |   .0092619   .0138351     0.67   0.503    -.0178575    .0363812
         13  |    .014808    .013628     1.09   0.277    -.0119054    .0415215
         14  |   .0159428   .0145732     1.09   0.274    -.0126232    .0445088
         15  |   .0227052    .014066     1.61   0.107    -.0048666    .0502771
         16  |   .0103549    .013141     0.79   0.431    -.0154039    .0361136
         17  |   .0070032   .0148804     0.47   0.638     -.022165    .0361715
         18  |   .0018145   .0152687     0.12   0.905     -.028115    .0317439
         19  |   .0060369   .0144707     0.42   0.677    -.0223283    .0344022
         20  |   .0170304   .0142679     1.19   0.233    -.0109373    .0449981
         21  |   .0157173   .0145239     1.08   0.279    -.0127522    .0441868
         22  |  -.0004218   .0154116    -0.03   0.978    -.0306313    .0297878
         23  |  -.0010398   .0146433    -0.07   0.943    -.0297435    .0276638
         24  |   .0498129   .0160379     3.11   0.002     .0183757    .0812502
         26  |  -.0099038   .0196864    -0.50   0.615    -.0484927    .0286851
         27  |   .0071318   .0198208     0.36   0.719    -.0317207    .0459842
         28  |   .0255769   .0216154     1.18   0.237    -.0167933    .0679471
         29  |   .0134457   .0191655     0.70   0.483    -.0241221    .0510136
         30  |   .0293651   .0189029     1.55   0.120    -.0076881    .0664182
         31  |   .0179128   .0187314     0.96   0.339    -.0188041    .0546296
         32  |   .0187474   .0193259     0.97   0.332    -.0191349    .0566297
         33  |   .0203978   .0194245     1.05   0.294    -.0176778    .0584735
         34  |   .0276616   .0187754     1.47   0.141    -.0091417    .0644649
         35  |   .0410732   .0202358     2.03   0.042     .0014074    .0807391
         36  |   .0191598   .0186099     1.03   0.303    -.0173189    .0556386
         37  |   .0310899   .0181823     1.71   0.087    -.0045507    .0667305
         38  |  -.0078812   .0157193    -0.50   0.616    -.0386938    .0229315
         39  |   .0175002   .0175655     1.00   0.319    -.0169314    .0519318
         40  |   .0464927   .0194302     2.39   0.017      .008406    .0845793
         41  |   .0049249   .0159776     0.31   0.758     -.026394    .0362439
         42  |   .0313506   .0198542     1.58   0.114    -.0075672    .0702684
         43  |   .0095052   .0196967     0.48   0.629    -.0291039    .0481144
         44  |    .073121   .0204398     3.58   0.000     .0330553    .1131868
         45  |   .0551226   .0206504     2.67   0.008     .0146441    .0956011
         46  |   .0356889   .0195592     1.82   0.068    -.0026506    .0740285
         47  |   .0051717   .0216048     0.24   0.811    -.0371776     .047521
         48  |   .0470197   .0211817     2.22   0.026     .0054997    .0885397
         49  |   .0433407   .0215581     2.01   0.044      .001083    .0855985
             |
     age_cat |
          1  |  -.0160472   .0104578    -1.53   0.125    -.0365463    .0044519
          2  |  -.0052804   .0105153    -0.50   0.616    -.0258922    .0153315
          3  |   -.014068   .0106613    -1.32   0.187    -.0349661    .0068301
          4  |  -.0078322   .0110358    -0.71   0.478    -.0294643    .0137999
          5  |  -.0018771   .0111936    -0.17   0.867    -.0238185    .0200643
          6  |  -.0223984   .0113375    -1.98   0.048     -.044622   -.0001747
          7  |   -.016556   .0121811    -1.36   0.174    -.0404331    .0073211
          8  |  -.0049639   .0122979    -0.40   0.686      -.02907    .0191423
          9  |  -.0130317   .0121036    -1.08   0.282    -.0367568    .0106935
         10  |  -.0132578   .0130721    -1.01   0.311    -.0388814    .0123659
         11  |  -.0179318   .0122315    -1.47   0.143    -.0419078    .0060441
         12  |  -.0128558   .0125089    -1.03   0.304    -.0373755    .0116639
         13  |   .0007733   .0127351     0.06   0.952    -.0241897    .0257364
         14  |  -.0099095   .0137627    -0.72   0.472     -.036887     .017068
         15  |  -.0161833   .0129713    -1.25   0.212    -.0416093    .0092428
         16  |  -.0277817   .0135113    -2.06   0.040    -.0542662   -.0012972
         17  |   -.002964   .0149119    -0.20   0.842    -.0321941    .0262661
         18  |  -.0174126   .0153681    -1.13   0.257    -.0475369    .0127117
         19  |  -.0130463   .0170504    -0.77   0.444    -.0464681    .0203755
         20  |  -.0250688   .0123574    -2.03   0.043    -.0492916   -.0008459
         25  |  -.0158998   .0170677    -0.93   0.352    -.0493556    .0175561
         30  |  -.0070018   .0099728    -0.70   0.483    -.0265503    .0125466
         40  |  -.0124962   .0121225    -1.03   0.303    -.0362585     .011266
         50  |  -.0112098   .0109309    -1.03   0.305    -.0326364    .0102168
             |
       _cons |  -.0376727   .0204575    -1.84   0.066     -.077773    .0024277
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text repla
> ce

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b', "`fmt'")) _newline
  6.         file write `output' ("   standard_error: " + string(`se', "`fmt'")) _
> newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se', "`fmt'")) 
> _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',
> "pvalue"),colnumb(`coefs',"`X'")]), "`fmt'") _newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file

. 
. reg Fexpat $outcomes foreign i.ind_year i.age_cat if lag_expat==1, vce(cluster f
> rame_id)
note: foreign omitted because of collinearity

Linear regression                               Number of obs     =      6,926
                                                F(75, 2482)       =       3.04
                                                Prob > F          =     0.0000
                                                R-squared         =     0.0364
                                                Root MSE          =     .47428

                           (Std. Err. adjusted for 2,483 clusters in frame_id)
------------------------------------------------------------------------------
             |               Robust
      Fexpat |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         lnL |   .0111643   .0055117     2.03   0.043     .0003563    .0219723
        lnKL |   .0002273   .0045195     0.05   0.960    -.0086352    .0090898
        lnQL |   .0163513    .006035     2.71   0.007     .0045172    .0281853
    exporter |   .0192285   .0177775     1.08   0.280    -.0156318    .0540888
     foreign |          0  (omitted)
             |
    ind_year |
          2  |   .0034947   .1363433     0.03   0.980    -.2638637    .2708531
          3  |  -.0430182   .1319885    -0.33   0.745    -.3018372    .2158007
          4  |   .1439239   .1278525     1.13   0.260    -.1067847    .3946325
          5  |   .1589526   .1164509     1.36   0.172    -.0693983    .3873035
          6  |   .0395165   .1187071     0.33   0.739    -.1932587    .2722918
          7  |   .1218051   .1160666     1.05   0.294    -.1057923    .3494024
          8  |   .1425177   .1135033     1.26   0.209    -.0800532    .3650886
          9  |   .1321961    .114705     1.15   0.249    -.0927312    .3571234
         10  |   .1866873   .1159992     1.61   0.108    -.0407779    .4141525
         11  |    .226869    .115344     1.97   0.049     .0006885    .4530494
         12  |   .2513837   .1137581     2.21   0.027     .0283132    .4744542
         13  |   .2777582   .1117713     2.49   0.013     .0585837    .4969327
         14  |   .2065177   .1120609     1.84   0.065    -.0132248    .4262603
         15  |   .1616364   .1141912     1.42   0.157    -.0622835    .3855563
         16  |   .2632863   .1111715     2.37   0.018     .0452878    .4812848
         17  |   .3223141   .1127125     2.86   0.004     .1012939    .5433343
         18  |   .2670392   .1119523     2.39   0.017     .0475096    .4865688
         19  |   .2576126   .1107868     2.33   0.020     .0403684    .4748567
         20  |   .2332337    .113197     2.06   0.039     .0112634     .455204
         21  |   .2221946   .1149362     1.93   0.053     -.003186    .4475753
         22  |   .3004846   .1121011     2.68   0.007     .0806634    .5203058
         23  |   .2492374   .1149188     2.17   0.030     .0238909    .4745839
         24  |   .3338053   .1142399     2.92   0.004     .1097899    .5578207
         26  |  -.0242104   .1457938    -0.17   0.868    -.3101004    .2616796
         27  |  -.0273276   .1318305    -0.21   0.836    -.2858366    .2311815
         28  |   .1281515   .1369668     0.94   0.350    -.1404295    .3967325
         29  |   .0725626   .1241625     0.58   0.559    -.1709102    .3160354
         30  |   .1927857   .1187738     1.62   0.105    -.0401203    .4256917
         31  |   .2776997   .1169194     2.38   0.018     .0484301    .5069694
         32  |    .258321   .1118418     2.31   0.021     .0390082    .4776338
         33  |   .1731421   .1144582     1.51   0.130    -.0513014    .3975856
         34  |   .2504686   .1136247     2.20   0.028     .0276595    .4732777
         35  |   .2038426   .1141584     1.79   0.074    -.0200129     .427698
         36  |   .3024619     .11121     2.72   0.007      .084388    .5205358
         37  |   .3166895   .1129841     2.80   0.005     .0951367    .5382423
         38  |   .2558388   .1108983     2.31   0.021     .0383762    .4733015
         39  |   .2530642   .1117407     2.26   0.024     .0339495    .4721789
         40  |   .2640678   .1125687     2.35   0.019     .0433296     .484806
         41  |   .3126213   .1118064     2.80   0.005     .0933779    .5318647
         42  |   .3249777   .1130317     2.88   0.004     .1033314    .5466239
         43  |   .2668105   .1139365     2.34   0.019     .0433902    .4902308
         44  |   .3144432   .1136463     2.77   0.006      .091592    .5372945
         45  |   .3776069   .1130005     3.34   0.001      .156022    .5991918
         46  |   .3472796   .1137078     3.05   0.002     .1243078    .5702514
         47  |   .3093175   .1166389     2.65   0.008      .080598    .5380371
         48  |   .3303239   .1152114     2.87   0.004     .1044035    .5562442
         49  |   .4089839   .1129413     3.62   0.000      .187515    .6304528
             |
     age_cat |
          1  |   .0301569   .0521424     0.58   0.563    -.0720902    .1324039
          2  |   .0301043   .0516993     0.58   0.560    -.0712739    .1314825
          3  |   .0268736   .0512923     0.52   0.600    -.0737064    .1274537
          4  |   .0270271   .0515444     0.52   0.600    -.0740474    .1281015
          5  |  -.0203086   .0530455    -0.38   0.702    -.1243267    .0837094
          6  |   .0239848   .0525729     0.46   0.648    -.0791065    .1270761
          7  |   -.000347   .0534446    -0.01   0.995    -.1051477    .1044537
          8  |  -.0535462   .0551676    -0.97   0.332    -.1617256    .0546332
          9  |   -.069577   .0555052    -1.25   0.210    -.1784184    .0392643
         10  |  -.0739253   .0559186    -1.32   0.186    -.1835772    .0357265
         11  |   .0039697    .056725     0.07   0.944    -.1072635    .1152029
         12  |  -.0527861   .0573014    -0.92   0.357    -.1651495    .0595773
         13  |  -.0643803   .0576173    -1.12   0.264    -.1773632    .0486026
         14  |  -.0779492   .0572792    -1.36   0.174    -.1902691    .0343707
         15  |  -.0386149   .0585187    -0.66   0.509    -.1533654    .0761357
         16  |  -.0885245   .0600269    -1.47   0.140    -.2062325    .0291836
         17  |  -.1488498   .0620414    -2.40   0.017    -.2705081   -.0271916
         18  |  -.1510984   .0643264    -2.35   0.019    -.2772373   -.0249595
         19  |  -.0381862   .0661225    -0.58   0.564    -.1678471    .0914747
         20  |  -.1535796   .0565072    -2.72   0.007    -.2643857   -.0427734
         25  |  -.1540871   .0764078    -2.02   0.044    -.3039168   -.0042574
         30  |  -.1388304   .1255954    -1.11   0.269     -.385113    .1074522
         40  |  -.1001599   .0968353    -1.03   0.301    -.2900462    .0897265
         50  |  -.0757408    .151672    -0.50   0.618    -.3731574    .2216759
             |
       _cons |   .1963403   .1226927     1.60   0.110    -.0442503    .4369308
------------------------------------------------------------------------------

. do regram output/regression/selection 4 Expat

. args tablefile specname speclabel

. 
. local fmt "%10.5f"

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }

. 
. estimates

----------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------

Linear regression                               Number of obs     =      6,926
                                                F(75, 2482)       =       3.04
                                                Prob > F          =     0.0000
                                                R-squared         =     0.0364
                                                Root MSE          =     .47428

                           (Std. Err. adjusted for 2,483 clusters in frame_id)
------------------------------------------------------------------------------
             |               Robust
      Fexpat |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         lnL |   .0111643   .0055117     2.03   0.043     .0003563    .0219723
        lnKL |   .0002273   .0045195     0.05   0.960    -.0086352    .0090898
        lnQL |   .0163513    .006035     2.71   0.007     .0045172    .0281853
    exporter |   .0192285   .0177775     1.08   0.280    -.0156318    .0540888
     foreign |          0  (omitted)
             |
    ind_year |
          2  |   .0034947   .1363433     0.03   0.980    -.2638637    .2708531
          3  |  -.0430182   .1319885    -0.33   0.745    -.3018372    .2158007
          4  |   .1439239   .1278525     1.13   0.260    -.1067847    .3946325
          5  |   .1589526   .1164509     1.36   0.172    -.0693983    .3873035
          6  |   .0395165   .1187071     0.33   0.739    -.1932587    .2722918
          7  |   .1218051   .1160666     1.05   0.294    -.1057923    .3494024
          8  |   .1425177   .1135033     1.26   0.209    -.0800532    .3650886
          9  |   .1321961    .114705     1.15   0.249    -.0927312    .3571234
         10  |   .1866873   .1159992     1.61   0.108    -.0407779    .4141525
         11  |    .226869    .115344     1.97   0.049     .0006885    .4530494
         12  |   .2513837   .1137581     2.21   0.027     .0283132    .4744542
         13  |   .2777582   .1117713     2.49   0.013     .0585837    .4969327
         14  |   .2065177   .1120609     1.84   0.065    -.0132248    .4262603
         15  |   .1616364   .1141912     1.42   0.157    -.0622835    .3855563
         16  |   .2632863   .1111715     2.37   0.018     .0452878    .4812848
         17  |   .3223141   .1127125     2.86   0.004     .1012939    .5433343
         18  |   .2670392   .1119523     2.39   0.017     .0475096    .4865688
         19  |   .2576126   .1107868     2.33   0.020     .0403684    .4748567
         20  |   .2332337    .113197     2.06   0.039     .0112634     .455204
         21  |   .2221946   .1149362     1.93   0.053     -.003186    .4475753
         22  |   .3004846   .1121011     2.68   0.007     .0806634    .5203058
         23  |   .2492374   .1149188     2.17   0.030     .0238909    .4745839
         24  |   .3338053   .1142399     2.92   0.004     .1097899    .5578207
         26  |  -.0242104   .1457938    -0.17   0.868    -.3101004    .2616796
         27  |  -.0273276   .1318305    -0.21   0.836    -.2858366    .2311815
         28  |   .1281515   .1369668     0.94   0.350    -.1404295    .3967325
         29  |   .0725626   .1241625     0.58   0.559    -.1709102    .3160354
         30  |   .1927857   .1187738     1.62   0.105    -.0401203    .4256917
         31  |   .2776997   .1169194     2.38   0.018     .0484301    .5069694
         32  |    .258321   .1118418     2.31   0.021     .0390082    .4776338
         33  |   .1731421   .1144582     1.51   0.130    -.0513014    .3975856
         34  |   .2504686   .1136247     2.20   0.028     .0276595    .4732777
         35  |   .2038426   .1141584     1.79   0.074    -.0200129     .427698
         36  |   .3024619     .11121     2.72   0.007      .084388    .5205358
         37  |   .3166895   .1129841     2.80   0.005     .0951367    .5382423
         38  |   .2558388   .1108983     2.31   0.021     .0383762    .4733015
         39  |   .2530642   .1117407     2.26   0.024     .0339495    .4721789
         40  |   .2640678   .1125687     2.35   0.019     .0433296     .484806
         41  |   .3126213   .1118064     2.80   0.005     .0933779    .5318647
         42  |   .3249777   .1130317     2.88   0.004     .1033314    .5466239
         43  |   .2668105   .1139365     2.34   0.019     .0433902    .4902308
         44  |   .3144432   .1136463     2.77   0.006      .091592    .5372945
         45  |   .3776069   .1130005     3.34   0.001      .156022    .5991918
         46  |   .3472796   .1137078     3.05   0.002     .1243078    .5702514
         47  |   .3093175   .1166389     2.65   0.008      .080598    .5380371
         48  |   .3303239   .1152114     2.87   0.004     .1044035    .5562442
         49  |   .4089839   .1129413     3.62   0.000      .187515    .6304528
             |
     age_cat |
          1  |   .0301569   .0521424     0.58   0.563    -.0720902    .1324039
          2  |   .0301043   .0516993     0.58   0.560    -.0712739    .1314825
          3  |   .0268736   .0512923     0.52   0.600    -.0737064    .1274537
          4  |   .0270271   .0515444     0.52   0.600    -.0740474    .1281015
          5  |  -.0203086   .0530455    -0.38   0.702    -.1243267    .0837094
          6  |   .0239848   .0525729     0.46   0.648    -.0791065    .1270761
          7  |   -.000347   .0534446    -0.01   0.995    -.1051477    .1044537
          8  |  -.0535462   .0551676    -0.97   0.332    -.1617256    .0546332
          9  |   -.069577   .0555052    -1.25   0.210    -.1784184    .0392643
         10  |  -.0739253   .0559186    -1.32   0.186    -.1835772    .0357265
         11  |   .0039697    .056725     0.07   0.944    -.1072635    .1152029
         12  |  -.0527861   .0573014    -0.92   0.357    -.1651495    .0595773
         13  |  -.0643803   .0576173    -1.12   0.264    -.1773632    .0486026
         14  |  -.0779492   .0572792    -1.36   0.174    -.1902691    .0343707
         15  |  -.0386149   .0585187    -0.66   0.509    -.1533654    .0761357
         16  |  -.0885245   .0600269    -1.47   0.140    -.2062325    .0291836
         17  |  -.1488498   .0620414    -2.40   0.017    -.2705081   -.0271916
         18  |  -.1510984   .0643264    -2.35   0.019    -.2772373   -.0249595
         19  |  -.0381862   .0661225    -0.58   0.564    -.1678471    .0914747
         20  |  -.1535796   .0565072    -2.72   0.007    -.2643857   -.0427734
         25  |  -.1540871   .0764078    -2.02   0.044    -.3039168   -.0042574
         30  |  -.1388304   .1255954    -1.11   0.269     -.385113    .1074522
         40  |  -.1001599   .0968353    -1.03   0.301    -.2900462    .0897265
         50  |  -.0757408    .151672    -0.50   0.618    -.3731574    .2216759
             |
       _cons |   .1963403   .1226927     1.60   0.110    -.0442503    .4369308
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text repla
> ce

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b', "`fmt'")) _newline
  6.         file write `output' ("   standard_error: " + string(`se', "`fmt'")) _
> newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se', "`fmt'")) 
> _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',
> "pvalue"),colnumb(`coefs',"`X'")]), "`fmt'") _newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file

. 
end of do-file

. 
. log close
      name:  <unnamed>
       log:  /Users/koren/Google Drive/Research/expat/research_design/talk/output/
> estimate_selection.log
  log type:  text
 closed on:  12 Jan 2019, 13:15:14
----------------------------------------------------------------------------------
