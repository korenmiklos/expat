----------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/koren/Google Drive/Research/expat/research_design/talk/output/
> estimate_selection.log
  log type:  text
 opened on:   4 Dec 2018, 20:44:36

. 
. 
. use temp/analysis_sample

. 
. *Dinamika
. scalar Tbefore = 4

. scalar Tduring = 6

. scalar Tafter = 4

. 
. gen byte analysis_window = (tenure>=-Tbefore-1)&(year-first_exit_year<=Tafter)

. 
. global sample_baseline (analysis_window==1)

. global sample_manufacturing $sample_baseline & (manufacturing==1)

. global sample_acquisitions $sample_baseline & (greenfield==0)

. 
. global samples baseline acquisitions

. 
. global outcomes lnL lnKL lnQL exporter

. label var lnL "Employment (log)"

. label var lnKL "Capital per worker (log)"

. label var lnQL "Revenue per worker (log)"

. label var exporter "Firm is an exporter (dummy)"

. 
. egen person_tag = tag(frame_id manager_id)

. egen N = sum(person_tag), by(frame_id)

. gen inverse_weight = 1/N

. 
. * verify founders are not in analysis sample
. foreach X of var during* after* {
  2.         replace `X'=0 if founder==1
  3. }
(0 real changes made)
(132,464 real changes made)
(55,048 real changes made)
(73,335 real changes made)
(81,604 real changes made)
(46,715 real changes made)
(88,449 real changes made)
(96,285 real changes made)
(94,584 real changes made)
(20,057 real changes made)
(10,166 real changes made)
(13,405 real changes made)
(13,063 real changes made)
(15,361 real changes made)
(11,994 real changes made)
(13,939 real changes made)
(17,025 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(70,373 real changes made)
(35,951 real changes made)
(37,925 real changes made)
(38,899 real changes made)
(31,710 real changes made)
(44,472 real changes made)
(52,990 real changes made)
(32,396 real changes made)
(32,892 real changes made)
(19,164 real changes made)
(22,477 real changes made)
(19,915 real changes made)
(25,211 real changes made)
(20,097 real changes made)
(27,732 real changes made)
(15,077 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)

. 
. xtset firm_person year
       panel variable:  firm_person (unbalanced)
        time variable:  year, 1992 to 2016, but with gaps
                delta:  1 unit

. 
. do est_`1'

. xtset firm_person year
       panel variable:  firm_person (unbalanced)
        time variable:  year, 1992 to 2016, but with gaps
                delta:  1 unit

. 
. gen byte Fexpat = F.expat==1 if !missing(F.expat)
(73,519 missing values generated)

. 
. keep if $sample_baseline & tenure == -1 & !missing(lag_expat)
(733,443 observations deleted)

. 
. reg Fexpat $outcomes foreign i.ind_year i.age_cat , vce(cluster frame_id)

Linear regression                               Number of obs     =     20,527
                                                F(76, 9918)       =     120.87
                                                Prob > F          =     0.0000
                                                R-squared         =     0.4070
                                                Root MSE          =     .34471

                           (Std. Err. adjusted for 9,919 clusters in frame_id)
------------------------------------------------------------------------------
             |               Robust
      Fexpat |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         lnL |   .0133575    .002584     5.17   0.000     .0082924    .0184226
        lnKL |   .0059986   .0018141     3.31   0.001     .0024427    .0095546
        lnQL |   .0095389   .0027966     3.41   0.001     .0040569    .0150209
    exporter |   .0473611   .0069805     6.78   0.000     .0336779    .0610444
     foreign |    .517421   .0072671    71.20   0.000     .5031761     .531666
             |
    ind_year |
          2  |   .0212906   .0399315     0.53   0.594    -.0569833    .0995645
          3  |  -.0069676   .0384595    -0.18   0.856     -.082356    .0684208
          4  |   -.013861   .0392702    -0.35   0.724    -.0908385    .0631164
          5  |  -.0318245   .0376367    -0.85   0.398       -.1056    .0419511
          6  |  -.0007699   .0362171    -0.02   0.983    -.0717629    .0702231
          7  |  -.0674166   .0355741    -1.90   0.058    -.1371491    .0023159
          8  |  -.0732685   .0333189    -2.20   0.028    -.1385803   -.0079567
          9  |  -.0749876   .0343953    -2.18   0.029    -.1424093   -.0075659
         10  |   -.061984   .0340149    -1.82   0.068    -.1286602    .0046921
         11  |  -.0637692   .0338954    -1.88   0.060     -.130211    .0026726
         12  |  -.0285749   .0330705    -0.86   0.388    -.0933998      .03625
         13  |  -.0365638   .0329291    -1.11   0.267    -.1011115    .0279839
         14  |  -.0354106   .0328368    -1.08   0.281    -.0997775    .0289562
         15  |   -.028464   .0330825    -0.86   0.390    -.0933123    .0363843
         16  |  -.0379072   .0324691    -1.17   0.243    -.1015531    .0257388
         17  |  -.0273159   .0330212    -0.83   0.408    -.0920443    .0374124
         18  |  -.0192066   .0327133    -0.59   0.557    -.0833313     .044918
         19  |  -.0405551   .0328723    -1.23   0.217    -.1049915    .0238814
         20  |  -.0142552   .0327664    -0.44   0.664    -.0784839    .0499736
         21  |  -.0141393   .0333302    -0.42   0.671    -.0794733    .0511948
         22  |  -.0268394   .0344696    -0.78   0.436    -.0944068     .040728
         23  |  -.0481976   .0330962    -1.46   0.145    -.1130728    .0166777
         24  |    .012956   .0339264     0.38   0.703    -.0535467    .0794587
         26  |   -.044376   .0517472    -0.86   0.391     -.145811    .0570591
         27  |  -.0165598   .0429768    -0.39   0.700    -.1008031    .0676836
         28  |   .0474617   .0423212     1.12   0.262    -.0354964    .1304198
         29  |  -.0522736   .0427583    -1.22   0.222    -.1360886    .0315414
         30  |    .008401   .0396801     0.21   0.832    -.0693801    .0861821
         31  |   .0025521   .0389844     0.07   0.948    -.0738652    .0789694
         32  |  -.0228748   .0378772    -0.60   0.546    -.0971218    .0513723
         33  |  -.0665079   .0365535    -1.82   0.069    -.1381602    .0051444
         34  |  -.0405707    .037274    -1.09   0.276    -.1136354    .0324939
         35  |  -.0414196   .0361569    -1.15   0.252    -.1122945    .0294554
         36  |   .0050165   .0368342     0.14   0.892    -.0671859    .0772189
         37  |  -.0100815    .034995    -0.29   0.773    -.0786787    .0585158
         38  |  -.0202657   .0349035    -0.58   0.562    -.0886837    .0481523
         39  |  -.0040893   .0353745    -0.12   0.908    -.0734305    .0652519
         40  |   .0378439   .0356656     1.06   0.289    -.0320679    .1077557
         41  |  -.0093895    .035097    -0.27   0.789    -.0781867    .0594078
         42  |   .0188913   .0367288     0.51   0.607    -.0531046    .0908871
         43  |   .0059908   .0372766     0.16   0.872    -.0670789    .0790604
         44  |   .0340617   .0357033     0.95   0.340     -.035924    .1040475
         45  |   .0500225   .0360647     1.39   0.165    -.0206717    .1207166
         46  |   .0269569   .0370115     0.73   0.466    -.0455932    .0995069
         47  |  -.0012883    .038876    -0.03   0.974    -.0774931    .0749165
         48  |   .0295997   .0363241     0.81   0.415    -.0416028    .1008023
         49  |    .066986   .0367998     1.82   0.069     -.005149     .139121
             |
     age_cat |
          1  |  -.0227988    .016389    -1.39   0.164    -.0549246     .009327
          2  |  -.0143804   .0162738    -0.88   0.377    -.0462805    .0175196
          3  |  -.0201509   .0170303    -1.18   0.237    -.0535338     .013232
          4  |  -.0304794   .0173676    -1.75   0.079    -.0645234    .0035646
          5  |  -.0270966   .0175734    -1.54   0.123    -.0615441    .0073509
          6  |  -.0581746   .0180461    -3.22   0.001    -.0935488   -.0228005
          7  |  -.0540312   .0181163    -2.98   0.003    -.0895429   -.0185195
          8  |  -.0520501   .0181159    -2.87   0.004     -.087561   -.0165392
          9  |  -.0689747   .0187326    -3.68   0.000    -.1056944    -.032255
         10  |  -.0868054   .0191902    -4.52   0.000    -.1244221   -.0491888
         11  |  -.0647092   .0189356    -3.42   0.001    -.1018267   -.0275916
         12  |  -.0788752   .0193565    -4.07   0.000    -.1168178   -.0409326
         13  |  -.0639408   .0195181    -3.28   0.001    -.1022002   -.0256813
         14  |  -.0823624   .0205099    -4.02   0.000     -.122566   -.0421587
         15  |   -.078424   .0202123    -3.88   0.000    -.1180443   -.0388037
         16  |  -.1107415    .021537    -5.14   0.000    -.1529584   -.0685246
         17  |  -.1042908   .0229349    -4.55   0.000    -.1492479   -.0593337
         18  |  -.1173268   .0232668    -5.04   0.000    -.1629344   -.0717192
         19  |  -.1030542   .0236071    -4.37   0.000    -.1493289   -.0567794
         20  |  -.1220146    .019361    -6.30   0.000    -.1599662   -.0840631
         25  |  -.0845007   .0296298    -2.85   0.004    -.1425811   -.0264203
         30  |  -.0596095   .0186926    -3.19   0.001    -.0962508   -.0229681
         40  |  -.0785703   .0225991    -3.48   0.001    -.1228691   -.0342715
         50  |  -.0704225   .0204581    -3.44   0.001    -.1105245   -.0303205
             |
       _cons |  -.1080187   .0399536    -2.70   0.007    -.1863359   -.0297015
------------------------------------------------------------------------------

. do regram output/regression/selection 1 Selection

. args tablefile specname speclabel

. 
. local fmt "%10.5f"

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }

. 
. estimates

----------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------

Linear regression                               Number of obs     =     20,527
                                                F(76, 9918)       =     120.87
                                                Prob > F          =     0.0000
                                                R-squared         =     0.4070
                                                Root MSE          =     .34471

                           (Std. Err. adjusted for 9,919 clusters in frame_id)
------------------------------------------------------------------------------
             |               Robust
      Fexpat |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         lnL |   .0133575    .002584     5.17   0.000     .0082924    .0184226
        lnKL |   .0059986   .0018141     3.31   0.001     .0024427    .0095546
        lnQL |   .0095389   .0027966     3.41   0.001     .0040569    .0150209
    exporter |   .0473611   .0069805     6.78   0.000     .0336779    .0610444
     foreign |    .517421   .0072671    71.20   0.000     .5031761     .531666
             |
    ind_year |
          2  |   .0212906   .0399315     0.53   0.594    -.0569833    .0995645
          3  |  -.0069676   .0384595    -0.18   0.856     -.082356    .0684208
          4  |   -.013861   .0392702    -0.35   0.724    -.0908385    .0631164
          5  |  -.0318245   .0376367    -0.85   0.398       -.1056    .0419511
          6  |  -.0007699   .0362171    -0.02   0.983    -.0717629    .0702231
          7  |  -.0674166   .0355741    -1.90   0.058    -.1371491    .0023159
          8  |  -.0732685   .0333189    -2.20   0.028    -.1385803   -.0079567
          9  |  -.0749876   .0343953    -2.18   0.029    -.1424093   -.0075659
         10  |   -.061984   .0340149    -1.82   0.068    -.1286602    .0046921
         11  |  -.0637692   .0338954    -1.88   0.060     -.130211    .0026726
         12  |  -.0285749   .0330705    -0.86   0.388    -.0933998      .03625
         13  |  -.0365638   .0329291    -1.11   0.267    -.1011115    .0279839
         14  |  -.0354106   .0328368    -1.08   0.281    -.0997775    .0289562
         15  |   -.028464   .0330825    -0.86   0.390    -.0933123    .0363843
         16  |  -.0379072   .0324691    -1.17   0.243    -.1015531    .0257388
         17  |  -.0273159   .0330212    -0.83   0.408    -.0920443    .0374124
         18  |  -.0192066   .0327133    -0.59   0.557    -.0833313     .044918
         19  |  -.0405551   .0328723    -1.23   0.217    -.1049915    .0238814
         20  |  -.0142552   .0327664    -0.44   0.664    -.0784839    .0499736
         21  |  -.0141393   .0333302    -0.42   0.671    -.0794733    .0511948
         22  |  -.0268394   .0344696    -0.78   0.436    -.0944068     .040728
         23  |  -.0481976   .0330962    -1.46   0.145    -.1130728    .0166777
         24  |    .012956   .0339264     0.38   0.703    -.0535467    .0794587
         26  |   -.044376   .0517472    -0.86   0.391     -.145811    .0570591
         27  |  -.0165598   .0429768    -0.39   0.700    -.1008031    .0676836
         28  |   .0474617   .0423212     1.12   0.262    -.0354964    .1304198
         29  |  -.0522736   .0427583    -1.22   0.222    -.1360886    .0315414
         30  |    .008401   .0396801     0.21   0.832    -.0693801    .0861821
         31  |   .0025521   .0389844     0.07   0.948    -.0738652    .0789694
         32  |  -.0228748   .0378772    -0.60   0.546    -.0971218    .0513723
         33  |  -.0665079   .0365535    -1.82   0.069    -.1381602    .0051444
         34  |  -.0405707    .037274    -1.09   0.276    -.1136354    .0324939
         35  |  -.0414196   .0361569    -1.15   0.252    -.1122945    .0294554
         36  |   .0050165   .0368342     0.14   0.892    -.0671859    .0772189
         37  |  -.0100815    .034995    -0.29   0.773    -.0786787    .0585158
         38  |  -.0202657   .0349035    -0.58   0.562    -.0886837    .0481523
         39  |  -.0040893   .0353745    -0.12   0.908    -.0734305    .0652519
         40  |   .0378439   .0356656     1.06   0.289    -.0320679    .1077557
         41  |  -.0093895    .035097    -0.27   0.789    -.0781867    .0594078
         42  |   .0188913   .0367288     0.51   0.607    -.0531046    .0908871
         43  |   .0059908   .0372766     0.16   0.872    -.0670789    .0790604
         44  |   .0340617   .0357033     0.95   0.340     -.035924    .1040475
         45  |   .0500225   .0360647     1.39   0.165    -.0206717    .1207166
         46  |   .0269569   .0370115     0.73   0.466    -.0455932    .0995069
         47  |  -.0012883    .038876    -0.03   0.974    -.0774931    .0749165
         48  |   .0295997   .0363241     0.81   0.415    -.0416028    .1008023
         49  |    .066986   .0367998     1.82   0.069     -.005149     .139121
             |
     age_cat |
          1  |  -.0227988    .016389    -1.39   0.164    -.0549246     .009327
          2  |  -.0143804   .0162738    -0.88   0.377    -.0462805    .0175196
          3  |  -.0201509   .0170303    -1.18   0.237    -.0535338     .013232
          4  |  -.0304794   .0173676    -1.75   0.079    -.0645234    .0035646
          5  |  -.0270966   .0175734    -1.54   0.123    -.0615441    .0073509
          6  |  -.0581746   .0180461    -3.22   0.001    -.0935488   -.0228005
          7  |  -.0540312   .0181163    -2.98   0.003    -.0895429   -.0185195
          8  |  -.0520501   .0181159    -2.87   0.004     -.087561   -.0165392
          9  |  -.0689747   .0187326    -3.68   0.000    -.1056944    -.032255
         10  |  -.0868054   .0191902    -4.52   0.000    -.1244221   -.0491888
         11  |  -.0647092   .0189356    -3.42   0.001    -.1018267   -.0275916
         12  |  -.0788752   .0193565    -4.07   0.000    -.1168178   -.0409326
         13  |  -.0639408   .0195181    -3.28   0.001    -.1022002   -.0256813
         14  |  -.0823624   .0205099    -4.02   0.000     -.122566   -.0421587
         15  |   -.078424   .0202123    -3.88   0.000    -.1180443   -.0388037
         16  |  -.1107415    .021537    -5.14   0.000    -.1529584   -.0685246
         17  |  -.1042908   .0229349    -4.55   0.000    -.1492479   -.0593337
         18  |  -.1173268   .0232668    -5.04   0.000    -.1629344   -.0717192
         19  |  -.1030542   .0236071    -4.37   0.000    -.1493289   -.0567794
         20  |  -.1220146    .019361    -6.30   0.000    -.1599662   -.0840631
         25  |  -.0845007   .0296298    -2.85   0.004    -.1425811   -.0264203
         30  |  -.0596095   .0186926    -3.19   0.001    -.0962508   -.0229681
         40  |  -.0785703   .0225991    -3.48   0.001    -.1228691   -.0342715
         50  |  -.0704225   .0204581    -3.44   0.001    -.1105245   -.0303205
             |
       _cons |  -.1080187   .0399536    -2.70   0.007    -.1863359   -.0297015
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text repla
> ce

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b', "`fmt'")) _newline
  6.         file write `output' ("   standard_error: " + string(`se', "`fmt'")) _
> newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se', "`fmt'")) 
> _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',
> "pvalue"),colnumb(`coefs',"`X'")]), "`fmt'") _newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file

. 
. reg Fexpat $outcomes foreign lag_expat i.ind_year i.age_cat, vce(cluster frame_i
> d)

Linear regression                               Number of obs     =     20,527
                                                F(77, 9918)       =     176.59
                                                Prob > F          =     0.0000
                                                R-squared         =     0.4414
                                                Root MSE          =     .33457

                           (Std. Err. adjusted for 9,919 clusters in frame_id)
------------------------------------------------------------------------------
             |               Robust
      Fexpat |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         lnL |   .0111244   .0021937     5.07   0.000     .0068243    .0154245
        lnKL |   .0038899   .0015626     2.49   0.013     .0008269     .006953
        lnQL |   .0078439   .0023631     3.32   0.001     .0032118     .012476
    exporter |   .0372103   .0060479     6.15   0.000     .0253553    .0490654
     foreign |    .378321   .0088583    42.71   0.000     .3609571     .395685
   lag_expat |   .2456533   .0110782    22.17   0.000     .2239378    .2673687
             |
    ind_year |
          2  |   .0319498   .0413504     0.77   0.440    -.0491054     .113005
          3  |    .003726    .039369     0.09   0.925    -.0734452    .0808972
          4  |  -.0039614   .0398519    -0.10   0.921    -.0820793    .0741565
          5  |  -.0259428   .0381057    -0.68   0.496    -.1006377     .048752
          6  |    .011593   .0374225     0.31   0.757    -.0617628    .0849488
          7  |  -.0513688   .0359708    -1.43   0.153    -.1218788    .0191412
          8  |  -.0554696   .0336175    -1.65   0.099    -.1213667    .0104275
          9  |   -.050982   .0345128    -1.48   0.140    -.1186342    .0166701
         10  |  -.0334182   .0338644    -0.99   0.324    -.0997993    .0329628
         11  |  -.0333589   .0335961    -0.99   0.321     -.099214    .0324963
         12  |   .0012444   .0329688     0.04   0.970    -.0633812      .06587
         13  |  -.0064354   .0328141    -0.20   0.845    -.0707578     .057887
         14  |  -.0062224   .0327286    -0.19   0.849    -.0703772    .0579324
         15  |  -.0048862   .0330534    -0.15   0.882    -.0696776    .0599052
         16  |  -.0128784    .032384    -0.40   0.691    -.0763576    .0506009
         17  |   .0065418   .0327805     0.20   0.842    -.0577147    .0707983
         18  |    .004326   .0324931     0.13   0.894    -.0593671    .0680192
         19  |  -.0144596   .0326862    -0.44   0.658    -.0785312    .0496119
         20  |   .0129322    .032611     0.40   0.692    -.0509921    .0768565
         21  |   .0073252   .0331736     0.22   0.825    -.0577019    .0723522
         22  |  -.0079307   .0340125    -0.23   0.816     -.074602    .0587406
         23  |  -.0198829   .0329101    -0.60   0.546    -.0843934    .0446277
         24  |   .0318271   .0337335     0.94   0.345    -.0342975    .0979517
         26  |  -.0535326   .0526911    -1.02   0.310    -.1568178    .0497527
         27  |  -.0038405   .0440218    -0.09   0.930    -.0901321    .0824511
         28  |    .051826   .0424914     1.22   0.223    -.0314659    .1351178
         29  |   -.037139   .0431473    -0.86   0.389    -.1217166    .0474385
         30  |   .0150797   .0399243     0.38   0.706      -.06318    .0933394
         31  |   .0122973   .0391375     0.31   0.753    -.0644202    .0890147
         32  |  -.0172818   .0376579    -0.46   0.646    -.0910989    .0565354
         33  |  -.0481655    .036625    -1.32   0.189    -.1199579     .023627
         34  |  -.0232597   .0372331    -0.62   0.532    -.0962442    .0497248
         35  |  -.0129015   .0363744    -0.35   0.723    -.0842028    .0583997
         36  |   .0225898    .036331     0.62   0.534    -.0486263    .0938059
         37  |   .0154336   .0349033     0.44   0.658     -.052984    .0838512
         38  |  -.0100114   .0344767    -0.29   0.772    -.0775928    .0575699
         39  |   .0154404   .0352427     0.44   0.661    -.0536424    .0845232
         40  |   .0556918   .0354762     1.57   0.116    -.0138488    .1252324
         41  |   .0097724   .0347985     0.28   0.779    -.0584397    .0779844
         42  |   .0359929   .0364809     0.99   0.324     -.035517    .1075028
         43  |   .0121101    .036806     0.33   0.742    -.0600371    .0842573
         44  |    .052653   .0355197     1.48   0.138    -.0169728    .1222788
         45  |   .0613717   .0357843     1.72   0.086    -.0087728    .1315163
         46  |   .0341128   .0367452     0.93   0.353    -.0379152    .1061409
         47  |   .0164748   .0381153     0.43   0.666    -.0582389    .0911886
         48  |   .0492654    .036035     1.37   0.172    -.0213705    .1199013
         49  |   .0729502   .0363325     2.01   0.045      .001731    .1441693
             |
     age_cat |
          1  |  -.0197309   .0162991    -1.21   0.226    -.0516804    .0122186
          2  |  -.0113792   .0161455    -0.70   0.481    -.0430277    .0202693
          3  |  -.0191094   .0168734    -1.13   0.257    -.0521847     .013966
          4  |  -.0234087   .0172116    -1.36   0.174    -.0571469    .0103295
          5  |  -.0240643   .0174202    -1.38   0.167    -.0582113    .0100828
          6  |   -.050695   .0176526    -2.87   0.004    -.0852978   -.0160923
          7  |  -.0435292   .0177226    -2.46   0.014    -.0782691   -.0087892
          8  |  -.0363146   .0177041    -2.05   0.040    -.0710181    -.001611
          9  |  -.0546204   .0182886    -2.99   0.003    -.0904698   -.0187711
         10  |   -.065849   .0186417    -3.53   0.000    -.1023905   -.0293074
         11  |   -.044129    .018186    -2.43   0.015    -.0797772   -.0084807
         12  |  -.0624968   .0187151    -3.34   0.001    -.0991823   -.0258113
         13  |  -.0470715   .0190105    -2.48   0.013     -.084336    -.009807
         14  |  -.0645893   .0197778    -3.27   0.001    -.1033579   -.0258207
         15  |  -.0581987   .0194179    -3.00   0.003    -.0962618   -.0201356
         16  |  -.0921428   .0206785    -4.46   0.000    -.1326768   -.0516087
         17  |  -.0800016   .0222681    -3.59   0.000    -.1236516   -.0363517
         18  |  -.0927438   .0223527    -4.15   0.000    -.1365596   -.0489279
         19  |  -.0687693   .0224496    -3.06   0.002    -.1127751   -.0247634
         20  |  -.0945402   .0179788    -5.26   0.000    -.1297823   -.0592981
         25  |   -.064914   .0278896    -2.33   0.020    -.1195833   -.0102446
         30  |  -.0470201    .017753    -2.65   0.008    -.0818196   -.0122206
         40  |   -.061687   .0204644    -3.01   0.003    -.1018014   -.0215726
         50  |  -.0529726   .0185759    -2.85   0.004    -.0893852     -.01656
             |
       _cons |  -.1023605   .0380221    -2.69   0.007    -.1768916   -.0278295
------------------------------------------------------------------------------

. do regram output/regression/selection 2 Persistence

. args tablefile specname speclabel

. 
. local fmt "%10.5f"

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }

. 
. estimates

----------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------

Linear regression                               Number of obs     =     20,527
                                                F(77, 9918)       =     176.59
                                                Prob > F          =     0.0000
                                                R-squared         =     0.4414
                                                Root MSE          =     .33457

                           (Std. Err. adjusted for 9,919 clusters in frame_id)
------------------------------------------------------------------------------
             |               Robust
      Fexpat |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         lnL |   .0111244   .0021937     5.07   0.000     .0068243    .0154245
        lnKL |   .0038899   .0015626     2.49   0.013     .0008269     .006953
        lnQL |   .0078439   .0023631     3.32   0.001     .0032118     .012476
    exporter |   .0372103   .0060479     6.15   0.000     .0253553    .0490654
     foreign |    .378321   .0088583    42.71   0.000     .3609571     .395685
   lag_expat |   .2456533   .0110782    22.17   0.000     .2239378    .2673687
             |
    ind_year |
          2  |   .0319498   .0413504     0.77   0.440    -.0491054     .113005
          3  |    .003726    .039369     0.09   0.925    -.0734452    .0808972
          4  |  -.0039614   .0398519    -0.10   0.921    -.0820793    .0741565
          5  |  -.0259428   .0381057    -0.68   0.496    -.1006377     .048752
          6  |    .011593   .0374225     0.31   0.757    -.0617628    .0849488
          7  |  -.0513688   .0359708    -1.43   0.153    -.1218788    .0191412
          8  |  -.0554696   .0336175    -1.65   0.099    -.1213667    .0104275
          9  |   -.050982   .0345128    -1.48   0.140    -.1186342    .0166701
         10  |  -.0334182   .0338644    -0.99   0.324    -.0997993    .0329628
         11  |  -.0333589   .0335961    -0.99   0.321     -.099214    .0324963
         12  |   .0012444   .0329688     0.04   0.970    -.0633812      .06587
         13  |  -.0064354   .0328141    -0.20   0.845    -.0707578     .057887
         14  |  -.0062224   .0327286    -0.19   0.849    -.0703772    .0579324
         15  |  -.0048862   .0330534    -0.15   0.882    -.0696776    .0599052
         16  |  -.0128784    .032384    -0.40   0.691    -.0763576    .0506009
         17  |   .0065418   .0327805     0.20   0.842    -.0577147    .0707983
         18  |    .004326   .0324931     0.13   0.894    -.0593671    .0680192
         19  |  -.0144596   .0326862    -0.44   0.658    -.0785312    .0496119
         20  |   .0129322    .032611     0.40   0.692    -.0509921    .0768565
         21  |   .0073252   .0331736     0.22   0.825    -.0577019    .0723522
         22  |  -.0079307   .0340125    -0.23   0.816     -.074602    .0587406
         23  |  -.0198829   .0329101    -0.60   0.546    -.0843934    .0446277
         24  |   .0318271   .0337335     0.94   0.345    -.0342975    .0979517
         26  |  -.0535326   .0526911    -1.02   0.310    -.1568178    .0497527
         27  |  -.0038405   .0440218    -0.09   0.930    -.0901321    .0824511
         28  |    .051826   .0424914     1.22   0.223    -.0314659    .1351178
         29  |   -.037139   .0431473    -0.86   0.389    -.1217166    .0474385
         30  |   .0150797   .0399243     0.38   0.706      -.06318    .0933394
         31  |   .0122973   .0391375     0.31   0.753    -.0644202    .0890147
         32  |  -.0172818   .0376579    -0.46   0.646    -.0910989    .0565354
         33  |  -.0481655    .036625    -1.32   0.189    -.1199579     .023627
         34  |  -.0232597   .0372331    -0.62   0.532    -.0962442    .0497248
         35  |  -.0129015   .0363744    -0.35   0.723    -.0842028    .0583997
         36  |   .0225898    .036331     0.62   0.534    -.0486263    .0938059
         37  |   .0154336   .0349033     0.44   0.658     -.052984    .0838512
         38  |  -.0100114   .0344767    -0.29   0.772    -.0775928    .0575699
         39  |   .0154404   .0352427     0.44   0.661    -.0536424    .0845232
         40  |   .0556918   .0354762     1.57   0.116    -.0138488    .1252324
         41  |   .0097724   .0347985     0.28   0.779    -.0584397    .0779844
         42  |   .0359929   .0364809     0.99   0.324     -.035517    .1075028
         43  |   .0121101    .036806     0.33   0.742    -.0600371    .0842573
         44  |    .052653   .0355197     1.48   0.138    -.0169728    .1222788
         45  |   .0613717   .0357843     1.72   0.086    -.0087728    .1315163
         46  |   .0341128   .0367452     0.93   0.353    -.0379152    .1061409
         47  |   .0164748   .0381153     0.43   0.666    -.0582389    .0911886
         48  |   .0492654    .036035     1.37   0.172    -.0213705    .1199013
         49  |   .0729502   .0363325     2.01   0.045      .001731    .1441693
             |
     age_cat |
          1  |  -.0197309   .0162991    -1.21   0.226    -.0516804    .0122186
          2  |  -.0113792   .0161455    -0.70   0.481    -.0430277    .0202693
          3  |  -.0191094   .0168734    -1.13   0.257    -.0521847     .013966
          4  |  -.0234087   .0172116    -1.36   0.174    -.0571469    .0103295
          5  |  -.0240643   .0174202    -1.38   0.167    -.0582113    .0100828
          6  |   -.050695   .0176526    -2.87   0.004    -.0852978   -.0160923
          7  |  -.0435292   .0177226    -2.46   0.014    -.0782691   -.0087892
          8  |  -.0363146   .0177041    -2.05   0.040    -.0710181    -.001611
          9  |  -.0546204   .0182886    -2.99   0.003    -.0904698   -.0187711
         10  |   -.065849   .0186417    -3.53   0.000    -.1023905   -.0293074
         11  |   -.044129    .018186    -2.43   0.015    -.0797772   -.0084807
         12  |  -.0624968   .0187151    -3.34   0.001    -.0991823   -.0258113
         13  |  -.0470715   .0190105    -2.48   0.013     -.084336    -.009807
         14  |  -.0645893   .0197778    -3.27   0.001    -.1033579   -.0258207
         15  |  -.0581987   .0194179    -3.00   0.003    -.0962618   -.0201356
         16  |  -.0921428   .0206785    -4.46   0.000    -.1326768   -.0516087
         17  |  -.0800016   .0222681    -3.59   0.000    -.1236516   -.0363517
         18  |  -.0927438   .0223527    -4.15   0.000    -.1365596   -.0489279
         19  |  -.0687693   .0224496    -3.06   0.002    -.1127751   -.0247634
         20  |  -.0945402   .0179788    -5.26   0.000    -.1297823   -.0592981
         25  |   -.064914   .0278896    -2.33   0.020    -.1195833   -.0102446
         30  |  -.0470201    .017753    -2.65   0.008    -.0818196   -.0122206
         40  |   -.061687   .0204644    -3.01   0.003    -.1018014   -.0215726
         50  |  -.0529726   .0185759    -2.85   0.004    -.0893852     -.01656
             |
       _cons |  -.1023605   .0380221    -2.69   0.007    -.1768916   -.0278295
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text repla
> ce

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b', "`fmt'")) _newline
  6.         file write `output' ("   standard_error: " + string(`se', "`fmt'")) _
> newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se', "`fmt'")) 
> _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',
> "pvalue"),colnumb(`coefs',"`X'")]), "`fmt'") _newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file

. 
. reg Fexpat $outcomes foreign i.ind_year i.age_cat if lag_expat==0, vce(cluster f
> rame_id)

Linear regression                               Number of obs     =     14,360
                                                F(76, 8516)       =      33.86
                                                Prob > F          =     0.0000
                                                R-squared         =     0.3416
                                                Root MSE          =     .25466

                           (Std. Err. adjusted for 8,517 clusters in frame_id)
------------------------------------------------------------------------------
             |               Robust
      Fexpat |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         lnL |    .005168    .002157     2.40   0.017     .0009398    .0093962
        lnKL |   .0027362    .001479     1.85   0.064    -.0001629    .0056353
        lnQL |   .0014343   .0022197     0.65   0.518    -.0029168    .0057854
    exporter |   .0388412   .0055311     7.02   0.000     .0279989    .0496834
     foreign |   .3801995   .0086823    43.79   0.000     .3631801    .3972189
             |
    ind_year |
          2  |   .0510734   .0376153     1.36   0.175    -.0226616    .1248085
          3  |   .0118571   .0366719     0.32   0.746    -.0600288     .083743
          4  |   .0081691   .0370214     0.22   0.825    -.0644018      .08074
          5  |  -.0119502   .0337213    -0.35   0.723    -.0780521    .0541518
          6  |   .0437751   .0335289     1.31   0.192    -.0219497       .1095
          7  |   -.018037   .0314477    -0.57   0.566    -.0796821    .0436081
          8  |  -.0574692   .0296529    -1.94   0.053    -.1155961    .0006576
          9  |  -.0468642    .030257    -1.55   0.121    -.1061753    .0124468
         10  |   -.057032   .0292183    -1.95   0.051    -.1143069    .0002429
         11  |  -.0734195    .029775    -2.47   0.014    -.1317857   -.0150534
         12  |  -.0456064   .0289759    -1.57   0.116    -.1024061    .0111933
         13  |  -.0466004   .0290399    -1.60   0.109    -.1035257    .0103249
         14  |  -.0480583   .0291551    -1.65   0.099    -.1052094    .0090928
         15  |  -.0305412    .028966    -1.05   0.292    -.0873216    .0262392
         16  |  -.0602268   .0284003    -2.12   0.034    -.1158982   -.0045554
         17  |  -.0488102   .0293759    -1.66   0.097     -.106394    .0087737
         18  |  -.0549974   .0288736    -1.90   0.057    -.1115966    .0016018
         19  |   -.059381   .0292482    -2.03   0.042    -.1167145   -.0020475
         20  |  -.0327372   .0293323    -1.12   0.264    -.0902355    .0247612
         21  |  -.0392449   .0291452    -1.35   0.178    -.0963766    .0178869
         22  |  -.0655781   .0295104    -2.22   0.026    -.1234257   -.0077305
         23  |  -.0591089   .0291082    -2.03   0.042     -.116168   -.0020498
         24  |  -.0257407   .0291988    -0.88   0.378    -.0829774     .031496
         26  |   .0163546    .053881     0.30   0.761    -.0892652    .1219745
         27  |   .0558959   .0446635     1.25   0.211    -.0316553    .1434471
         28  |   .0448529   .0470017     0.95   0.340    -.0472818    .1369877
         29  |  -.0097468   .0448772    -0.22   0.828    -.0977171    .0782235
         30  |   .0136059   .0385066     0.35   0.724    -.0618763    .0890881
         31  |   .0093059   .0380483     0.24   0.807     -.065278    .0838898
         32  |  -.0463154   .0349292    -1.33   0.185    -.1147851    .0221543
         33  |  -.0542554   .0334969    -1.62   0.105    -.1199175    .0114068
         34  |  -.0410419   .0344575    -1.19   0.234     -.108587    .0265031
         35  |  -.0169378   .0335693    -0.50   0.614    -.0827417    .0488661
         36  |   -.056979   .0337678    -1.69   0.092    -.1231722    .0092141
         37  |  -.0249433   .0322619    -0.77   0.439    -.0881845    .0382978
         38  |  -.0826187   .0306874    -2.69   0.007    -.1427735    -.022464
         39  |  -.0397769   .0321405    -1.24   0.216    -.1027802    .0232264
         40  |  -.0076303   .0328986    -0.23   0.817    -.0721196    .0568591
         41  |  -.0528051    .031081    -1.70   0.089    -.1137314    .0081212
         42  |  -.0182825   .0340809    -0.54   0.592    -.0850892    .0485242
         43  |   -.049937   .0336665    -1.48   0.138    -.1159316    .0160576
         44  |  -.0023844   .0322564    -0.07   0.941    -.0656149     .060846
         45  |   -.008177   .0329004    -0.25   0.804    -.0726698    .0563158
         46  |  -.0195483   .0332626    -0.59   0.557     -.084751    .0456545
         47  |  -.0557643   .0348777    -1.60   0.110    -.1241329    .0126044
         48  |  -.0108205   .0328523    -0.33   0.742     -.075219     .053578
         49  |  -.0096662   .0337654    -0.29   0.775    -.0758547    .0565223
             |
     age_cat |
          1  |  -.0151455   .0130169    -1.16   0.245    -.0406618    .0103709
          2  |  -.0070344   .0129782    -0.54   0.588    -.0324747     .018406
          3  |  -.0081784   .0134854    -0.61   0.544    -.0346131    .0182563
          4  |  -.0152028   .0142666    -1.07   0.287    -.0431688    .0127632
          5  |   .0051547   .0146766     0.35   0.725    -.0236149    .0339243
          6  |  -.0364517   .0145628    -2.50   0.012    -.0649983   -.0079051
          7  |   -.020305    .015076    -1.35   0.178    -.0498577    .0092477
          8  |  -.0054906   .0151181    -0.36   0.716    -.0351257    .0241445
          9  |  -.0130106   .0150903    -0.86   0.389    -.0425913    .0165701
         10  |  -.0251745   .0159388    -1.58   0.114    -.0564184    .0060694
         11  |  -.0211905   .0152671    -1.39   0.165    -.0511176    .0087367
         12  |  -.0203029   .0161284    -1.26   0.208    -.0519185    .0113127
         13  |   -.005177   .0164837    -0.31   0.753     -.037489     .027135
         14  |  -.0195378   .0173079    -1.13   0.259    -.0534654    .0143898
         15  |  -.0220764   .0166486    -1.33   0.185    -.0547118    .0105589
         16  |  -.0390773   .0175467    -2.23   0.026    -.0734731   -.0046815
         17  |  -.0182207   .0198373    -0.92   0.358    -.0571066    .0206652
         18  |  -.0396862   .0197523    -2.01   0.045    -.0784056   -.0009668
         19  |  -.0310951   .0205734    -1.51   0.131    -.0714241    .0092338
         20  |  -.0405171   .0155638    -2.60   0.009    -.0710259   -.0100084
         25  |  -.0206781   .0246186    -0.84   0.401    -.0689364    .0275802
         30  |  -.0076334   .0128952    -0.59   0.554     -.032911    .0176443
         40  |  -.0253794   .0161187    -1.57   0.115    -.0569759    .0062171
         50  |  -.0195828   .0152352    -1.29   0.199    -.0494476    .0102819
             |
       _cons |  -.0054368   .0343508    -0.16   0.874    -.0727727    .0618992
------------------------------------------------------------------------------

. do regram output/regression/selection 3 Local

. args tablefile specname speclabel

. 
. local fmt "%10.5f"

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }

. 
. estimates

----------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------

Linear regression                               Number of obs     =     14,360
                                                F(76, 8516)       =      33.86
                                                Prob > F          =     0.0000
                                                R-squared         =     0.3416
                                                Root MSE          =     .25466

                           (Std. Err. adjusted for 8,517 clusters in frame_id)
------------------------------------------------------------------------------
             |               Robust
      Fexpat |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         lnL |    .005168    .002157     2.40   0.017     .0009398    .0093962
        lnKL |   .0027362    .001479     1.85   0.064    -.0001629    .0056353
        lnQL |   .0014343   .0022197     0.65   0.518    -.0029168    .0057854
    exporter |   .0388412   .0055311     7.02   0.000     .0279989    .0496834
     foreign |   .3801995   .0086823    43.79   0.000     .3631801    .3972189
             |
    ind_year |
          2  |   .0510734   .0376153     1.36   0.175    -.0226616    .1248085
          3  |   .0118571   .0366719     0.32   0.746    -.0600288     .083743
          4  |   .0081691   .0370214     0.22   0.825    -.0644018      .08074
          5  |  -.0119502   .0337213    -0.35   0.723    -.0780521    .0541518
          6  |   .0437751   .0335289     1.31   0.192    -.0219497       .1095
          7  |   -.018037   .0314477    -0.57   0.566    -.0796821    .0436081
          8  |  -.0574692   .0296529    -1.94   0.053    -.1155961    .0006576
          9  |  -.0468642    .030257    -1.55   0.121    -.1061753    .0124468
         10  |   -.057032   .0292183    -1.95   0.051    -.1143069    .0002429
         11  |  -.0734195    .029775    -2.47   0.014    -.1317857   -.0150534
         12  |  -.0456064   .0289759    -1.57   0.116    -.1024061    .0111933
         13  |  -.0466004   .0290399    -1.60   0.109    -.1035257    .0103249
         14  |  -.0480583   .0291551    -1.65   0.099    -.1052094    .0090928
         15  |  -.0305412    .028966    -1.05   0.292    -.0873216    .0262392
         16  |  -.0602268   .0284003    -2.12   0.034    -.1158982   -.0045554
         17  |  -.0488102   .0293759    -1.66   0.097     -.106394    .0087737
         18  |  -.0549974   .0288736    -1.90   0.057    -.1115966    .0016018
         19  |   -.059381   .0292482    -2.03   0.042    -.1167145   -.0020475
         20  |  -.0327372   .0293323    -1.12   0.264    -.0902355    .0247612
         21  |  -.0392449   .0291452    -1.35   0.178    -.0963766    .0178869
         22  |  -.0655781   .0295104    -2.22   0.026    -.1234257   -.0077305
         23  |  -.0591089   .0291082    -2.03   0.042     -.116168   -.0020498
         24  |  -.0257407   .0291988    -0.88   0.378    -.0829774     .031496
         26  |   .0163546    .053881     0.30   0.761    -.0892652    .1219745
         27  |   .0558959   .0446635     1.25   0.211    -.0316553    .1434471
         28  |   .0448529   .0470017     0.95   0.340    -.0472818    .1369877
         29  |  -.0097468   .0448772    -0.22   0.828    -.0977171    .0782235
         30  |   .0136059   .0385066     0.35   0.724    -.0618763    .0890881
         31  |   .0093059   .0380483     0.24   0.807     -.065278    .0838898
         32  |  -.0463154   .0349292    -1.33   0.185    -.1147851    .0221543
         33  |  -.0542554   .0334969    -1.62   0.105    -.1199175    .0114068
         34  |  -.0410419   .0344575    -1.19   0.234     -.108587    .0265031
         35  |  -.0169378   .0335693    -0.50   0.614    -.0827417    .0488661
         36  |   -.056979   .0337678    -1.69   0.092    -.1231722    .0092141
         37  |  -.0249433   .0322619    -0.77   0.439    -.0881845    .0382978
         38  |  -.0826187   .0306874    -2.69   0.007    -.1427735    -.022464
         39  |  -.0397769   .0321405    -1.24   0.216    -.1027802    .0232264
         40  |  -.0076303   .0328986    -0.23   0.817    -.0721196    .0568591
         41  |  -.0528051    .031081    -1.70   0.089    -.1137314    .0081212
         42  |  -.0182825   .0340809    -0.54   0.592    -.0850892    .0485242
         43  |   -.049937   .0336665    -1.48   0.138    -.1159316    .0160576
         44  |  -.0023844   .0322564    -0.07   0.941    -.0656149     .060846
         45  |   -.008177   .0329004    -0.25   0.804    -.0726698    .0563158
         46  |  -.0195483   .0332626    -0.59   0.557     -.084751    .0456545
         47  |  -.0557643   .0348777    -1.60   0.110    -.1241329    .0126044
         48  |  -.0108205   .0328523    -0.33   0.742     -.075219     .053578
         49  |  -.0096662   .0337654    -0.29   0.775    -.0758547    .0565223
             |
     age_cat |
          1  |  -.0151455   .0130169    -1.16   0.245    -.0406618    .0103709
          2  |  -.0070344   .0129782    -0.54   0.588    -.0324747     .018406
          3  |  -.0081784   .0134854    -0.61   0.544    -.0346131    .0182563
          4  |  -.0152028   .0142666    -1.07   0.287    -.0431688    .0127632
          5  |   .0051547   .0146766     0.35   0.725    -.0236149    .0339243
          6  |  -.0364517   .0145628    -2.50   0.012    -.0649983   -.0079051
          7  |   -.020305    .015076    -1.35   0.178    -.0498577    .0092477
          8  |  -.0054906   .0151181    -0.36   0.716    -.0351257    .0241445
          9  |  -.0130106   .0150903    -0.86   0.389    -.0425913    .0165701
         10  |  -.0251745   .0159388    -1.58   0.114    -.0564184    .0060694
         11  |  -.0211905   .0152671    -1.39   0.165    -.0511176    .0087367
         12  |  -.0203029   .0161284    -1.26   0.208    -.0519185    .0113127
         13  |   -.005177   .0164837    -0.31   0.753     -.037489     .027135
         14  |  -.0195378   .0173079    -1.13   0.259    -.0534654    .0143898
         15  |  -.0220764   .0166486    -1.33   0.185    -.0547118    .0105589
         16  |  -.0390773   .0175467    -2.23   0.026    -.0734731   -.0046815
         17  |  -.0182207   .0198373    -0.92   0.358    -.0571066    .0206652
         18  |  -.0396862   .0197523    -2.01   0.045    -.0784056   -.0009668
         19  |  -.0310951   .0205734    -1.51   0.131    -.0714241    .0092338
         20  |  -.0405171   .0155638    -2.60   0.009    -.0710259   -.0100084
         25  |  -.0206781   .0246186    -0.84   0.401    -.0689364    .0275802
         30  |  -.0076334   .0128952    -0.59   0.554     -.032911    .0176443
         40  |  -.0253794   .0161187    -1.57   0.115    -.0569759    .0062171
         50  |  -.0195828   .0152352    -1.29   0.199    -.0494476    .0102819
             |
       _cons |  -.0054368   .0343508    -0.16   0.874    -.0727727    .0618992
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text repla
> ce

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b', "`fmt'")) _newline
  6.         file write `output' ("   standard_error: " + string(`se', "`fmt'")) _
> newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se', "`fmt'")) 
> _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',
> "pvalue"),colnumb(`coefs',"`X'")]), "`fmt'") _newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file

. 
. reg Fexpat $outcomes foreign i.ind_year i.age_cat if lag_expat==1, vce(cluster f
> rame_id)
note: foreign omitted because of collinearity

Linear regression                               Number of obs     =      6,167
                                                F(75, 2868)       =       3.53
                                                Prob > F          =     0.0000
                                                R-squared         =     0.0416
                                                Root MSE          =     .46638

                           (Std. Err. adjusted for 2,869 clusters in frame_id)
------------------------------------------------------------------------------
             |               Robust
      Fexpat |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         lnL |   .0202282   .0052371     3.86   0.000     .0099594    .0304971
        lnKL |   .0061312   .0043451     1.41   0.158    -.0023887     .014651
        lnQL |   .0192303   .0059465     3.23   0.001     .0075704    .0308902
    exporter |   .0380909   .0165064     2.31   0.021     .0057253    .0704565
     foreign |          0  (omitted)
             |
    ind_year |
          2  |   .0121676    .084312     0.14   0.885    -.1531506    .1774858
          3  |  -.0038075   .0776576    -0.05   0.961    -.1560778    .1484629
          4  |  -.0088856   .0784954    -0.11   0.910    -.1627986    .1450274
          5  |  -.0402383   .0762049    -0.53   0.598    -.1896602    .1091835
          6  |  -.0405464   .0756965    -0.54   0.592    -.1889714    .1078786
          7  |  -.1208813   .0769498    -1.57   0.116    -.2717638    .0300012
          8  |   -.075895   .0736817    -1.03   0.303    -.2203695    .0685794
          9  |  -.0962009   .0771464    -1.25   0.213     -.247469    .0550671
         10  |  -.0124792   .0787444    -0.16   0.874    -.1668805    .1419221
         11  |   .0519378   .0777649     0.67   0.504     -.100543    .2044186
         12  |   .1209763   .0760668     1.59   0.112    -.0281749    .2701275
         13  |   .0862983    .075581     1.14   0.254    -.0619002    .2344968
         14  |   .0699666    .073934     0.95   0.344    -.0750026    .2149357
         15  |   .0079207   .0788624     0.10   0.920     -.146712    .1625534
         16  |   .0784654   .0725181     1.08   0.279    -.0637274    .2206583
         17  |   .1348339   .0743995     1.81   0.070    -.0110481    .2807159
         18  |   .1367564   .0721559     1.90   0.058    -.0047263    .2782391
         19  |   .0788216   .0727363     1.08   0.279    -.0637992    .2214424
         20  |   .1072288    .073117     1.47   0.143    -.0361383    .2505959
         21  |   .0920693   .0767667     1.20   0.230    -.0584542    .2425929
         22  |   .1268662   .0772972     1.64   0.101    -.0246974    .2784299
         23  |   .0664177   .0787351     0.84   0.399    -.0879653    .2208008
         24  |   .1901951   .0774307     2.46   0.014     .0383696    .3420207
         26  |  -.0790873   .0898492    -0.88   0.379    -.2552629    .0970883
         27  |  -.0441847   .0805636    -0.55   0.583    -.2021531    .1137837
         28  |   .0771728   .0762438     1.01   0.312    -.0723254     .226671
         29  |   -.039892   .0799946    -0.50   0.618    -.1967446    .1169607
         30  |   .0321121   .0770559     0.42   0.677    -.1189784    .1832026
         31  |   .0341691   .0756186     0.45   0.651    -.1141031    .1824413
         32  |    .032519   .0742288     0.44   0.661    -.1130281    .1780662
         33  |  -.0328115   .0754453    -0.43   0.664     -.180744     .115121
         34  |    .014906   .0759082     0.20   0.844    -.1339341    .1637462
         35  |  -.0150909   .0766552    -0.20   0.844    -.1653959     .135214
         36  |   .1556137   .0742779     2.10   0.036     .0099702    .3012573
         37  |   .0905824   .0732936     1.24   0.217    -.0531311     .234296
         38  |   .1046209   .0714313     1.46   0.143    -.0354409    .2446828
         39  |   .1082579   .0728961     1.49   0.138    -.0346763     .251192
         40  |    .159544   .0732919     2.18   0.030     .0158339    .3032542
         41  |   .1245485   .0746263     1.67   0.095    -.0217781    .2708752
         42  |   .1225441   .0747859     1.64   0.101    -.0240954    .2691837
         43  |   .1260137   .0753212     1.67   0.094    -.0216754    .2737029
         44  |    .152152   .0753317     2.02   0.044     .0044422    .2998618
         45  |   .1854069   .0741423     2.50   0.012     .0400292    .3307845
         46  |   .1310392    .076493     1.71   0.087    -.0189477     .281026
         47  |   .1424556   .0813787     1.75   0.080    -.0171112    .3020223
         48  |   .1661228   .0771799     2.15   0.031     .0147891    .3174564
         49  |    .228952   .0746165     3.07   0.002     .0826446    .3752594
             |
     age_cat |
          1  |  -.0269075    .047168    -0.57   0.568     -.119394    .0655791
          2  |  -.0335965    .046143    -0.73   0.467    -.1240733    .0568802
          3  |  -.0465839   .0467401    -1.00   0.319    -.1382314    .0450636
          4  |  -.0461893   .0472385    -0.98   0.328    -.1388142    .0464356
          5  |  -.0869354   .0479251    -1.81   0.070    -.1809065    .0070358
          6  |  -.0859216   .0493066    -1.74   0.082    -.1826015    .0107583
          7  |  -.0916351   .0493196    -1.86   0.063    -.1883405    .0050703
          8  |  -.1073286   .0502617    -2.14   0.033    -.2058813   -.0087758
          9  |  -.1517581   .0516703    -2.94   0.003    -.2530728   -.0504434
         10  |  -.1579877   .0519735    -3.04   0.002    -.2598969   -.0560785
         11  |  -.0909906    .053698    -1.69   0.090    -.1962811       .0143
         12  |  -.1665812   .0530764    -3.14   0.002     -.270653   -.0625094
         13  |  -.1491061   .0535134    -2.79   0.005    -.2540348   -.0441775
         14  |  -.1761043   .0541583    -3.25   0.001    -.2822975   -.0699111
         15  |  -.1403349   .0551462    -2.54   0.011    -.2484651   -.0322047
         16  |  -.2122033   .0574911    -3.69   0.000    -.3249313   -.0994753
         17  |  -.2340841   .0599904    -3.90   0.000    -.3517127   -.1164554
         18  |  -.2268958      .0604    -3.76   0.000    -.3453277    -.108464
         19  |  -.1520487   .0632641    -2.40   0.016    -.2760964    -.028001
         20  |  -.2327193   .0517523    -4.50   0.000    -.3341947   -.1312439
         25  |  -.2203269   .0769469    -2.86   0.004    -.3712038   -.0694501
         30  |  -.1867462   .1345132    -1.39   0.165    -.4504985    .0770061
         40  |  -.1683933   .0944771    -1.78   0.075    -.3536432    .0168566
         50  |  -.0895193   .1003856    -0.89   0.373    -.2863546    .1073159
             |
       _cons |   .3560133   .0865276     4.11   0.000     .1863507    .5256759
------------------------------------------------------------------------------

. do regram output/regression/selection 4 Expat

. args tablefile specname speclabel

. 
. local fmt "%10.5f"

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }

. 
. estimates

----------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------

Linear regression                               Number of obs     =      6,167
                                                F(75, 2868)       =       3.53
                                                Prob > F          =     0.0000
                                                R-squared         =     0.0416
                                                Root MSE          =     .46638

                           (Std. Err. adjusted for 2,869 clusters in frame_id)
------------------------------------------------------------------------------
             |               Robust
      Fexpat |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         lnL |   .0202282   .0052371     3.86   0.000     .0099594    .0304971
        lnKL |   .0061312   .0043451     1.41   0.158    -.0023887     .014651
        lnQL |   .0192303   .0059465     3.23   0.001     .0075704    .0308902
    exporter |   .0380909   .0165064     2.31   0.021     .0057253    .0704565
     foreign |          0  (omitted)
             |
    ind_year |
          2  |   .0121676    .084312     0.14   0.885    -.1531506    .1774858
          3  |  -.0038075   .0776576    -0.05   0.961    -.1560778    .1484629
          4  |  -.0088856   .0784954    -0.11   0.910    -.1627986    .1450274
          5  |  -.0402383   .0762049    -0.53   0.598    -.1896602    .1091835
          6  |  -.0405464   .0756965    -0.54   0.592    -.1889714    .1078786
          7  |  -.1208813   .0769498    -1.57   0.116    -.2717638    .0300012
          8  |   -.075895   .0736817    -1.03   0.303    -.2203695    .0685794
          9  |  -.0962009   .0771464    -1.25   0.213     -.247469    .0550671
         10  |  -.0124792   .0787444    -0.16   0.874    -.1668805    .1419221
         11  |   .0519378   .0777649     0.67   0.504     -.100543    .2044186
         12  |   .1209763   .0760668     1.59   0.112    -.0281749    .2701275
         13  |   .0862983    .075581     1.14   0.254    -.0619002    .2344968
         14  |   .0699666    .073934     0.95   0.344    -.0750026    .2149357
         15  |   .0079207   .0788624     0.10   0.920     -.146712    .1625534
         16  |   .0784654   .0725181     1.08   0.279    -.0637274    .2206583
         17  |   .1348339   .0743995     1.81   0.070    -.0110481    .2807159
         18  |   .1367564   .0721559     1.90   0.058    -.0047263    .2782391
         19  |   .0788216   .0727363     1.08   0.279    -.0637992    .2214424
         20  |   .1072288    .073117     1.47   0.143    -.0361383    .2505959
         21  |   .0920693   .0767667     1.20   0.230    -.0584542    .2425929
         22  |   .1268662   .0772972     1.64   0.101    -.0246974    .2784299
         23  |   .0664177   .0787351     0.84   0.399    -.0879653    .2208008
         24  |   .1901951   .0774307     2.46   0.014     .0383696    .3420207
         26  |  -.0790873   .0898492    -0.88   0.379    -.2552629    .0970883
         27  |  -.0441847   .0805636    -0.55   0.583    -.2021531    .1137837
         28  |   .0771728   .0762438     1.01   0.312    -.0723254     .226671
         29  |   -.039892   .0799946    -0.50   0.618    -.1967446    .1169607
         30  |   .0321121   .0770559     0.42   0.677    -.1189784    .1832026
         31  |   .0341691   .0756186     0.45   0.651    -.1141031    .1824413
         32  |    .032519   .0742288     0.44   0.661    -.1130281    .1780662
         33  |  -.0328115   .0754453    -0.43   0.664     -.180744     .115121
         34  |    .014906   .0759082     0.20   0.844    -.1339341    .1637462
         35  |  -.0150909   .0766552    -0.20   0.844    -.1653959     .135214
         36  |   .1556137   .0742779     2.10   0.036     .0099702    .3012573
         37  |   .0905824   .0732936     1.24   0.217    -.0531311     .234296
         38  |   .1046209   .0714313     1.46   0.143    -.0354409    .2446828
         39  |   .1082579   .0728961     1.49   0.138    -.0346763     .251192
         40  |    .159544   .0732919     2.18   0.030     .0158339    .3032542
         41  |   .1245485   .0746263     1.67   0.095    -.0217781    .2708752
         42  |   .1225441   .0747859     1.64   0.101    -.0240954    .2691837
         43  |   .1260137   .0753212     1.67   0.094    -.0216754    .2737029
         44  |    .152152   .0753317     2.02   0.044     .0044422    .2998618
         45  |   .1854069   .0741423     2.50   0.012     .0400292    .3307845
         46  |   .1310392    .076493     1.71   0.087    -.0189477     .281026
         47  |   .1424556   .0813787     1.75   0.080    -.0171112    .3020223
         48  |   .1661228   .0771799     2.15   0.031     .0147891    .3174564
         49  |    .228952   .0746165     3.07   0.002     .0826446    .3752594
             |
     age_cat |
          1  |  -.0269075    .047168    -0.57   0.568     -.119394    .0655791
          2  |  -.0335965    .046143    -0.73   0.467    -.1240733    .0568802
          3  |  -.0465839   .0467401    -1.00   0.319    -.1382314    .0450636
          4  |  -.0461893   .0472385    -0.98   0.328    -.1388142    .0464356
          5  |  -.0869354   .0479251    -1.81   0.070    -.1809065    .0070358
          6  |  -.0859216   .0493066    -1.74   0.082    -.1826015    .0107583
          7  |  -.0916351   .0493196    -1.86   0.063    -.1883405    .0050703
          8  |  -.1073286   .0502617    -2.14   0.033    -.2058813   -.0087758
          9  |  -.1517581   .0516703    -2.94   0.003    -.2530728   -.0504434
         10  |  -.1579877   .0519735    -3.04   0.002    -.2598969   -.0560785
         11  |  -.0909906    .053698    -1.69   0.090    -.1962811       .0143
         12  |  -.1665812   .0530764    -3.14   0.002     -.270653   -.0625094
         13  |  -.1491061   .0535134    -2.79   0.005    -.2540348   -.0441775
         14  |  -.1761043   .0541583    -3.25   0.001    -.2822975   -.0699111
         15  |  -.1403349   .0551462    -2.54   0.011    -.2484651   -.0322047
         16  |  -.2122033   .0574911    -3.69   0.000    -.3249313   -.0994753
         17  |  -.2340841   .0599904    -3.90   0.000    -.3517127   -.1164554
         18  |  -.2268958      .0604    -3.76   0.000    -.3453277    -.108464
         19  |  -.1520487   .0632641    -2.40   0.016    -.2760964    -.028001
         20  |  -.2327193   .0517523    -4.50   0.000    -.3341947   -.1312439
         25  |  -.2203269   .0769469    -2.86   0.004    -.3712038   -.0694501
         30  |  -.1867462   .1345132    -1.39   0.165    -.4504985    .0770061
         40  |  -.1683933   .0944771    -1.78   0.075    -.3536432    .0168566
         50  |  -.0895193   .1003856    -0.89   0.373    -.2863546    .1073159
             |
       _cons |   .3560133   .0865276     4.11   0.000     .1863507    .5256759
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text repla
> ce

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b', "`fmt'")) _newline
  6.         file write `output' ("   standard_error: " + string(`se', "`fmt'")) _
> newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se', "`fmt'")) 
> _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',
> "pvalue"),colnumb(`coefs',"`X'")]), "`fmt'") _newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file

. 
end of do-file

. 
. log close
      name:  <unnamed>
       log:  /Users/koren/Google Drive/Research/expat/research_design/talk/output/
> estimate_selection.log
  log type:  text
 closed on:   4 Dec 2018, 20:44:54
----------------------------------------------------------------------------------
