-------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/koren/Google Drive/Research/expat/research_design/talk/outp
> ut/variables.log
  log type:  text
 opened on:   4 Dec 2018, 14:42:21

. 
. use temp/firm_ceo_panel

. 
. scalar T1 = 1989

. scalar T2 = 2016

. expand T2-T1+1
(2,324,943 observations created)

. bys frame_id manager_id: gen year = _n-1+T1

. 
. tempfile expand

. save `expand', replace
(note: file /var/folders/f4/7drmhl1d5kj3wp1r33jvx32m0000gn/T//St04365.000001 no
> t found)
file /var/folders/f4/7drmhl1d5kj3wp1r33jvx32m0000gn/T//St04365.000001 saved

. 
. merge m:1 frame_id year using temp/balance-small, nogen keep(match)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                         1,310,146  
    -----------------------------------------

. merge m:1 frame_id year using temp/N_ceos, nogen keep(match)
(note: variable frame_id was str10, now str12 to accommodate using data's
       values)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                         1,159,664  
    -----------------------------------------

. * drop very large firms
. egen fp_tag = tag(frame_id manager_id ) 

. egen total_CEOs = sum(fp_tag ), by(frame_id )

. tab total_CEOs 

 total_CEOs |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |     42,842        3.69        3.69
          2 |    116,462       10.04       13.74
          3 |    140,964       12.16       25.89
          4 |    129,408       11.16       37.05
          5 |    107,740        9.29       46.34
          6 |     94,074        8.11       54.45
          7 |     81,389        7.02       61.47
          8 |     60,112        5.18       66.66
          9 |     50,103        4.32       70.98
         10 |     44,880        3.87       74.85
         11 |     39,809        3.43       78.28
         12 |     31,812        2.74       81.02
         13 |     24,284        2.09       83.12
         14 |     25,620        2.21       85.33
         15 |     18,240        1.57       86.90
         16 |     16,000        1.38       88.28
         17 |     16,558        1.43       89.71
         18 |     13,338        1.15       90.86
         19 |     10,355        0.89       91.75
         20 |      9,660        0.83       92.58
         21 |      7,035        0.61       93.19
         22 |      6,930        0.60       93.79
         23 |      4,991        0.43       94.22
         24 |      6,792        0.59       94.80
         25 |      4,150        0.36       95.16
         26 |      2,496        0.22       95.38
         27 |      2,322        0.20       95.58
         28 |      1,400        0.12       95.70
         29 |      4,234        0.37       96.06
         30 |      1,890        0.16       96.23
         31 |      3,379        0.29       96.52
         32 |        800        0.07       96.59
         33 |      2,013        0.17       96.76
         34 |      2,074        0.18       96.94
         35 |      1,295        0.11       97.05
         36 |      1,332        0.11       97.16
         37 |        814        0.07       97.23
         38 |      3,116        0.27       97.50
         41 |      1,025        0.09       97.59
         42 |      5,502        0.47       98.07
         43 |      2,193        0.19       98.26
         46 |      3,266        0.28       98.54
         49 |      1,176        0.10       98.64
         51 |      1,122        0.10       98.74
         52 |        780        0.07       98.80
         55 |      1,210        0.10       98.91
         56 |      1,008        0.09       98.99
         64 |      2,240        0.19       99.19
         67 |        268        0.02       99.21
         80 |      1,760        0.15       99.36
         85 |      2,040        0.18       99.54
         87 |      2,175        0.19       99.73
        177 |      3,186        0.27      100.00
------------+-----------------------------------
      Total |  1,159,664      100.00

. 
. drop if total_CEOs>15
(151,925 observations deleted)

. scalar dropped_too_many_CEOs = r(N_drop)

. 
. gen ceo_span = first_exit_year-enter_year+1

. tab ceo_span

   ceo_span |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |    197,979       19.65       19.65
          2 |    125,567       12.46       32.11
          3 |     96,685        9.59       41.70
          4 |     80,465        7.98       49.69
          5 |     76,101        7.55       57.24
          6 |     53,420        5.30       62.54
          7 |     44,868        4.45       66.99
          8 |     38,783        3.85       70.84
          9 |     37,551        3.73       74.56
         10 |     31,357        3.11       77.68
         11 |     25,286        2.51       80.19
         12 |     22,870        2.27       82.46
         13 |     22,552        2.24       84.69
         14 |     18,086        1.79       86.49
         15 |     16,630        1.65       88.14
         16 |     14,427        1.43       89.57
         17 |     15,306        1.52       91.09
         18 |     11,694        1.16       92.25
         19 |     11,624        1.15       93.40
         20 |     11,144        1.11       94.51
         21 |      9,821        0.97       95.48
         22 |      7,844        0.78       96.26
         23 |      8,063        0.80       97.06
         24 |      7,442        0.74       97.80
         25 |      8,428        0.84       98.64
         26 |      5,620        0.56       99.19
         27 |      3,694        0.37       99.56
         28 |        809        0.08       99.64
         29 |        137        0.01       99.65
         30 |         63        0.01       99.66
         31 |        111        0.01       99.67
         32 |        116        0.01       99.68
         33 |        191        0.02       99.70
         34 |         56        0.01       99.71
         35 |         56        0.01       99.71
         36 |         92        0.01       99.72
         37 |        231        0.02       99.74
         38 |        109        0.01       99.76
         39 |        138        0.01       99.77
         40 |        214        0.02       99.79
         41 |        240        0.02       99.81
         42 |        489        0.05       99.86
         43 |        356        0.04       99.90
         44 |        208        0.02       99.92
         45 |        157        0.02       99.93
         46 |         84        0.01       99.94
         47 |         52        0.01       99.95
         48 |         53        0.01       99.95
         49 |         61        0.01       99.96
         50 |         49        0.00       99.96
         51 |         42        0.00       99.97
         53 |         66        0.01       99.97
         55 |         25        0.00       99.98
         56 |         18        0.00       99.98
         58 |        140        0.01       99.99
         61 |         24        0.00      100.00
         64 |         45        0.00      100.00
------------+-----------------------------------
      Total |  1,007,739      100.00

. egen industry_ceo_span = median(ceo_span), by(industry_mode)

. tab industry_ceo_span

industry_ce |
     o_span |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |      8,065        0.80        0.80
          3 |     75,283        7.47        8.27
          4 |    424,089       42.08       50.35
          5 |    342,350       33.97       84.33
          6 |    157,952       15.67      100.00
------------+-----------------------------------
      Total |  1,007,739      100.00

. gen byte slow = industry_ceo_span>4

. 
. tab industry_mode if slow

industry_mo |
         de |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |     80,563       16.10       16.10
          8 |      3,495        0.70       16.80
         13 |     12,385        2.48       19.28
         14 |     18,978        3.79       23.07
         15 |      8,530        1.70       24.78
         16 |     12,096        2.42       27.19
         18 |     10,018        2.00       29.20
         25 |     52,209       10.44       39.63
         27 |     13,510        2.70       42.33
         28 |     30,515        6.10       48.43
         31 |      9,330        1.86       50.30
         32 |      4,592        0.92       51.21
         33 |      2,105        0.42       51.63
         41 |     27,396        5.48       57.11
         42 |     22,655        4.53       61.64
         43 |     25,297        5.06       66.69
         45 |     31,285        6.25       72.95
         47 |     57,039       11.40       84.35
         49 |     23,205        4.64       88.99
         56 |     19,433        3.88       92.87
         71 |     17,926        3.58       96.45
         74 |      2,447        0.49       96.94
         81 |     12,191        2.44       99.38
         87 |      1,533        0.31       99.69
         95 |      1,569        0.31      100.00
------------+-----------------------------------
      Total |    500,302      100.00

. 
. * create sample splits based on data in founder years
. local continuous lnL lnKL lnQL

. local dummy exporter slow

. foreach X of var `continuous' {
  2.         egen mean_`X' = mean(cond(founder==1 & year<=first_exit_year,`X',.
> )), by(frame_id)
  3.         egen median_`X' = median(mean_`X'), by(industry_mode)
  4.         gen byte H_`X' = mean_`X' > median_`X'
  5.         tab H_`X'
  6. }
(202025 missing values generated)
(75 missing values generated)

      H_lnL |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |    406,448       40.33       40.33
          1 |    601,291       59.67      100.00
------------+-----------------------------------
      Total |  1,007,739      100.00
(202025 missing values generated)
(75 missing values generated)

     H_lnKL |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |    406,559       40.34       40.34
          1 |    601,180       59.66      100.00
------------+-----------------------------------
      Total |  1,007,739      100.00
(202025 missing values generated)
(75 missing values generated)

     H_lnQL |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |    407,081       40.40       40.40
          1 |    600,658       59.60      100.00
------------+-----------------------------------
      Total |  1,007,739      100.00

. foreach X of var `dummy' {
  2.         egen mean_`X' = mean(cond(founder==1 & year<=first_exit_year,`X',.
> )), by(frame_id)
  3.         gen byte H_`X' = mean_`X' > 0.5
  4.         tab H_`X'
  5. }
(202025 missing values generated)

 H_exporter |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |    444,452       44.10       44.10
          1 |    563,287       55.90      100.00
------------+-----------------------------------
      Total |  1,007,739      100.00
(202025 missing values generated)

     H_slow |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |    413,866       41.07       41.07
          1 |    593,873       58.93      100.00
------------+-----------------------------------
      Total |  1,007,739      100.00

. gen byte H_early = enter_year<=2000

. gen byte H_young_firm = age<=10

. 
. codebook frame_id

-------------------------------------------------------------------------------
frame_id                                                            (unlabeled)
-------------------------------------------------------------------------------

                  type:  string (str12), but longest is str10

         unique values:  23,899                   missing "":  0/1,007,739

              examples:  "ft10455944"
                         "ft10809408"
                         "ft11261168"
                         "ft12353271"

. 
. * time invariant vars
. foreach X of var expat foreign {
  2.         egen first_year_`X' = min(cond(`X'==1,year,.)), by(frame_id)
  3.         egen ever_`X' = max(`X'==1), by(frame_id)
  4. }
(443623 missing values generated)
(618901 missing values generated)

. 
. gen tenure_foreign = year-first_year_foreign
(618,901 missing values generated)

. 
. 
. *foreign visszahúzása expatba, valaha expat-tal, de soha foreign-mal bíró cég
> ek teljes kidobása
. replace foreign=1 if first_year_expat<=year&foreign==0&ever_foreign==1
(76,878 real changes made)

. drop first_year_foreign

. egen first_year_foreign = min(cond(foreign==1,year,.)), by(frame_id)
(618901 missing values generated)

. 
. drop if ever_expat==1 & ever_foreign==0
(229,328 observations deleted)

. scalar dropped_do3_expat_firmyears = r(N_drop)

. 
. * spell relation dummies
. gen byte before = year<enter_year

. gen byte during = year>=enter_year & year<=first_exit_year

. gen byte after = year>first_exit_year

. gen tenure = year-enter_year

. 
. * spell-to-spell transition
. gen byte DD = (lag_expat==0)&(expat==0)

. gen byte DE = (lag_expat==0)&(expat==1)

. gen byte ED = (lag_expat==1)&(expat==0)

. gen byte EE = (lag_expat==1)&(expat==1)

. 
. * newly arriving CEOs
. local T 4

. gen byte domestic = (expat==0)

. foreach X of var domestic expat DD DE ED EE {
  2.         gen byte new_`X' = (tenure <=`T') & (tenure>=0) & (`X'==1)
  3.         
.         * new managers at foreign firms
.         gen byte fnew_`X' = new_`X' & foreign==1
  4.         * only include managers joining in years [-1,...) since foreign
.         replace fnew_`X' = 0 if tenure > tenure_foreign+1
  5. 
.         foreach Y of var tenure before during after {
  6.                 gen `Y'_`X' = (`X'==1)*`Y'
  7.                 foreach Z of var H_* {
  8.                         gen `Y'_`X'_`Z' = (`X'==1)*`Y'*(`Z'==1)
  9.                 }
 10.         }
 11. }
(6,818 real changes made)
(4,139 real changes made)
(1,398 real changes made)
(483 real changes made)
(983 real changes made)
(525 real changes made)

. gen fold_expat = expat==1 & tenure>`T'

. gen byte new = new_domestic | new_expat

. gen byte fnew = fnew_domestic | fnew_expat

. 
. *foreign_switch interakció létrehozása
. gen byte foreign_new = foreign & new

. 
. 
. ** do stats here
. tempvar tag

. foreach X of var foreign new expat new_expat fnew fnew_expat {
  2.         count if `X'==1
  3.         scalar N_it_`X' = r(N)
  4.         
.         * by firms
.         egen `tag' = tag(frame_id `X')
  5.         count if `X'==1 & `tag'==1
  6.         scalar N_i_`X' = r(N)
  7.         drop `tag'
  8. }
  359,028
  5,704
  230,387
  18,520
  189,842
  4,175
  52,016
  4,136
  86,433
  5,208
  47,877
  3,734

. 
. 
. *Firm_tag
. egen firm_tag=tag(frame_id)

. egen firm_person = group(frame_id manager_id)

. 
. * zero out all treatment dummies for founders. they are alwyas just control
. foreach X of var before during after DD DE ED EE {
  2.         replace `X' = 0 if founder==1
  3. }
(0 real changes made)
(154,869 real changes made)
(106,844 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)

. 
. *Teljes minta elmentése a kontrollokkal
. compress
  variable year was float now int
  variable emp was long now int
  variable id was float now int
  variable relative_year was float now byte
  variable foreign_infirst was float now byte
  variable industry_year was float now int
  variable ind_year was float now byte
  variable manufacturing was float now byte
  variable age was float now int
  variable age_cat was float now byte
  variable N_ceos was long now byte
  variable total_CEOs was float now byte
  variable ceo_span was float now byte
  variable industry_ceo_span was float now byte
  variable mean_slow was float now byte
  variable first_year_expat was float now int
  variable ever_expat was float now byte
  variable ever_foreign was float now byte
  variable tenure_foreign was float now byte
  variable first_year_foreign was float now int
  variable tenure was float now byte
  variable tenure_domestic was float now byte
  variable tenure_domestic_H_lnL was float now byte
  variable tenure_domestic_H_lnKL was float now byte
  variable tenure_domestic_H_lnQL was float now byte
  variable tenure_domestic_H_exporter was float now byte
  variable tenure_domestic_H_slow was float now byte
  variable tenure_domestic_H_early was float now byte
  variable tenure_domestic_H_young_firm was float now byte
  variable before_domestic was float now byte
  variable before_domestic_H_lnL was float now byte
  variable before_domestic_H_lnKL was float now byte
  variable before_domestic_H_lnQL was float now byte
  variable before_domestic_H_exporter was float now byte
  variable before_domestic_H_slow was float now byte
  variable before_domestic_H_early was float now byte
  variable before_domestic_H_young_firm was float now byte
  variable during_domestic was float now byte
  variable during_domestic_H_lnL was float now byte
  variable during_domestic_H_lnKL was float now byte
  variable during_domestic_H_lnQL was float now byte
  variable during_domestic_H_exporter was float now byte
  variable during_domestic_H_slow was float now byte
  variable during_domestic_H_early was float now byte
  variable during_domestic_H_young_firm was float now byte
  variable after_domestic was float now byte
  variable after_domestic_H_lnL was float now byte
  variable after_domestic_H_lnKL was float now byte
  variable after_domestic_H_lnQL was float now byte
  variable after_domestic_H_exporter was float now byte
  variable after_domestic_H_slow was float now byte
  variable after_domestic_H_early was float now byte
  variable after_domestic_H_young_firm was float now byte
  variable tenure_expat was float now byte
  variable tenure_expat_H_lnL was float now byte
  variable tenure_expat_H_lnKL was float now byte
  variable tenure_expat_H_lnQL was float now byte
  variable tenure_expat_H_exporter was float now byte
  variable tenure_expat_H_slow was float now byte
  variable tenure_expat_H_early was float now byte
  variable tenure_expat_H_young_firm was float now byte
  variable before_expat was float now byte
  variable before_expat_H_lnL was float now byte
  variable before_expat_H_lnKL was float now byte
  variable before_expat_H_lnQL was float now byte
  variable before_expat_H_exporter was float now byte
  variable before_expat_H_slow was float now byte
  variable before_expat_H_early was float now byte
  variable before_expat_H_young_firm was float now byte
  variable during_expat was float now byte
  variable during_expat_H_lnL was float now byte
  variable during_expat_H_lnKL was float now byte
  variable during_expat_H_lnQL was float now byte
  variable during_expat_H_exporter was float now byte
  variable during_expat_H_slow was float now byte
  variable during_expat_H_early was float now byte
  variable during_expat_H_young_firm was float now byte
  variable after_expat was float now byte
  variable after_expat_H_lnL was float now byte
  variable after_expat_H_lnKL was float now byte
  variable after_expat_H_lnQL was float now byte
  variable after_expat_H_exporter was float now byte
  variable after_expat_H_slow was float now byte
  variable after_expat_H_early was float now byte
  variable after_expat_H_young_firm was float now byte
  variable tenure_DD was float now byte
  variable tenure_DD_H_lnL was float now byte
  variable tenure_DD_H_lnKL was float now byte
  variable tenure_DD_H_lnQL was float now byte
  variable tenure_DD_H_exporter was float now byte
  variable tenure_DD_H_slow was float now byte
  variable tenure_DD_H_early was float now byte
  variable tenure_DD_H_young_firm was float now byte
  variable before_DD was float now byte
  variable before_DD_H_lnL was float now byte
  variable before_DD_H_lnKL was float now byte
  variable before_DD_H_lnQL was float now byte
  variable before_DD_H_exporter was float now byte
  variable before_DD_H_slow was float now byte
  variable before_DD_H_early was float now byte
  variable before_DD_H_young_firm was float now byte
  variable during_DD was float now byte
  variable during_DD_H_lnL was float now byte
  variable during_DD_H_lnKL was float now byte
  variable during_DD_H_lnQL was float now byte
  variable during_DD_H_exporter was float now byte
  variable during_DD_H_slow was float now byte
  variable during_DD_H_early was float now byte
  variable during_DD_H_young_firm was float now byte
  variable after_DD was float now byte
  variable after_DD_H_lnL was float now byte
  variable after_DD_H_lnKL was float now byte
  variable after_DD_H_lnQL was float now byte
  variable after_DD_H_exporter was float now byte
  variable after_DD_H_slow was float now byte
  variable after_DD_H_early was float now byte
  variable after_DD_H_young_firm was float now byte
  variable tenure_DE was float now byte
  variable tenure_DE_H_lnL was float now byte
  variable tenure_DE_H_lnKL was float now byte
  variable tenure_DE_H_lnQL was float now byte
  variable tenure_DE_H_exporter was float now byte
  variable tenure_DE_H_slow was float now byte
  variable tenure_DE_H_early was float now byte
  variable tenure_DE_H_young_firm was float now byte
  variable before_DE was float now byte
  variable before_DE_H_lnL was float now byte
  variable before_DE_H_lnKL was float now byte
  variable before_DE_H_lnQL was float now byte
  variable before_DE_H_exporter was float now byte
  variable before_DE_H_slow was float now byte
  variable before_DE_H_early was float now byte
  variable before_DE_H_young_firm was float now byte
  variable during_DE was float now byte
  variable during_DE_H_lnL was float now byte
  variable during_DE_H_lnKL was float now byte
  variable during_DE_H_lnQL was float now byte
  variable during_DE_H_exporter was float now byte
  variable during_DE_H_slow was float now byte
  variable during_DE_H_early was float now byte
  variable during_DE_H_young_firm was float now byte
  variable after_DE was float now byte
  variable after_DE_H_lnL was float now byte
  variable after_DE_H_lnKL was float now byte
  variable after_DE_H_lnQL was float now byte
  variable after_DE_H_exporter was float now byte
  variable after_DE_H_slow was float now byte
  variable after_DE_H_early was float now byte
  variable after_DE_H_young_firm was float now byte
  variable tenure_ED was float now byte
  variable tenure_ED_H_lnL was float now byte
  variable tenure_ED_H_lnKL was float now byte
  variable tenure_ED_H_lnQL was float now byte
  variable tenure_ED_H_exporter was float now byte
  variable tenure_ED_H_slow was float now byte
  variable tenure_ED_H_early was float now byte
  variable tenure_ED_H_young_firm was float now byte
  variable before_ED was float now byte
  variable before_ED_H_lnL was float now byte
  variable before_ED_H_lnKL was float now byte
  variable before_ED_H_lnQL was float now byte
  variable before_ED_H_exporter was float now byte
  variable before_ED_H_slow was float now byte
  variable before_ED_H_early was float now byte
  variable before_ED_H_young_firm was float now byte
  variable during_ED was float now byte
  variable during_ED_H_lnL was float now byte
  variable during_ED_H_lnKL was float now byte
  variable during_ED_H_lnQL was float now byte
  variable during_ED_H_exporter was float now byte
  variable during_ED_H_slow was float now byte
  variable during_ED_H_early was float now byte
  variable during_ED_H_young_firm was float now byte
  variable after_ED was float now byte
  variable after_ED_H_lnL was float now byte
  variable after_ED_H_lnKL was float now byte
  variable after_ED_H_lnQL was float now byte
  variable after_ED_H_exporter was float now byte
  variable after_ED_H_slow was float now byte
  variable after_ED_H_early was float now byte
  variable after_ED_H_young_firm was float now byte
  variable tenure_EE was float now byte
  variable tenure_EE_H_lnL was float now byte
  variable tenure_EE_H_lnKL was float now byte
  variable tenure_EE_H_lnQL was float now byte
  variable tenure_EE_H_exporter was float now byte
  variable tenure_EE_H_slow was float now byte
  variable tenure_EE_H_early was float now byte
  variable tenure_EE_H_young_firm was float now byte
  variable before_EE was float now byte
  variable before_EE_H_lnL was float now byte
  variable before_EE_H_lnKL was float now byte
  variable before_EE_H_lnQL was float now byte
  variable before_EE_H_exporter was float now byte
  variable before_EE_H_slow was float now byte
  variable before_EE_H_early was float now byte
  variable before_EE_H_young_firm was float now byte
  variable during_EE was float now byte
  variable during_EE_H_lnL was float now byte
  variable during_EE_H_lnKL was float now byte
  variable during_EE_H_lnQL was float now byte
  variable during_EE_H_exporter was float now byte
  variable during_EE_H_slow was float now byte
  variable during_EE_H_early was float now byte
  variable during_EE_H_young_firm was float now byte
  variable after_EE was float now byte
  variable after_EE_H_lnL was float now byte
  variable after_EE_H_lnKL was float now byte
  variable after_EE_H_lnQL was float now byte
  variable after_EE_H_exporter was float now byte
  variable after_EE_H_slow was float now byte
  variable after_EE_H_early was float now byte
  variable after_EE_H_young_firm was float now byte
  variable fold_expat was float now byte
  variable jetok was double now long
  variable export was double now long
  variable ranyag was double now long
  variable wbill was double now long
  variable sales was double now long
  variable final_netgep was double now long
  variable frame_id was str12 now str10
  (514,529,671 bytes saved)

. save temp/analysis_sample, replace
file temp/analysis_sample.dta saved

. save_all_to_json

. log close
      name:  <unnamed>
       log:  /Users/koren/Google Drive/Research/expat/research_design/talk/outp
> ut/variables.log
  log type:  text
 closed on:   4 Dec 2018, 14:44:10
-------------------------------------------------------------------------------
