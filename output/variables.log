-------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/koren/Google Drive/Research/expat/research_design/talk/outp
> ut/variables.log
  log type:  text
 opened on:   4 Dec 2018, 16:08:45

. 
. use temp/firm_ceo_panel

. 
. scalar T1 = 1989

. scalar T2 = 2016

. expand T2-T1+1
(2,324,943 observations created)

. bys frame_id manager_id: gen year = _n-1+T1

. 
. tempfile expand

. save `expand', replace
(note: file /var/folders/f4/7drmhl1d5kj3wp1r33jvx32m0000gn/T//St04838.000001 no
> t found)
file /var/folders/f4/7drmhl1d5kj3wp1r33jvx32m0000gn/T//St04838.000001 saved

. 
. merge m:1 frame_id year using temp/balance-small, nogen keep(match)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                         1,276,058  
    -----------------------------------------

. merge m:1 frame_id year using temp/N_ceos, nogen keep(match)
(note: variable frame_id was str10, now str12 to accommodate using data's
       values)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                         1,128,710  
    -----------------------------------------

. * drop very large firms
. egen fp_tag = tag(frame_id manager_id ) 

. egen total_CEOs = sum(fp_tag ), by(frame_id )

. tab total_CEOs 

 total_CEOs |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |     42,570        3.77        3.77
          2 |    115,496       10.23       14.00
          3 |    138,396       12.26       26.27
          4 |    127,196       11.27       37.53
          5 |    105,375        9.34       46.87
          6 |     91,038        8.07       54.94
          7 |     79,191        7.02       61.95
          8 |     57,832        5.12       67.08
          9 |     49,104        4.35       71.43
         10 |     42,640        3.78       75.20
         11 |     38,599        3.42       78.62
         12 |     30,240        2.68       81.30
         13 |     23,959        2.12       83.43
         14 |     24,682        2.19       85.61
         15 |     17,295        1.53       87.14
         16 |     15,424        1.37       88.51
         17 |     15,878        1.41       89.92
         18 |     12,636        1.12       91.04
         19 |      9,443        0.84       91.87
         20 |      8,720        0.77       92.65
         21 |      6,615        0.59       93.23
         22 |      5,896        0.52       93.76
         23 |      4,439        0.39       94.15
         24 |      6,792        0.60       94.75
         25 |      4,150        0.37       95.12
         26 |      2,496        0.22       95.34
         27 |      2,322        0.21       95.54
         28 |      1,400        0.12       95.67
         29 |      4,234        0.38       96.04
         30 |      1,890        0.17       96.21
         31 |      3,379        0.30       96.51
         32 |        800        0.07       96.58
         33 |      2,013        0.18       96.76
         34 |      2,074        0.18       96.94
         35 |      1,295        0.11       97.06
         36 |      1,332        0.12       97.18
         37 |        814        0.07       97.25
         38 |      3,116        0.28       97.52
         41 |      1,025        0.09       97.62
         42 |      5,502        0.49       98.10
         43 |      2,193        0.19       98.30
         46 |      2,254        0.20       98.50
         49 |      1,176        0.10       98.60
         51 |      1,122        0.10       98.70
         52 |        780        0.07       98.77
         55 |      1,210        0.11       98.88
         56 |      1,008        0.09       98.97
         64 |      2,240        0.20       99.16
         67 |        268        0.02       99.19
         80 |      1,760        0.16       99.34
         85 |      2,040        0.18       99.53
         87 |      2,175        0.19       99.72
        177 |      3,186        0.28      100.00
------------+-----------------------------------
      Total |  1,128,710      100.00

. 
. drop if total_CEOs>15
(145,097 observations deleted)

. scalar dropped_too_many_CEOs = r(N_drop)

. 
. gen ceo_span = first_exit_year-enter_year+1

. tab ceo_span

   ceo_span |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |    192,228       19.54       19.54
          2 |    121,932       12.40       31.94
          3 |     93,811        9.54       41.48
          4 |     78,529        7.98       49.46
          5 |     74,490        7.57       57.03
          6 |     52,438        5.33       62.36
          7 |     44,110        4.48       66.85
          8 |     37,992        3.86       70.71
          9 |     36,684        3.73       74.44
         10 |     30,644        3.12       77.56
         11 |     24,789        2.52       80.08
         12 |     22,237        2.26       82.34
         13 |     22,145        2.25       84.59
         14 |     17,763        1.81       86.39
         15 |     16,102        1.64       88.03
         16 |     14,175        1.44       89.47
         17 |     15,018        1.53       91.00
         18 |     11,466        1.17       92.17
         19 |     11,525        1.17       93.34
         20 |     10,998        1.12       94.46
         21 |      9,666        0.98       95.44
         22 |      7,709        0.78       96.22
         23 |      7,951        0.81       97.03
         24 |      7,371        0.75       97.78
         25 |      8,278        0.84       98.62
         26 |      5,545        0.56       99.18
         27 |      3,602        0.37       99.55
         28 |        809        0.08       99.63
         29 |        137        0.01       99.65
         30 |         63        0.01       99.65
         31 |        111        0.01       99.67
         32 |        116        0.01       99.68
         33 |        191        0.02       99.70
         34 |         56        0.01       99.70
         35 |         56        0.01       99.71
         36 |         92        0.01       99.72
         37 |        220        0.02       99.74
         38 |        109        0.01       99.75
         39 |        132        0.01       99.76
         40 |        214        0.02       99.79
         41 |        240        0.02       99.81
         42 |        489        0.05       99.86
         43 |        356        0.04       99.90
         44 |        208        0.02       99.92
         45 |        157        0.02       99.93
         46 |         84        0.01       99.94
         47 |         52        0.01       99.95
         48 |         53        0.01       99.95
         49 |         61        0.01       99.96
         50 |         49        0.00       99.96
         51 |         42        0.00       99.97
         53 |         66        0.01       99.97
         55 |         25        0.00       99.98
         56 |         18        0.00       99.98
         58 |        140        0.01       99.99
         61 |         24        0.00      100.00
         64 |         45        0.00      100.00
------------+-----------------------------------
      Total |    983,613      100.00

. egen industry_ceo_span = median(ceo_span), by(industry_mode)

. tab industry_ceo_span

industry_ce |
     o_span |      Freq.     Percent        Cum.
------------+-----------------------------------
          2 |      7,628        0.78        0.78
          3 |     42,899        4.36        5.14
          4 |    346,456       35.22       40.36
          5 |    430,767       43.79       84.15
          6 |    155,863       15.85      100.00
------------+-----------------------------------
      Total |    983,613      100.00

. gen byte slow = industry_ceo_span>4

. 
. tab industry_mode if slow

industry_mo |
         de |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |     79,846       13.61       13.61
          5 |        477        0.08       13.69
          8 |      3,468        0.59       14.28
         13 |     12,220        2.08       16.37
         14 |     18,752        3.20       19.56
         15 |      8,302        1.42       20.98
         16 |     11,863        2.02       23.00
         18 |      9,472        1.61       24.62
         25 |     51,440        8.77       33.38
         27 |     13,369        2.28       35.66
         28 |     30,045        5.12       40.78
         31 |      9,240        1.58       42.36
         32 |      4,400        0.75       43.11
         33 |      1,952        0.33       43.44
         41 |     27,203        4.64       48.08
         42 |     22,279        3.80       51.88
         43 |     25,073        4.27       56.15
         45 |     30,496        5.20       61.35
         46 |     94,591       16.12       77.47
         47 |     55,751        9.50       86.98
         49 |     22,544        3.84       90.82
         56 |     18,945        3.23       94.05
         71 |     17,254        2.94       96.99
         74 |      2,447        0.42       97.41
         81 |     12,099        2.06       99.47
         87 |      1,533        0.26       99.73
         95 |      1,569        0.27      100.00
------------+-----------------------------------
      Total |    586,630      100.00

. 
. * create sample splits based on data in founder years
. local continuous lnL lnKL lnQL

. local dummy exporter slow

. foreach X of var `continuous' {
  2.         egen mean_`X' = mean(cond(founder==1 & year<=first_exit_year,`X',.
> )), by(frame_id)
  3.         egen median_`X' = median(mean_`X'), by(industry_mode)
  4.         gen byte H_`X' = mean_`X' > median_`X'
  5.         tab H_`X'
  6. }
(196392 missing values generated)
(75 missing values generated)

      H_lnL |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |    397,584       40.42       40.42
          1 |    586,029       59.58      100.00
------------+-----------------------------------
      Total |    983,613      100.00
(196392 missing values generated)
(75 missing values generated)

     H_lnKL |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |    397,621       40.42       40.42
          1 |    585,992       59.58      100.00
------------+-----------------------------------
      Total |    983,613      100.00
(196392 missing values generated)
(75 missing values generated)

     H_lnQL |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |    398,656       40.53       40.53
          1 |    584,957       59.47      100.00
------------+-----------------------------------
      Total |    983,613      100.00

. foreach X of var `dummy' {
  2.         egen mean_`X' = mean(cond(founder==1 & year<=first_exit_year,`X',.
> )), by(frame_id)
  3.         gen byte H_`X' = mean_`X' > 0.5
  4.         tab H_`X'
  5. }
(196392 missing values generated)

 H_exporter |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |    434,803       44.20       44.20
          1 |    548,810       55.80      100.00
------------+-----------------------------------
      Total |    983,613      100.00
(196392 missing values generated)

     H_slow |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |    322,502       32.79       32.79
          1 |    661,111       67.21      100.00
------------+-----------------------------------
      Total |    983,613      100.00

. gen byte H_early = enter_year<=2000

. gen byte H_young_firm = age<=10

. 
. codebook frame_id

-------------------------------------------------------------------------------
frame_id                                                            (unlabeled)
-------------------------------------------------------------------------------

                  type:  string (str12), but longest is str10

         unique values:  23,618                   missing "":  0/983,613

              examples:  "ft10455793"
                         "ft10813229"
                         "ft11262547"
                         "ft12369410"

. 
. * time invariant vars
. foreach X of var expat foreign {
  2.         egen first_year_`X' = min(cond(`X'==1,year,.)), by(frame_id)
  3.         egen ever_`X' = max(`X'==1), by(frame_id)
  4. }
(437802 missing values generated)
(618803 missing values generated)

. 
. gen tenure_foreign = year-first_year_foreign
(618,803 missing values generated)

. 
. 
. *foreign visszahúzása expatba, valaha expat-tal, de soha foreign-mal bíró cég
> ek teljes kidobása
. replace foreign=1 if first_year_expat<=year&foreign==0&ever_foreign==1
(68,050 real changes made)

. drop first_year_foreign

. egen first_year_foreign = min(cond(foreign==1,year,.)), by(frame_id)
(618803 missing values generated)

. 
. drop if ever_expat==1 & ever_foreign==0
(229,328 observations deleted)

. scalar dropped_do3_expat_firmyears = r(N_drop)

. 
. * spell relation dummies
. gen byte before = year<enter_year

. gen byte during = year>=enter_year & year<=first_exit_year

. gen byte after = year>first_exit_year

. gen tenure = year-enter_year

. 
. * spell-to-spell transition
. gen byte DD = (lag_expat==0)&(expat==0)

. gen byte DE = (lag_expat==0)&(expat==1)

. gen byte ED = (lag_expat==1)&(expat==0)

. gen byte EE = (lag_expat==1)&(expat==1)

. 
. * newly arriving CEOs
. local T 4

. gen byte domestic = (expat==0)

. foreach X of var domestic expat DD DE ED EE {
  2.         gen byte new_`X' = (tenure <=`T') & (tenure>=0) & (`X'==1)
  3.         
.         * new managers at foreign firms
.         gen byte fnew_`X' = new_`X' & foreign==1
  4.         * only include managers joining in years [-1,...) since foreign
.         replace fnew_`X' = 0 if tenure > tenure_foreign+1
  5. 
.         foreach Y of var tenure before during after {
  6.                 gen `Y'_`X' = (`X'==1)*`Y'
  7.                 foreach Z of var H_* {
  8.                         gen `Y'_`X'_`Z' = (`X'==1)*`Y'*(`Z'==1)
  9.                 }
 10.         }
 11. }
(6,289 real changes made)
(3,853 real changes made)
(1,278 real changes made)
(445 real changes made)
(893 real changes made)
(475 real changes made)

. gen fold_expat = expat==1 & tenure>`T'

. gen byte new = new_domestic | new_expat

. gen byte fnew = fnew_domestic | fnew_expat

. 
. *foreign_switch interakció létrehozása
. gen byte foreign_new = foreign & new

. 
. 
. ** do stats here
. tempvar tag

. foreach X of var foreign new expat new_expat fnew fnew_expat {
  2.         count if `X'==1
  3.         scalar N_it_`X' = r(N)
  4.         
.         * by firms
.         egen `tag' = tag(frame_id `X')
  5.         count if `X'==1 & `tag'==1
  6.         scalar N_i_`X' = r(N)
  7.         drop `tag'
  8. }
  338,436
  5,430
  224,473
  18,241
  182,515
  3,994
  50,345
  3,960
  82,283
  4,966
  46,492
  3,593

. 
. 
. *Firm_tag
. egen firm_tag=tag(frame_id)

. egen firm_person = group(frame_id manager_id)

. 
. * zero out all treatment dummies for founders. they are alwyas just control
. foreach X of var before during after DD DE ED EE {
  2.         replace `X' = 0 if founder==1
  3. }
(0 real changes made)
(152,521 real changes made)
(103,265 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)

. 
. *Teljes minta elmentése a kontrollokkal
. compress
  variable year was float now int
  variable emp was long now int
  variable id was float now int
  variable relative_year was float now byte
  variable foreign_infirst was float now byte
  variable industry_year was float now int
  variable ind_year was float now byte
  variable manufacturing was float now byte
  variable age was float now int
  variable age_cat was float now byte
  variable N_ceos was long now byte
  variable total_CEOs was float now byte
  variable ceo_span was float now byte
  variable industry_ceo_span was float now byte
  variable mean_slow was float now byte
  variable first_year_expat was float now int
  variable ever_expat was float now byte
  variable ever_foreign was float now byte
  variable tenure_foreign was float now byte
  variable first_year_foreign was float now int
  variable tenure was float now byte
  variable tenure_domestic was float now byte
  variable tenure_domestic_H_lnL was float now byte
  variable tenure_domestic_H_lnKL was float now byte
  variable tenure_domestic_H_lnQL was float now byte
  variable tenure_domestic_H_exporter was float now byte
  variable tenure_domestic_H_slow was float now byte
  variable tenure_domestic_H_early was float now byte
  variable tenure_domestic_H_young_firm was float now byte
  variable before_domestic was float now byte
  variable before_domestic_H_lnL was float now byte
  variable before_domestic_H_lnKL was float now byte
  variable before_domestic_H_lnQL was float now byte
  variable before_domestic_H_exporter was float now byte
  variable before_domestic_H_slow was float now byte
  variable before_domestic_H_early was float now byte
  variable before_domestic_H_young_firm was float now byte
  variable during_domestic was float now byte
  variable during_domestic_H_lnL was float now byte
  variable during_domestic_H_lnKL was float now byte
  variable during_domestic_H_lnQL was float now byte
  variable during_domestic_H_exporter was float now byte
  variable during_domestic_H_slow was float now byte
  variable during_domestic_H_early was float now byte
  variable during_domestic_H_young_firm was float now byte
  variable after_domestic was float now byte
  variable after_domestic_H_lnL was float now byte
  variable after_domestic_H_lnKL was float now byte
  variable after_domestic_H_lnQL was float now byte
  variable after_domestic_H_exporter was float now byte
  variable after_domestic_H_slow was float now byte
  variable after_domestic_H_early was float now byte
  variable after_domestic_H_young_firm was float now byte
  variable tenure_expat was float now byte
  variable tenure_expat_H_lnL was float now byte
  variable tenure_expat_H_lnKL was float now byte
  variable tenure_expat_H_lnQL was float now byte
  variable tenure_expat_H_exporter was float now byte
  variable tenure_expat_H_slow was float now byte
  variable tenure_expat_H_early was float now byte
  variable tenure_expat_H_young_firm was float now byte
  variable before_expat was float now byte
  variable before_expat_H_lnL was float now byte
  variable before_expat_H_lnKL was float now byte
  variable before_expat_H_lnQL was float now byte
  variable before_expat_H_exporter was float now byte
  variable before_expat_H_slow was float now byte
  variable before_expat_H_early was float now byte
  variable before_expat_H_young_firm was float now byte
  variable during_expat was float now byte
  variable during_expat_H_lnL was float now byte
  variable during_expat_H_lnKL was float now byte
  variable during_expat_H_lnQL was float now byte
  variable during_expat_H_exporter was float now byte
  variable during_expat_H_slow was float now byte
  variable during_expat_H_early was float now byte
  variable during_expat_H_young_firm was float now byte
  variable after_expat was float now byte
  variable after_expat_H_lnL was float now byte
  variable after_expat_H_lnKL was float now byte
  variable after_expat_H_lnQL was float now byte
  variable after_expat_H_exporter was float now byte
  variable after_expat_H_slow was float now byte
  variable after_expat_H_early was float now byte
  variable after_expat_H_young_firm was float now byte
  variable tenure_DD was float now byte
  variable tenure_DD_H_lnL was float now byte
  variable tenure_DD_H_lnKL was float now byte
  variable tenure_DD_H_lnQL was float now byte
  variable tenure_DD_H_exporter was float now byte
  variable tenure_DD_H_slow was float now byte
  variable tenure_DD_H_early was float now byte
  variable tenure_DD_H_young_firm was float now byte
  variable before_DD was float now byte
  variable before_DD_H_lnL was float now byte
  variable before_DD_H_lnKL was float now byte
  variable before_DD_H_lnQL was float now byte
  variable before_DD_H_exporter was float now byte
  variable before_DD_H_slow was float now byte
  variable before_DD_H_early was float now byte
  variable before_DD_H_young_firm was float now byte
  variable during_DD was float now byte
  variable during_DD_H_lnL was float now byte
  variable during_DD_H_lnKL was float now byte
  variable during_DD_H_lnQL was float now byte
  variable during_DD_H_exporter was float now byte
  variable during_DD_H_slow was float now byte
  variable during_DD_H_early was float now byte
  variable during_DD_H_young_firm was float now byte
  variable after_DD was float now byte
  variable after_DD_H_lnL was float now byte
  variable after_DD_H_lnKL was float now byte
  variable after_DD_H_lnQL was float now byte
  variable after_DD_H_exporter was float now byte
  variable after_DD_H_slow was float now byte
  variable after_DD_H_early was float now byte
  variable after_DD_H_young_firm was float now byte
  variable tenure_DE was float now byte
  variable tenure_DE_H_lnL was float now byte
  variable tenure_DE_H_lnKL was float now byte
  variable tenure_DE_H_lnQL was float now byte
  variable tenure_DE_H_exporter was float now byte
  variable tenure_DE_H_slow was float now byte
  variable tenure_DE_H_early was float now byte
  variable tenure_DE_H_young_firm was float now byte
  variable before_DE was float now byte
  variable before_DE_H_lnL was float now byte
  variable before_DE_H_lnKL was float now byte
  variable before_DE_H_lnQL was float now byte
  variable before_DE_H_exporter was float now byte
  variable before_DE_H_slow was float now byte
  variable before_DE_H_early was float now byte
  variable before_DE_H_young_firm was float now byte
  variable during_DE was float now byte
  variable during_DE_H_lnL was float now byte
  variable during_DE_H_lnKL was float now byte
  variable during_DE_H_lnQL was float now byte
  variable during_DE_H_exporter was float now byte
  variable during_DE_H_slow was float now byte
  variable during_DE_H_early was float now byte
  variable during_DE_H_young_firm was float now byte
  variable after_DE was float now byte
  variable after_DE_H_lnL was float now byte
  variable after_DE_H_lnKL was float now byte
  variable after_DE_H_lnQL was float now byte
  variable after_DE_H_exporter was float now byte
  variable after_DE_H_slow was float now byte
  variable after_DE_H_early was float now byte
  variable after_DE_H_young_firm was float now byte
  variable tenure_ED was float now byte
  variable tenure_ED_H_lnL was float now byte
  variable tenure_ED_H_lnKL was float now byte
  variable tenure_ED_H_lnQL was float now byte
  variable tenure_ED_H_exporter was float now byte
  variable tenure_ED_H_slow was float now byte
  variable tenure_ED_H_early was float now byte
  variable tenure_ED_H_young_firm was float now byte
  variable before_ED was float now byte
  variable before_ED_H_lnL was float now byte
  variable before_ED_H_lnKL was float now byte
  variable before_ED_H_lnQL was float now byte
  variable before_ED_H_exporter was float now byte
  variable before_ED_H_slow was float now byte
  variable before_ED_H_early was float now byte
  variable before_ED_H_young_firm was float now byte
  variable during_ED was float now byte
  variable during_ED_H_lnL was float now byte
  variable during_ED_H_lnKL was float now byte
  variable during_ED_H_lnQL was float now byte
  variable during_ED_H_exporter was float now byte
  variable during_ED_H_slow was float now byte
  variable during_ED_H_early was float now byte
  variable during_ED_H_young_firm was float now byte
  variable after_ED was float now byte
  variable after_ED_H_lnL was float now byte
  variable after_ED_H_lnKL was float now byte
  variable after_ED_H_lnQL was float now byte
  variable after_ED_H_exporter was float now byte
  variable after_ED_H_slow was float now byte
  variable after_ED_H_early was float now byte
  variable after_ED_H_young_firm was float now byte
  variable tenure_EE was float now byte
  variable tenure_EE_H_lnL was float now byte
  variable tenure_EE_H_lnKL was float now byte
  variable tenure_EE_H_lnQL was float now byte
  variable tenure_EE_H_exporter was float now byte
  variable tenure_EE_H_slow was float now byte
  variable tenure_EE_H_early was float now byte
  variable tenure_EE_H_young_firm was float now byte
  variable before_EE was float now byte
  variable before_EE_H_lnL was float now byte
  variable before_EE_H_lnKL was float now byte
  variable before_EE_H_lnQL was float now byte
  variable before_EE_H_exporter was float now byte
  variable before_EE_H_slow was float now byte
  variable before_EE_H_early was float now byte
  variable before_EE_H_young_firm was float now byte
  variable during_EE was float now byte
  variable during_EE_H_lnL was float now byte
  variable during_EE_H_lnKL was float now byte
  variable during_EE_H_lnQL was float now byte
  variable during_EE_H_exporter was float now byte
  variable during_EE_H_slow was float now byte
  variable during_EE_H_early was float now byte
  variable during_EE_H_young_firm was float now byte
  variable after_EE was float now byte
  variable after_EE_H_lnL was float now byte
  variable after_EE_H_lnKL was float now byte
  variable after_EE_H_lnQL was float now byte
  variable after_EE_H_exporter was float now byte
  variable after_EE_H_slow was float now byte
  variable after_EE_H_early was float now byte
  variable after_EE_H_young_firm was float now byte
  variable fold_expat was float now byte
  variable jetok was double now long
  variable export was double now long
  variable ranyag was double now long
  variable wbill was double now long
  variable sales was double now long
  variable final_netgep was double now long
  variable frame_id was str12 now str10
  (498,582,385 bytes saved)

. save temp/analysis_sample, replace
file temp/analysis_sample.dta saved

. save_all_to_json

. log close
      name:  <unnamed>
       log:  /Users/koren/Google Drive/Research/expat/research_design/talk/outp
> ut/variables.log
  log type:  text
 closed on:   4 Dec 2018, 16:10:23
-------------------------------------------------------------------------------
