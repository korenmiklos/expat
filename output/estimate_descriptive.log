--------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/koren/Google Drive/Research/expat/research_design/talk/output/estimate_descriptive.log
  log type:  text
 opened on:   4 Dec 2018, 17:13:52

. 
. 
. use temp/analysis_sample

. 
. *Dinamika
. scalar Tbefore = 4

. scalar Tduring = 6

. scalar Tafter = 4

. 
. gen byte analysis_window = (tenure>=-Tbefore-1)&(year-first_exit_year<=Tafter)

. 
. global sample_baseline (analysis_window==1)

. global sample_manufacturing $sample_baseline & (manufacturing==1)

. global sample_acquisitions $sample_baseline & (greenfield==0)

. 
. global samples baseline acquisitions

. 
. global outcomes lnL lnKL lnQL exporter

. label var lnL "Employment (log)"

. label var lnKL "Capital per worker (log)"

. label var lnQL "Revenue per worker (log)"

. label var exporter "Firm is an exporter (dummy)"

. 
. egen person_tag = tag(frame_id manager_id)

. egen N = sum(person_tag), by(frame_id)

. gen inverse_weight = 1/N

. 
. * verify founders are not in analysis sample
. foreach X of var during* after* {
  2.         replace `X'=0 if founder==1
  3. }
(0 real changes made)
(132,464 real changes made)
(55,048 real changes made)
(73,335 real changes made)
(81,604 real changes made)
(46,715 real changes made)
(88,449 real changes made)
(96,285 real changes made)
(94,584 real changes made)
(20,057 real changes made)
(10,166 real changes made)
(13,405 real changes made)
(13,063 real changes made)
(15,361 real changes made)
(11,994 real changes made)
(13,939 real changes made)
(17,025 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(70,373 real changes made)
(35,951 real changes made)
(37,925 real changes made)
(38,899 real changes made)
(31,710 real changes made)
(44,472 real changes made)
(52,990 real changes made)
(32,396 real changes made)
(32,892 real changes made)
(19,164 real changes made)
(22,477 real changes made)
(19,915 real changes made)
(25,211 real changes made)
(20,097 real changes made)
(27,732 real changes made)
(15,077 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)

. 
. xtset firm_person year
       panel variable:  firm_person (unbalanced)
        time variable:  year, 1992 to 2016, but with gaps
                delta:  1 unit

. 
. do est_`1'

. local i = 1

. foreach X of var $outcomes {
  2.         foreach sample in $samples {
  3.                 * simple, descriptive regressions first, including founders, but not before/after years
.                 reg `X' foreign expat i.ind_year i.age_cat if ${sample_`sample'} & year>=enter_year & year<=first_exit_year [a
> w=inverse_weight], vce(cluster id)
  4.                 do regram output/regression/`sample'_OLS `i' `X'
  5. 
.                 xtreg `X' foreign expat i.ind_year i.age_cat if ${sample_`sample'} & year>=enter_year & year<=first_exit_year 
> [aw=inverse_weight], i(id) fe vce(cluster id)
  6.                 local r2_w = `e(r2_w)'
  7.                 do regram output/regression/`sample'_FE `i' `X' R2_within "`r2_w'"
  8.         }
  9.         local i = `i' + 1
 10. }
(sum of wgt is 116,031.571570903)

Linear regression                               Number of obs     =    311,119
                                                F(75, 18507)      =      40.45
                                                Prob > F          =     0.0000
                                                R-squared         =     0.0727
                                                Root MSE          =     1.0113

                                (Std. Err. adjusted for 18,508 clusters in id)
------------------------------------------------------------------------------
             |               Robust
         lnL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .3968028   .0207821    19.09   0.000      .356068    .4375375
       expat |   .0035631   .0244946     0.15   0.884    -.0444486    .0515748
             |
    ind_year |
          2  |  -.1144104   .0280604    -4.08   0.000    -.1694113   -.0594094
          3  |  -.2213342   .0323348    -6.85   0.000    -.2847135   -.1579549
          4  |  -.2964991   .0339898    -8.72   0.000    -.3631222    -.229876
          5  |  -.3347454   .0349629    -9.57   0.000     -.403276   -.2662149
          6  |  -.4021774   .0355181   -11.32   0.000    -.4717962   -.3325586
          7  |  -.4071611   .0360993   -11.28   0.000     -.477919   -.3364033
          8  |   -.378163   .0363288   -10.41   0.000    -.4493707   -.3069553
          9  |  -.3592311   .0363747    -9.88   0.000    -.4305288   -.2879334
         10  |  -.3627089   .0366441    -9.90   0.000    -.4345348   -.2908831
         11  |  -.3639607   .0368874    -9.87   0.000    -.4362634   -.2916581
         12  |  -.3627249   .0368131    -9.85   0.000    -.4348819   -.2905678
         13  |  -.3147501   .0366318    -8.59   0.000    -.3865518   -.2429485
         14  |  -.3031444   .0365849    -8.29   0.000    -.3748541   -.2314346
         15  |  -.2745963   .0365018    -7.52   0.000    -.3461432   -.2030495
         16  |  -.2614519    .036428    -7.18   0.000    -.3328542   -.1900497
         17  |  -.2363042   .0366721    -6.44   0.000    -.3081849   -.1644236
         18  |  -.2706225   .0366844    -7.38   0.000    -.3425273   -.1987177
         19  |  -.2650282   .0368782    -7.19   0.000    -.3373128   -.1927436
         20  |  -.2490941   .0369657    -6.74   0.000    -.3215502    -.176638
         21  |  -.2543249   .0371468    -6.85   0.000    -.3271361   -.1815136
         22  |  -.2497099   .0372251    -6.71   0.000    -.3226746   -.1767452
         23  |   -.230167   .0373313    -6.17   0.000    -.3033398   -.1569942
         24  |  -.1760093   .0382095    -4.61   0.000    -.2509035   -.1011152
         25  |  -.1326953   .0386349    -3.43   0.001    -.2084233   -.0569674
         26  |   .3897128   .0544684     7.15   0.000     .2829498    .4964759
         27  |   .1738966   .0460238     3.78   0.000     .0836856    .2641075
         28  |   .1074774   .0434708     2.47   0.013     .0222707    .1926841
         29  |   .0326144   .0421819     0.77   0.439     -.050066    .1152949
         30  |  -.0103666   .0410542    -0.25   0.801    -.0908366    .0701034
         31  |   .0015742   .0401748     0.04   0.969    -.0771721    .0803206
         32  |  -.0184392   .0396454    -0.47   0.642    -.0961479    .0592694
         33  |  -.0381732   .0390168    -0.98   0.328    -.1146496    .0383033
         34  |  -.0532491   .0387525    -1.37   0.169    -.1292075    .0227093
         35  |  -.0565706   .0383497    -1.48   0.140    -.1317395    .0185983
         36  |  -.0934093     .03827    -2.44   0.015     -.168422   -.0183966
         37  |  -.0897867   .0383834    -2.34   0.019    -.1650216   -.0145517
         38  |  -.0930691   .0386507    -2.41   0.016    -.1688281   -.0173102
         39  |  -.0928637   .0384153    -2.42   0.016    -.1681612   -.0175661
         40  |  -.0901218   .0388975    -2.32   0.021    -.1663645   -.0138792
         41  |  -.0551103   .0385545    -1.43   0.153    -.1306806      .02046
         42  |  -.0467588   .0387523    -1.21   0.228    -.1227168    .0291993
         43  |  -.1303135   .0391229    -3.33   0.001     -.206998    -.053629
         44  |  -.1183719   .0395658    -2.99   0.003    -.1959246   -.0408192
         45  |  -.0774738   .0396659    -1.95   0.051    -.1552225     .000275
         46  |   -.032981   .0396254    -0.83   0.405    -.1106504    .0446884
         47  |  -.0044319   .0401618    -0.11   0.912    -.0831528    .0742889
         48  |   .0378044   .0403854     0.94   0.349    -.0413547    .1169635
         49  |   .1157465   .0412893     2.80   0.005     .0348156    .1966773
         50  |   .1541635   .0420199     3.67   0.000     .0718007    .2365263
             |
     age_cat |
          1  |   .2893536   .0214886    13.47   0.000     .2472339    .3314732
          2  |   .4677176   .0223355    20.94   0.000      .423938    .5114972
          3  |   .5605284   .0229866    24.39   0.000     .5154725    .6055842
          4  |   .6391583   .0235482    27.14   0.000     .5930016    .6853151
          5  |   .7072942   .0241139    29.33   0.000     .6600287    .7545597
          6  |   .7554959   .0244223    30.93   0.000     .7076259     .803366
          7  |   .7890839   .0248422    31.76   0.000     .7403909    .8377769
          8  |   .8104131    .025238    32.11   0.000     .7609442     .859882
          9  |   .8118201   .0255904    31.72   0.000     .7616605    .8619796
         10  |   .8117348   .0258248    31.43   0.000     .7611158    .8623539
         11  |   .8139585   .0262305    31.03   0.000     .7625444    .8653727
         12  |    .820165   .0265059    30.94   0.000      .768211    .8721189
         13  |   .8150206   .0268112    30.40   0.000     .7624682    .8675731
         14  |   .7925799   .0273032    29.03   0.000     .7390631    .8460967
         15  |   .7796034   .0278417    28.00   0.000     .7250311    .8341757
         16  |   .7530753   .0285251    26.40   0.000     .6971636    .8089871
         17  |    .723441   .0293926    24.61   0.000     .6658288    .7810533
         18  |   .7056133   .0300681    23.47   0.000      .646677    .7645496
         19  |   .6814948   .0311918    21.85   0.000     .6203561    .7426335
         20  |   .6212426   .0330348    18.81   0.000     .5564913    .6859939
         25  |   .5394603   .0466952    11.55   0.000     .4479334    .6309872
         30  |    .621861   .0770034     8.08   0.000     .4709272    .7727948
         40  |   .8052176   .0700325    11.50   0.000     .6679474    .9424879
         50  |   .4392939   .0933748     4.70   0.000     .2562708    .6223171
             |
       _cons |   3.088894   .0378079    81.70   0.000     3.014787    3.163001
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. local fmt "%10.5f"

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }

. 
. estimates

--------------------------------------------------------------------------------------------------------------------------------
active results
--------------------------------------------------------------------------------------------------------------------------------

Linear regression                               Number of obs     =    311,119
                                                F(75, 18507)      =      40.45
                                                Prob > F          =     0.0000
                                                R-squared         =     0.0727
                                                Root MSE          =     1.0113

                                (Std. Err. adjusted for 18,508 clusters in id)
------------------------------------------------------------------------------
             |               Robust
         lnL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .3968028   .0207821    19.09   0.000      .356068    .4375375
       expat |   .0035631   .0244946     0.15   0.884    -.0444486    .0515748
             |
    ind_year |
          2  |  -.1144104   .0280604    -4.08   0.000    -.1694113   -.0594094
          3  |  -.2213342   .0323348    -6.85   0.000    -.2847135   -.1579549
          4  |  -.2964991   .0339898    -8.72   0.000    -.3631222    -.229876
          5  |  -.3347454   .0349629    -9.57   0.000     -.403276   -.2662149
          6  |  -.4021774   .0355181   -11.32   0.000    -.4717962   -.3325586
          7  |  -.4071611   .0360993   -11.28   0.000     -.477919   -.3364033
          8  |   -.378163   .0363288   -10.41   0.000    -.4493707   -.3069553
          9  |  -.3592311   .0363747    -9.88   0.000    -.4305288   -.2879334
         10  |  -.3627089   .0366441    -9.90   0.000    -.4345348   -.2908831
         11  |  -.3639607   .0368874    -9.87   0.000    -.4362634   -.2916581
         12  |  -.3627249   .0368131    -9.85   0.000    -.4348819   -.2905678
         13  |  -.3147501   .0366318    -8.59   0.000    -.3865518   -.2429485
         14  |  -.3031444   .0365849    -8.29   0.000    -.3748541   -.2314346
         15  |  -.2745963   .0365018    -7.52   0.000    -.3461432   -.2030495
         16  |  -.2614519    .036428    -7.18   0.000    -.3328542   -.1900497
         17  |  -.2363042   .0366721    -6.44   0.000    -.3081849   -.1644236
         18  |  -.2706225   .0366844    -7.38   0.000    -.3425273   -.1987177
         19  |  -.2650282   .0368782    -7.19   0.000    -.3373128   -.1927436
         20  |  -.2490941   .0369657    -6.74   0.000    -.3215502    -.176638
         21  |  -.2543249   .0371468    -6.85   0.000    -.3271361   -.1815136
         22  |  -.2497099   .0372251    -6.71   0.000    -.3226746   -.1767452
         23  |   -.230167   .0373313    -6.17   0.000    -.3033398   -.1569942
         24  |  -.1760093   .0382095    -4.61   0.000    -.2509035   -.1011152
         25  |  -.1326953   .0386349    -3.43   0.001    -.2084233   -.0569674
         26  |   .3897128   .0544684     7.15   0.000     .2829498    .4964759
         27  |   .1738966   .0460238     3.78   0.000     .0836856    .2641075
         28  |   .1074774   .0434708     2.47   0.013     .0222707    .1926841
         29  |   .0326144   .0421819     0.77   0.439     -.050066    .1152949
         30  |  -.0103666   .0410542    -0.25   0.801    -.0908366    .0701034
         31  |   .0015742   .0401748     0.04   0.969    -.0771721    .0803206
         32  |  -.0184392   .0396454    -0.47   0.642    -.0961479    .0592694
         33  |  -.0381732   .0390168    -0.98   0.328    -.1146496    .0383033
         34  |  -.0532491   .0387525    -1.37   0.169    -.1292075    .0227093
         35  |  -.0565706   .0383497    -1.48   0.140    -.1317395    .0185983
         36  |  -.0934093     .03827    -2.44   0.015     -.168422   -.0183966
         37  |  -.0897867   .0383834    -2.34   0.019    -.1650216   -.0145517
         38  |  -.0930691   .0386507    -2.41   0.016    -.1688281   -.0173102
         39  |  -.0928637   .0384153    -2.42   0.016    -.1681612   -.0175661
         40  |  -.0901218   .0388975    -2.32   0.021    -.1663645   -.0138792
         41  |  -.0551103   .0385545    -1.43   0.153    -.1306806      .02046
         42  |  -.0467588   .0387523    -1.21   0.228    -.1227168    .0291993
         43  |  -.1303135   .0391229    -3.33   0.001     -.206998    -.053629
         44  |  -.1183719   .0395658    -2.99   0.003    -.1959246   -.0408192
         45  |  -.0774738   .0396659    -1.95   0.051    -.1552225     .000275
         46  |   -.032981   .0396254    -0.83   0.405    -.1106504    .0446884
         47  |  -.0044319   .0401618    -0.11   0.912    -.0831528    .0742889
         48  |   .0378044   .0403854     0.94   0.349    -.0413547    .1169635
         49  |   .1157465   .0412893     2.80   0.005     .0348156    .1966773
         50  |   .1541635   .0420199     3.67   0.000     .0718007    .2365263
             |
     age_cat |
          1  |   .2893536   .0214886    13.47   0.000     .2472339    .3314732
          2  |   .4677176   .0223355    20.94   0.000      .423938    .5114972
          3  |   .5605284   .0229866    24.39   0.000     .5154725    .6055842
          4  |   .6391583   .0235482    27.14   0.000     .5930016    .6853151
          5  |   .7072942   .0241139    29.33   0.000     .6600287    .7545597
          6  |   .7554959   .0244223    30.93   0.000     .7076259     .803366
          7  |   .7890839   .0248422    31.76   0.000     .7403909    .8377769
          8  |   .8104131    .025238    32.11   0.000     .7609442     .859882
          9  |   .8118201   .0255904    31.72   0.000     .7616605    .8619796
         10  |   .8117348   .0258248    31.43   0.000     .7611158    .8623539
         11  |   .8139585   .0262305    31.03   0.000     .7625444    .8653727
         12  |    .820165   .0265059    30.94   0.000      .768211    .8721189
         13  |   .8150206   .0268112    30.40   0.000     .7624682    .8675731
         14  |   .7925799   .0273032    29.03   0.000     .7390631    .8460967
         15  |   .7796034   .0278417    28.00   0.000     .7250311    .8341757
         16  |   .7530753   .0285251    26.40   0.000     .6971636    .8089871
         17  |    .723441   .0293926    24.61   0.000     .6658288    .7810533
         18  |   .7056133   .0300681    23.47   0.000      .646677    .7645496
         19  |   .6814948   .0311918    21.85   0.000     .6203561    .7426335
         20  |   .6212426   .0330348    18.81   0.000     .5564913    .6859939
         25  |   .5394603   .0466952    11.55   0.000     .4479334    .6309872
         30  |    .621861   .0770034     8.08   0.000     .4709272    .7727948
         40  |   .8052176   .0700325    11.50   0.000     .6679474    .9424879
         50  |   .4392939   .0933748     4.70   0.000     .2562708    .6223171
             |
       _cons |   3.088894   .0378079    81.70   0.000     3.014787    3.163001
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text replace

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b', "`fmt'")) _newline
  6.         file write `output' ("   standard_error: " + string(`se', "`fmt'")) _newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se', "`fmt'")) _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',"pvalue"),colnumb(`coefs',"`X'")]), "`fmt'") _
> newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file
warning: existing panel variable is not id

Fixed-effects (within) regression               Number of obs     =    311,119
Group variable: id                              Number of groups  =     18,508

R-sq:                                           Obs per group:
     within  = 0.1138                                         min =          1
     between = 0.0118                                         avg =       16.8
     overall = 0.0264                                         max =        140

                                                F(75,18507)       =      55.30
corr(u_i, Xb)  = -0.3491                        Prob > F          =     0.0000

                                (Std. Err. adjusted for 18,508 clusters in id)
------------------------------------------------------------------------------
             |               Robust
         lnL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |  -.0143761   .0317239    -0.45   0.650    -.0765579    .0478058
       expat |  -.0432142   .0124241    -3.48   0.001    -.0675666   -.0188617
             |
    ind_year |
          2  |  -.1147425   .0243914    -4.70   0.000    -.1625519    -.066933
          3  |  -.2422387   .0308864    -7.84   0.000     -.302779   -.1816985
          4  |   -.376581   .0348162   -10.82   0.000     -.444824    -.308338
          5  |  -.4664116   .0391416   -11.92   0.000    -.5431327   -.3896905
          6  |  -.5584814   .0427933   -13.05   0.000    -.6423603   -.4746026
          7  |  -.6146619   .0464719   -13.23   0.000    -.7057511   -.5235727
          8  |  -.6517757   .0500077   -13.03   0.000    -.7497954   -.5537559
          9  |  -.6984171   .0537342   -13.00   0.000    -.8037411   -.5930931
         10  |  -.7677326   .0575245   -13.35   0.000    -.8804859   -.6549793
         11  |  -.8361671   .0610604   -13.69   0.000    -.9558511   -.7164831
         12  |  -.8877235    .064739   -13.71   0.000    -1.014618   -.7608291
         13  |  -.9199431   .0684937   -13.43   0.000    -1.054197   -.7856892
         14  |  -.9693867   .0722773   -13.41   0.000    -1.111057   -.8277166
         15  |  -.9995237    .076003   -13.15   0.000    -1.148497   -.8505507
         16  |  -1.049105   .0797949   -13.15   0.000     -1.20551   -.8926999
         17  |  -1.098325   .0838782   -13.09   0.000    -1.262734   -.9339156
         18  |  -1.199843   .0877472   -13.67   0.000    -1.371836   -1.027851
         19  |   -1.27645   .0914111   -13.96   0.000    -1.455624   -1.097276
         20  |  -1.332019   .0949564   -14.03   0.000    -1.518142   -1.145896
         21  |  -1.406434   .0983816   -14.30   0.000    -1.599271   -1.213597
         22  |  -1.457568   .1016738   -14.34   0.000    -1.656858   -1.258278
         23  |  -1.503609   .1050246   -14.32   0.000    -1.709467   -1.297751
         24  |  -1.548122   .1087768   -14.23   0.000    -1.761334   -1.334909
         25  |  -1.587458   .1126333   -14.09   0.000     -1.80823   -1.366686
         26  |   .5078723   .0650245     7.81   0.000     .3804184    .6353262
         27  |   .3497652   .0618136     5.66   0.000     .2286048    .4709256
         28  |   .2318092   .0598929     3.87   0.000     .1144135    .3492048
         29  |   .1172246   .0593804     1.97   0.048     .0008336    .2336156
         30  |   .0201666   .0589192     0.34   0.732    -.0953205    .1356538
         31  |  -.0419102   .0597716    -0.70   0.483    -.1590681    .0752477
         32  |   -.110386   .0606466    -1.82   0.069    -.2292589    .0084868
         33  |  -.1928241   .0623761    -3.09   0.002    -.3150871   -.0705612
         34  |  -.2576764   .0644809    -4.00   0.000    -.3840649   -.1312878
         35  |  -.3250887   .0667673    -4.87   0.000    -.4559586   -.1942187
         36  |  -.4256061   .0692759    -6.14   0.000    -.5613932    -.289819
         37  |  -.5000827   .0718029    -6.96   0.000    -.6408229   -.3593424
         38  |  -.5917297   .0748859    -7.90   0.000    -.7385129   -.4449464
         39  |  -.6558395   .0782867    -8.38   0.000    -.8092887   -.5023902
         40  |  -.7029353   .0820874    -8.56   0.000    -.8638343   -.5420364
         41  |  -.7308668   .0853164    -8.57   0.000    -.8980948   -.5636389
         42  |  -.7876429   .0887707    -8.87   0.000    -.9616417    -.613644
         43  |  -.9339883   .0926085   -10.09   0.000     -1.11551    -.752467
         44  |  -.9947075   .0967431   -10.28   0.000    -1.184333   -.8050821
         45  |  -1.009714   .1004364   -10.05   0.000    -1.206579   -.8128495
         46  |  -1.042784   .1039837   -10.03   0.000    -1.246601   -.8389661
         47  |  -1.072745   .1071994   -10.01   0.000    -1.282866   -.8626244
         48  |  -1.092497   .1106489    -9.87   0.000    -1.309379   -.8756153
         49  |  -1.117638   .1141196    -9.79   0.000    -1.341323   -.8939528
         50  |  -1.152689   .1170651    -9.85   0.000    -1.382148   -.9232309
             |
     age_cat |
          1  |   .4237045   .0178529    23.73   0.000     .3887111    .4586979
          2  |   .7306123    .020677    35.33   0.000     .6900836    .7711411
          3  |   .9477397   .0240286    39.44   0.000     .9006413     .994838
          4  |   1.126177   .0275349    40.90   0.000     1.072206    1.180148
          5  |   1.277721   .0313966    40.70   0.000     1.216181    1.339261
          6  |   1.408021   .0353102    39.88   0.000      1.33881    1.477232
          7  |   1.512001   .0394372    38.34   0.000       1.4347    1.589301
          8  |   1.611681   .0435973    36.97   0.000     1.526226    1.697136
          9  |   1.691382   .0477611    35.41   0.000     1.597766    1.784998
         10  |   1.765041   .0519078    34.00   0.000     1.663297    1.866785
         11  |   1.836483   .0561519    32.71   0.000      1.72642    1.946546
         12  |   1.911351   .0603908    31.65   0.000     1.792979    2.029722
         13  |   1.975759   .0646271    30.57   0.000     1.849084    2.102434
         14  |   2.025225   .0690369    29.34   0.000     1.889907    2.160544
         15  |   2.076065   .0734158    28.28   0.000     1.932163    2.219966
         16  |   2.113299   .0778216    27.16   0.000     1.960762    2.265837
         17  |   2.152726   .0823408    26.14   0.000      1.99133    2.314121
         18  |   2.205538   .0867109    25.44   0.000     2.035576    2.375499
         19  |   2.246692   .0912567    24.62   0.000      2.06782    2.425563
         20  |   2.332555   .0998505    23.36   0.000     2.136839    2.528271
         25  |   2.476822   .1139162    21.74   0.000     2.253536    2.700109
         30  |   2.173705   .1556204    13.97   0.000     1.868674    2.478735
         40  |   2.018097   .1763405    11.44   0.000     1.672453     2.36374
         50  |   1.884773   .1850109    10.19   0.000     1.522134    2.247411
             |
       _cons |   2.975808   .0430914    69.06   0.000     2.891345    3.060271
-------------+----------------------------------------------------------------
     sigma_u |  1.0792941
     sigma_e |  .64504074
         rho |  .73681856   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. local fmt "%10.5f"

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }
key: R2_within
value: .1138316927183624

. 
. estimates

--------------------------------------------------------------------------------------------------------------------------------
active results
--------------------------------------------------------------------------------------------------------------------------------

Fixed-effects (within) regression               Number of obs     =    311,119
Group variable: id                              Number of groups  =     18,508

R-sq:                                           Obs per group:
     within  = 0.1138                                         min =          1
     between = 0.0118                                         avg =       16.8
     overall = 0.0264                                         max =        140

                                                F(75,18507)       =      55.30
corr(u_i, Xb)  = -0.3491                        Prob > F          =     0.0000

                                (Std. Err. adjusted for 18,508 clusters in id)
------------------------------------------------------------------------------
             |               Robust
         lnL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |  -.0143761   .0317239    -0.45   0.650    -.0765579    .0478058
       expat |  -.0432142   .0124241    -3.48   0.001    -.0675666   -.0188617
             |
    ind_year |
          2  |  -.1147425   .0243914    -4.70   0.000    -.1625519    -.066933
          3  |  -.2422387   .0308864    -7.84   0.000     -.302779   -.1816985
          4  |   -.376581   .0348162   -10.82   0.000     -.444824    -.308338
          5  |  -.4664116   .0391416   -11.92   0.000    -.5431327   -.3896905
          6  |  -.5584814   .0427933   -13.05   0.000    -.6423603   -.4746026
          7  |  -.6146619   .0464719   -13.23   0.000    -.7057511   -.5235727
          8  |  -.6517757   .0500077   -13.03   0.000    -.7497954   -.5537559
          9  |  -.6984171   .0537342   -13.00   0.000    -.8037411   -.5930931
         10  |  -.7677326   .0575245   -13.35   0.000    -.8804859   -.6549793
         11  |  -.8361671   .0610604   -13.69   0.000    -.9558511   -.7164831
         12  |  -.8877235    .064739   -13.71   0.000    -1.014618   -.7608291
         13  |  -.9199431   .0684937   -13.43   0.000    -1.054197   -.7856892
         14  |  -.9693867   .0722773   -13.41   0.000    -1.111057   -.8277166
         15  |  -.9995237    .076003   -13.15   0.000    -1.148497   -.8505507
         16  |  -1.049105   .0797949   -13.15   0.000     -1.20551   -.8926999
         17  |  -1.098325   .0838782   -13.09   0.000    -1.262734   -.9339156
         18  |  -1.199843   .0877472   -13.67   0.000    -1.371836   -1.027851
         19  |   -1.27645   .0914111   -13.96   0.000    -1.455624   -1.097276
         20  |  -1.332019   .0949564   -14.03   0.000    -1.518142   -1.145896
         21  |  -1.406434   .0983816   -14.30   0.000    -1.599271   -1.213597
         22  |  -1.457568   .1016738   -14.34   0.000    -1.656858   -1.258278
         23  |  -1.503609   .1050246   -14.32   0.000    -1.709467   -1.297751
         24  |  -1.548122   .1087768   -14.23   0.000    -1.761334   -1.334909
         25  |  -1.587458   .1126333   -14.09   0.000     -1.80823   -1.366686
         26  |   .5078723   .0650245     7.81   0.000     .3804184    .6353262
         27  |   .3497652   .0618136     5.66   0.000     .2286048    .4709256
         28  |   .2318092   .0598929     3.87   0.000     .1144135    .3492048
         29  |   .1172246   .0593804     1.97   0.048     .0008336    .2336156
         30  |   .0201666   .0589192     0.34   0.732    -.0953205    .1356538
         31  |  -.0419102   .0597716    -0.70   0.483    -.1590681    .0752477
         32  |   -.110386   .0606466    -1.82   0.069    -.2292589    .0084868
         33  |  -.1928241   .0623761    -3.09   0.002    -.3150871   -.0705612
         34  |  -.2576764   .0644809    -4.00   0.000    -.3840649   -.1312878
         35  |  -.3250887   .0667673    -4.87   0.000    -.4559586   -.1942187
         36  |  -.4256061   .0692759    -6.14   0.000    -.5613932    -.289819
         37  |  -.5000827   .0718029    -6.96   0.000    -.6408229   -.3593424
         38  |  -.5917297   .0748859    -7.90   0.000    -.7385129   -.4449464
         39  |  -.6558395   .0782867    -8.38   0.000    -.8092887   -.5023902
         40  |  -.7029353   .0820874    -8.56   0.000    -.8638343   -.5420364
         41  |  -.7308668   .0853164    -8.57   0.000    -.8980948   -.5636389
         42  |  -.7876429   .0887707    -8.87   0.000    -.9616417    -.613644
         43  |  -.9339883   .0926085   -10.09   0.000     -1.11551    -.752467
         44  |  -.9947075   .0967431   -10.28   0.000    -1.184333   -.8050821
         45  |  -1.009714   .1004364   -10.05   0.000    -1.206579   -.8128495
         46  |  -1.042784   .1039837   -10.03   0.000    -1.246601   -.8389661
         47  |  -1.072745   .1071994   -10.01   0.000    -1.282866   -.8626244
         48  |  -1.092497   .1106489    -9.87   0.000    -1.309379   -.8756153
         49  |  -1.117638   .1141196    -9.79   0.000    -1.341323   -.8939528
         50  |  -1.152689   .1170651    -9.85   0.000    -1.382148   -.9232309
             |
     age_cat |
          1  |   .4237045   .0178529    23.73   0.000     .3887111    .4586979
          2  |   .7306123    .020677    35.33   0.000     .6900836    .7711411
          3  |   .9477397   .0240286    39.44   0.000     .9006413     .994838
          4  |   1.126177   .0275349    40.90   0.000     1.072206    1.180148
          5  |   1.277721   .0313966    40.70   0.000     1.216181    1.339261
          6  |   1.408021   .0353102    39.88   0.000      1.33881    1.477232
          7  |   1.512001   .0394372    38.34   0.000       1.4347    1.589301
          8  |   1.611681   .0435973    36.97   0.000     1.526226    1.697136
          9  |   1.691382   .0477611    35.41   0.000     1.597766    1.784998
         10  |   1.765041   .0519078    34.00   0.000     1.663297    1.866785
         11  |   1.836483   .0561519    32.71   0.000      1.72642    1.946546
         12  |   1.911351   .0603908    31.65   0.000     1.792979    2.029722
         13  |   1.975759   .0646271    30.57   0.000     1.849084    2.102434
         14  |   2.025225   .0690369    29.34   0.000     1.889907    2.160544
         15  |   2.076065   .0734158    28.28   0.000     1.932163    2.219966
         16  |   2.113299   .0778216    27.16   0.000     1.960762    2.265837
         17  |   2.152726   .0823408    26.14   0.000      1.99133    2.314121
         18  |   2.205538   .0867109    25.44   0.000     2.035576    2.375499
         19  |   2.246692   .0912567    24.62   0.000      2.06782    2.425563
         20  |   2.332555   .0998505    23.36   0.000     2.136839    2.528271
         25  |   2.476822   .1139162    21.74   0.000     2.253536    2.700109
         30  |   2.173705   .1556204    13.97   0.000     1.868674    2.478735
         40  |   2.018097   .1763405    11.44   0.000     1.672453     2.36374
         50  |   1.884773   .1850109    10.19   0.000     1.522134    2.247411
             |
       _cons |   2.975808   .0430914    69.06   0.000     2.891345    3.060271
-------------+----------------------------------------------------------------
     sigma_u |  1.0792941
     sigma_e |  .64504074
         rho |  .73681856   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text replace

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b', "`fmt'")) _newline
  6.         file write `output' ("   standard_error: " + string(`se', "`fmt'")) _newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se', "`fmt'")) _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',"pvalue"),colnumb(`coefs',"`X'")]), "`fmt'") _
> newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file
(sum of wgt is 96,323.3384407535)

Linear regression                               Number of obs     =    229,907
                                                F(75, 14528)      =      25.08
                                                Prob > F          =     0.0000
                                                R-squared         =     0.0496
                                                Root MSE          =     .98486

                                (Std. Err. adjusted for 14,529 clusters in id)
------------------------------------------------------------------------------
             |               Robust
         lnL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .4173433   .0376065    11.10   0.000     .3436299    .4910568
       expat |   -.000184   .0565134    -0.00   0.997    -.1109574    .1105893
             |
    ind_year |
          2  |  -.1244199   .0294426    -4.23   0.000    -.1821311   -.0667086
          3  |  -.2506806   .0343829    -7.29   0.000    -.3180754   -.1832858
          4  |  -.3250693   .0360829    -9.01   0.000    -.3957964   -.2543421
          5  |  -.3734918   .0370737   -10.07   0.000     -.446161   -.3008225
          6  |  -.4570634   .0378469   -12.08   0.000    -.5312481   -.3828787
          7  |  -.4697888   .0386322   -12.16   0.000    -.5455128   -.3940648
          8  |  -.4448196   .0388335   -11.45   0.000    -.5209383    -.368701
          9  |  -.4252826   .0389141   -10.93   0.000    -.5015592    -.349006
         10  |  -.4398132   .0391081   -11.25   0.000    -.5164701   -.3631563
         11  |   -.437657   .0393694   -11.12   0.000     -.514826    -.360488
         12  |  -.4335634   .0392386   -11.05   0.000     -.510476   -.3566508
         13  |  -.3900223   .0390599    -9.99   0.000    -.4665847     -.31346
         14  |  -.3800898   .0389935    -9.75   0.000     -.456522   -.3036575
         15  |  -.3521154   .0388458    -9.06   0.000    -.4282581   -.2759728
         16  |  -.3463884   .0388045    -8.93   0.000    -.4224501   -.2703267
         17  |  -.3358301   .0390064    -8.61   0.000    -.4122877   -.2593724
         18  |  -.3590572   .0390075    -9.20   0.000     -.435517   -.2825975
         19  |   -.354866   .0391711    -9.06   0.000    -.4316464   -.2780856
         20  |  -.3359015   .0392688    -8.55   0.000    -.4128733   -.2589297
         21  |  -.3355692   .0395142    -8.49   0.000     -.413022   -.2581164
         22  |  -.3246971   .0395731    -8.20   0.000    -.4022655   -.2471287
         23  |  -.3123545   .0396663    -7.87   0.000    -.3901054   -.2346035
         24  |  -.2713739   .0406671    -6.67   0.000    -.3510866   -.1916613
         25  |  -.2254272   .0410522    -5.49   0.000    -.3058948   -.1449597
         26  |   .3634684   .0610423     5.95   0.000     .2438177     .483119
         27  |   .1406832   .0509178     2.76   0.006     .0408778    .2404886
         28  |   .0819819   .0481027     1.70   0.088    -.0123056    .1762694
         29  |  -.0089585   .0470263    -0.19   0.849     -.101136    .0832191
         30  |  -.0583391   .0454725    -1.28   0.200    -.1474709    .0307928
         31  |  -.0669661   .0441936    -1.52   0.130    -.1535911    .0196589
         32  |   -.101969   .0431789    -2.36   0.018    -.1866051   -.0173329
         33  |  -.1364455   .0423596    -3.22   0.001    -.2194757   -.0534153
         34  |  -.1627898   .0422091    -3.86   0.000    -.2455251   -.0800546
         35  |  -.1733504   .0416673    -4.16   0.000    -.2550236   -.0916771
         36  |   -.201552   .0413057    -4.88   0.000    -.2825164   -.1205875
         37  |  -.1990606   .0414731    -4.80   0.000    -.2803532   -.1177681
         38  |  -.1972195   .0417302    -4.73   0.000    -.2790161    -.115423
         39  |  -.1937848   .0414502    -4.68   0.000    -.2750324   -.1125372
         40  |  -.1935738   .0420089    -4.61   0.000    -.2759166    -.111231
         41  |  -.1715572   .0415068    -4.13   0.000    -.2529159   -.0901985
         42  |  -.1675188   .0417063    -4.02   0.000    -.2492685   -.0857691
         43  |  -.2488317   .0422612    -5.89   0.000    -.3316689   -.1659944
         44  |  -.2322444   .0425824    -5.45   0.000    -.3157114   -.1487774
         45  |   -.205841   .0427896    -4.81   0.000     -.289714    -.121968
         46  |   -.167224   .0426542    -3.92   0.000    -.2508316   -.0836164
         47  |  -.1350634   .0434648    -3.11   0.002    -.2202601   -.0498668
         48  |  -.0906636   .0436131    -2.08   0.038    -.1761507   -.0051764
         49  |  -.0567405    .045115    -1.26   0.209    -.1451717    .0316907
         50  |   -.018802   .0458552    -0.41   0.682    -.1086841      .07108
             |
     age_cat |
          1  |   .2700856   .0233801    11.55   0.000     .2242577    .3159136
          2  |   .4294853   .0243702    17.62   0.000     .3817167     .477254
          3  |   .5151097   .0252279    20.42   0.000     .4656597    .5645597
          4  |   .5888222   .0258853    22.75   0.000     .5380838    .6395606
          5  |   .6570082   .0265264    24.77   0.000     .6050131    .7090033
          6  |   .7011863   .0268987    26.07   0.000     .6484613    .7539112
          7  |   .7363104   .0273552    26.92   0.000     .6826908      .78993
          8  |   .7530158   .0277796    27.11   0.000     .6985643    .8074673
          9  |   .7513965   .0281982    26.65   0.000     .6961244    .8066686
         10  |    .752995   .0283448    26.57   0.000     .6974355    .8085544
         11  |   .7597108   .0287749    26.40   0.000     .7033082    .8161133
         12  |     .76518   .0290488    26.34   0.000     .7082406    .8221194
         13  |   .7584757    .029393    25.80   0.000     .7008618    .8160897
         14  |   .7341557   .0299691    24.50   0.000     .6754125    .7928989
         15  |   .7220016   .0305082    23.67   0.000     .6622016    .7818016
         16  |   .6921769    .031215    22.17   0.000     .6309914    .7533623
         17  |   .6647914   .0321145    20.70   0.000     .6018429    .7277399
         18  |   .6430981   .0328858    19.56   0.000     .5786377    .7075586
         19  |   .6188066    .034179    18.10   0.000     .5518115    .6858017
         20  |   .5519827   .0360506    15.31   0.000      .481319    .6226465
         25  |   .4610349   .0506318     9.11   0.000     .3617901    .5602798
         30  |   .5432309   .0775194     7.01   0.000     .3912829    .6951789
         40  |   .7296762   .0706781    10.32   0.000     .5911381    .8682143
         50  |   .3958439   .0952638     4.16   0.000     .2091146    .5825732
             |
       _cons |   3.223869   .0401272    80.34   0.000     3.145215    3.302524
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. local fmt "%10.5f"

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }

. 
. estimates

--------------------------------------------------------------------------------------------------------------------------------
active results
--------------------------------------------------------------------------------------------------------------------------------

Linear regression                               Number of obs     =    229,907
                                                F(75, 14528)      =      25.08
                                                Prob > F          =     0.0000
                                                R-squared         =     0.0496
                                                Root MSE          =     .98486

                                (Std. Err. adjusted for 14,529 clusters in id)
------------------------------------------------------------------------------
             |               Robust
         lnL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .4173433   .0376065    11.10   0.000     .3436299    .4910568
       expat |   -.000184   .0565134    -0.00   0.997    -.1109574    .1105893
             |
    ind_year |
          2  |  -.1244199   .0294426    -4.23   0.000    -.1821311   -.0667086
          3  |  -.2506806   .0343829    -7.29   0.000    -.3180754   -.1832858
          4  |  -.3250693   .0360829    -9.01   0.000    -.3957964   -.2543421
          5  |  -.3734918   .0370737   -10.07   0.000     -.446161   -.3008225
          6  |  -.4570634   .0378469   -12.08   0.000    -.5312481   -.3828787
          7  |  -.4697888   .0386322   -12.16   0.000    -.5455128   -.3940648
          8  |  -.4448196   .0388335   -11.45   0.000    -.5209383    -.368701
          9  |  -.4252826   .0389141   -10.93   0.000    -.5015592    -.349006
         10  |  -.4398132   .0391081   -11.25   0.000    -.5164701   -.3631563
         11  |   -.437657   .0393694   -11.12   0.000     -.514826    -.360488
         12  |  -.4335634   .0392386   -11.05   0.000     -.510476   -.3566508
         13  |  -.3900223   .0390599    -9.99   0.000    -.4665847     -.31346
         14  |  -.3800898   .0389935    -9.75   0.000     -.456522   -.3036575
         15  |  -.3521154   .0388458    -9.06   0.000    -.4282581   -.2759728
         16  |  -.3463884   .0388045    -8.93   0.000    -.4224501   -.2703267
         17  |  -.3358301   .0390064    -8.61   0.000    -.4122877   -.2593724
         18  |  -.3590572   .0390075    -9.20   0.000     -.435517   -.2825975
         19  |   -.354866   .0391711    -9.06   0.000    -.4316464   -.2780856
         20  |  -.3359015   .0392688    -8.55   0.000    -.4128733   -.2589297
         21  |  -.3355692   .0395142    -8.49   0.000     -.413022   -.2581164
         22  |  -.3246971   .0395731    -8.20   0.000    -.4022655   -.2471287
         23  |  -.3123545   .0396663    -7.87   0.000    -.3901054   -.2346035
         24  |  -.2713739   .0406671    -6.67   0.000    -.3510866   -.1916613
         25  |  -.2254272   .0410522    -5.49   0.000    -.3058948   -.1449597
         26  |   .3634684   .0610423     5.95   0.000     .2438177     .483119
         27  |   .1406832   .0509178     2.76   0.006     .0408778    .2404886
         28  |   .0819819   .0481027     1.70   0.088    -.0123056    .1762694
         29  |  -.0089585   .0470263    -0.19   0.849     -.101136    .0832191
         30  |  -.0583391   .0454725    -1.28   0.200    -.1474709    .0307928
         31  |  -.0669661   .0441936    -1.52   0.130    -.1535911    .0196589
         32  |   -.101969   .0431789    -2.36   0.018    -.1866051   -.0173329
         33  |  -.1364455   .0423596    -3.22   0.001    -.2194757   -.0534153
         34  |  -.1627898   .0422091    -3.86   0.000    -.2455251   -.0800546
         35  |  -.1733504   .0416673    -4.16   0.000    -.2550236   -.0916771
         36  |   -.201552   .0413057    -4.88   0.000    -.2825164   -.1205875
         37  |  -.1990606   .0414731    -4.80   0.000    -.2803532   -.1177681
         38  |  -.1972195   .0417302    -4.73   0.000    -.2790161    -.115423
         39  |  -.1937848   .0414502    -4.68   0.000    -.2750324   -.1125372
         40  |  -.1935738   .0420089    -4.61   0.000    -.2759166    -.111231
         41  |  -.1715572   .0415068    -4.13   0.000    -.2529159   -.0901985
         42  |  -.1675188   .0417063    -4.02   0.000    -.2492685   -.0857691
         43  |  -.2488317   .0422612    -5.89   0.000    -.3316689   -.1659944
         44  |  -.2322444   .0425824    -5.45   0.000    -.3157114   -.1487774
         45  |   -.205841   .0427896    -4.81   0.000     -.289714    -.121968
         46  |   -.167224   .0426542    -3.92   0.000    -.2508316   -.0836164
         47  |  -.1350634   .0434648    -3.11   0.002    -.2202601   -.0498668
         48  |  -.0906636   .0436131    -2.08   0.038    -.1761507   -.0051764
         49  |  -.0567405    .045115    -1.26   0.209    -.1451717    .0316907
         50  |   -.018802   .0458552    -0.41   0.682    -.1086841      .07108
             |
     age_cat |
          1  |   .2700856   .0233801    11.55   0.000     .2242577    .3159136
          2  |   .4294853   .0243702    17.62   0.000     .3817167     .477254
          3  |   .5151097   .0252279    20.42   0.000     .4656597    .5645597
          4  |   .5888222   .0258853    22.75   0.000     .5380838    .6395606
          5  |   .6570082   .0265264    24.77   0.000     .6050131    .7090033
          6  |   .7011863   .0268987    26.07   0.000     .6484613    .7539112
          7  |   .7363104   .0273552    26.92   0.000     .6826908      .78993
          8  |   .7530158   .0277796    27.11   0.000     .6985643    .8074673
          9  |   .7513965   .0281982    26.65   0.000     .6961244    .8066686
         10  |    .752995   .0283448    26.57   0.000     .6974355    .8085544
         11  |   .7597108   .0287749    26.40   0.000     .7033082    .8161133
         12  |     .76518   .0290488    26.34   0.000     .7082406    .8221194
         13  |   .7584757    .029393    25.80   0.000     .7008618    .8160897
         14  |   .7341557   .0299691    24.50   0.000     .6754125    .7928989
         15  |   .7220016   .0305082    23.67   0.000     .6622016    .7818016
         16  |   .6921769    .031215    22.17   0.000     .6309914    .7533623
         17  |   .6647914   .0321145    20.70   0.000     .6018429    .7277399
         18  |   .6430981   .0328858    19.56   0.000     .5786377    .7075586
         19  |   .6188066    .034179    18.10   0.000     .5518115    .6858017
         20  |   .5519827   .0360506    15.31   0.000      .481319    .6226465
         25  |   .4610349   .0506318     9.11   0.000     .3617901    .5602798
         30  |   .5432309   .0775194     7.01   0.000     .3912829    .6951789
         40  |   .7296762   .0706781    10.32   0.000     .5911381    .8682143
         50  |   .3958439   .0952638     4.16   0.000     .2091146    .5825732
             |
       _cons |   3.223869   .0401272    80.34   0.000     3.145215    3.302524
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text replace

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b', "`fmt'")) _newline
  6.         file write `output' ("   standard_error: " + string(`se', "`fmt'")) _newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se', "`fmt'")) _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',"pvalue"),colnumb(`coefs',"`X'")]), "`fmt'") _
> newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file

Fixed-effects (within) regression               Number of obs     =    229,907
Group variable: id                              Number of groups  =     14,529

R-sq:                                           Obs per group:
     within  = 0.1062                                         min =          1
     between = 0.0101                                         avg =       15.8
     overall = 0.0239                                         max =        140

                                                F(75,14528)       =      39.95
corr(u_i, Xb)  = -0.3849                        Prob > F          =     0.0000

                                (Std. Err. adjusted for 14,529 clusters in id)
------------------------------------------------------------------------------
             |               Robust
         lnL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0227946   .0407455     0.56   0.576    -.0570717     .102661
       expat |   .0377238   .0314005     1.20   0.230    -.0238251    .0992728
             |
    ind_year |
          2  |  -.1224629   .0261763    -4.68   0.000    -.1737717   -.0711541
          3  |  -.2716961   .0336005    -8.09   0.000    -.3375573   -.2058349
          4  |  -.4162162   .0378093   -11.01   0.000    -.4903272   -.3421052
          5  |  -.5197883    .042404   -12.26   0.000    -.6029055   -.4366711
          6  |  -.6297841   .0465047   -13.54   0.000    -.7209394   -.5386289
          7  |  -.6922923   .0505968   -13.68   0.000    -.7914685   -.5931161
          8  |  -.7376113   .0543116   -13.58   0.000    -.8440689   -.6311536
          9  |  -.7895392   .0583056   -13.54   0.000    -.9038256   -.6752528
         10  |   -.864823   .0622712   -13.89   0.000    -.9868826   -.7427635
         11  |  -.9321578    .065929   -14.14   0.000    -1.061387   -.8029285
         12  |  -.9835326   .0697812   -14.09   0.000    -1.120313   -.8467526
         13  |  -1.019444   .0737019   -13.83   0.000     -1.16391   -.8749793
         14  |  -1.073065   .0776782   -13.81   0.000    -1.225324   -.9208055
         15  |  -1.104594   .0815559   -13.54   0.000    -1.264454   -.9447343
         16  |  -1.165459   .0855278   -13.63   0.000    -1.333104   -.9978138
         17  |  -1.221918    .089802   -13.61   0.000    -1.397941   -1.045894
         18  |  -1.317147   .0938336   -14.04   0.000    -1.501073   -1.133221
         19  |  -1.390906   .0976098   -14.25   0.000    -1.582234   -1.199579
         20  |  -1.445508   .1012932   -14.27   0.000    -1.644055    -1.24696
         21  |  -1.516695   .1048679   -14.46   0.000    -1.722249    -1.31114
         22  |  -1.565794   .1083065   -14.46   0.000    -1.778088   -1.353499
         23  |  -1.614658      .1118   -14.44   0.000      -1.8338   -1.395516
         24  |  -1.665179   .1157437   -14.39   0.000    -1.892052   -1.438307
         25  |    -1.7024   .1198013   -14.21   0.000    -1.937226   -1.467574
         26  |   .4544873   .0743873     6.11   0.000     .3086786    .6002959
         27  |   .2926782   .0701394     4.17   0.000      .155196    .4301603
         28  |   .1716799   .0677049     2.54   0.011     .0389697    .3043902
         29  |   .0414229   .0671643     0.62   0.537    -.0902277    .1730734
         30  |  -.0750562   .0663575    -1.13   0.258    -.2051253     .055013
         31  |  -.1456731    .066906    -2.18   0.029    -.2768174   -.0145289
         32  |  -.2302633   .0674321    -3.41   0.001    -.3624389   -.0980878
         33  |  -.3196816   .0691192    -4.63   0.000     -.455164   -.1841993
         34  |  -.3982724   .0712176    -5.59   0.000    -.5378681   -.2586768
         35  |  -.4668277    .073482    -6.35   0.000    -.6108617   -.3227937
         36  |  -.5534672   .0758236    -7.30   0.000    -.7020912   -.4048433
         37  |  -.6306414   .0783026    -8.05   0.000    -.7841244   -.4771584
         38  |  -.7160045   .0814057    -8.80   0.000      -.87557   -.5564389
         39  |  -.7805069   .0849287    -9.19   0.000     -.946978   -.6140358
         40  |  -.8299264   .0889226    -9.33   0.000    -1.004226   -.6556268
         41  |  -.8659058   .0921941    -9.39   0.000    -1.046618   -.6851936
         42  |  -.9264243   .0955623    -9.69   0.000    -1.113739   -.7391101
         43  |  -1.067504   .0994939   -10.73   0.000    -1.262525   -.8724833
         44  |  -1.122439   .1037047   -10.82   0.000    -1.325713   -.9191643
         45  |  -1.147291   .1076457   -10.66   0.000    -1.358291   -.9362922
         46  |  -1.177276   .1113508   -10.57   0.000    -1.395538   -.9590144
         47  |  -1.212424   .1146563   -10.57   0.000    -1.437165   -.9876831
         48  |  -1.233356   .1183049   -10.43   0.000    -1.465249   -1.001464
         49  |  -1.279023   .1219875   -10.48   0.000    -1.518135   -1.039912
         50  |  -1.317453   .1249563   -10.54   0.000    -1.562384   -1.072523
             |
     age_cat |
          1  |   .4240128   .0197394    21.48   0.000      .385321    .4627045
          2  |    .716485   .0228061    31.42   0.000     .6717821    .7611878
          3  |   .9316294   .0264634    35.20   0.000     .8797578     .983501
          4  |     1.1125   .0301354    36.92   0.000     1.053431    1.171569
          5  |    1.26725    .034217    37.04   0.000     1.200181     1.33432
          6  |   1.399937   .0383677    36.49   0.000     1.324731    1.475142
          7  |   1.508148   .0427564    35.27   0.000      1.42434    1.591956
          8  |   1.606425   .0471515    34.07   0.000     1.514003    1.698848
          9  |   1.684751   .0515124    32.71   0.000      1.58378    1.785722
         10  |   1.757387   .0558303    31.48   0.000     1.647952    1.866821
         11  |   1.830476    .060267    30.37   0.000     1.712345    1.948607
         12  |   1.906628    .064712    29.46   0.000     1.779784    2.033472
         13  |   1.969361   .0691378    28.48   0.000     1.833842     2.10488
         14  |   2.018448   .0738195    27.34   0.000     1.873752    2.163144
         15  |   2.067409   .0784015    26.37   0.000     1.913732    2.221086
         16  |   2.103844   .0830422    25.33   0.000      1.94107    2.266617
         17  |   2.142873     .08779    24.41   0.000     1.970793    2.314952
         18  |   2.195192   .0923808    23.76   0.000     2.014114     2.37627
         19  |   2.234385   .0972659    22.97   0.000     2.043732    2.425039
         20  |   2.318486   .1062728    21.82   0.000     2.110177    2.526794
         25  |   2.461659   .1211806    20.31   0.000     2.224129    2.699188
         30  |   2.182444   .1634827    13.35   0.000     1.861997    2.502891
         40  |   2.043806   .1852334    11.03   0.000     1.680725    2.406887
         50  |   1.927327   .1945898     9.90   0.000     1.545906    2.308748
             |
       _cons |   3.016232   .0459983    65.57   0.000      2.92607    3.106395
-------------+----------------------------------------------------------------
     sigma_u |  1.0621318
     sigma_e |  .64605715
         rho |  .72993457   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. local fmt "%10.5f"

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }
key: R2_within
value: .1061853773543986

. 
. estimates

--------------------------------------------------------------------------------------------------------------------------------
active results
--------------------------------------------------------------------------------------------------------------------------------

Fixed-effects (within) regression               Number of obs     =    229,907
Group variable: id                              Number of groups  =     14,529

R-sq:                                           Obs per group:
     within  = 0.1062                                         min =          1
     between = 0.0101                                         avg =       15.8
     overall = 0.0239                                         max =        140

                                                F(75,14528)       =      39.95
corr(u_i, Xb)  = -0.3849                        Prob > F          =     0.0000

                                (Std. Err. adjusted for 14,529 clusters in id)
------------------------------------------------------------------------------
             |               Robust
         lnL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0227946   .0407455     0.56   0.576    -.0570717     .102661
       expat |   .0377238   .0314005     1.20   0.230    -.0238251    .0992728
             |
    ind_year |
          2  |  -.1224629   .0261763    -4.68   0.000    -.1737717   -.0711541
          3  |  -.2716961   .0336005    -8.09   0.000    -.3375573   -.2058349
          4  |  -.4162162   .0378093   -11.01   0.000    -.4903272   -.3421052
          5  |  -.5197883    .042404   -12.26   0.000    -.6029055   -.4366711
          6  |  -.6297841   .0465047   -13.54   0.000    -.7209394   -.5386289
          7  |  -.6922923   .0505968   -13.68   0.000    -.7914685   -.5931161
          8  |  -.7376113   .0543116   -13.58   0.000    -.8440689   -.6311536
          9  |  -.7895392   .0583056   -13.54   0.000    -.9038256   -.6752528
         10  |   -.864823   .0622712   -13.89   0.000    -.9868826   -.7427635
         11  |  -.9321578    .065929   -14.14   0.000    -1.061387   -.8029285
         12  |  -.9835326   .0697812   -14.09   0.000    -1.120313   -.8467526
         13  |  -1.019444   .0737019   -13.83   0.000     -1.16391   -.8749793
         14  |  -1.073065   .0776782   -13.81   0.000    -1.225324   -.9208055
         15  |  -1.104594   .0815559   -13.54   0.000    -1.264454   -.9447343
         16  |  -1.165459   .0855278   -13.63   0.000    -1.333104   -.9978138
         17  |  -1.221918    .089802   -13.61   0.000    -1.397941   -1.045894
         18  |  -1.317147   .0938336   -14.04   0.000    -1.501073   -1.133221
         19  |  -1.390906   .0976098   -14.25   0.000    -1.582234   -1.199579
         20  |  -1.445508   .1012932   -14.27   0.000    -1.644055    -1.24696
         21  |  -1.516695   .1048679   -14.46   0.000    -1.722249    -1.31114
         22  |  -1.565794   .1083065   -14.46   0.000    -1.778088   -1.353499
         23  |  -1.614658      .1118   -14.44   0.000      -1.8338   -1.395516
         24  |  -1.665179   .1157437   -14.39   0.000    -1.892052   -1.438307
         25  |    -1.7024   .1198013   -14.21   0.000    -1.937226   -1.467574
         26  |   .4544873   .0743873     6.11   0.000     .3086786    .6002959
         27  |   .2926782   .0701394     4.17   0.000      .155196    .4301603
         28  |   .1716799   .0677049     2.54   0.011     .0389697    .3043902
         29  |   .0414229   .0671643     0.62   0.537    -.0902277    .1730734
         30  |  -.0750562   .0663575    -1.13   0.258    -.2051253     .055013
         31  |  -.1456731    .066906    -2.18   0.029    -.2768174   -.0145289
         32  |  -.2302633   .0674321    -3.41   0.001    -.3624389   -.0980878
         33  |  -.3196816   .0691192    -4.63   0.000     -.455164   -.1841993
         34  |  -.3982724   .0712176    -5.59   0.000    -.5378681   -.2586768
         35  |  -.4668277    .073482    -6.35   0.000    -.6108617   -.3227937
         36  |  -.5534672   .0758236    -7.30   0.000    -.7020912   -.4048433
         37  |  -.6306414   .0783026    -8.05   0.000    -.7841244   -.4771584
         38  |  -.7160045   .0814057    -8.80   0.000      -.87557   -.5564389
         39  |  -.7805069   .0849287    -9.19   0.000     -.946978   -.6140358
         40  |  -.8299264   .0889226    -9.33   0.000    -1.004226   -.6556268
         41  |  -.8659058   .0921941    -9.39   0.000    -1.046618   -.6851936
         42  |  -.9264243   .0955623    -9.69   0.000    -1.113739   -.7391101
         43  |  -1.067504   .0994939   -10.73   0.000    -1.262525   -.8724833
         44  |  -1.122439   .1037047   -10.82   0.000    -1.325713   -.9191643
         45  |  -1.147291   .1076457   -10.66   0.000    -1.358291   -.9362922
         46  |  -1.177276   .1113508   -10.57   0.000    -1.395538   -.9590144
         47  |  -1.212424   .1146563   -10.57   0.000    -1.437165   -.9876831
         48  |  -1.233356   .1183049   -10.43   0.000    -1.465249   -1.001464
         49  |  -1.279023   .1219875   -10.48   0.000    -1.518135   -1.039912
         50  |  -1.317453   .1249563   -10.54   0.000    -1.562384   -1.072523
             |
     age_cat |
          1  |   .4240128   .0197394    21.48   0.000      .385321    .4627045
          2  |    .716485   .0228061    31.42   0.000     .6717821    .7611878
          3  |   .9316294   .0264634    35.20   0.000     .8797578     .983501
          4  |     1.1125   .0301354    36.92   0.000     1.053431    1.171569
          5  |    1.26725    .034217    37.04   0.000     1.200181     1.33432
          6  |   1.399937   .0383677    36.49   0.000     1.324731    1.475142
          7  |   1.508148   .0427564    35.27   0.000      1.42434    1.591956
          8  |   1.606425   .0471515    34.07   0.000     1.514003    1.698848
          9  |   1.684751   .0515124    32.71   0.000      1.58378    1.785722
         10  |   1.757387   .0558303    31.48   0.000     1.647952    1.866821
         11  |   1.830476    .060267    30.37   0.000     1.712345    1.948607
         12  |   1.906628    .064712    29.46   0.000     1.779784    2.033472
         13  |   1.969361   .0691378    28.48   0.000     1.833842     2.10488
         14  |   2.018448   .0738195    27.34   0.000     1.873752    2.163144
         15  |   2.067409   .0784015    26.37   0.000     1.913732    2.221086
         16  |   2.103844   .0830422    25.33   0.000      1.94107    2.266617
         17  |   2.142873     .08779    24.41   0.000     1.970793    2.314952
         18  |   2.195192   .0923808    23.76   0.000     2.014114     2.37627
         19  |   2.234385   .0972659    22.97   0.000     2.043732    2.425039
         20  |   2.318486   .1062728    21.82   0.000     2.110177    2.526794
         25  |   2.461659   .1211806    20.31   0.000     2.224129    2.699188
         30  |   2.182444   .1634827    13.35   0.000     1.861997    2.502891
         40  |   2.043806   .1852334    11.03   0.000     1.680725    2.406887
         50  |   1.927327   .1945898     9.90   0.000     1.545906    2.308748
             |
       _cons |   3.016232   .0459983    65.57   0.000      2.92607    3.106395
-------------+----------------------------------------------------------------
     sigma_u |  1.0621318
     sigma_e |  .64605715
         rho |  .72993457   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text replace

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b', "`fmt'")) _newline
  6.         file write `output' ("   standard_error: " + string(`se', "`fmt'")) _newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se', "`fmt'")) _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',"pvalue"),colnumb(`coefs',"`X'")]), "`fmt'") _
> newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file
(sum of wgt is 116,031.571570903)

Linear regression                               Number of obs     =    311,119
                                                F(75, 18507)      =     132.72
                                                Prob > F          =     0.0000
                                                R-squared         =     0.1403
                                                Root MSE          =     1.6894

                                (Std. Err. adjusted for 18,508 clusters in id)
------------------------------------------------------------------------------
             |               Robust
        lnKL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .5463166   .0328281    16.64   0.000     .4819706    .6106626
       expat |   .1134724    .039662     2.86   0.004     .0357312    .1912137
             |
    ind_year |
          2  |    .178078   .0373881     4.76   0.000     .1047939    .2513621
          3  |   .8150087   .0415583    19.61   0.000     .7335506    .8964669
          4  |    1.00104   .0446271    22.43   0.000     .9135665    1.088513
          5  |   1.136322   .0451257    25.18   0.000     1.047871    1.224772
          6  |   1.384203   .0460628    30.05   0.000     1.293916    1.474491
          7  |   1.577764   .0464871    33.94   0.000     1.486645    1.668883
          8  |   1.742884   .0469371    37.13   0.000     1.650883    1.834885
          9  |   1.858042   .0467337    39.76   0.000      1.76644    1.949645
         10  |   1.993262   .0468807    42.52   0.000     1.901371    2.085152
         11  |   2.068939    .047101    43.93   0.000     1.976617    2.161261
         12  |   2.077177   .0475991    43.64   0.000     1.983879    2.170476
         13  |   2.071722   .0477539    43.38   0.000      1.97812    2.165324
         14  |   2.052541   .0481514    42.63   0.000      1.95816    2.146922
         15  |    1.97182   .0488014    40.40   0.000     1.876165    2.067475
         16  |   1.965083   .0492183    39.93   0.000      1.86861    2.061555
         17  |   1.950955   .0499202    39.08   0.000     1.853107    2.048804
         18  |   1.927264   .0506942    38.02   0.000     1.827899     2.02663
         19  |   1.859949   .0511883    36.34   0.000     1.759615    1.960283
         20  |   1.786544   .0520428    34.33   0.000     1.684535    1.888553
         21  |   1.771988   .0531237    33.36   0.000      1.66786    1.876115
         22  |   1.763087   .0539524    32.68   0.000     1.657335    1.868839
         23  |   1.783498   .0544285    32.77   0.000     1.676813    1.890183
         24  |   1.587048    .056534    28.07   0.000     1.476236     1.69786
         25  |   1.594821   .0578893    27.55   0.000     1.481352    1.708289
         26  |   .6382566   .0679795     9.39   0.000     .5050106    .7715027
         27  |   .7251514    .060014    12.08   0.000     .6075186    .8427843
         28  |   1.001345   .0563695    17.76   0.000     .8908559    1.111835
         29  |   1.098425   .0536183    20.49   0.000     .9933284    1.203522
         30  |   1.185341   .0530703    22.34   0.000     1.081318    1.289364
         31  |   1.290682   .0526446    24.52   0.000     1.187494     1.39387
         32  |   1.464463   .0521973    28.06   0.000     1.362151    1.566775
         33  |   1.593249   .0513307    31.04   0.000     1.492637    1.693862
         34  |    1.70227   .0514672    33.07   0.000     1.601389     1.80315
         35  |   1.783297   .0522479    34.13   0.000     1.680887    1.885708
         36  |   1.884591   .0524837    35.91   0.000     1.781718    1.987464
         37  |   1.975083   .0531631    37.15   0.000     1.870878    2.079287
         38  |   2.059261   .0529246    38.91   0.000     1.955524    2.162998
         39  |   2.078374   .0536387    38.75   0.000     1.973238    2.183511
         40  |   2.076069    .054725    37.94   0.000     1.968803    2.183335
         41  |   2.093264   .0551723    37.94   0.000     1.985121    2.201407
         42  |   2.108566   .0558892    37.73   0.000     1.999018    2.218114
         43  |   2.152717   .0570614    37.73   0.000     2.040871    2.264562
         44  |   2.116446   .0577364    36.66   0.000     2.003277    2.229614
         45  |   2.084953   .0584387    35.68   0.000     1.970408    2.199499
         46  |   2.073797   .0595142    34.85   0.000     1.957144     2.19045
         47  |   2.080756    .062317    33.39   0.000     1.958609    2.202903
         48  |   2.151253   .0626219    34.35   0.000     2.028508    2.273998
         49  |    2.08357   .0629168    33.12   0.000     1.960247    2.206893
         50  |   2.105601   .0637095    33.05   0.000     1.980724    2.230477
             |
     age_cat |
          1  |   .1726713   .0368282     4.69   0.000     .1004846    .2448581
          2  |   .2902396   .0384006     7.56   0.000     .2149708    .3655083
          3  |   .4103355   .0395208    10.38   0.000      .332871       .4878
          4  |   .5618618   .0404168    13.90   0.000     .4826411    .6410824
          5  |   .6438961    .041189    15.63   0.000     .5631618    .7246304
          6  |    .706169   .0420235    16.80   0.000     .6237991    .7885389
          7  |    .763932    .042759    17.87   0.000     .6801203    .8477436
          8  |   .8287795   .0434387    19.08   0.000     .7436357    .9139233
          9  |   .8892556   .0439722    20.22   0.000      .803066    .9754451
         10  |   .9263126   .0446838    20.73   0.000     .8387283    1.013897
         11  |   .9709612   .0454659    21.36   0.000     .8818438    1.060079
         12  |     1.0322    .046182    22.35   0.000     .9416793    1.122721
         13  |   1.058706   .0472463    22.41   0.000     .9660985    1.151313
         14  |   1.109287   .0482058    23.01   0.000     1.014799    1.203775
         15  |   1.164786   .0490767    23.73   0.000     1.068591    1.260981
         16  |    1.19487   .0504424    23.69   0.000     1.095998    1.293741
         17  |   1.208633   .0516813    23.39   0.000     1.107333    1.309933
         18  |    1.24601   .0529197    23.55   0.000     1.142282    1.349737
         19  |   1.271758   .0545071    23.33   0.000     1.164919    1.378597
         20  |   1.342776   .0578801    23.20   0.000     1.229326    1.456227
         25  |   1.252153     .07311    17.13   0.000     1.108851    1.395455
         30  |   1.120927   .0938591    11.94   0.000     .9369549      1.3049
         40  |   .9959127   .0995309    10.01   0.000      .800823    1.191003
         50  |   .7715599   .1298199     5.94   0.000     .5171009    1.026019
             |
       _cons |   3.510734   .0514761    68.20   0.000     3.409836    3.611632
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. local fmt "%10.5f"

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }

. 
. estimates

--------------------------------------------------------------------------------------------------------------------------------
active results
--------------------------------------------------------------------------------------------------------------------------------

Linear regression                               Number of obs     =    311,119
                                                F(75, 18507)      =     132.72
                                                Prob > F          =     0.0000
                                                R-squared         =     0.1403
                                                Root MSE          =     1.6894

                                (Std. Err. adjusted for 18,508 clusters in id)
------------------------------------------------------------------------------
             |               Robust
        lnKL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .5463166   .0328281    16.64   0.000     .4819706    .6106626
       expat |   .1134724    .039662     2.86   0.004     .0357312    .1912137
             |
    ind_year |
          2  |    .178078   .0373881     4.76   0.000     .1047939    .2513621
          3  |   .8150087   .0415583    19.61   0.000     .7335506    .8964669
          4  |    1.00104   .0446271    22.43   0.000     .9135665    1.088513
          5  |   1.136322   .0451257    25.18   0.000     1.047871    1.224772
          6  |   1.384203   .0460628    30.05   0.000     1.293916    1.474491
          7  |   1.577764   .0464871    33.94   0.000     1.486645    1.668883
          8  |   1.742884   .0469371    37.13   0.000     1.650883    1.834885
          9  |   1.858042   .0467337    39.76   0.000      1.76644    1.949645
         10  |   1.993262   .0468807    42.52   0.000     1.901371    2.085152
         11  |   2.068939    .047101    43.93   0.000     1.976617    2.161261
         12  |   2.077177   .0475991    43.64   0.000     1.983879    2.170476
         13  |   2.071722   .0477539    43.38   0.000      1.97812    2.165324
         14  |   2.052541   .0481514    42.63   0.000      1.95816    2.146922
         15  |    1.97182   .0488014    40.40   0.000     1.876165    2.067475
         16  |   1.965083   .0492183    39.93   0.000      1.86861    2.061555
         17  |   1.950955   .0499202    39.08   0.000     1.853107    2.048804
         18  |   1.927264   .0506942    38.02   0.000     1.827899     2.02663
         19  |   1.859949   .0511883    36.34   0.000     1.759615    1.960283
         20  |   1.786544   .0520428    34.33   0.000     1.684535    1.888553
         21  |   1.771988   .0531237    33.36   0.000      1.66786    1.876115
         22  |   1.763087   .0539524    32.68   0.000     1.657335    1.868839
         23  |   1.783498   .0544285    32.77   0.000     1.676813    1.890183
         24  |   1.587048    .056534    28.07   0.000     1.476236     1.69786
         25  |   1.594821   .0578893    27.55   0.000     1.481352    1.708289
         26  |   .6382566   .0679795     9.39   0.000     .5050106    .7715027
         27  |   .7251514    .060014    12.08   0.000     .6075186    .8427843
         28  |   1.001345   .0563695    17.76   0.000     .8908559    1.111835
         29  |   1.098425   .0536183    20.49   0.000     .9933284    1.203522
         30  |   1.185341   .0530703    22.34   0.000     1.081318    1.289364
         31  |   1.290682   .0526446    24.52   0.000     1.187494     1.39387
         32  |   1.464463   .0521973    28.06   0.000     1.362151    1.566775
         33  |   1.593249   .0513307    31.04   0.000     1.492637    1.693862
         34  |    1.70227   .0514672    33.07   0.000     1.601389     1.80315
         35  |   1.783297   .0522479    34.13   0.000     1.680887    1.885708
         36  |   1.884591   .0524837    35.91   0.000     1.781718    1.987464
         37  |   1.975083   .0531631    37.15   0.000     1.870878    2.079287
         38  |   2.059261   .0529246    38.91   0.000     1.955524    2.162998
         39  |   2.078374   .0536387    38.75   0.000     1.973238    2.183511
         40  |   2.076069    .054725    37.94   0.000     1.968803    2.183335
         41  |   2.093264   .0551723    37.94   0.000     1.985121    2.201407
         42  |   2.108566   .0558892    37.73   0.000     1.999018    2.218114
         43  |   2.152717   .0570614    37.73   0.000     2.040871    2.264562
         44  |   2.116446   .0577364    36.66   0.000     2.003277    2.229614
         45  |   2.084953   .0584387    35.68   0.000     1.970408    2.199499
         46  |   2.073797   .0595142    34.85   0.000     1.957144     2.19045
         47  |   2.080756    .062317    33.39   0.000     1.958609    2.202903
         48  |   2.151253   .0626219    34.35   0.000     2.028508    2.273998
         49  |    2.08357   .0629168    33.12   0.000     1.960247    2.206893
         50  |   2.105601   .0637095    33.05   0.000     1.980724    2.230477
             |
     age_cat |
          1  |   .1726713   .0368282     4.69   0.000     .1004846    .2448581
          2  |   .2902396   .0384006     7.56   0.000     .2149708    .3655083
          3  |   .4103355   .0395208    10.38   0.000      .332871       .4878
          4  |   .5618618   .0404168    13.90   0.000     .4826411    .6410824
          5  |   .6438961    .041189    15.63   0.000     .5631618    .7246304
          6  |    .706169   .0420235    16.80   0.000     .6237991    .7885389
          7  |    .763932    .042759    17.87   0.000     .6801203    .8477436
          8  |   .8287795   .0434387    19.08   0.000     .7436357    .9139233
          9  |   .8892556   .0439722    20.22   0.000      .803066    .9754451
         10  |   .9263126   .0446838    20.73   0.000     .8387283    1.013897
         11  |   .9709612   .0454659    21.36   0.000     .8818438    1.060079
         12  |     1.0322    .046182    22.35   0.000     .9416793    1.122721
         13  |   1.058706   .0472463    22.41   0.000     .9660985    1.151313
         14  |   1.109287   .0482058    23.01   0.000     1.014799    1.203775
         15  |   1.164786   .0490767    23.73   0.000     1.068591    1.260981
         16  |    1.19487   .0504424    23.69   0.000     1.095998    1.293741
         17  |   1.208633   .0516813    23.39   0.000     1.107333    1.309933
         18  |    1.24601   .0529197    23.55   0.000     1.142282    1.349737
         19  |   1.271758   .0545071    23.33   0.000     1.164919    1.378597
         20  |   1.342776   .0578801    23.20   0.000     1.229326    1.456227
         25  |   1.252153     .07311    17.13   0.000     1.108851    1.395455
         30  |   1.120927   .0938591    11.94   0.000     .9369549      1.3049
         40  |   .9959127   .0995309    10.01   0.000      .800823    1.191003
         50  |   .7715599   .1298199     5.94   0.000     .5171009    1.026019
             |
       _cons |   3.510734   .0514761    68.20   0.000     3.409836    3.611632
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text replace

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b', "`fmt'")) _newline
  6.         file write `output' ("   standard_error: " + string(`se', "`fmt'")) _newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se', "`fmt'")) _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',"pvalue"),colnumb(`coefs',"`X'")]), "`fmt'") _
> newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file

Fixed-effects (within) regression               Number of obs     =    311,119
Group variable: id                              Number of groups  =     18,508

R-sq:                                           Obs per group:
     within  = 0.1765                                         min =          1
     between = 0.0730                                         avg =       16.8
     overall = 0.0856                                         max =        140

                                                F(75,18507)       =      88.13
corr(u_i, Xb)  = 0.0209                         Prob > F          =     0.0000

                                (Std. Err. adjusted for 18,508 clusters in id)
------------------------------------------------------------------------------
             |               Robust
        lnKL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .1358927   .0432414     3.14   0.002     .0511356    .2206498
       expat |   .0497924   .0138604     3.59   0.000     .0226248    .0769601
             |
    ind_year |
          2  |   .1624546   .0341559     4.76   0.000     .0955058    .2294033
          3  |   .7986725   .0419215    19.05   0.000     .7165025    .8808425
          4  |   .9507932   .0471331    20.17   0.000     .8584079    1.043178
          5  |   1.111937   .0516458    21.53   0.000     1.010707    1.213168
          6  |   1.358371   .0559978    24.26   0.000      1.24861    1.468131
          7  |   1.629489   .0607847    26.81   0.000     1.510345    1.748632
          8  |   1.832826   .0658511    27.83   0.000     1.703752    1.961901
          9  |   1.968067   .0710975    27.68   0.000     1.828709    2.107424
         10  |   2.113814   .0767428    27.54   0.000     1.963391    2.264237
         11  |   2.267344   .0821048    27.62   0.000     2.106411    2.428277
         12  |   2.320894   .0878915    26.41   0.000     2.148619    2.493169
         13  |   2.370719   .0938476    25.26   0.000      2.18677    2.554669
         14  |   2.384633   .0998195    23.89   0.000     2.188977    2.580288
         15  |   2.348898   .1061217    22.13   0.000      2.14089    2.556906
         16  |   2.378099   .1122045    21.19   0.000     2.158168     2.59803
         17  |    2.39945   .1187222    20.21   0.000     2.166744    2.632157
         18  |   2.400674    .125102    19.19   0.000     2.155462    2.645885
         19  |   2.356974    .131347    17.94   0.000     2.099522    2.614426
         20  |   2.354487   .1373246    17.15   0.000     2.085318    2.623655
         21  |   2.374725   .1426216    16.65   0.000     2.095174    2.654277
         22  |   2.402827   .1478945    16.25   0.000      2.11294    2.692714
         23  |   2.509963   .1532241    16.38   0.000      2.20963    2.810296
         24  |   2.286329   .1593373    14.35   0.000     1.974013    2.598645
         25  |   2.278115   .1654455    13.77   0.000     1.953827    2.602404
         26  |   .5057291   .0767329     6.59   0.000     .3553255    .6561327
         27  |   .6535546   .0690458     9.47   0.000     .5182185    .7888906
         28  |   .9634585   .0650325    14.82   0.000     .8359888    1.090928
         29  |   1.092875   .0643988    16.97   0.000     .9666474    1.219103
         30  |    1.21152   .0659042    18.38   0.000     1.082341    1.340698
         31  |   1.369299   .0679842    20.14   0.000     1.236044    1.502554
         32  |   1.575568   .0707278    22.28   0.000     1.436935    1.714201
         33  |   1.746833   .0744392    23.47   0.000     1.600925     1.89274
         34  |   1.863133   .0787704    23.65   0.000     1.708736     2.01753
         35  |   1.965227   .0833876    23.57   0.000      1.80178    2.128674
         36  |    2.06551    .088472    23.35   0.000     1.892097    2.238924
         37  |   2.153728   .0936605    23.00   0.000     1.970145    2.337311
         38  |   2.244996   .0986551    22.76   0.000     2.051623    2.438369
         39  |   2.254722    .104344    21.61   0.000     2.050198    2.459246
         40  |   2.261822   .1099911    20.56   0.000     2.046229    2.477414
         41  |   2.284334   .1160484    19.68   0.000     2.056868    2.511799
         42  |   2.346012   .1223535    19.17   0.000     2.106188    2.585836
         43  |   2.394868   .1288542    18.59   0.000     2.142302    2.647435
         44  |   2.373214   .1353924    17.53   0.000     2.107832    2.638596
         45  |   2.392549   .1412729    16.94   0.000     2.115641    2.669457
         46  |   2.404254   .1473676    16.31   0.000       2.1154    2.693108
         47  |   2.442411   .1527052    15.99   0.000     2.143095    2.741727
         48  |   2.523488   .1576792    16.00   0.000     2.214423    2.832554
         49  |   2.413796   .1636191    14.75   0.000     2.093087    2.734504
         50  |     2.4282    .168753    14.39   0.000     2.097429    2.758972
             |
     age_cat |
          1  |   .0937566   .0285735     3.28   0.001     .0377499    .1497633
          2  |   .1252934   .0323636     3.87   0.000     .0618578     .188729
          3  |   .1304567   .0365744     3.57   0.000     .0587675    .2021458
          4  |   .1574295   .0413792     3.80   0.000     .0763224    .2385365
          5  |   .1457722   .0466595     3.12   0.002     .0543153     .237229
          6  |   .1268445   .0522957     2.43   0.015     .0243401     .229349
          7  |   .1200275   .0581159     2.07   0.039      .006115      .23394
          8  |   .1175727   .0642193     1.83   0.067    -.0083031    .2434485
          9  |   .1174022   .0703754     1.67   0.095    -.0205401    .2553445
         10  |   .1068981   .0766769     1.39   0.163    -.0433957    .2571919
         11  |   .1032464   .0830085     1.24   0.214    -.0594579    .2659507
         12  |   .1046285   .0893077     1.17   0.241    -.0704228    .2796798
         13  |   .0989138   .0957052     1.03   0.301    -.0886771    .2865047
         14  |   .1110576   .1021986     1.09   0.277    -.0892611    .3113763
         15  |   .1227984   .1087469     1.13   0.259    -.0903556    .3359524
         16  |   .1245057   .1156502     1.08   0.282    -.1021794    .3511907
         17  |   .1247075   .1225086     1.02   0.309    -.1154205    .3648356
         18  |    .133481   .1292648     1.03   0.302      -.11989     .386852
         19  |   .1235036   .1363525     0.91   0.365    -.1437598     .390767
         20  |   .0973338   .1501808     0.65   0.517    -.1970344     .391702
         25  |   .0487474   .1733461     0.28   0.779    -.2910268    .3885217
         30  |   .1623671   .2170628     0.75   0.454     -.263096    .5878302
         40  |    .354737   .2579281     1.38   0.169    -.1508258    .8602997
         50  |   .3664585   .2954189     1.24   0.215    -.2125898    .9455068
             |
       _cons |   3.976149   .0551774    72.06   0.000     3.867996    4.084302
-------------+----------------------------------------------------------------
     sigma_u |  1.7684189
     sigma_e |  .87931945
         rho |  .80176873   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. local fmt "%10.5f"

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }
key: R2_within
value: .1765282822999796

. 
. estimates

--------------------------------------------------------------------------------------------------------------------------------
active results
--------------------------------------------------------------------------------------------------------------------------------

Fixed-effects (within) regression               Number of obs     =    311,119
Group variable: id                              Number of groups  =     18,508

R-sq:                                           Obs per group:
     within  = 0.1765                                         min =          1
     between = 0.0730                                         avg =       16.8
     overall = 0.0856                                         max =        140

                                                F(75,18507)       =      88.13
corr(u_i, Xb)  = 0.0209                         Prob > F          =     0.0000

                                (Std. Err. adjusted for 18,508 clusters in id)
------------------------------------------------------------------------------
             |               Robust
        lnKL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .1358927   .0432414     3.14   0.002     .0511356    .2206498
       expat |   .0497924   .0138604     3.59   0.000     .0226248    .0769601
             |
    ind_year |
          2  |   .1624546   .0341559     4.76   0.000     .0955058    .2294033
          3  |   .7986725   .0419215    19.05   0.000     .7165025    .8808425
          4  |   .9507932   .0471331    20.17   0.000     .8584079    1.043178
          5  |   1.111937   .0516458    21.53   0.000     1.010707    1.213168
          6  |   1.358371   .0559978    24.26   0.000      1.24861    1.468131
          7  |   1.629489   .0607847    26.81   0.000     1.510345    1.748632
          8  |   1.832826   .0658511    27.83   0.000     1.703752    1.961901
          9  |   1.968067   .0710975    27.68   0.000     1.828709    2.107424
         10  |   2.113814   .0767428    27.54   0.000     1.963391    2.264237
         11  |   2.267344   .0821048    27.62   0.000     2.106411    2.428277
         12  |   2.320894   .0878915    26.41   0.000     2.148619    2.493169
         13  |   2.370719   .0938476    25.26   0.000      2.18677    2.554669
         14  |   2.384633   .0998195    23.89   0.000     2.188977    2.580288
         15  |   2.348898   .1061217    22.13   0.000      2.14089    2.556906
         16  |   2.378099   .1122045    21.19   0.000     2.158168     2.59803
         17  |    2.39945   .1187222    20.21   0.000     2.166744    2.632157
         18  |   2.400674    .125102    19.19   0.000     2.155462    2.645885
         19  |   2.356974    .131347    17.94   0.000     2.099522    2.614426
         20  |   2.354487   .1373246    17.15   0.000     2.085318    2.623655
         21  |   2.374725   .1426216    16.65   0.000     2.095174    2.654277
         22  |   2.402827   .1478945    16.25   0.000      2.11294    2.692714
         23  |   2.509963   .1532241    16.38   0.000      2.20963    2.810296
         24  |   2.286329   .1593373    14.35   0.000     1.974013    2.598645
         25  |   2.278115   .1654455    13.77   0.000     1.953827    2.602404
         26  |   .5057291   .0767329     6.59   0.000     .3553255    .6561327
         27  |   .6535546   .0690458     9.47   0.000     .5182185    .7888906
         28  |   .9634585   .0650325    14.82   0.000     .8359888    1.090928
         29  |   1.092875   .0643988    16.97   0.000     .9666474    1.219103
         30  |    1.21152   .0659042    18.38   0.000     1.082341    1.340698
         31  |   1.369299   .0679842    20.14   0.000     1.236044    1.502554
         32  |   1.575568   .0707278    22.28   0.000     1.436935    1.714201
         33  |   1.746833   .0744392    23.47   0.000     1.600925     1.89274
         34  |   1.863133   .0787704    23.65   0.000     1.708736     2.01753
         35  |   1.965227   .0833876    23.57   0.000      1.80178    2.128674
         36  |    2.06551    .088472    23.35   0.000     1.892097    2.238924
         37  |   2.153728   .0936605    23.00   0.000     1.970145    2.337311
         38  |   2.244996   .0986551    22.76   0.000     2.051623    2.438369
         39  |   2.254722    .104344    21.61   0.000     2.050198    2.459246
         40  |   2.261822   .1099911    20.56   0.000     2.046229    2.477414
         41  |   2.284334   .1160484    19.68   0.000     2.056868    2.511799
         42  |   2.346012   .1223535    19.17   0.000     2.106188    2.585836
         43  |   2.394868   .1288542    18.59   0.000     2.142302    2.647435
         44  |   2.373214   .1353924    17.53   0.000     2.107832    2.638596
         45  |   2.392549   .1412729    16.94   0.000     2.115641    2.669457
         46  |   2.404254   .1473676    16.31   0.000       2.1154    2.693108
         47  |   2.442411   .1527052    15.99   0.000     2.143095    2.741727
         48  |   2.523488   .1576792    16.00   0.000     2.214423    2.832554
         49  |   2.413796   .1636191    14.75   0.000     2.093087    2.734504
         50  |     2.4282    .168753    14.39   0.000     2.097429    2.758972
             |
     age_cat |
          1  |   .0937566   .0285735     3.28   0.001     .0377499    .1497633
          2  |   .1252934   .0323636     3.87   0.000     .0618578     .188729
          3  |   .1304567   .0365744     3.57   0.000     .0587675    .2021458
          4  |   .1574295   .0413792     3.80   0.000     .0763224    .2385365
          5  |   .1457722   .0466595     3.12   0.002     .0543153     .237229
          6  |   .1268445   .0522957     2.43   0.015     .0243401     .229349
          7  |   .1200275   .0581159     2.07   0.039      .006115      .23394
          8  |   .1175727   .0642193     1.83   0.067    -.0083031    .2434485
          9  |   .1174022   .0703754     1.67   0.095    -.0205401    .2553445
         10  |   .1068981   .0766769     1.39   0.163    -.0433957    .2571919
         11  |   .1032464   .0830085     1.24   0.214    -.0594579    .2659507
         12  |   .1046285   .0893077     1.17   0.241    -.0704228    .2796798
         13  |   .0989138   .0957052     1.03   0.301    -.0886771    .2865047
         14  |   .1110576   .1021986     1.09   0.277    -.0892611    .3113763
         15  |   .1227984   .1087469     1.13   0.259    -.0903556    .3359524
         16  |   .1245057   .1156502     1.08   0.282    -.1021794    .3511907
         17  |   .1247075   .1225086     1.02   0.309    -.1154205    .3648356
         18  |    .133481   .1292648     1.03   0.302      -.11989     .386852
         19  |   .1235036   .1363525     0.91   0.365    -.1437598     .390767
         20  |   .0973338   .1501808     0.65   0.517    -.1970344     .391702
         25  |   .0487474   .1733461     0.28   0.779    -.2910268    .3885217
         30  |   .1623671   .2170628     0.75   0.454     -.263096    .5878302
         40  |    .354737   .2579281     1.38   0.169    -.1508258    .8602997
         50  |   .3664585   .2954189     1.24   0.215    -.2125898    .9455068
             |
       _cons |   3.976149   .0551774    72.06   0.000     3.867996    4.084302
-------------+----------------------------------------------------------------
     sigma_u |  1.7684189
     sigma_e |  .87931945
         rho |  .80176873   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text replace

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b', "`fmt'")) _newline
  6.         file write `output' ("   standard_error: " + string(`se', "`fmt'")) _newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se', "`fmt'")) _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',"pvalue"),colnumb(`coefs',"`X'")]), "`fmt'") _
> newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file
(sum of wgt is 96,323.3384407535)

Linear regression                               Number of obs     =    229,907
                                                F(75, 14528)      =     120.53
                                                Prob > F          =     0.0000
                                                R-squared         =     0.1475
                                                Root MSE          =      1.665

                                (Std. Err. adjusted for 14,529 clusters in id)
------------------------------------------------------------------------------
             |               Robust
        lnKL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .4836675    .048564     9.96   0.000     .3884759    .5788591
       expat |   .1393059   .0702642     1.98   0.047      .001579    .2770327
             |
    ind_year |
          2  |    .160548   .0400837     4.01   0.000     .0819789    .2391171
          3  |   .8146877   .0440626    18.49   0.000     .7283193     .901056
          4  |   1.015088   .0477736    21.25   0.000      .921446    1.108731
          5  |   1.139647   .0481687    23.66   0.000      1.04523    1.234064
          6  |    1.40206   .0491364    28.53   0.000     1.305746    1.498374
          7  |   1.603945   .0495832    32.35   0.000     1.506756    1.701134
          8  |    1.77157   .0498679    35.53   0.000     1.673822    1.869317
          9  |    1.89105   .0496242    38.11   0.000      1.79378     1.98832
         10  |   2.021027   .0499264    40.48   0.000     1.923165    2.118889
         11  |   2.101714   .0501804    41.88   0.000     2.003354    2.200074
         12  |   2.120806   .0506118    41.90   0.000     2.021601    2.220012
         13  |   2.112696   .0508624    41.54   0.000     2.012999    2.212393
         14  |   2.083657   .0514331    40.51   0.000     1.982841    2.184472
         15  |   2.011718    .052072    38.63   0.000     1.909651    2.113786
         16  |   2.010204     .05252    38.28   0.000     1.907258    2.113149
         17  |   2.000278   .0532613    37.56   0.000      1.89588    2.104677
         18  |   1.973028   .0541823    36.41   0.000     1.866824    2.079233
         19  |   1.914247    .054662    35.02   0.000     1.807103    2.021392
         20  |   1.837151   .0555339    33.08   0.000     1.728297    1.946004
         21  |   1.832717   .0570075    32.15   0.000     1.720975    1.944459
         22  |   1.826733    .057825    31.59   0.000     1.713388    1.940077
         23  |   1.866414   .0583927    31.96   0.000     1.751957    1.980871
         24  |    1.67822    .060856    27.58   0.000     1.558935    1.797506
         25  |   1.683009   .0624606    26.95   0.000     1.560578     1.80544
         26  |   .6030206   .0734549     8.21   0.000     .4590396    .7470016
         27  |   .7100851   .0644873    11.01   0.000     .5836817    .8364885
         28  |   .9962867   .0614582    16.21   0.000     .8758209    1.116753
         29  |   1.104753   .0587374    18.81   0.000     .9896206    1.219886
         30  |   1.203243   .0581539    20.69   0.000     1.089254    1.317232
         31  |   1.327589   .0572348    23.20   0.000     1.215402    1.439777
         32  |   1.515221   .0563827    26.87   0.000     1.404704    1.625738
         33  |   1.606765   .0560035    28.69   0.000     1.496991    1.716539
         34  |   1.726048   .0559363    30.86   0.000     1.616405     1.83569
         35  |   1.825084   .0572003    31.91   0.000     1.712964    1.937204
         36  |   1.947446   .0573512    33.96   0.000      1.83503    2.059861
         37  |    2.04074   .0579742    35.20   0.000     1.927103    2.154377
         38  |   2.100605   .0575089    36.53   0.000      1.98788     2.21333
         39  |   2.098846   .0585451    35.85   0.000     1.984091    2.213602
         40  |    2.07913    .060278    34.49   0.000     1.960977    2.197282
         41  |   2.090632    .060827    34.37   0.000     1.971403     2.20986
         42  |   2.100636   .0612016    34.32   0.000     1.980673    2.220599
         43  |   2.131727   .0627707    33.96   0.000     2.008688    2.254765
         44  |   2.102695   .0637718    32.97   0.000     1.977694    2.227696
         45  |    2.07976   .0645725    32.21   0.000      1.95319     2.20633
         46  |   2.051845   .0660231    31.08   0.000     1.922432    2.181259
         47  |   2.083762   .0685602    30.39   0.000     1.949375    2.218148
         48  |   2.158832   .0687258    31.41   0.000     2.024121    2.293544
         49  |   2.106604   .0694545    30.33   0.000     1.970465    2.242744
         50  |   2.137347   .0708066    30.19   0.000     1.998557    2.276136
             |
     age_cat |
          1  |   .1244812   .0399086     3.12   0.002     .0462554    .2027071
          2  |   .2684575   .0417359     6.43   0.000     .1866497    .3502652
          3  |   .4004442   .0430235     9.31   0.000     .3161127    .4847758
          4  |   .5486489   .0440786    12.45   0.000     .4622492    .6350486
          5  |   .6403159   .0449402    14.25   0.000     .5522275    .7284044
          6  |   .7094082   .0458434    15.47   0.000     .6195494     .799267
          7  |   .7879968   .0466699    16.88   0.000     .6965178    .8794758
          8  |   .8676513   .0473891    18.31   0.000     .7747626      .96054
          9  |   .9437648   .0479213    19.69   0.000     .8498328    1.037697
         10  |   .9904353   .0487069    20.33   0.000     .8949635    1.085907
         11  |   1.044528   .0496707    21.03   0.000     .9471673    1.141889
         12  |    1.10942   .0503885    22.02   0.000     1.010652    1.208187
         13  |   1.141847   .0516693    22.10   0.000     1.040568    1.243125
         14  |   1.193255   .0528178    22.59   0.000     1.089726    1.296785
         15  |   1.249978    .053889    23.20   0.000     1.144349    1.355608
         16  |   1.271946   .0555496    22.90   0.000     1.163062     1.38083
         17  |   1.286304   .0568736    22.62   0.000     1.174825    1.397784
         18  |    1.32963   .0582029    22.84   0.000     1.215545    1.443715
         19  |   1.350475   .0599926    22.51   0.000     1.232882    1.468068
         20  |   1.409672   .0637992    22.10   0.000     1.284618    1.534727
         25  |   1.291724   .0804098    16.06   0.000      1.13411    1.449337
         30  |   1.163094   .0963963    12.07   0.000     .9741447    1.352043
         40  |   1.034127   .1012761    10.21   0.000     .8356131    1.232641
         50  |   .7923451   .1321278     6.00   0.000     .5333577    1.051332
             |
       _cons |   3.443578   .0548959    62.73   0.000     3.335975    3.551181
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. local fmt "%10.5f"

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }

. 
. estimates

--------------------------------------------------------------------------------------------------------------------------------
active results
--------------------------------------------------------------------------------------------------------------------------------

Linear regression                               Number of obs     =    229,907
                                                F(75, 14528)      =     120.53
                                                Prob > F          =     0.0000
                                                R-squared         =     0.1475
                                                Root MSE          =      1.665

                                (Std. Err. adjusted for 14,529 clusters in id)
------------------------------------------------------------------------------
             |               Robust
        lnKL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .4836675    .048564     9.96   0.000     .3884759    .5788591
       expat |   .1393059   .0702642     1.98   0.047      .001579    .2770327
             |
    ind_year |
          2  |    .160548   .0400837     4.01   0.000     .0819789    .2391171
          3  |   .8146877   .0440626    18.49   0.000     .7283193     .901056
          4  |   1.015088   .0477736    21.25   0.000      .921446    1.108731
          5  |   1.139647   .0481687    23.66   0.000      1.04523    1.234064
          6  |    1.40206   .0491364    28.53   0.000     1.305746    1.498374
          7  |   1.603945   .0495832    32.35   0.000     1.506756    1.701134
          8  |    1.77157   .0498679    35.53   0.000     1.673822    1.869317
          9  |    1.89105   .0496242    38.11   0.000      1.79378     1.98832
         10  |   2.021027   .0499264    40.48   0.000     1.923165    2.118889
         11  |   2.101714   .0501804    41.88   0.000     2.003354    2.200074
         12  |   2.120806   .0506118    41.90   0.000     2.021601    2.220012
         13  |   2.112696   .0508624    41.54   0.000     2.012999    2.212393
         14  |   2.083657   .0514331    40.51   0.000     1.982841    2.184472
         15  |   2.011718    .052072    38.63   0.000     1.909651    2.113786
         16  |   2.010204     .05252    38.28   0.000     1.907258    2.113149
         17  |   2.000278   .0532613    37.56   0.000      1.89588    2.104677
         18  |   1.973028   .0541823    36.41   0.000     1.866824    2.079233
         19  |   1.914247    .054662    35.02   0.000     1.807103    2.021392
         20  |   1.837151   .0555339    33.08   0.000     1.728297    1.946004
         21  |   1.832717   .0570075    32.15   0.000     1.720975    1.944459
         22  |   1.826733    .057825    31.59   0.000     1.713388    1.940077
         23  |   1.866414   .0583927    31.96   0.000     1.751957    1.980871
         24  |    1.67822    .060856    27.58   0.000     1.558935    1.797506
         25  |   1.683009   .0624606    26.95   0.000     1.560578     1.80544
         26  |   .6030206   .0734549     8.21   0.000     .4590396    .7470016
         27  |   .7100851   .0644873    11.01   0.000     .5836817    .8364885
         28  |   .9962867   .0614582    16.21   0.000     .8758209    1.116753
         29  |   1.104753   .0587374    18.81   0.000     .9896206    1.219886
         30  |   1.203243   .0581539    20.69   0.000     1.089254    1.317232
         31  |   1.327589   .0572348    23.20   0.000     1.215402    1.439777
         32  |   1.515221   .0563827    26.87   0.000     1.404704    1.625738
         33  |   1.606765   .0560035    28.69   0.000     1.496991    1.716539
         34  |   1.726048   .0559363    30.86   0.000     1.616405     1.83569
         35  |   1.825084   .0572003    31.91   0.000     1.712964    1.937204
         36  |   1.947446   .0573512    33.96   0.000      1.83503    2.059861
         37  |    2.04074   .0579742    35.20   0.000     1.927103    2.154377
         38  |   2.100605   .0575089    36.53   0.000      1.98788     2.21333
         39  |   2.098846   .0585451    35.85   0.000     1.984091    2.213602
         40  |    2.07913    .060278    34.49   0.000     1.960977    2.197282
         41  |   2.090632    .060827    34.37   0.000     1.971403     2.20986
         42  |   2.100636   .0612016    34.32   0.000     1.980673    2.220599
         43  |   2.131727   .0627707    33.96   0.000     2.008688    2.254765
         44  |   2.102695   .0637718    32.97   0.000     1.977694    2.227696
         45  |    2.07976   .0645725    32.21   0.000      1.95319     2.20633
         46  |   2.051845   .0660231    31.08   0.000     1.922432    2.181259
         47  |   2.083762   .0685602    30.39   0.000     1.949375    2.218148
         48  |   2.158832   .0687258    31.41   0.000     2.024121    2.293544
         49  |   2.106604   .0694545    30.33   0.000     1.970465    2.242744
         50  |   2.137347   .0708066    30.19   0.000     1.998557    2.276136
             |
     age_cat |
          1  |   .1244812   .0399086     3.12   0.002     .0462554    .2027071
          2  |   .2684575   .0417359     6.43   0.000     .1866497    .3502652
          3  |   .4004442   .0430235     9.31   0.000     .3161127    .4847758
          4  |   .5486489   .0440786    12.45   0.000     .4622492    .6350486
          5  |   .6403159   .0449402    14.25   0.000     .5522275    .7284044
          6  |   .7094082   .0458434    15.47   0.000     .6195494     .799267
          7  |   .7879968   .0466699    16.88   0.000     .6965178    .8794758
          8  |   .8676513   .0473891    18.31   0.000     .7747626      .96054
          9  |   .9437648   .0479213    19.69   0.000     .8498328    1.037697
         10  |   .9904353   .0487069    20.33   0.000     .8949635    1.085907
         11  |   1.044528   .0496707    21.03   0.000     .9471673    1.141889
         12  |    1.10942   .0503885    22.02   0.000     1.010652    1.208187
         13  |   1.141847   .0516693    22.10   0.000     1.040568    1.243125
         14  |   1.193255   .0528178    22.59   0.000     1.089726    1.296785
         15  |   1.249978    .053889    23.20   0.000     1.144349    1.355608
         16  |   1.271946   .0555496    22.90   0.000     1.163062     1.38083
         17  |   1.286304   .0568736    22.62   0.000     1.174825    1.397784
         18  |    1.32963   .0582029    22.84   0.000     1.215545    1.443715
         19  |   1.350475   .0599926    22.51   0.000     1.232882    1.468068
         20  |   1.409672   .0637992    22.10   0.000     1.284618    1.534727
         25  |   1.291724   .0804098    16.06   0.000      1.13411    1.449337
         30  |   1.163094   .0963963    12.07   0.000     .9741447    1.352043
         40  |   1.034127   .1012761    10.21   0.000     .8356131    1.232641
         50  |   .7923451   .1321278     6.00   0.000     .5333577    1.051332
             |
       _cons |   3.443578   .0548959    62.73   0.000     3.335975    3.551181
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text replace

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b', "`fmt'")) _newline
  6.         file write `output' ("   standard_error: " + string(`se', "`fmt'")) _newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se', "`fmt'")) _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',"pvalue"),colnumb(`coefs',"`X'")]), "`fmt'") _
> newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file

Fixed-effects (within) regression               Number of obs     =    229,907
Group variable: id                              Number of groups  =     14,529

R-sq:                                           Obs per group:
     within  = 0.2057                                         min =          1
     between = 0.0758                                         avg =       15.8
     overall = 0.0988                                         max =        140

                                                F(75,14528)       =      83.74
corr(u_i, Xb)  = 0.0051                         Prob > F          =     0.0000

                                (Std. Err. adjusted for 14,529 clusters in id)
------------------------------------------------------------------------------
             |               Robust
        lnKL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0096547   .0536642     0.18   0.857    -.0955339    .1148433
       expat |   .0227839   .0329526     0.69   0.489    -.0418074    .0873752
             |
    ind_year |
          2  |   .1577378   .0371575     4.25   0.000     .0849043    .2305713
          3  |   .8064069   .0455088    17.72   0.000     .7172039      .89561
          4  |   .9696815   .0511726    18.95   0.000     .8693766    1.069986
          5  |   1.120672   .0559404    20.03   0.000     1.011022    1.230323
          6  |   1.367612   .0603881    22.65   0.000     1.249244    1.485981
          7  |   1.645816   .0654791    25.13   0.000     1.517468    1.774163
          8  |   1.856548   .0707581    26.24   0.000     1.717853    1.995243
          9  |   1.990818   .0762061    26.12   0.000     1.841445    2.140192
         10  |   2.136755   .0822689    25.97   0.000     1.975498    2.298013
         11  |   2.295101   .0879471    26.10   0.000     2.122714    2.467489
         12  |   2.349243   .0940823    24.97   0.000      2.16483    2.533657
         13  |   2.403103   .1004409    23.93   0.000     2.206226     2.59998
         14  |   2.415516   .1068001    22.62   0.000     2.206174    2.624858
         15  |   2.383085   .1134692    21.00   0.000     2.160671    2.605499
         16  |   2.420655   .1199065    20.19   0.000     2.185623    2.655687
         17  |   2.447878   .1268776    19.29   0.000     2.199182    2.696574
         18  |    2.44441   .1336316    18.29   0.000     2.182475    2.706345
         19  |   2.398035   .1401221    17.11   0.000     2.123378    2.672692
         20  |   2.391706   .1464803    16.33   0.000     2.104586    2.678826
         21  |   2.413816    .152028    15.88   0.000     2.115822     2.71181
         22  |   2.448446   .1576422    15.53   0.000     2.139447    2.757444
         23  |    2.56663    .163325    15.71   0.000     2.246492    2.886768
         24  |   2.368551   .1697714    13.95   0.000     2.035778    2.701325
         25  |   2.355943   .1762914    13.36   0.000      2.01039    2.701497
         26  |   .4735011   .0869134     5.45   0.000     .3031397    .6438624
         27  |   .6073804   .0769028     7.90   0.000     .4566411    .7581196
         28  |   .9153375   .0720206    12.71   0.000     .7741679    1.056507
         29  |   1.051427   .0710386    14.80   0.000     .9121823    1.190672
         30  |   1.172687   .0723226    16.21   0.000     1.030926    1.314449
         31  |   1.332439   .0743307    17.93   0.000     1.186741    1.478137
         32  |   1.546461   .0769527    20.10   0.000     1.395624    1.697298
         33  |   1.702543   .0812245    20.96   0.000     1.543333    1.861754
         34  |    1.82831   .0855787    21.36   0.000     1.660564    1.996055
         35  |   1.945402   .0905063    21.49   0.000     1.767998    2.122806
         36  |   2.073213   .0957918    21.64   0.000     1.885449    2.260977
         37  |   2.188625    .101142    21.64   0.000     1.990373    2.386876
         38  |   2.267939   .1063385    21.33   0.000     2.059502    2.476376
         39  |   2.279721   .1122968    20.30   0.000     2.059605    2.499837
         40  |   2.283538   .1181022    19.34   0.000     2.052043    2.515034
         41  |   2.313722   .1246318    18.56   0.000     2.069428    2.558017
         42  |   2.381914   .1312738    18.14   0.000     2.124601    2.639228
         43  |   2.418774   .1382574    17.49   0.000     2.147772    2.689776
         44  |   2.393767   .1452669    16.48   0.000     2.109026    2.678509
         45  |   2.412148    .151587    15.91   0.000     2.115018    2.709278
         46  |   2.409272   .1581354    15.24   0.000     2.099306    2.719238
         47  |   2.445747   .1637131    14.94   0.000     2.124848    2.766645
         48  |   2.529298   .1688031    14.98   0.000     2.198422    2.860173
         49  |   2.452628   .1751394    14.00   0.000     2.109332    2.795923
         50  |   2.469438    .180551    13.68   0.000     2.115535    2.823341
             |
     age_cat |
          1  |   .0935263   .0315877     2.96   0.003     .0316103    .1554422
          2  |   .1536939   .0357825     4.30   0.000     .0835555    .2238322
          3  |   .1751579   .0402381     4.35   0.000     .0962861    .2540297
          4  |   .2067612   .0453055     4.56   0.000     .1179567    .2955656
          5  |   .2068139   .0508305     4.07   0.000     .1071796    .3064481
          6  |   .1894644   .0567656     3.34   0.001     .0781966    .3007323
          7  |   .1980244    .062911     3.15   0.002     .0747109     .321338
          8  |   .2050359   .0693914     2.95   0.003     .0690198     .341052
          9  |   .2176488    .075841     2.87   0.004     .0689907    .3663068
         10  |   .2172892   .0825193     2.63   0.008     .0555408    .3790376
         11  |   .2164249   .0892692     2.42   0.015     .0414458    .3914039
         12  |   .2189582   .0959055     2.28   0.022     .0309712    .4069451
         13  |   .2147993   .1027068     2.09   0.037     .0134809    .4161176
         14  |   .2297929   .1096171     2.10   0.036     .0149294    .4446564
         15  |   .2413673    .116588     2.07   0.038       .01284    .4698947
         16  |   .2400442   .1239545     1.94   0.053    -.0029224    .4830108
         17  |   .2371148   .1312244     1.81   0.071    -.0201018    .4943314
         18  |   .2550218   .1384168     1.84   0.065    -.0162927    .5263364
         19  |   .2420782   .1458612     1.66   0.097    -.0438284    .5279847
         20  |   .2225723   .1605366     1.39   0.166       -.0921    .5372446
         25  |   .1839989    .185425     0.99   0.321    -.1794576    .5474555
         30  |   .3243962   .2312313     1.40   0.161    -.1288467     .777639
         40  |   .5111235   .2735675     1.87   0.062    -.0251037    1.047351
         50  |   .4918966   .3128857     1.57   0.116    -.1213992    1.105192
             |
       _cons |   3.805377   .0583856    65.18   0.000     3.690933     3.91982
-------------+----------------------------------------------------------------
     sigma_u |  1.7325127
     sigma_e |  .87282601
         rho |  .79757133   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. local fmt "%10.5f"

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }
key: R2_within
value: .2056984644323606

. 
. estimates

--------------------------------------------------------------------------------------------------------------------------------
active results
--------------------------------------------------------------------------------------------------------------------------------

Fixed-effects (within) regression               Number of obs     =    229,907
Group variable: id                              Number of groups  =     14,529

R-sq:                                           Obs per group:
     within  = 0.2057                                         min =          1
     between = 0.0758                                         avg =       15.8
     overall = 0.0988                                         max =        140

                                                F(75,14528)       =      83.74
corr(u_i, Xb)  = 0.0051                         Prob > F          =     0.0000

                                (Std. Err. adjusted for 14,529 clusters in id)
------------------------------------------------------------------------------
             |               Robust
        lnKL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0096547   .0536642     0.18   0.857    -.0955339    .1148433
       expat |   .0227839   .0329526     0.69   0.489    -.0418074    .0873752
             |
    ind_year |
          2  |   .1577378   .0371575     4.25   0.000     .0849043    .2305713
          3  |   .8064069   .0455088    17.72   0.000     .7172039      .89561
          4  |   .9696815   .0511726    18.95   0.000     .8693766    1.069986
          5  |   1.120672   .0559404    20.03   0.000     1.011022    1.230323
          6  |   1.367612   .0603881    22.65   0.000     1.249244    1.485981
          7  |   1.645816   .0654791    25.13   0.000     1.517468    1.774163
          8  |   1.856548   .0707581    26.24   0.000     1.717853    1.995243
          9  |   1.990818   .0762061    26.12   0.000     1.841445    2.140192
         10  |   2.136755   .0822689    25.97   0.000     1.975498    2.298013
         11  |   2.295101   .0879471    26.10   0.000     2.122714    2.467489
         12  |   2.349243   .0940823    24.97   0.000      2.16483    2.533657
         13  |   2.403103   .1004409    23.93   0.000     2.206226     2.59998
         14  |   2.415516   .1068001    22.62   0.000     2.206174    2.624858
         15  |   2.383085   .1134692    21.00   0.000     2.160671    2.605499
         16  |   2.420655   .1199065    20.19   0.000     2.185623    2.655687
         17  |   2.447878   .1268776    19.29   0.000     2.199182    2.696574
         18  |    2.44441   .1336316    18.29   0.000     2.182475    2.706345
         19  |   2.398035   .1401221    17.11   0.000     2.123378    2.672692
         20  |   2.391706   .1464803    16.33   0.000     2.104586    2.678826
         21  |   2.413816    .152028    15.88   0.000     2.115822     2.71181
         22  |   2.448446   .1576422    15.53   0.000     2.139447    2.757444
         23  |    2.56663    .163325    15.71   0.000     2.246492    2.886768
         24  |   2.368551   .1697714    13.95   0.000     2.035778    2.701325
         25  |   2.355943   .1762914    13.36   0.000      2.01039    2.701497
         26  |   .4735011   .0869134     5.45   0.000     .3031397    .6438624
         27  |   .6073804   .0769028     7.90   0.000     .4566411    .7581196
         28  |   .9153375   .0720206    12.71   0.000     .7741679    1.056507
         29  |   1.051427   .0710386    14.80   0.000     .9121823    1.190672
         30  |   1.172687   .0723226    16.21   0.000     1.030926    1.314449
         31  |   1.332439   .0743307    17.93   0.000     1.186741    1.478137
         32  |   1.546461   .0769527    20.10   0.000     1.395624    1.697298
         33  |   1.702543   .0812245    20.96   0.000     1.543333    1.861754
         34  |    1.82831   .0855787    21.36   0.000     1.660564    1.996055
         35  |   1.945402   .0905063    21.49   0.000     1.767998    2.122806
         36  |   2.073213   .0957918    21.64   0.000     1.885449    2.260977
         37  |   2.188625    .101142    21.64   0.000     1.990373    2.386876
         38  |   2.267939   .1063385    21.33   0.000     2.059502    2.476376
         39  |   2.279721   .1122968    20.30   0.000     2.059605    2.499837
         40  |   2.283538   .1181022    19.34   0.000     2.052043    2.515034
         41  |   2.313722   .1246318    18.56   0.000     2.069428    2.558017
         42  |   2.381914   .1312738    18.14   0.000     2.124601    2.639228
         43  |   2.418774   .1382574    17.49   0.000     2.147772    2.689776
         44  |   2.393767   .1452669    16.48   0.000     2.109026    2.678509
         45  |   2.412148    .151587    15.91   0.000     2.115018    2.709278
         46  |   2.409272   .1581354    15.24   0.000     2.099306    2.719238
         47  |   2.445747   .1637131    14.94   0.000     2.124848    2.766645
         48  |   2.529298   .1688031    14.98   0.000     2.198422    2.860173
         49  |   2.452628   .1751394    14.00   0.000     2.109332    2.795923
         50  |   2.469438    .180551    13.68   0.000     2.115535    2.823341
             |
     age_cat |
          1  |   .0935263   .0315877     2.96   0.003     .0316103    .1554422
          2  |   .1536939   .0357825     4.30   0.000     .0835555    .2238322
          3  |   .1751579   .0402381     4.35   0.000     .0962861    .2540297
          4  |   .2067612   .0453055     4.56   0.000     .1179567    .2955656
          5  |   .2068139   .0508305     4.07   0.000     .1071796    .3064481
          6  |   .1894644   .0567656     3.34   0.001     .0781966    .3007323
          7  |   .1980244    .062911     3.15   0.002     .0747109     .321338
          8  |   .2050359   .0693914     2.95   0.003     .0690198     .341052
          9  |   .2176488    .075841     2.87   0.004     .0689907    .3663068
         10  |   .2172892   .0825193     2.63   0.008     .0555408    .3790376
         11  |   .2164249   .0892692     2.42   0.015     .0414458    .3914039
         12  |   .2189582   .0959055     2.28   0.022     .0309712    .4069451
         13  |   .2147993   .1027068     2.09   0.037     .0134809    .4161176
         14  |   .2297929   .1096171     2.10   0.036     .0149294    .4446564
         15  |   .2413673    .116588     2.07   0.038       .01284    .4698947
         16  |   .2400442   .1239545     1.94   0.053    -.0029224    .4830108
         17  |   .2371148   .1312244     1.81   0.071    -.0201018    .4943314
         18  |   .2550218   .1384168     1.84   0.065    -.0162927    .5263364
         19  |   .2420782   .1458612     1.66   0.097    -.0438284    .5279847
         20  |   .2225723   .1605366     1.39   0.166       -.0921    .5372446
         25  |   .1839989    .185425     0.99   0.321    -.1794576    .5474555
         30  |   .3243962   .2312313     1.40   0.161    -.1288467     .777639
         40  |   .5111235   .2735675     1.87   0.062    -.0251037    1.047351
         50  |   .4918966   .3128857     1.57   0.116    -.1213992    1.105192
             |
       _cons |   3.805377   .0583856    65.18   0.000     3.690933     3.91982
-------------+----------------------------------------------------------------
     sigma_u |  1.7325127
     sigma_e |  .87282601
         rho |  .79757133   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text replace

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b', "`fmt'")) _newline
  6.         file write `output' ("   standard_error: " + string(`se', "`fmt'")) _newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se', "`fmt'")) _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',"pvalue"),colnumb(`coefs',"`X'")]), "`fmt'") _
> newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file
(sum of wgt is 116,031.571570903)

Linear regression                               Number of obs     =    311,119
                                                F(75, 18507)      =     187.79
                                                Prob > F          =     0.0000
                                                R-squared         =     0.2063
                                                Root MSE          =     1.1472

                                (Std. Err. adjusted for 18,508 clusters in id)
------------------------------------------------------------------------------
             |               Robust
        lnQL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .6556925   .0238725    27.47   0.000     .6089002    .7024848
       expat |  -.1032573   .0274149    -3.77   0.000     -.156993   -.0495216
             |
    ind_year |
          2  |   .1435737   .0288248     4.98   0.000     .0870743     .200073
          3  |   .3603141   .0328421    10.97   0.000     .2959406    .4246877
          4  |   .5812647   .0340192    17.09   0.000     .5145839    .6479455
          5  |   .7501768   .0349081    21.49   0.000     .6817536    .8185999
          6  |   .9437972   .0358096    26.36   0.000      .873607    1.013987
          7  |   1.034111   .0363286    28.47   0.000     .9629032    1.105318
          8  |   1.100646   .0363422    30.29   0.000     1.029412     1.17188
          9  |   1.202023   .0363588    33.06   0.000     1.130757     1.27329
         10  |   1.298777   .0366711    35.42   0.000     1.226898    1.370656
         11  |   1.299299   .0372283    34.90   0.000     1.226328     1.37227
         12  |   1.311777   .0375813    34.91   0.000     1.238114    1.385439
         13  |   1.331825   .0377209    35.31   0.000     1.257889    1.405762
         14  |    1.34527   .0382095    35.21   0.000     1.270376    1.420164
         15  |   1.396992   .0383791    36.40   0.000     1.321765    1.472218
         16  |   1.405056   .0381601    36.82   0.000     1.330259    1.479853
         17  |    1.43974   .0384713    37.42   0.000     1.364333    1.515148
         18  |   1.356242   .0389294    34.84   0.000     1.279936    1.432547
         19  |   1.372411   .0388566    35.32   0.000     1.296248    1.448573
         20  |   1.418837   .0394332    35.98   0.000     1.341544    1.496129
         21  |   1.420527   .0401478    35.38   0.000     1.341834    1.499221
         22  |    1.43918   .0406601    35.40   0.000     1.359482    1.518877
         23  |   1.495191   .0407621    36.68   0.000     1.415293    1.575089
         24  |   1.552551   .0417934    37.15   0.000     1.470632     1.63447
         25  |   1.567938   .0423059    37.06   0.000     1.485014    1.650861
         26  |  -.5655181   .0469212   -12.05   0.000    -.6574879   -.4735482
         27  |  -.4180866   .0435204    -9.61   0.000    -.5033905   -.3327827
         28  |  -.2358875   .0420326    -5.61   0.000    -.3182752   -.1534997
         29  |   .0011309   .0415855     0.03   0.978    -.0803807    .0826424
         30  |   .1420326   .0414687     3.43   0.001     .0607501    .2233151
         31  |   .2886721    .041002     7.04   0.000     .2083043    .3690398
         32  |   .4232504   .0401615    10.54   0.000     .3445302    .5019707
         33  |    .466013   .0396942    11.74   0.000     .3882086    .5438173
         34  |   .6014318    .040185    14.97   0.000     .5226655    .6801982
         35  |   .6745239   .0399661    16.88   0.000     .5961866    .7528611
         36  |   .7451515   .0398631    18.69   0.000     .6670162    .8232868
         37  |   .8075026   .0403597    20.01   0.000     .7283938    .8866113
         38  |   .8838888   .0403374    21.91   0.000     .8048237    .9629539
         39  |   .9377729   .0406332    23.08   0.000      .858128    1.017418
         40  |   1.024576   .0416209    24.62   0.000     .9429951    1.106157
         41  |   1.085642   .0412252    26.33   0.000     1.004836    1.166447
         42  |   1.148808   .0411911    27.89   0.000      1.06807    1.229546
         43  |   1.139996   .0418791    27.22   0.000     1.057909    1.222083
         44  |   1.181818   .0423969    27.88   0.000     1.098717     1.26492
         45  |   1.241988   .0431068    28.81   0.000     1.157495    1.326482
         46  |   1.256049    .043446    28.91   0.000     1.170891    1.341207
         47  |   1.280458   .0438885    29.18   0.000     1.194433    1.366484
         48  |   1.348289   .0440283    30.62   0.000     1.261989    1.434588
         49  |   1.400106   .0452905    30.91   0.000     1.311333     1.48888
         50  |   1.436823   .0451318    31.84   0.000      1.34836    1.525285
             |
     age_cat |
          1  |   .3200034   .0241456    13.25   0.000     .2726758    .3673311
          2  |   .3964462   .0249422    15.89   0.000     .3475572    .4453352
          3  |   .4504336   .0255989    17.60   0.000     .4002575    .5006098
          4  |   .4911757   .0262657    18.70   0.000     .4396924    .5426589
          5  |   .5299677   .0268268    19.76   0.000     .4773847    .5825506
          6  |   .5561845   .0273916    20.30   0.000     .5024944    .6098746
          7  |   .5935499    .027945    21.24   0.000     .5387752    .6483246
          8  |   .6147529   .0283778    21.66   0.000     .5591298     .670376
          9  |   .6570813   .0289584    22.69   0.000     .6003201    .7138425
         10  |   .6686766    .029423    22.73   0.000     .6110048    .7263485
         11  |    .703437   .0300673    23.40   0.000     .6445024    .7623716
         12  |   .7215471   .0307534    23.46   0.000     .6612675    .7818266
         13  |   .7464521   .0313998    23.77   0.000     .6849057    .8079985
         14  |    .776855   .0319221    24.34   0.000     .7142849    .8394252
         15  |   .8027274   .0327114    24.54   0.000       .73861    .8668447
         16  |   .8199287   .0333297    24.60   0.000     .7545993     .885258
         17  |   .8246115   .0342434    24.08   0.000     .7574913    .8917317
         18  |   .8399357   .0348786    24.08   0.000     .7715705    .9083009
         19  |   .8410581   .0359413    23.40   0.000     .7706098    .9115064
         20  |   .8496776   .0383227    22.17   0.000     .7745615    .9247937
         25  |   .7833882    .048507    16.15   0.000     .6883099    .8784665
         30  |   .2167302   .0637325     3.40   0.001     .0918086    .3416519
         40  |   .1427066   .0563759     2.53   0.011     .0322045    .2532086
         50  |   .3452411   .0689041     5.01   0.000     .2101827    .4802996
             |
       _cons |   7.274921   .0386609   188.17   0.000     7.199143      7.3507
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. local fmt "%10.5f"

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }

. 
. estimates

--------------------------------------------------------------------------------------------------------------------------------
active results
--------------------------------------------------------------------------------------------------------------------------------

Linear regression                               Number of obs     =    311,119
                                                F(75, 18507)      =     187.79
                                                Prob > F          =     0.0000
                                                R-squared         =     0.2063
                                                Root MSE          =     1.1472

                                (Std. Err. adjusted for 18,508 clusters in id)
------------------------------------------------------------------------------
             |               Robust
        lnQL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .6556925   .0238725    27.47   0.000     .6089002    .7024848
       expat |  -.1032573   .0274149    -3.77   0.000     -.156993   -.0495216
             |
    ind_year |
          2  |   .1435737   .0288248     4.98   0.000     .0870743     .200073
          3  |   .3603141   .0328421    10.97   0.000     .2959406    .4246877
          4  |   .5812647   .0340192    17.09   0.000     .5145839    .6479455
          5  |   .7501768   .0349081    21.49   0.000     .6817536    .8185999
          6  |   .9437972   .0358096    26.36   0.000      .873607    1.013987
          7  |   1.034111   .0363286    28.47   0.000     .9629032    1.105318
          8  |   1.100646   .0363422    30.29   0.000     1.029412     1.17188
          9  |   1.202023   .0363588    33.06   0.000     1.130757     1.27329
         10  |   1.298777   .0366711    35.42   0.000     1.226898    1.370656
         11  |   1.299299   .0372283    34.90   0.000     1.226328     1.37227
         12  |   1.311777   .0375813    34.91   0.000     1.238114    1.385439
         13  |   1.331825   .0377209    35.31   0.000     1.257889    1.405762
         14  |    1.34527   .0382095    35.21   0.000     1.270376    1.420164
         15  |   1.396992   .0383791    36.40   0.000     1.321765    1.472218
         16  |   1.405056   .0381601    36.82   0.000     1.330259    1.479853
         17  |    1.43974   .0384713    37.42   0.000     1.364333    1.515148
         18  |   1.356242   .0389294    34.84   0.000     1.279936    1.432547
         19  |   1.372411   .0388566    35.32   0.000     1.296248    1.448573
         20  |   1.418837   .0394332    35.98   0.000     1.341544    1.496129
         21  |   1.420527   .0401478    35.38   0.000     1.341834    1.499221
         22  |    1.43918   .0406601    35.40   0.000     1.359482    1.518877
         23  |   1.495191   .0407621    36.68   0.000     1.415293    1.575089
         24  |   1.552551   .0417934    37.15   0.000     1.470632     1.63447
         25  |   1.567938   .0423059    37.06   0.000     1.485014    1.650861
         26  |  -.5655181   .0469212   -12.05   0.000    -.6574879   -.4735482
         27  |  -.4180866   .0435204    -9.61   0.000    -.5033905   -.3327827
         28  |  -.2358875   .0420326    -5.61   0.000    -.3182752   -.1534997
         29  |   .0011309   .0415855     0.03   0.978    -.0803807    .0826424
         30  |   .1420326   .0414687     3.43   0.001     .0607501    .2233151
         31  |   .2886721    .041002     7.04   0.000     .2083043    .3690398
         32  |   .4232504   .0401615    10.54   0.000     .3445302    .5019707
         33  |    .466013   .0396942    11.74   0.000     .3882086    .5438173
         34  |   .6014318    .040185    14.97   0.000     .5226655    .6801982
         35  |   .6745239   .0399661    16.88   0.000     .5961866    .7528611
         36  |   .7451515   .0398631    18.69   0.000     .6670162    .8232868
         37  |   .8075026   .0403597    20.01   0.000     .7283938    .8866113
         38  |   .8838888   .0403374    21.91   0.000     .8048237    .9629539
         39  |   .9377729   .0406332    23.08   0.000      .858128    1.017418
         40  |   1.024576   .0416209    24.62   0.000     .9429951    1.106157
         41  |   1.085642   .0412252    26.33   0.000     1.004836    1.166447
         42  |   1.148808   .0411911    27.89   0.000      1.06807    1.229546
         43  |   1.139996   .0418791    27.22   0.000     1.057909    1.222083
         44  |   1.181818   .0423969    27.88   0.000     1.098717     1.26492
         45  |   1.241988   .0431068    28.81   0.000     1.157495    1.326482
         46  |   1.256049    .043446    28.91   0.000     1.170891    1.341207
         47  |   1.280458   .0438885    29.18   0.000     1.194433    1.366484
         48  |   1.348289   .0440283    30.62   0.000     1.261989    1.434588
         49  |   1.400106   .0452905    30.91   0.000     1.311333     1.48888
         50  |   1.436823   .0451318    31.84   0.000      1.34836    1.525285
             |
     age_cat |
          1  |   .3200034   .0241456    13.25   0.000     .2726758    .3673311
          2  |   .3964462   .0249422    15.89   0.000     .3475572    .4453352
          3  |   .4504336   .0255989    17.60   0.000     .4002575    .5006098
          4  |   .4911757   .0262657    18.70   0.000     .4396924    .5426589
          5  |   .5299677   .0268268    19.76   0.000     .4773847    .5825506
          6  |   .5561845   .0273916    20.30   0.000     .5024944    .6098746
          7  |   .5935499    .027945    21.24   0.000     .5387752    .6483246
          8  |   .6147529   .0283778    21.66   0.000     .5591298     .670376
          9  |   .6570813   .0289584    22.69   0.000     .6003201    .7138425
         10  |   .6686766    .029423    22.73   0.000     .6110048    .7263485
         11  |    .703437   .0300673    23.40   0.000     .6445024    .7623716
         12  |   .7215471   .0307534    23.46   0.000     .6612675    .7818266
         13  |   .7464521   .0313998    23.77   0.000     .6849057    .8079985
         14  |    .776855   .0319221    24.34   0.000     .7142849    .8394252
         15  |   .8027274   .0327114    24.54   0.000       .73861    .8668447
         16  |   .8199287   .0333297    24.60   0.000     .7545993     .885258
         17  |   .8246115   .0342434    24.08   0.000     .7574913    .8917317
         18  |   .8399357   .0348786    24.08   0.000     .7715705    .9083009
         19  |   .8410581   .0359413    23.40   0.000     .7706098    .9115064
         20  |   .8496776   .0383227    22.17   0.000     .7745615    .9247937
         25  |   .7833882    .048507    16.15   0.000     .6883099    .8784665
         30  |   .2167302   .0637325     3.40   0.001     .0918086    .3416519
         40  |   .1427066   .0563759     2.53   0.011     .0322045    .2532086
         50  |   .3452411   .0689041     5.01   0.000     .2101827    .4802996
             |
       _cons |   7.274921   .0386609   188.17   0.000     7.199143      7.3507
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text replace

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b', "`fmt'")) _newline
  6.         file write `output' ("   standard_error: " + string(`se', "`fmt'")) _newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se', "`fmt'")) _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',"pvalue"),colnumb(`coefs',"`X'")]), "`fmt'") _
> newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file

Fixed-effects (within) regression               Number of obs     =    311,119
Group variable: id                              Number of groups  =     18,508

R-sq:                                           Obs per group:
     within  = 0.2831                                         min =          1
     between = 0.1719                                         avg =       16.8
     overall = 0.1472                                         max =        140

                                                F(75,18507)       =     159.99
corr(u_i, Xb)  = 0.0338                         Prob > F          =     0.0000

                                (Std. Err. adjusted for 18,508 clusters in id)
------------------------------------------------------------------------------
             |               Robust
        lnQL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0796446   .0230348     3.46   0.001     .0344943    .1247949
       expat |  -.0043098   .0090175    -0.48   0.633     -.021985    .0133654
             |
    ind_year |
          2  |   .1181643   .0211188     5.60   0.000     .0767695    .1595592
          3  |   .3018117   .0248385    12.15   0.000      .253126    .3504975
          4  |   .4867407   .0263883    18.45   0.000     .4350173    .5384642
          5  |   .6598361   .0289031    22.83   0.000     .6031834    .7164888
          6  |   .8554849   .0313146    27.32   0.000     .7941054    .9168644
          7  |   .9844805   .0337648    29.16   0.000     .9182984    1.050663
          8  |   1.062396   .0361947    29.35   0.000     .9914514    1.133341
          9  |   1.172672   .0388553    30.18   0.000     1.096512    1.248832
         10  |   1.288993   .0419351    30.74   0.000     1.206796    1.371189
         11  |   1.354019   .0448293    30.20   0.000      1.26615    1.441889
         12  |   1.386206   .0479968    28.88   0.000     1.292128    1.480284
         13  |   1.435448   .0508112    28.25   0.000     1.335854    1.535043
         14  |   1.480775   .0536396    27.61   0.000     1.375636    1.585913
         15  |   1.550295   .0569694    27.21   0.000      1.43863     1.66196
         16  |   1.585821    .059728    26.55   0.000     1.468748    1.702893
         17  |   1.638042   .0631358    25.94   0.000      1.51429    1.761794
         18  |   1.570851   .0662714    23.70   0.000     1.440953    1.700749
         19  |   1.599847   .0692777    23.09   0.000     1.464056    1.735637
         20  |   1.660053   .0723319    22.95   0.000     1.518276    1.801831
         21  |   1.680911     .07525    22.34   0.000     1.533415    1.828408
         22  |   1.729222   .0779811    22.17   0.000     1.576372    1.882072
         23  |   1.784343    .080732    22.10   0.000     1.626101    1.942585
         24  |   1.809638   .0838987    21.57   0.000     1.645189    1.974087
         25  |   1.817076   .0866573    20.97   0.000      1.64722    1.986932
         26  |  -.3031728   .0438815    -6.91   0.000    -.3891846    -.217161
         27  |  -.1540292    .041488    -3.71   0.000    -.2353495    -.072709
         28  |   .0381457   .0394663     0.97   0.334    -.0392119    .1155033
         29  |   .2783944   .0396133     7.03   0.000     .2007487    .3560401
         30  |   .4411095   .0400424    11.02   0.000     .3626227    .5195962
         31  |   .6078111   .0408204    14.89   0.000     .5277993    .6878229
         32  |   .7579632   .0419562    18.07   0.000     .6757251    .8402012
         33  |   .8372367   .0434184    19.28   0.000     .7521327    .9223407
         34  |    .989931   .0454879    21.76   0.000     .9007705    1.079091
         35  |   1.080218   .0473368    22.82   0.000     .9874338    1.173003
         36  |   1.133122   .0500477    22.64   0.000     1.035024     1.23122
         37  |   1.204568   .0524117    22.98   0.000     1.101836      1.3073
         38  |   1.281261   .0551135    23.25   0.000     1.173234    1.389289
         39  |   1.332202   .0577741    23.06   0.000     1.218959    1.445444
         40  |   1.435058   .0613399    23.40   0.000     1.314826     1.55529
         41  |   1.501606   .0636662    23.59   0.000     1.376815    1.626398
         42  |   1.578023   .0662551    23.82   0.000     1.448157    1.707889
         43  |    1.55871   .0694422    22.45   0.000     1.422597    1.694823
         44  |   1.617681   .0725426    22.30   0.000     1.475491    1.759871
         45  |   1.690706   .0754883    22.40   0.000     1.542742     1.83867
         46  |   1.696883   .0782959    21.67   0.000     1.543415     1.85035
         47  |   1.730812   .0807897    21.42   0.000     1.572457    1.889168
         48  |   1.799935   .0832355    21.62   0.000     1.636785    1.963084
         49  |   1.817432   .0864687    21.02   0.000     1.647945    1.986918
         50  |   1.853131   .0893013    20.75   0.000     1.678092     2.02817
             |
     age_cat |
          1  |   .2627691   .0167445    15.69   0.000     .2299484    .2955898
          2  |   .2918839   .0185374    15.75   0.000     .2555488    .3282191
          3  |   .2833198   .0206464    13.72   0.000      .242851    .3237886
          4  |   .2705071   .0229462    11.79   0.000     .2255306    .3154837
          5  |   .2601213   .0254885    10.21   0.000     .2101615    .3100812
          6  |   .2499336   .0282764     8.84   0.000     .1945093    .3053579
          7  |   .2524518    .031245     8.08   0.000     .1912088    .3136948
          8  |   .2331751    .034279     6.80   0.000     .1659852     .300365
          9  |   .2299819   .0374029     6.15   0.000     .1566688    .3032951
         10  |   .2157775   .0406032     5.31   0.000     .1361916    .2953635
         11  |   .2183049     .04386     4.98   0.000     .1323352    .3042745
         12  |   .2019066   .0472224     4.28   0.000     .1093463    .2944669
         13  |   .1981266   .0504554     3.93   0.000     .0992293    .2970239
         14  |   .1986553   .0537909     3.69   0.000     .0932202    .3040905
         15  |   .1977959   .0571567     3.46   0.001     .0857635    .3098284
         16  |   .1952087   .0604598     3.23   0.001      .076702    .3137154
         17  |   .1824908   .0640212     2.85   0.004     .0570034    .3079782
         18  |   .1839491   .0674457     2.73   0.006     .0517493    .3161489
         19  |   .1593103   .0711211     2.24   0.025     .0199063    .2987143
         20  |   .1311431   .0781931     1.68   0.094    -.0221227    .2844089
         25  |   .0894608    .090158     0.99   0.321    -.0872571    .2661787
         30  |   .1176048   .1220038     0.96   0.335     -.121534    .3567435
         40  |   .2201477   .1409722     1.56   0.118    -.0561708    .4964661
         50  |    .211962   .1572875     1.35   0.178    -.0963359      .52026
             |
       _cons |   7.529174   .0319298   235.80   0.000     7.466588    7.591759
-------------+----------------------------------------------------------------
     sigma_u |  1.1946969
     sigma_e |  .52627455
         rho |  .83748725   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. local fmt "%10.5f"

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }
key: R2_within
value: .2830547973548901

. 
. estimates

--------------------------------------------------------------------------------------------------------------------------------
active results
--------------------------------------------------------------------------------------------------------------------------------

Fixed-effects (within) regression               Number of obs     =    311,119
Group variable: id                              Number of groups  =     18,508

R-sq:                                           Obs per group:
     within  = 0.2831                                         min =          1
     between = 0.1719                                         avg =       16.8
     overall = 0.1472                                         max =        140

                                                F(75,18507)       =     159.99
corr(u_i, Xb)  = 0.0338                         Prob > F          =     0.0000

                                (Std. Err. adjusted for 18,508 clusters in id)
------------------------------------------------------------------------------
             |               Robust
        lnQL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0796446   .0230348     3.46   0.001     .0344943    .1247949
       expat |  -.0043098   .0090175    -0.48   0.633     -.021985    .0133654
             |
    ind_year |
          2  |   .1181643   .0211188     5.60   0.000     .0767695    .1595592
          3  |   .3018117   .0248385    12.15   0.000      .253126    .3504975
          4  |   .4867407   .0263883    18.45   0.000     .4350173    .5384642
          5  |   .6598361   .0289031    22.83   0.000     .6031834    .7164888
          6  |   .8554849   .0313146    27.32   0.000     .7941054    .9168644
          7  |   .9844805   .0337648    29.16   0.000     .9182984    1.050663
          8  |   1.062396   .0361947    29.35   0.000     .9914514    1.133341
          9  |   1.172672   .0388553    30.18   0.000     1.096512    1.248832
         10  |   1.288993   .0419351    30.74   0.000     1.206796    1.371189
         11  |   1.354019   .0448293    30.20   0.000      1.26615    1.441889
         12  |   1.386206   .0479968    28.88   0.000     1.292128    1.480284
         13  |   1.435448   .0508112    28.25   0.000     1.335854    1.535043
         14  |   1.480775   .0536396    27.61   0.000     1.375636    1.585913
         15  |   1.550295   .0569694    27.21   0.000      1.43863     1.66196
         16  |   1.585821    .059728    26.55   0.000     1.468748    1.702893
         17  |   1.638042   .0631358    25.94   0.000      1.51429    1.761794
         18  |   1.570851   .0662714    23.70   0.000     1.440953    1.700749
         19  |   1.599847   .0692777    23.09   0.000     1.464056    1.735637
         20  |   1.660053   .0723319    22.95   0.000     1.518276    1.801831
         21  |   1.680911     .07525    22.34   0.000     1.533415    1.828408
         22  |   1.729222   .0779811    22.17   0.000     1.576372    1.882072
         23  |   1.784343    .080732    22.10   0.000     1.626101    1.942585
         24  |   1.809638   .0838987    21.57   0.000     1.645189    1.974087
         25  |   1.817076   .0866573    20.97   0.000      1.64722    1.986932
         26  |  -.3031728   .0438815    -6.91   0.000    -.3891846    -.217161
         27  |  -.1540292    .041488    -3.71   0.000    -.2353495    -.072709
         28  |   .0381457   .0394663     0.97   0.334    -.0392119    .1155033
         29  |   .2783944   .0396133     7.03   0.000     .2007487    .3560401
         30  |   .4411095   .0400424    11.02   0.000     .3626227    .5195962
         31  |   .6078111   .0408204    14.89   0.000     .5277993    .6878229
         32  |   .7579632   .0419562    18.07   0.000     .6757251    .8402012
         33  |   .8372367   .0434184    19.28   0.000     .7521327    .9223407
         34  |    .989931   .0454879    21.76   0.000     .9007705    1.079091
         35  |   1.080218   .0473368    22.82   0.000     .9874338    1.173003
         36  |   1.133122   .0500477    22.64   0.000     1.035024     1.23122
         37  |   1.204568   .0524117    22.98   0.000     1.101836      1.3073
         38  |   1.281261   .0551135    23.25   0.000     1.173234    1.389289
         39  |   1.332202   .0577741    23.06   0.000     1.218959    1.445444
         40  |   1.435058   .0613399    23.40   0.000     1.314826     1.55529
         41  |   1.501606   .0636662    23.59   0.000     1.376815    1.626398
         42  |   1.578023   .0662551    23.82   0.000     1.448157    1.707889
         43  |    1.55871   .0694422    22.45   0.000     1.422597    1.694823
         44  |   1.617681   .0725426    22.30   0.000     1.475491    1.759871
         45  |   1.690706   .0754883    22.40   0.000     1.542742     1.83867
         46  |   1.696883   .0782959    21.67   0.000     1.543415     1.85035
         47  |   1.730812   .0807897    21.42   0.000     1.572457    1.889168
         48  |   1.799935   .0832355    21.62   0.000     1.636785    1.963084
         49  |   1.817432   .0864687    21.02   0.000     1.647945    1.986918
         50  |   1.853131   .0893013    20.75   0.000     1.678092     2.02817
             |
     age_cat |
          1  |   .2627691   .0167445    15.69   0.000     .2299484    .2955898
          2  |   .2918839   .0185374    15.75   0.000     .2555488    .3282191
          3  |   .2833198   .0206464    13.72   0.000      .242851    .3237886
          4  |   .2705071   .0229462    11.79   0.000     .2255306    .3154837
          5  |   .2601213   .0254885    10.21   0.000     .2101615    .3100812
          6  |   .2499336   .0282764     8.84   0.000     .1945093    .3053579
          7  |   .2524518    .031245     8.08   0.000     .1912088    .3136948
          8  |   .2331751    .034279     6.80   0.000     .1659852     .300365
          9  |   .2299819   .0374029     6.15   0.000     .1566688    .3032951
         10  |   .2157775   .0406032     5.31   0.000     .1361916    .2953635
         11  |   .2183049     .04386     4.98   0.000     .1323352    .3042745
         12  |   .2019066   .0472224     4.28   0.000     .1093463    .2944669
         13  |   .1981266   .0504554     3.93   0.000     .0992293    .2970239
         14  |   .1986553   .0537909     3.69   0.000     .0932202    .3040905
         15  |   .1977959   .0571567     3.46   0.001     .0857635    .3098284
         16  |   .1952087   .0604598     3.23   0.001      .076702    .3137154
         17  |   .1824908   .0640212     2.85   0.004     .0570034    .3079782
         18  |   .1839491   .0674457     2.73   0.006     .0517493    .3161489
         19  |   .1593103   .0711211     2.24   0.025     .0199063    .2987143
         20  |   .1311431   .0781931     1.68   0.094    -.0221227    .2844089
         25  |   .0894608    .090158     0.99   0.321    -.0872571    .2661787
         30  |   .1176048   .1220038     0.96   0.335     -.121534    .3567435
         40  |   .2201477   .1409722     1.56   0.118    -.0561708    .4964661
         50  |    .211962   .1572875     1.35   0.178    -.0963359      .52026
             |
       _cons |   7.529174   .0319298   235.80   0.000     7.466588    7.591759
-------------+----------------------------------------------------------------
     sigma_u |  1.1946969
     sigma_e |  .52627455
         rho |  .83748725   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text replace

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b', "`fmt'")) _newline
  6.         file write `output' ("   standard_error: " + string(`se', "`fmt'")) _newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se', "`fmt'")) _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',"pvalue"),colnumb(`coefs',"`X'")]), "`fmt'") _
> newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file
(sum of wgt is 96,323.3384407535)

Linear regression                               Number of obs     =    229,907
                                                F(75, 14528)      =     141.57
                                                Prob > F          =     0.0000
                                                R-squared         =     0.1825
                                                Root MSE          =     1.1302

                                (Std. Err. adjusted for 14,529 clusters in id)
------------------------------------------------------------------------------
             |               Robust
        lnQL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .5932985   .0364614    16.27   0.000     .5218296    .6647674
       expat |  -.0499687    .050412    -0.99   0.322    -.1487826    .0488452
             |
    ind_year |
          2  |   .1249773   .0306018     4.08   0.000     .0649938    .1849608
          3  |   .3558776   .0348204    10.22   0.000     .2876252      .42413
          4  |   .5955838   .0360861    16.50   0.000     .5248505    .6663172
          5  |     .75403   .0367141    20.54   0.000     .6820656    .8259944
          6  |   .9513528    .037965    25.06   0.000     .8769365    1.025769
          7  |   1.038314   .0385059    26.97   0.000     .9628376    1.113791
          8  |   1.102316   .0384811    28.65   0.000     1.026889    1.177744
          9  |   1.204404   .0384681    31.31   0.000     1.129002    1.279806
         10  |   1.297755   .0388527    33.40   0.000     1.221599    1.373912
         11  |    1.29299   .0395245    32.71   0.000     1.215517    1.370463
         12  |   1.305967   .0399688    32.67   0.000     1.227623    1.384311
         13  |   1.313551   .0401039    32.75   0.000     1.234942     1.39216
         14  |   1.322682     .04052    32.64   0.000     1.243258    1.402107
         15  |   1.377155      .0409    33.67   0.000     1.296985    1.457324
         16  |   1.383582   .0406217    34.06   0.000     1.303958    1.463205
         17  |   1.420105    .041069    34.58   0.000     1.339605    1.500605
         18  |   1.330667   .0415491    32.03   0.000     1.249226    1.412109
         19  |   1.337459   .0415053    32.22   0.000     1.256103    1.418814
         20  |   1.381013    .042079    32.82   0.000     1.298533    1.463493
         21  |   1.381873   .0430214    32.12   0.000     1.297546    1.466201
         22  |   1.411003    .043561    32.39   0.000     1.325618    1.496389
         23  |   1.471681   .0436147    33.74   0.000      1.38619    1.557171
         24  |   1.514552   .0448945    33.74   0.000     1.426553    1.602551
         25  |   1.525329   .0454695    33.55   0.000     1.436203    1.614455
         26  |  -.5038855   .0508146    -9.92   0.000    -.6034887   -.4042824
         27  |  -.3152353   .0467957    -6.74   0.000    -.4069607   -.2235099
         28  |  -.1312467   .0456106    -2.88   0.004    -.2206493   -.0418441
         29  |   .1071245    .045152     2.37   0.018     .0186207    .1956282
         30  |   .2760817   .0450695     6.13   0.000     .1877397    .3644237
         31  |    .414664   .0445272     9.31   0.000     .3273849     .501943
         32  |   .5507132   .0434139    12.69   0.000     .4656164      .63581
         33  |   .5705936   .0429213    13.29   0.000     .4864624    .6547248
         34  |   .7049842   .0435385    16.19   0.000     .6196431    .7903252
         35  |   .7702656   .0433371    17.77   0.000     .6853193    .8552119
         36  |   .8375817    .043083    19.44   0.000     .7531336    .9220298
         37  |   .8614328   .0437035    19.71   0.000     .7757683    .9470973
         38  |   .9223769   .0436693    21.12   0.000     .8367794    1.007974
         39  |   .9553677   .0439401    21.74   0.000     .8692394    1.041496
         40  |   1.024479   .0452321    22.65   0.000     .9358183     1.11314
         41  |   1.092888   .0447762    24.41   0.000     1.005121    1.180655
         42  |   1.151109   .0446296    25.79   0.000      1.06363    1.238589
         43  |   1.129847   .0455144    24.82   0.000     1.040633    1.219061
         44  |   1.170453   .0462631    25.30   0.000     1.079772    1.261135
         45  |   1.224603   .0469885    26.06   0.000     1.132499    1.316706
         46  |   1.231056   .0474431    25.95   0.000     1.138061     1.32405
         47  |   1.261391   .0477205    26.43   0.000     1.167853    1.354929
         48  |   1.334521   .0474685    28.11   0.000     1.241476    1.427565
         49  |   1.365765   .0493686    27.66   0.000     1.268996    1.462533
         50  |    1.40968   .0488681    28.85   0.000     1.313892    1.505467
             |
     age_cat |
          1  |   .2966818   .0262108    11.32   0.000     .2453054    .3480583
          2  |   .3533236   .0271252    13.03   0.000     .3001549    .4064924
          3  |   .3984406   .0279194    14.27   0.000      .343715    .4531663
          4  |   .4363066   .0287587    15.17   0.000     .3799359    .4926774
          5  |   .4750887   .0294162    16.15   0.000     .4174292    .5327482
          6  |   .4952559   .0301268    16.44   0.000     .4362036    .5543082
          7  |   .5389178   .0307666    17.52   0.000     .4786114    .5992242
          8  |   .5691412   .0312871    18.19   0.000     .5078144     .630468
          9  |    .615553   .0319693    19.25   0.000      .552889     .678217
         10  |   .6281002   .0324987    19.33   0.000     .5643986    .6918018
         11  |   .6745896   .0332854    20.27   0.000      .609346    .7398333
         12  |   .6999914   .0340623    20.55   0.000     .6332251    .7667578
         13  |    .728497   .0348204    20.92   0.000     .6602446    .7967493
         14  |   .7638629   .0354424    21.55   0.000     .6943913    .8333345
         15  |   .7895986   .0363885    21.70   0.000     .7182725    .8609247
         16  |   .8123398   .0371225    21.88   0.000     .7395749    .8851046
         17  |   .8196928   .0381687    21.48   0.000     .7448773    .8945083
         18  |   .8366627   .0388615    21.53   0.000     .7604892    .9128362
         19  |   .8404182   .0400683    20.97   0.000     .7618792    .9189572
         20  |   .8405871   .0426573    19.71   0.000     .7569734    .9242007
         25  |   .7473538    .053685    13.92   0.000     .6421243    .8525833
         30  |   .1750548   .0658526     2.66   0.008     .0459753    .3041343
         40  |   .0991147   .0587419     1.69   0.092    -.0160269    .2142563
         50  |   .3215126   .0708148     4.54   0.000     .1827066    .4603186
             |
       _cons |   7.301938   .0410346   177.95   0.000     7.221505     7.38237
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. local fmt "%10.5f"

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }

. 
. estimates

--------------------------------------------------------------------------------------------------------------------------------
active results
--------------------------------------------------------------------------------------------------------------------------------

Linear regression                               Number of obs     =    229,907
                                                F(75, 14528)      =     141.57
                                                Prob > F          =     0.0000
                                                R-squared         =     0.1825
                                                Root MSE          =     1.1302

                                (Std. Err. adjusted for 14,529 clusters in id)
------------------------------------------------------------------------------
             |               Robust
        lnQL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .5932985   .0364614    16.27   0.000     .5218296    .6647674
       expat |  -.0499687    .050412    -0.99   0.322    -.1487826    .0488452
             |
    ind_year |
          2  |   .1249773   .0306018     4.08   0.000     .0649938    .1849608
          3  |   .3558776   .0348204    10.22   0.000     .2876252      .42413
          4  |   .5955838   .0360861    16.50   0.000     .5248505    .6663172
          5  |     .75403   .0367141    20.54   0.000     .6820656    .8259944
          6  |   .9513528    .037965    25.06   0.000     .8769365    1.025769
          7  |   1.038314   .0385059    26.97   0.000     .9628376    1.113791
          8  |   1.102316   .0384811    28.65   0.000     1.026889    1.177744
          9  |   1.204404   .0384681    31.31   0.000     1.129002    1.279806
         10  |   1.297755   .0388527    33.40   0.000     1.221599    1.373912
         11  |    1.29299   .0395245    32.71   0.000     1.215517    1.370463
         12  |   1.305967   .0399688    32.67   0.000     1.227623    1.384311
         13  |   1.313551   .0401039    32.75   0.000     1.234942     1.39216
         14  |   1.322682     .04052    32.64   0.000     1.243258    1.402107
         15  |   1.377155      .0409    33.67   0.000     1.296985    1.457324
         16  |   1.383582   .0406217    34.06   0.000     1.303958    1.463205
         17  |   1.420105    .041069    34.58   0.000     1.339605    1.500605
         18  |   1.330667   .0415491    32.03   0.000     1.249226    1.412109
         19  |   1.337459   .0415053    32.22   0.000     1.256103    1.418814
         20  |   1.381013    .042079    32.82   0.000     1.298533    1.463493
         21  |   1.381873   .0430214    32.12   0.000     1.297546    1.466201
         22  |   1.411003    .043561    32.39   0.000     1.325618    1.496389
         23  |   1.471681   .0436147    33.74   0.000      1.38619    1.557171
         24  |   1.514552   .0448945    33.74   0.000     1.426553    1.602551
         25  |   1.525329   .0454695    33.55   0.000     1.436203    1.614455
         26  |  -.5038855   .0508146    -9.92   0.000    -.6034887   -.4042824
         27  |  -.3152353   .0467957    -6.74   0.000    -.4069607   -.2235099
         28  |  -.1312467   .0456106    -2.88   0.004    -.2206493   -.0418441
         29  |   .1071245    .045152     2.37   0.018     .0186207    .1956282
         30  |   .2760817   .0450695     6.13   0.000     .1877397    .3644237
         31  |    .414664   .0445272     9.31   0.000     .3273849     .501943
         32  |   .5507132   .0434139    12.69   0.000     .4656164      .63581
         33  |   .5705936   .0429213    13.29   0.000     .4864624    .6547248
         34  |   .7049842   .0435385    16.19   0.000     .6196431    .7903252
         35  |   .7702656   .0433371    17.77   0.000     .6853193    .8552119
         36  |   .8375817    .043083    19.44   0.000     .7531336    .9220298
         37  |   .8614328   .0437035    19.71   0.000     .7757683    .9470973
         38  |   .9223769   .0436693    21.12   0.000     .8367794    1.007974
         39  |   .9553677   .0439401    21.74   0.000     .8692394    1.041496
         40  |   1.024479   .0452321    22.65   0.000     .9358183     1.11314
         41  |   1.092888   .0447762    24.41   0.000     1.005121    1.180655
         42  |   1.151109   .0446296    25.79   0.000      1.06363    1.238589
         43  |   1.129847   .0455144    24.82   0.000     1.040633    1.219061
         44  |   1.170453   .0462631    25.30   0.000     1.079772    1.261135
         45  |   1.224603   .0469885    26.06   0.000     1.132499    1.316706
         46  |   1.231056   .0474431    25.95   0.000     1.138061     1.32405
         47  |   1.261391   .0477205    26.43   0.000     1.167853    1.354929
         48  |   1.334521   .0474685    28.11   0.000     1.241476    1.427565
         49  |   1.365765   .0493686    27.66   0.000     1.268996    1.462533
         50  |    1.40968   .0488681    28.85   0.000     1.313892    1.505467
             |
     age_cat |
          1  |   .2966818   .0262108    11.32   0.000     .2453054    .3480583
          2  |   .3533236   .0271252    13.03   0.000     .3001549    .4064924
          3  |   .3984406   .0279194    14.27   0.000      .343715    .4531663
          4  |   .4363066   .0287587    15.17   0.000     .3799359    .4926774
          5  |   .4750887   .0294162    16.15   0.000     .4174292    .5327482
          6  |   .4952559   .0301268    16.44   0.000     .4362036    .5543082
          7  |   .5389178   .0307666    17.52   0.000     .4786114    .5992242
          8  |   .5691412   .0312871    18.19   0.000     .5078144     .630468
          9  |    .615553   .0319693    19.25   0.000      .552889     .678217
         10  |   .6281002   .0324987    19.33   0.000     .5643986    .6918018
         11  |   .6745896   .0332854    20.27   0.000      .609346    .7398333
         12  |   .6999914   .0340623    20.55   0.000     .6332251    .7667578
         13  |    .728497   .0348204    20.92   0.000     .6602446    .7967493
         14  |   .7638629   .0354424    21.55   0.000     .6943913    .8333345
         15  |   .7895986   .0363885    21.70   0.000     .7182725    .8609247
         16  |   .8123398   .0371225    21.88   0.000     .7395749    .8851046
         17  |   .8196928   .0381687    21.48   0.000     .7448773    .8945083
         18  |   .8366627   .0388615    21.53   0.000     .7604892    .9128362
         19  |   .8404182   .0400683    20.97   0.000     .7618792    .9189572
         20  |   .8405871   .0426573    19.71   0.000     .7569734    .9242007
         25  |   .7473538    .053685    13.92   0.000     .6421243    .8525833
         30  |   .1750548   .0658526     2.66   0.008     .0459753    .3041343
         40  |   .0991147   .0587419     1.69   0.092    -.0160269    .2142563
         50  |   .3215126   .0708148     4.54   0.000     .1827066    .4603186
             |
       _cons |   7.301938   .0410346   177.95   0.000     7.221505     7.38237
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text replace

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b', "`fmt'")) _newline
  6.         file write `output' ("   standard_error: " + string(`se', "`fmt'")) _newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se', "`fmt'")) _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',"pvalue"),colnumb(`coefs',"`X'")]), "`fmt'") _
> newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file

Fixed-effects (within) regression               Number of obs     =    229,907
Group variable: id                              Number of groups  =     14,529

R-sq:                                           Obs per group:
     within  = 0.2791                                         min =          1
     between = 0.1548                                         avg =       15.8
     overall = 0.1323                                         max =        140

                                                F(75,14528)       =     121.44
corr(u_i, Xb)  = -0.0010                        Prob > F          =     0.0000

                                (Std. Err. adjusted for 14,529 clusters in id)
------------------------------------------------------------------------------
             |               Robust
        lnQL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0634101   .0298496     2.12   0.034      .004901    .1219191
       expat |   .0342829   .0205747     1.67   0.096    -.0060461    .0746119
             |
    ind_year |
          2  |   .1108669   .0222866     4.97   0.000     .0671822    .1545515
          3  |   .3114018   .0267206    11.65   0.000     .2590261    .3637775
          4  |   .5092845   .0282241    18.04   0.000     .4539617    .5646072
          5  |    .678678   .0309597    21.92   0.000      .617993    .7393631
          6  |   .8748625   .0336711    25.98   0.000     .8088629    .9408621
          7  |   1.004446    .036301    27.67   0.000      .933291      1.0756
          8  |    1.08681   .0388174    28.00   0.000     1.010723    1.162898
          9  |   1.204849   .0416415    28.93   0.000     1.123227    1.286472
         10  |   1.325677   .0449326    29.50   0.000     1.237603     1.41375
         11  |   1.391858   .0479668    29.02   0.000     1.297837    1.485879
         12  |   1.424958   .0513357    27.76   0.000     1.324334    1.525583
         13  |   1.468169   .0542677    27.05   0.000     1.361798    1.574541
         14  |   1.514783   .0572477    26.46   0.000      1.40257    1.626995
         15  |   1.590439   .0607889    26.16   0.000     1.471285    1.709593
         16  |   1.631436   .0635964    25.65   0.000     1.506779    1.756093
         17  |   1.690712   .0672202    25.15   0.000     1.558952    1.822472
         18  |   1.621349   .0705058    23.00   0.000     1.483148    1.759549
         19  |   1.645642   .0736213    22.35   0.000     1.501335    1.789949
         20  |   1.705885   .0768213    22.21   0.000     1.555305    1.856464
         21  |   1.729486   .0799161    21.64   0.000      1.57284    1.886132
         22  |   1.781594   .0827689    21.52   0.000     1.619356    1.943831
         23  |   1.837782   .0856282    21.46   0.000      1.66994    2.005625
         24  |   1.868869   .0890011    21.00   0.000     1.694416    2.043323
         25  |   1.869964   .0918568    20.36   0.000     1.689912    2.050015
         26  |  -.2364596   .0494548    -4.78   0.000    -.3333973   -.1395219
         27  |  -.0832035   .0462705    -1.80   0.072    -.1738995    .0074925
         28  |   .0841884   .0442488     1.90   0.057    -.0025449    .1709218
         29  |   .3137271   .0442171     7.10   0.000      .227056    .4003982
         30  |   .4980023   .0444345    11.21   0.000      .410905    .5850996
         31  |   .6555417   .0452334    14.49   0.000     .5668785     .744205
         32  |   .8082236   .0463725    17.43   0.000     .7173277    .8991196
         33  |   .8740975   .0478392    18.27   0.000     .7803266    .9678683
         34  |    1.02961   .0498933    20.64   0.000     .9318129    1.127407
         35  |   1.124574   .0516764    21.76   0.000     1.023282    1.225867
         36  |   1.181804   .0545978    21.65   0.000     1.074785    1.288823
         37  |   1.245954    .057051    21.84   0.000     1.134126    1.357781
         38  |   1.324409   .0597872    22.15   0.000     1.207219      1.4416
         39  |   1.365368   .0624637    21.86   0.000     1.242931    1.487805
         40  |   1.462176    .066208    22.08   0.000       1.3324    1.591952
         41  |   1.541953   .0684646    22.52   0.000     1.407754    1.676153
         42  |   1.619214   .0711387    22.76   0.000     1.479773    1.758655
         43  |   1.596264   .0745144    21.42   0.000     1.450206    1.742321
         44  |   1.645794   .0777731    21.16   0.000     1.493349    1.798239
         45  |   1.719021   .0808747    21.26   0.000     1.560497    1.877546
         46  |   1.716704   .0838683    20.47   0.000     1.552312    1.881097
         47  |   1.749115   .0863169    20.26   0.000     1.579923    1.918307
         48  |   1.821893   .0887933    20.52   0.000     1.647847    1.995939
         49  |   1.833826   .0923183    19.86   0.000      1.65287    2.014781
         50  |    1.87309   .0952501    19.66   0.000     1.686388    2.059793
             |
     age_cat |
          1  |   .2435429   .0179671    13.55   0.000     .2083252    .2787607
          2  |   .2474306   .0198922    12.44   0.000     .2084394    .2864218
          3  |    .225263   .0222344    10.13   0.000     .1816808    .2688453
          4  |   .2081426   .0246795     8.43   0.000     .1597676    .2565177
          5  |   .1997124   .0273505     7.30   0.000     .1461018    .2533229
          6  |   .1833492   .0303626     6.04   0.000     .1238346    .2428638
          7  |   .1855511    .033524     5.53   0.000     .1198399    .2512624
          8  |    .168547   .0367556     4.59   0.000     .0965014    .2405926
          9  |   .1627767    .040059     4.06   0.000     .0842561    .2412974
         10  |   .1479125   .0434283     3.41   0.001     .0627875    .2330374
         11  |    .151991   .0468441     3.24   0.001     .0601707    .2438113
         12  |   .1367517    .050397     2.71   0.007     .0379672    .2355362
         13  |   .1301708   .0537865     2.42   0.016     .0247423    .2355993
         14  |   .1328532    .057294     2.32   0.020     .0205495    .2451568
         15  |   .1279376   .0608587     2.10   0.036     .0086469    .2472283
         16  |   .1270532   .0643208     1.98   0.048     .0009763    .2531301
         17  |   .1128387   .0681264     1.66   0.098    -.0206978    .2463752
         18  |   .1137725   .0717322     1.59   0.113    -.0268318    .2543768
         19  |   .0890244   .0756797     1.18   0.239    -.0593173    .2373662
         20  |    .059765   .0831835     0.72   0.472    -.1032853    .2228153
         25  |   .0184078   .0958941     0.19   0.848    -.1695569    .2063725
         30  |   .0569664    .128638     0.44   0.658    -.1951804    .3091131
         40  |   .1638614   .1472602     1.11   0.266    -.1247874    .4525102
         50  |   .1466915   .1644272     0.89   0.372    -.1756068    .4689897
             |
       _cons |   7.476812   .0335529   222.84   0.000     7.411043     7.54258
-------------+----------------------------------------------------------------
     sigma_u |  1.1565039
     sigma_e |  .52187414
         rho |  .83082153   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. local fmt "%10.5f"

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }
key: R2_within
value: .2791470826118606

. 
. estimates

--------------------------------------------------------------------------------------------------------------------------------
active results
--------------------------------------------------------------------------------------------------------------------------------

Fixed-effects (within) regression               Number of obs     =    229,907
Group variable: id                              Number of groups  =     14,529

R-sq:                                           Obs per group:
     within  = 0.2791                                         min =          1
     between = 0.1548                                         avg =       15.8
     overall = 0.1323                                         max =        140

                                                F(75,14528)       =     121.44
corr(u_i, Xb)  = -0.0010                        Prob > F          =     0.0000

                                (Std. Err. adjusted for 14,529 clusters in id)
------------------------------------------------------------------------------
             |               Robust
        lnQL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0634101   .0298496     2.12   0.034      .004901    .1219191
       expat |   .0342829   .0205747     1.67   0.096    -.0060461    .0746119
             |
    ind_year |
          2  |   .1108669   .0222866     4.97   0.000     .0671822    .1545515
          3  |   .3114018   .0267206    11.65   0.000     .2590261    .3637775
          4  |   .5092845   .0282241    18.04   0.000     .4539617    .5646072
          5  |    .678678   .0309597    21.92   0.000      .617993    .7393631
          6  |   .8748625   .0336711    25.98   0.000     .8088629    .9408621
          7  |   1.004446    .036301    27.67   0.000      .933291      1.0756
          8  |    1.08681   .0388174    28.00   0.000     1.010723    1.162898
          9  |   1.204849   .0416415    28.93   0.000     1.123227    1.286472
         10  |   1.325677   .0449326    29.50   0.000     1.237603     1.41375
         11  |   1.391858   .0479668    29.02   0.000     1.297837    1.485879
         12  |   1.424958   .0513357    27.76   0.000     1.324334    1.525583
         13  |   1.468169   .0542677    27.05   0.000     1.361798    1.574541
         14  |   1.514783   .0572477    26.46   0.000      1.40257    1.626995
         15  |   1.590439   .0607889    26.16   0.000     1.471285    1.709593
         16  |   1.631436   .0635964    25.65   0.000     1.506779    1.756093
         17  |   1.690712   .0672202    25.15   0.000     1.558952    1.822472
         18  |   1.621349   .0705058    23.00   0.000     1.483148    1.759549
         19  |   1.645642   .0736213    22.35   0.000     1.501335    1.789949
         20  |   1.705885   .0768213    22.21   0.000     1.555305    1.856464
         21  |   1.729486   .0799161    21.64   0.000      1.57284    1.886132
         22  |   1.781594   .0827689    21.52   0.000     1.619356    1.943831
         23  |   1.837782   .0856282    21.46   0.000      1.66994    2.005625
         24  |   1.868869   .0890011    21.00   0.000     1.694416    2.043323
         25  |   1.869964   .0918568    20.36   0.000     1.689912    2.050015
         26  |  -.2364596   .0494548    -4.78   0.000    -.3333973   -.1395219
         27  |  -.0832035   .0462705    -1.80   0.072    -.1738995    .0074925
         28  |   .0841884   .0442488     1.90   0.057    -.0025449    .1709218
         29  |   .3137271   .0442171     7.10   0.000      .227056    .4003982
         30  |   .4980023   .0444345    11.21   0.000      .410905    .5850996
         31  |   .6555417   .0452334    14.49   0.000     .5668785     .744205
         32  |   .8082236   .0463725    17.43   0.000     .7173277    .8991196
         33  |   .8740975   .0478392    18.27   0.000     .7803266    .9678683
         34  |    1.02961   .0498933    20.64   0.000     .9318129    1.127407
         35  |   1.124574   .0516764    21.76   0.000     1.023282    1.225867
         36  |   1.181804   .0545978    21.65   0.000     1.074785    1.288823
         37  |   1.245954    .057051    21.84   0.000     1.134126    1.357781
         38  |   1.324409   .0597872    22.15   0.000     1.207219      1.4416
         39  |   1.365368   .0624637    21.86   0.000     1.242931    1.487805
         40  |   1.462176    .066208    22.08   0.000       1.3324    1.591952
         41  |   1.541953   .0684646    22.52   0.000     1.407754    1.676153
         42  |   1.619214   .0711387    22.76   0.000     1.479773    1.758655
         43  |   1.596264   .0745144    21.42   0.000     1.450206    1.742321
         44  |   1.645794   .0777731    21.16   0.000     1.493349    1.798239
         45  |   1.719021   .0808747    21.26   0.000     1.560497    1.877546
         46  |   1.716704   .0838683    20.47   0.000     1.552312    1.881097
         47  |   1.749115   .0863169    20.26   0.000     1.579923    1.918307
         48  |   1.821893   .0887933    20.52   0.000     1.647847    1.995939
         49  |   1.833826   .0923183    19.86   0.000      1.65287    2.014781
         50  |    1.87309   .0952501    19.66   0.000     1.686388    2.059793
             |
     age_cat |
          1  |   .2435429   .0179671    13.55   0.000     .2083252    .2787607
          2  |   .2474306   .0198922    12.44   0.000     .2084394    .2864218
          3  |    .225263   .0222344    10.13   0.000     .1816808    .2688453
          4  |   .2081426   .0246795     8.43   0.000     .1597676    .2565177
          5  |   .1997124   .0273505     7.30   0.000     .1461018    .2533229
          6  |   .1833492   .0303626     6.04   0.000     .1238346    .2428638
          7  |   .1855511    .033524     5.53   0.000     .1198399    .2512624
          8  |    .168547   .0367556     4.59   0.000     .0965014    .2405926
          9  |   .1627767    .040059     4.06   0.000     .0842561    .2412974
         10  |   .1479125   .0434283     3.41   0.001     .0627875    .2330374
         11  |    .151991   .0468441     3.24   0.001     .0601707    .2438113
         12  |   .1367517    .050397     2.71   0.007     .0379672    .2355362
         13  |   .1301708   .0537865     2.42   0.016     .0247423    .2355993
         14  |   .1328532    .057294     2.32   0.020     .0205495    .2451568
         15  |   .1279376   .0608587     2.10   0.036     .0086469    .2472283
         16  |   .1270532   .0643208     1.98   0.048     .0009763    .2531301
         17  |   .1128387   .0681264     1.66   0.098    -.0206978    .2463752
         18  |   .1137725   .0717322     1.59   0.113    -.0268318    .2543768
         19  |   .0890244   .0756797     1.18   0.239    -.0593173    .2373662
         20  |    .059765   .0831835     0.72   0.472    -.1032853    .2228153
         25  |   .0184078   .0958941     0.19   0.848    -.1695569    .2063725
         30  |   .0569664    .128638     0.44   0.658    -.1951804    .3091131
         40  |   .1638614   .1472602     1.11   0.266    -.1247874    .4525102
         50  |   .1466915   .1644272     0.89   0.372    -.1756068    .4689897
             |
       _cons |   7.476812   .0335529   222.84   0.000     7.411043     7.54258
-------------+----------------------------------------------------------------
     sigma_u |  1.1565039
     sigma_e |  .52187414
         rho |  .83082153   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text replace

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b', "`fmt'")) _newline
  6.         file write `output' ("   standard_error: " + string(`se', "`fmt'")) _newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se', "`fmt'")) _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',"pvalue"),colnumb(`coefs',"`X'")]), "`fmt'") _
> newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file
(sum of wgt is 116,031.571570903)

Linear regression                               Number of obs     =    311,119
                                                F(75, 18507)      =     159.34
                                                Prob > F          =     0.0000
                                                R-squared         =     0.2005
                                                Root MSE          =     .43681

                                (Std. Err. adjusted for 18,508 clusters in id)
------------------------------------------------------------------------------
             |               Robust
    exporter |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .3363388   .0080859    41.60   0.000     .3204898    .3521878
       expat |   .0554549   .0083446     6.65   0.000     .0390988    .0718111
             |
    ind_year |
          2  |   -.030038   .0105903    -2.84   0.005     -.050796   -.0092799
          3  |  -.0539263   .0120014    -4.49   0.000    -.0774502   -.0304025
          4  |  -.0632167   .0123347    -5.13   0.000    -.0873938   -.0390396
          5  |  -.0500005   .0128016    -3.91   0.000    -.0750929   -.0249082
          6  |  -.0673186   .0128501    -5.24   0.000    -.0925059   -.0421314
          7  |  -.0683093   .0128869    -5.30   0.000    -.0935688   -.0430498
          8  |  -.0831344   .0130075    -6.39   0.000    -.1086302   -.0576385
          9  |  -.0938854   .0130442    -7.20   0.000    -.1194532   -.0683176
         10  |  -.0908038   .0131635    -6.90   0.000    -.1166055   -.0650021
         11  |  -.1055422     .01305    -8.09   0.000    -.1311213    -.079963
         12  |  -.1093224   .0130493    -8.38   0.000    -.1349002   -.0837446
         13  |  -.1075887   .0130765    -8.23   0.000    -.1332197   -.0819576
         14  |  -.0979444   .0132069    -7.42   0.000    -.1238311   -.0720578
         15  |  -.0886051   .0132911    -6.67   0.000    -.1146569   -.0625533
         16  |  -.0793128   .0134246    -5.91   0.000    -.1056263   -.0529993
         17  |  -.0677456   .0135219    -5.01   0.000    -.0942498   -.0412415
         18  |  -.0658929   .0136091    -4.84   0.000    -.0925681   -.0392178
         19  |  -.0607479   .0137452    -4.42   0.000    -.0876896   -.0338061
         20  |  -.0485841   .0138794    -3.50   0.000    -.0757889   -.0213793
         21  |  -.0400309   .0140136    -2.86   0.004    -.0674989    -.012563
         22  |  -.0410834   .0142705    -2.88   0.004    -.0690549   -.0131119
         23  |  -.0399681   .0143615    -2.78   0.005    -.0681179   -.0118182
         24  |  -.1389217   .0141838    -9.79   0.000    -.1667233   -.1111201
         25  |  -.1669469   .0144555   -11.55   0.000     -.195281   -.1386127
         26  |   .2032286   .0200039    10.16   0.000     .1640192    .2424381
         27  |   .1641285   .0174376     9.41   0.000     .1299492    .1983078
         28  |   .1698759    .016673    10.19   0.000     .1371954    .2025565
         29  |   .1723192   .0163085    10.57   0.000      .140353    .2042853
         30  |   .1924916   .0161721    11.90   0.000     .1607928    .2241905
         31  |   .1904852   .0159022    11.98   0.000     .1593154     .221655
         32  |   .1875797   .0156438    11.99   0.000     .1569164     .218243
         33  |   .1752949   .0154249    11.36   0.000     .1450608    .2055291
         34  |   .1810127   .0153884    11.76   0.000     .1508501    .2111754
         35  |    .183764   .0153963    11.94   0.000     .1535857    .2139422
         36  |   .1861897   .0153575    12.12   0.000     .1560876    .2162917
         37  |   .1788879   .0153164    11.68   0.000     .1488663    .2089094
         38  |   .1753371   .0152053    11.53   0.000     .1455333    .2051409
         39  |   .1724914   .0152697    11.30   0.000     .1425613    .2024214
         40  |   .1712365   .0153323    11.17   0.000     .1411839    .2012891
         41  |   .1926665   .0154166    12.50   0.000     .1624486    .2228845
         42  |   .1980059   .0154839    12.79   0.000     .1676561    .2283558
         43  |   .1975639   .0157168    12.57   0.000     .1667575    .2283702
         44  |   .2126677   .0158659    13.40   0.000     .1815691    .2437662
         45  |    .214088   .0160215    13.36   0.000     .1826843    .2454917
         46  |   .2208512   .0161253    13.70   0.000     .1892442    .2524583
         47  |   .2287281   .0164662    13.89   0.000     .1964529    .2610033
         48  |   .2182675   .0165725    13.17   0.000     .1857838    .2507512
         49  |  -.0239916   .0166641    -1.44   0.150    -.0566548    .0086716
         50  |  -.0688275   .0169416    -4.06   0.000    -.1020346   -.0356204
             |
     age_cat |
          1  |   .0551022   .0070656     7.80   0.000      .041253    .0689515
          2  |   .0827472   .0074066    11.17   0.000     .0682295    .0972648
          3  |   .1010726   .0076094    13.28   0.000     .0861575    .1159878
          4  |   .1260098   .0078541    16.04   0.000      .110615    .1414046
          5  |   .1425163   .0080704    17.66   0.000     .1266975    .1583351
          6  |    .155102   .0083404    18.60   0.000     .1387542    .1714499
          7  |   .1658662   .0085835    19.32   0.000     .1490419    .1826906
          8  |   .1822192   .0088916    20.49   0.000     .1647908    .1996476
          9  |   .1877121     .00909    20.65   0.000     .1698948    .2055294
         10  |   .1903312   .0092718    20.53   0.000     .1721576    .2085047
         11  |    .198639   .0094733    20.97   0.000     .1800704    .2172076
         12  |   .2017011   .0096929    20.81   0.000     .1827022       .2207
         13  |   .2129047   .0099948    21.30   0.000      .193314    .2324954
         14  |   .2232596   .0104027    21.46   0.000     .2028693      .24365
         15  |   .2345621   .0106998    21.92   0.000     .2135894    .2555347
         16  |   .2413749   .0110813    21.78   0.000     .2196547    .2630952
         17  |   .2413165   .0114987    20.99   0.000     .2187779    .2638551
         18  |   .2491693   .0119674    20.82   0.000     .2257121    .2726265
         19  |   .2371019   .0123593    19.18   0.000     .2128766    .2613272
         20  |    .246414    .012841    19.19   0.000     .2212444    .2715836
         25  |   .2588381   .0175434    14.75   0.000     .2244515    .2932247
         30  |   .0745433   .0207074     3.60   0.000      .033955    .1151316
         40  |   .1032239   .0205627     5.02   0.000     .0629192    .1435286
         50  |   .0948734   .0232638     4.08   0.000     .0492742    .1404726
             |
       _cons |   .1439521   .0129544    11.11   0.000     .1185603    .1693439
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. local fmt "%10.5f"

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }

. 
. estimates

--------------------------------------------------------------------------------------------------------------------------------
active results
--------------------------------------------------------------------------------------------------------------------------------

Linear regression                               Number of obs     =    311,119
                                                F(75, 18507)      =     159.34
                                                Prob > F          =     0.0000
                                                R-squared         =     0.2005
                                                Root MSE          =     .43681

                                (Std. Err. adjusted for 18,508 clusters in id)
------------------------------------------------------------------------------
             |               Robust
    exporter |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .3363388   .0080859    41.60   0.000     .3204898    .3521878
       expat |   .0554549   .0083446     6.65   0.000     .0390988    .0718111
             |
    ind_year |
          2  |   -.030038   .0105903    -2.84   0.005     -.050796   -.0092799
          3  |  -.0539263   .0120014    -4.49   0.000    -.0774502   -.0304025
          4  |  -.0632167   .0123347    -5.13   0.000    -.0873938   -.0390396
          5  |  -.0500005   .0128016    -3.91   0.000    -.0750929   -.0249082
          6  |  -.0673186   .0128501    -5.24   0.000    -.0925059   -.0421314
          7  |  -.0683093   .0128869    -5.30   0.000    -.0935688   -.0430498
          8  |  -.0831344   .0130075    -6.39   0.000    -.1086302   -.0576385
          9  |  -.0938854   .0130442    -7.20   0.000    -.1194532   -.0683176
         10  |  -.0908038   .0131635    -6.90   0.000    -.1166055   -.0650021
         11  |  -.1055422     .01305    -8.09   0.000    -.1311213    -.079963
         12  |  -.1093224   .0130493    -8.38   0.000    -.1349002   -.0837446
         13  |  -.1075887   .0130765    -8.23   0.000    -.1332197   -.0819576
         14  |  -.0979444   .0132069    -7.42   0.000    -.1238311   -.0720578
         15  |  -.0886051   .0132911    -6.67   0.000    -.1146569   -.0625533
         16  |  -.0793128   .0134246    -5.91   0.000    -.1056263   -.0529993
         17  |  -.0677456   .0135219    -5.01   0.000    -.0942498   -.0412415
         18  |  -.0658929   .0136091    -4.84   0.000    -.0925681   -.0392178
         19  |  -.0607479   .0137452    -4.42   0.000    -.0876896   -.0338061
         20  |  -.0485841   .0138794    -3.50   0.000    -.0757889   -.0213793
         21  |  -.0400309   .0140136    -2.86   0.004    -.0674989    -.012563
         22  |  -.0410834   .0142705    -2.88   0.004    -.0690549   -.0131119
         23  |  -.0399681   .0143615    -2.78   0.005    -.0681179   -.0118182
         24  |  -.1389217   .0141838    -9.79   0.000    -.1667233   -.1111201
         25  |  -.1669469   .0144555   -11.55   0.000     -.195281   -.1386127
         26  |   .2032286   .0200039    10.16   0.000     .1640192    .2424381
         27  |   .1641285   .0174376     9.41   0.000     .1299492    .1983078
         28  |   .1698759    .016673    10.19   0.000     .1371954    .2025565
         29  |   .1723192   .0163085    10.57   0.000      .140353    .2042853
         30  |   .1924916   .0161721    11.90   0.000     .1607928    .2241905
         31  |   .1904852   .0159022    11.98   0.000     .1593154     .221655
         32  |   .1875797   .0156438    11.99   0.000     .1569164     .218243
         33  |   .1752949   .0154249    11.36   0.000     .1450608    .2055291
         34  |   .1810127   .0153884    11.76   0.000     .1508501    .2111754
         35  |    .183764   .0153963    11.94   0.000     .1535857    .2139422
         36  |   .1861897   .0153575    12.12   0.000     .1560876    .2162917
         37  |   .1788879   .0153164    11.68   0.000     .1488663    .2089094
         38  |   .1753371   .0152053    11.53   0.000     .1455333    .2051409
         39  |   .1724914   .0152697    11.30   0.000     .1425613    .2024214
         40  |   .1712365   .0153323    11.17   0.000     .1411839    .2012891
         41  |   .1926665   .0154166    12.50   0.000     .1624486    .2228845
         42  |   .1980059   .0154839    12.79   0.000     .1676561    .2283558
         43  |   .1975639   .0157168    12.57   0.000     .1667575    .2283702
         44  |   .2126677   .0158659    13.40   0.000     .1815691    .2437662
         45  |    .214088   .0160215    13.36   0.000     .1826843    .2454917
         46  |   .2208512   .0161253    13.70   0.000     .1892442    .2524583
         47  |   .2287281   .0164662    13.89   0.000     .1964529    .2610033
         48  |   .2182675   .0165725    13.17   0.000     .1857838    .2507512
         49  |  -.0239916   .0166641    -1.44   0.150    -.0566548    .0086716
         50  |  -.0688275   .0169416    -4.06   0.000    -.1020346   -.0356204
             |
     age_cat |
          1  |   .0551022   .0070656     7.80   0.000      .041253    .0689515
          2  |   .0827472   .0074066    11.17   0.000     .0682295    .0972648
          3  |   .1010726   .0076094    13.28   0.000     .0861575    .1159878
          4  |   .1260098   .0078541    16.04   0.000      .110615    .1414046
          5  |   .1425163   .0080704    17.66   0.000     .1266975    .1583351
          6  |    .155102   .0083404    18.60   0.000     .1387542    .1714499
          7  |   .1658662   .0085835    19.32   0.000     .1490419    .1826906
          8  |   .1822192   .0088916    20.49   0.000     .1647908    .1996476
          9  |   .1877121     .00909    20.65   0.000     .1698948    .2055294
         10  |   .1903312   .0092718    20.53   0.000     .1721576    .2085047
         11  |    .198639   .0094733    20.97   0.000     .1800704    .2172076
         12  |   .2017011   .0096929    20.81   0.000     .1827022       .2207
         13  |   .2129047   .0099948    21.30   0.000      .193314    .2324954
         14  |   .2232596   .0104027    21.46   0.000     .2028693      .24365
         15  |   .2345621   .0106998    21.92   0.000     .2135894    .2555347
         16  |   .2413749   .0110813    21.78   0.000     .2196547    .2630952
         17  |   .2413165   .0114987    20.99   0.000     .2187779    .2638551
         18  |   .2491693   .0119674    20.82   0.000     .2257121    .2726265
         19  |   .2371019   .0123593    19.18   0.000     .2128766    .2613272
         20  |    .246414    .012841    19.19   0.000     .2212444    .2715836
         25  |   .2588381   .0175434    14.75   0.000     .2244515    .2932247
         30  |   .0745433   .0207074     3.60   0.000      .033955    .1151316
         40  |   .1032239   .0205627     5.02   0.000     .0629192    .1435286
         50  |   .0948734   .0232638     4.08   0.000     .0492742    .1404726
             |
       _cons |   .1439521   .0129544    11.11   0.000     .1185603    .1693439
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text replace

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b', "`fmt'")) _newline
  6.         file write `output' ("   standard_error: " + string(`se', "`fmt'")) _newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se', "`fmt'")) _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',"pvalue"),colnumb(`coefs',"`X'")]), "`fmt'") _
> newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file

Fixed-effects (within) regression               Number of obs     =    311,119
Group variable: id                              Number of groups  =     18,508

R-sq:                                           Obs per group:
     within  = 0.0479                                         min =          1
     between = 0.1554                                         avg =       16.8
     overall = 0.0969                                         max =        140

                                                F(75,18507)       =      32.14
corr(u_i, Xb)  = 0.2060                         Prob > F          =     0.0000

                                (Std. Err. adjusted for 18,508 clusters in id)
------------------------------------------------------------------------------
             |               Robust
    exporter |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0295596   .0124357     2.38   0.017     .0051844    .0539348
       expat |   .0167337   .0037428     4.47   0.000     .0093976    .0240699
             |
    ind_year |
          2  |  -.0189551   .0098918    -1.92   0.055     -.038344    .0004337
          3  |  -.0355731   .0118372    -3.01   0.003    -.0587752    -.012371
          4  |  -.0440353   .0124878    -3.53   0.000    -.0685124   -.0195581
          5  |  -.0326008   .0137851    -2.36   0.018    -.0596208   -.0055807
          6  |  -.0449044   .0146014    -3.08   0.002    -.0735246   -.0162842
          7  |  -.0424723   .0156175    -2.72   0.007    -.0730839   -.0118606
          8  |   -.055646   .0166631    -3.34   0.001    -.0883073   -.0229847
          9  |  -.0585139   .0179518    -3.26   0.001    -.0937011   -.0233267
         10  |  -.0543457   .0191438    -2.84   0.005    -.0918693   -.0168221
         11  |  -.0602873   .0204183    -2.95   0.003     -.100309   -.0202657
         12  |  -.0596539   .0215694    -2.77   0.006    -.1019319    -.017376
         13  |   -.053228   .0229427    -2.32   0.020    -.0981978   -.0082581
         14  |  -.0421436   .0243096    -1.73   0.083    -.0897927    .0055055
         15  |  -.0304013   .0256918    -1.18   0.237    -.0807597    .0199571
         16  |  -.0195889   .0270662    -0.72   0.469    -.0726412    .0334633
         17  |  -.0062808   .0284678    -0.22   0.825    -.0620804    .0495187
         18  |  -.0042826   .0300291    -0.14   0.887    -.0631425    .0545773
         19  |  -.0013887   .0314846    -0.04   0.965    -.0631014    .0603241
         20  |   .0064413   .0328414     0.20   0.845     -.057931    .0708135
         21  |   .0106262    .034152     0.31   0.756    -.0563149    .0775673
         22  |     .01379   .0354222     0.39   0.697    -.0556407    .0832207
         23  |   .0127417   .0366943     0.35   0.728    -.0591824    .0846659
         24  |  -.1038491   .0379732    -2.73   0.006      -.17828   -.0294182
         25  |  -.1363198   .0394816    -3.45   0.001    -.2137074   -.0589322
         26  |   .0228749   .0225602     1.01   0.311    -.0213451    .0670949
         27  |   .0183582   .0200758     0.91   0.360    -.0209922    .0577085
         28  |   .0291076   .0195594     1.49   0.137    -.0092305    .0674458
         29  |    .036635   .0192305     1.91   0.057    -.0010586    .0743286
         30  |   .0450436   .0193535     2.33   0.020      .007109    .0829781
         31  |   .0377118   .0194526     1.94   0.053    -.0004171    .0758407
         32  |   .0356198   .0199913     1.78   0.075    -.0035649    .0748045
         33  |   .0317812   .0206625     1.54   0.124    -.0087192    .0722816
         34  |   .0327622   .0213714     1.53   0.125    -.0091277     .074652
         35  |   .0358572   .0223367     1.61   0.108    -.0079249    .0796392
         36  |   .0337007   .0234599     1.44   0.151    -.0122827    .0796842
         37  |    .031979   .0245079     1.30   0.192    -.0160587    .0800168
         38  |   .0312063   .0255105     1.22   0.221    -.0187967    .0812093
         39  |   .0317445   .0266886     1.19   0.234    -.0205675    .0840566
         40  |   .0320702   .0277762     1.15   0.248    -.0223737    .0865141
         41  |   .0532598    .028992     1.84   0.066    -.0035671    .1100867
         42  |   .0604352    .030267     2.00   0.046     .0011091    .1197613
         43  |    .059481   .0317481     1.87   0.061    -.0027481    .1217101
         44  |   .0750556   .0331771     2.26   0.024     .0100255    .1400857
         45  |   .0790386   .0344471     2.29   0.022     .0115191    .1465581
         46  |   .0817612   .0358758     2.28   0.023     .0114413    .1520811
         47  |   .0905719   .0371563     2.44   0.015      .017742    .1634017
         48  |   .0801689   .0381076     2.10   0.035     .0054744    .1548634
         49  |  -.1879394   .0395934    -4.75   0.000    -.2655462   -.1103327
         50  |  -.2433802   .0410342    -5.93   0.000     -.323811   -.1629494
             |
     age_cat |
          1  |   .0445987   .0067916     6.57   0.000     .0312866    .0579108
          2  |   .0668214   .0076825     8.70   0.000      .051763    .0818798
          3  |   .0830005   .0086376     9.61   0.000       .06607     .099931
          4  |   .1038877   .0098043    10.60   0.000     .0846703    .1231051
          5  |   .1190965   .0110264    10.80   0.000     .0974839    .1407092
          6  |   .1301522   .0124044    10.49   0.000     .1058383     .154466
          7  |   .1370681   .0137921     9.94   0.000     .1100342    .1641019
          8  |   .1504791   .0152622     9.86   0.000     .1205638    .1803944
          9  |   .1521365   .0167289     9.09   0.000     .1193462    .1849267
         10  |   .1538599    .018194     8.46   0.000     .1181981    .1895218
         11  |   .1615564   .0196573     8.22   0.000     .1230263    .2000865
         12  |   .1603673    .021147     7.58   0.000     .1189173    .2018173
         13  |   .1711255   .0227294     7.53   0.000     .1265739    .2156772
         14  |   .1817947   .0243562     7.46   0.000     .1340544    .2295351
         15  |   .1892375   .0258719     7.31   0.000     .1385262    .2399489
         16  |   .1961233   .0274397     7.15   0.000     .1423391    .2499076
         17  |   .1949827   .0289524     6.73   0.000     .1382332    .2517321
         18  |   .2021306   .0306848     6.59   0.000     .1419855    .2622757
         19  |   .1909467   .0325026     5.87   0.000     .1272387    .2546547
         20  |   .1999322   .0352131     5.68   0.000     .1309114    .2689531
         25  |   .2210753   .0408576     5.41   0.000     .1409907      .30116
         30  |   .2004415   .0605167     3.31   0.001     .0818232    .3190597
         40  |   .1876713   .0682878     2.75   0.006     .0538208    .3215217
         50  |    .114174   .0735771     1.55   0.121     -.030044    .2583919
             |
       _cons |   .2602642   .0143014    18.20   0.000     .2322321    .2882963
-------------+----------------------------------------------------------------
     sigma_u |  .39314233
     sigma_e |  .28494111
         rho |  .65560707   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. local fmt "%10.5f"

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }
key: R2_within
value: .0479139965663238

. 
. estimates

--------------------------------------------------------------------------------------------------------------------------------
active results
--------------------------------------------------------------------------------------------------------------------------------

Fixed-effects (within) regression               Number of obs     =    311,119
Group variable: id                              Number of groups  =     18,508

R-sq:                                           Obs per group:
     within  = 0.0479                                         min =          1
     between = 0.1554                                         avg =       16.8
     overall = 0.0969                                         max =        140

                                                F(75,18507)       =      32.14
corr(u_i, Xb)  = 0.2060                         Prob > F          =     0.0000

                                (Std. Err. adjusted for 18,508 clusters in id)
------------------------------------------------------------------------------
             |               Robust
    exporter |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0295596   .0124357     2.38   0.017     .0051844    .0539348
       expat |   .0167337   .0037428     4.47   0.000     .0093976    .0240699
             |
    ind_year |
          2  |  -.0189551   .0098918    -1.92   0.055     -.038344    .0004337
          3  |  -.0355731   .0118372    -3.01   0.003    -.0587752    -.012371
          4  |  -.0440353   .0124878    -3.53   0.000    -.0685124   -.0195581
          5  |  -.0326008   .0137851    -2.36   0.018    -.0596208   -.0055807
          6  |  -.0449044   .0146014    -3.08   0.002    -.0735246   -.0162842
          7  |  -.0424723   .0156175    -2.72   0.007    -.0730839   -.0118606
          8  |   -.055646   .0166631    -3.34   0.001    -.0883073   -.0229847
          9  |  -.0585139   .0179518    -3.26   0.001    -.0937011   -.0233267
         10  |  -.0543457   .0191438    -2.84   0.005    -.0918693   -.0168221
         11  |  -.0602873   .0204183    -2.95   0.003     -.100309   -.0202657
         12  |  -.0596539   .0215694    -2.77   0.006    -.1019319    -.017376
         13  |   -.053228   .0229427    -2.32   0.020    -.0981978   -.0082581
         14  |  -.0421436   .0243096    -1.73   0.083    -.0897927    .0055055
         15  |  -.0304013   .0256918    -1.18   0.237    -.0807597    .0199571
         16  |  -.0195889   .0270662    -0.72   0.469    -.0726412    .0334633
         17  |  -.0062808   .0284678    -0.22   0.825    -.0620804    .0495187
         18  |  -.0042826   .0300291    -0.14   0.887    -.0631425    .0545773
         19  |  -.0013887   .0314846    -0.04   0.965    -.0631014    .0603241
         20  |   .0064413   .0328414     0.20   0.845     -.057931    .0708135
         21  |   .0106262    .034152     0.31   0.756    -.0563149    .0775673
         22  |     .01379   .0354222     0.39   0.697    -.0556407    .0832207
         23  |   .0127417   .0366943     0.35   0.728    -.0591824    .0846659
         24  |  -.1038491   .0379732    -2.73   0.006      -.17828   -.0294182
         25  |  -.1363198   .0394816    -3.45   0.001    -.2137074   -.0589322
         26  |   .0228749   .0225602     1.01   0.311    -.0213451    .0670949
         27  |   .0183582   .0200758     0.91   0.360    -.0209922    .0577085
         28  |   .0291076   .0195594     1.49   0.137    -.0092305    .0674458
         29  |    .036635   .0192305     1.91   0.057    -.0010586    .0743286
         30  |   .0450436   .0193535     2.33   0.020      .007109    .0829781
         31  |   .0377118   .0194526     1.94   0.053    -.0004171    .0758407
         32  |   .0356198   .0199913     1.78   0.075    -.0035649    .0748045
         33  |   .0317812   .0206625     1.54   0.124    -.0087192    .0722816
         34  |   .0327622   .0213714     1.53   0.125    -.0091277     .074652
         35  |   .0358572   .0223367     1.61   0.108    -.0079249    .0796392
         36  |   .0337007   .0234599     1.44   0.151    -.0122827    .0796842
         37  |    .031979   .0245079     1.30   0.192    -.0160587    .0800168
         38  |   .0312063   .0255105     1.22   0.221    -.0187967    .0812093
         39  |   .0317445   .0266886     1.19   0.234    -.0205675    .0840566
         40  |   .0320702   .0277762     1.15   0.248    -.0223737    .0865141
         41  |   .0532598    .028992     1.84   0.066    -.0035671    .1100867
         42  |   .0604352    .030267     2.00   0.046     .0011091    .1197613
         43  |    .059481   .0317481     1.87   0.061    -.0027481    .1217101
         44  |   .0750556   .0331771     2.26   0.024     .0100255    .1400857
         45  |   .0790386   .0344471     2.29   0.022     .0115191    .1465581
         46  |   .0817612   .0358758     2.28   0.023     .0114413    .1520811
         47  |   .0905719   .0371563     2.44   0.015      .017742    .1634017
         48  |   .0801689   .0381076     2.10   0.035     .0054744    .1548634
         49  |  -.1879394   .0395934    -4.75   0.000    -.2655462   -.1103327
         50  |  -.2433802   .0410342    -5.93   0.000     -.323811   -.1629494
             |
     age_cat |
          1  |   .0445987   .0067916     6.57   0.000     .0312866    .0579108
          2  |   .0668214   .0076825     8.70   0.000      .051763    .0818798
          3  |   .0830005   .0086376     9.61   0.000       .06607     .099931
          4  |   .1038877   .0098043    10.60   0.000     .0846703    .1231051
          5  |   .1190965   .0110264    10.80   0.000     .0974839    .1407092
          6  |   .1301522   .0124044    10.49   0.000     .1058383     .154466
          7  |   .1370681   .0137921     9.94   0.000     .1100342    .1641019
          8  |   .1504791   .0152622     9.86   0.000     .1205638    .1803944
          9  |   .1521365   .0167289     9.09   0.000     .1193462    .1849267
         10  |   .1538599    .018194     8.46   0.000     .1181981    .1895218
         11  |   .1615564   .0196573     8.22   0.000     .1230263    .2000865
         12  |   .1603673    .021147     7.58   0.000     .1189173    .2018173
         13  |   .1711255   .0227294     7.53   0.000     .1265739    .2156772
         14  |   .1817947   .0243562     7.46   0.000     .1340544    .2295351
         15  |   .1892375   .0258719     7.31   0.000     .1385262    .2399489
         16  |   .1961233   .0274397     7.15   0.000     .1423391    .2499076
         17  |   .1949827   .0289524     6.73   0.000     .1382332    .2517321
         18  |   .2021306   .0306848     6.59   0.000     .1419855    .2622757
         19  |   .1909467   .0325026     5.87   0.000     .1272387    .2546547
         20  |   .1999322   .0352131     5.68   0.000     .1309114    .2689531
         25  |   .2210753   .0408576     5.41   0.000     .1409907      .30116
         30  |   .2004415   .0605167     3.31   0.001     .0818232    .3190597
         40  |   .1876713   .0682878     2.75   0.006     .0538208    .3215217
         50  |    .114174   .0735771     1.55   0.121     -.030044    .2583919
             |
       _cons |   .2602642   .0143014    18.20   0.000     .2322321    .2882963
-------------+----------------------------------------------------------------
     sigma_u |  .39314233
     sigma_e |  .28494111
         rho |  .65560707   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text replace

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b', "`fmt'")) _newline
  6.         file write `output' ("   standard_error: " + string(`se', "`fmt'")) _newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se', "`fmt'")) _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',"pvalue"),colnumb(`coefs',"`X'")]), "`fmt'") _
> newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file
(sum of wgt is 96,323.3384407535)

Linear regression                               Number of obs     =    229,907
                                                F(75, 14528)      =      53.25
                                                Prob > F          =     0.0000
                                                R-squared         =     0.1139
                                                Root MSE          =      .4399

                                (Std. Err. adjusted for 14,529 clusters in id)
------------------------------------------------------------------------------
             |               Robust
    exporter |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |    .241646    .013854    17.44   0.000     .2144904    .2688016
       expat |   .0599137   .0197114     3.04   0.002     .0212769    .0985505
             |
    ind_year |
          2  |  -.0314178   .0111686    -2.81   0.005    -.0533097   -.0095258
          3  |   -.054332   .0128638    -4.22   0.000    -.0795467   -.0291173
          4  |  -.0614938   .0131357    -4.68   0.000    -.0872414   -.0357462
          5  |  -.0504143   .0136363    -3.70   0.000    -.0771432   -.0236854
          6  |   -.059979   .0137579    -4.36   0.000    -.0869461   -.0330118
          7  |  -.0669476   .0138401    -4.84   0.000    -.0940759   -.0398193
          8  |  -.0799541   .0139233    -5.74   0.000    -.1072456   -.0526626
          9  |  -.0887716   .0139849    -6.35   0.000    -.1161839   -.0613594
         10  |  -.0876087   .0140981    -6.21   0.000    -.1152429   -.0599746
         11  |  -.1029662   .0139726    -7.37   0.000    -.1303543   -.0755781
         12  |  -.1082692   .0139828    -7.74   0.000    -.1356772   -.0808611
         13  |  -.1083096   .0140159    -7.73   0.000    -.1357826   -.0808366
         14  |  -.1011823   .0141533    -7.15   0.000    -.1289245     -.07344
         15  |  -.0930571   .0142593    -6.53   0.000    -.1210072    -.065107
         16  |  -.0845106   .0143878    -5.87   0.000    -.1127126   -.0563087
         17  |  -.0722405   .0145399    -4.97   0.000    -.1007406   -.0437405
         18  |  -.0715391   .0146448    -4.88   0.000    -.1002449   -.0428334
         19  |  -.0637528   .0148144    -4.30   0.000    -.0927908   -.0347148
         20  |  -.0526932   .0149612    -3.52   0.000     -.082019   -.0233674
         21  |  -.0484969   .0151371    -3.20   0.001    -.0781676   -.0188263
         22  |  -.0488993   .0153967    -3.18   0.001    -.0790788   -.0187198
         23  |  -.0494272   .0155367    -3.18   0.001    -.0798812   -.0189732
         24  |  -.1540525   .0152291   -10.12   0.000    -.1839036   -.1242015
         25  |  -.1836447   .0155244   -11.83   0.000    -.2140744   -.1532149
         26  |    .192863   .0231298     8.34   0.000     .1475257    .2382004
         27  |    .159963   .0198332     8.07   0.000     .1210874    .1988385
         28  |   .1679928   .0190251     8.83   0.000     .1307012    .2052845
         29  |   .1600612    .018759     8.53   0.000     .1232912    .1968312
         30  |   .1920852   .0185764    10.34   0.000      .155673    .2284973
         31  |    .188966   .0182514    10.35   0.000     .1531909     .224741
         32  |   .1863339   .0178776    10.42   0.000     .1512917    .2213762
         33  |   .1660399   .0175934     9.44   0.000     .1315546    .2005252
         34  |   .1756986   .0174721    10.06   0.000      .141451    .2099463
         35  |   .1809079   .0174027    10.40   0.000     .1467965    .2150193
         36  |   .1861135   .0173238    10.74   0.000     .1521568    .2200703
         37  |   .1702537   .0173034     9.84   0.000      .136337    .2041705
         38  |   .1647215   .0171399     9.61   0.000     .1311252    .1983179
         39  |   .1646914    .017207     9.57   0.000     .1309635    .1984193
         40  |   .1694968   .0172437     9.83   0.000     .1356969    .2032967
         41  |   .1889135   .0174911    10.80   0.000     .1546288    .2231982
         42  |   .1951369   .0175886    11.09   0.000      .160661    .2296127
         43  |   .1957357   .0179153    10.93   0.000     .1606194    .2308521
         44  |   .2158636   .0181295    11.91   0.000     .1803275    .2513996
         45  |   .2170628   .0183203    11.85   0.000     .1811527    .2529729
         46  |   .2252959   .0185108    12.17   0.000     .1890124    .2615794
         47  |   .2425945   .0188234    12.89   0.000     .2056982    .2794908
         48  |   .2348344   .0188435    12.46   0.000     .1978988    .2717701
         49  |  -.0419206   .0186391    -2.25   0.025    -.0784557   -.0053856
         50  |  -.0836348   .0188485    -4.44   0.000    -.1205803   -.0466894
             |
     age_cat |
          1  |   .0515079   .0074878     6.88   0.000     .0368309     .066185
          2  |   .0755845   .0078435     9.64   0.000     .0602102    .0909588
          3  |   .0929995    .008128    11.44   0.000     .0770675    .1089314
          4  |   .1166499   .0084003    13.89   0.000     .1001843    .1331155
          5  |   .1355904    .008661    15.66   0.000     .1186138     .152567
          6  |   .1489695   .0089987    16.55   0.000     .1313309    .1666081
          7  |   .1594502   .0092626    17.21   0.000     .1412943    .1776061
          8  |   .1773053    .009612    18.45   0.000     .1584645    .1961461
          9  |   .1811049    .009865    18.36   0.000     .1617682    .2004416
         10  |   .1846352   .0100801    18.32   0.000     .1648771    .2043934
         11  |   .1930445   .0103247    18.70   0.000     .1728067    .2132823
         12  |   .1993978   .0105694    18.87   0.000     .1786804    .2201152
         13  |   .2117606    .010948    19.34   0.000     .1903012    .2332201
         14  |   .2206443   .0114231    19.32   0.000     .1982535    .2430351
         15  |   .2326443   .0117971    19.72   0.000     .2095205    .2557681
         16  |   .2367484    .012262    19.31   0.000     .2127133    .2607835
         17  |   .2414842   .0127205    18.98   0.000     .2165505     .266418
         18  |    .249112   .0133023    18.73   0.000     .2230377    .2751862
         19  |   .2363185   .0137559    17.18   0.000     .2093552    .2632817
         20  |   .2464976   .0142885    17.25   0.000     .2184903    .2745049
         25  |   .2565079   .0192093    13.35   0.000     .2188551    .2941606
         30  |   .0735175   .0211614     3.47   0.001     .0320385    .1149965
         40  |   .1042299   .0208432     5.00   0.000     .0633746    .1450852
         50  |   .1009861   .0236197     4.28   0.000     .0546885    .1472837
             |
       _cons |   .1474941   .0137954    10.69   0.000     .1204533    .1745349
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. local fmt "%10.5f"

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }

. 
. estimates

--------------------------------------------------------------------------------------------------------------------------------
active results
--------------------------------------------------------------------------------------------------------------------------------

Linear regression                               Number of obs     =    229,907
                                                F(75, 14528)      =      53.25
                                                Prob > F          =     0.0000
                                                R-squared         =     0.1139
                                                Root MSE          =      .4399

                                (Std. Err. adjusted for 14,529 clusters in id)
------------------------------------------------------------------------------
             |               Robust
    exporter |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |    .241646    .013854    17.44   0.000     .2144904    .2688016
       expat |   .0599137   .0197114     3.04   0.002     .0212769    .0985505
             |
    ind_year |
          2  |  -.0314178   .0111686    -2.81   0.005    -.0533097   -.0095258
          3  |   -.054332   .0128638    -4.22   0.000    -.0795467   -.0291173
          4  |  -.0614938   .0131357    -4.68   0.000    -.0872414   -.0357462
          5  |  -.0504143   .0136363    -3.70   0.000    -.0771432   -.0236854
          6  |   -.059979   .0137579    -4.36   0.000    -.0869461   -.0330118
          7  |  -.0669476   .0138401    -4.84   0.000    -.0940759   -.0398193
          8  |  -.0799541   .0139233    -5.74   0.000    -.1072456   -.0526626
          9  |  -.0887716   .0139849    -6.35   0.000    -.1161839   -.0613594
         10  |  -.0876087   .0140981    -6.21   0.000    -.1152429   -.0599746
         11  |  -.1029662   .0139726    -7.37   0.000    -.1303543   -.0755781
         12  |  -.1082692   .0139828    -7.74   0.000    -.1356772   -.0808611
         13  |  -.1083096   .0140159    -7.73   0.000    -.1357826   -.0808366
         14  |  -.1011823   .0141533    -7.15   0.000    -.1289245     -.07344
         15  |  -.0930571   .0142593    -6.53   0.000    -.1210072    -.065107
         16  |  -.0845106   .0143878    -5.87   0.000    -.1127126   -.0563087
         17  |  -.0722405   .0145399    -4.97   0.000    -.1007406   -.0437405
         18  |  -.0715391   .0146448    -4.88   0.000    -.1002449   -.0428334
         19  |  -.0637528   .0148144    -4.30   0.000    -.0927908   -.0347148
         20  |  -.0526932   .0149612    -3.52   0.000     -.082019   -.0233674
         21  |  -.0484969   .0151371    -3.20   0.001    -.0781676   -.0188263
         22  |  -.0488993   .0153967    -3.18   0.001    -.0790788   -.0187198
         23  |  -.0494272   .0155367    -3.18   0.001    -.0798812   -.0189732
         24  |  -.1540525   .0152291   -10.12   0.000    -.1839036   -.1242015
         25  |  -.1836447   .0155244   -11.83   0.000    -.2140744   -.1532149
         26  |    .192863   .0231298     8.34   0.000     .1475257    .2382004
         27  |    .159963   .0198332     8.07   0.000     .1210874    .1988385
         28  |   .1679928   .0190251     8.83   0.000     .1307012    .2052845
         29  |   .1600612    .018759     8.53   0.000     .1232912    .1968312
         30  |   .1920852   .0185764    10.34   0.000      .155673    .2284973
         31  |    .188966   .0182514    10.35   0.000     .1531909     .224741
         32  |   .1863339   .0178776    10.42   0.000     .1512917    .2213762
         33  |   .1660399   .0175934     9.44   0.000     .1315546    .2005252
         34  |   .1756986   .0174721    10.06   0.000      .141451    .2099463
         35  |   .1809079   .0174027    10.40   0.000     .1467965    .2150193
         36  |   .1861135   .0173238    10.74   0.000     .1521568    .2200703
         37  |   .1702537   .0173034     9.84   0.000      .136337    .2041705
         38  |   .1647215   .0171399     9.61   0.000     .1311252    .1983179
         39  |   .1646914    .017207     9.57   0.000     .1309635    .1984193
         40  |   .1694968   .0172437     9.83   0.000     .1356969    .2032967
         41  |   .1889135   .0174911    10.80   0.000     .1546288    .2231982
         42  |   .1951369   .0175886    11.09   0.000      .160661    .2296127
         43  |   .1957357   .0179153    10.93   0.000     .1606194    .2308521
         44  |   .2158636   .0181295    11.91   0.000     .1803275    .2513996
         45  |   .2170628   .0183203    11.85   0.000     .1811527    .2529729
         46  |   .2252959   .0185108    12.17   0.000     .1890124    .2615794
         47  |   .2425945   .0188234    12.89   0.000     .2056982    .2794908
         48  |   .2348344   .0188435    12.46   0.000     .1978988    .2717701
         49  |  -.0419206   .0186391    -2.25   0.025    -.0784557   -.0053856
         50  |  -.0836348   .0188485    -4.44   0.000    -.1205803   -.0466894
             |
     age_cat |
          1  |   .0515079   .0074878     6.88   0.000     .0368309     .066185
          2  |   .0755845   .0078435     9.64   0.000     .0602102    .0909588
          3  |   .0929995    .008128    11.44   0.000     .0770675    .1089314
          4  |   .1166499   .0084003    13.89   0.000     .1001843    .1331155
          5  |   .1355904    .008661    15.66   0.000     .1186138     .152567
          6  |   .1489695   .0089987    16.55   0.000     .1313309    .1666081
          7  |   .1594502   .0092626    17.21   0.000     .1412943    .1776061
          8  |   .1773053    .009612    18.45   0.000     .1584645    .1961461
          9  |   .1811049    .009865    18.36   0.000     .1617682    .2004416
         10  |   .1846352   .0100801    18.32   0.000     .1648771    .2043934
         11  |   .1930445   .0103247    18.70   0.000     .1728067    .2132823
         12  |   .1993978   .0105694    18.87   0.000     .1786804    .2201152
         13  |   .2117606    .010948    19.34   0.000     .1903012    .2332201
         14  |   .2206443   .0114231    19.32   0.000     .1982535    .2430351
         15  |   .2326443   .0117971    19.72   0.000     .2095205    .2557681
         16  |   .2367484    .012262    19.31   0.000     .2127133    .2607835
         17  |   .2414842   .0127205    18.98   0.000     .2165505     .266418
         18  |    .249112   .0133023    18.73   0.000     .2230377    .2751862
         19  |   .2363185   .0137559    17.18   0.000     .2093552    .2632817
         20  |   .2464976   .0142885    17.25   0.000     .2184903    .2745049
         25  |   .2565079   .0192093    13.35   0.000     .2188551    .2941606
         30  |   .0735175   .0211614     3.47   0.001     .0320385    .1149965
         40  |   .1042299   .0208432     5.00   0.000     .0633746    .1450852
         50  |   .1009861   .0236197     4.28   0.000     .0546885    .1472837
             |
       _cons |   .1474941   .0137954    10.69   0.000     .1204533    .1745349
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text replace

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b', "`fmt'")) _newline
  6.         file write `output' ("   standard_error: " + string(`se', "`fmt'")) _newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se', "`fmt'")) _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',"pvalue"),colnumb(`coefs',"`X'")]), "`fmt'") _
> newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file

Fixed-effects (within) regression               Number of obs     =    229,907
Group variable: id                              Number of groups  =     14,529

R-sq:                                           Obs per group:
     within  = 0.0524                                         min =          1
     between = 0.0729                                         avg =       15.8
     overall = 0.0612                                         max =        140

                                                F(75,14528)       =      26.87
corr(u_i, Xb)  = 0.1035                         Prob > F          =     0.0000

                                (Std. Err. adjusted for 14,529 clusters in id)
------------------------------------------------------------------------------
             |               Robust
    exporter |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0179814   .0137893     1.30   0.192    -.0090474    .0450101
       expat |   .0346767   .0093965     3.69   0.000     .0162584    .0530951
             |
    ind_year |
          2  |  -.0171675   .0105284    -1.63   0.103    -.0378045    .0034695
          3  |  -.0344893   .0128728    -2.68   0.007    -.0597216   -.0092571
          4  |  -.0424306   .0134029    -3.17   0.002     -.068702   -.0161591
          5  |  -.0333243   .0147896    -2.25   0.024    -.0623138   -.0043348
          6  |  -.0425596   .0157175    -2.71   0.007    -.0733679   -.0117513
          7  |  -.0482559   .0168533    -2.86   0.004    -.0812905   -.0152213
          8  |  -.0596053    .017882    -3.33   0.001    -.0946563   -.0245543
          9  |  -.0621511   .0192558    -3.23   0.001     -.099895   -.0244073
         10  |    -.06022   .0204953    -2.94   0.003    -.1003934   -.0200467
         11  |  -.0667439   .0218097    -3.06   0.002    -.1094937   -.0239942
         12  |  -.0687362   .0230303    -2.98   0.003    -.1138786   -.0235939
         13  |  -.0644347   .0244754    -2.63   0.008    -.1124095   -.0164599
         14  |  -.0549787   .0259158    -2.12   0.034    -.1057769   -.0041805
         15  |  -.0430328   .0273724    -1.57   0.116    -.0966861    .0106205
         16  |  -.0329674   .0287894    -1.15   0.252    -.0893983    .0234636
         17  |  -.0192402   .0302722    -0.64   0.525    -.0785775    .0400971
         18  |  -.0189902   .0319364    -0.59   0.552    -.0815896    .0436091
         19  |  -.0129248   .0334553    -0.39   0.699    -.0785014    .0526518
         20  |  -.0064297   .0348821    -0.18   0.854    -.0748031    .0619438
         21  |  -.0064884   .0362421    -0.18   0.858    -.0775274    .0645507
         22  |  -.0048746   .0375812    -0.13   0.897    -.0785386    .0687894
         23  |  -.0080302   .0389352    -0.21   0.837    -.0843482    .0682877
         24  |  -.1210757   .0402482    -3.01   0.003    -.1999673    -.042184
         25  |  -.1563054   .0418629    -3.73   0.000     -.238362   -.0742487
         26  |  -.0139555   .0260662    -0.54   0.592    -.0650487    .0371376
         27  |  -.0098649   .0229839    -0.43   0.668    -.0549163    .0351864
         28  |   .0115525   .0223381     0.52   0.605     -.032233     .055338
         29  |   .0085981   .0219665     0.39   0.695    -.0344589    .0516552
         30  |   .0284085   .0219884     1.29   0.196    -.0146916    .0715086
         31  |   .0217209   .0219684     0.99   0.323    -.0213399    .0647817
         32  |   .0229457   .0224473     1.02   0.307    -.0210539    .0669453
         33  |   .0139126     .02305     0.60   0.546    -.0312683    .0590936
         34  |   .0190332   .0236931     0.80   0.422    -.0274083    .0654747
         35  |    .024108   .0245568     0.98   0.326    -.0240264    .0722424
         36  |   .0266605   .0257452     1.04   0.300    -.0238034    .0771243
         37  |   .0153889   .0268916     0.57   0.567    -.0373221    .0680998
         38  |   .0131946   .0278286     0.47   0.635     -.041353    .0677422
         39  |    .018085   .0291101     0.62   0.534    -.0389745    .0751445
         40  |   .0278305    .030145     0.92   0.356    -.0312575    .0869185
         41  |    .048171   .0314294     1.53   0.125    -.0134346    .1097766
         42  |   .0557908   .0326663     1.71   0.088    -.0082394     .119821
         43  |    .056554   .0342194     1.65   0.098    -.0105205    .1236284
         44  |   .0757821   .0357208     2.12   0.034     .0057648    .1457994
         45  |   .0811597   .0370207     2.19   0.028     .0085944     .153725
         46  |   .0840474   .0385591     2.18   0.029     .0084666    .1596282
         47  |   .0984254   .0398462     2.47   0.014     .0203218    .1765291
         48  |    .087342   .0407308     2.14   0.032     .0075044    .1671796
         49  |   -.206943   .0423258    -4.89   0.000    -.2899071    -.123979
         50  |   -.261799   .0438901    -5.96   0.000    -.3478292   -.1757688
             |
     age_cat |
          1  |   .0434855   .0072887     5.97   0.000     .0291986    .0577723
          2  |   .0634244   .0082392     7.70   0.000     .0472746    .0795742
          3  |   .0808972   .0092892     8.71   0.000     .0626891    .0991053
          4  |   .1026464   .0105336     9.74   0.000     .0819992    .1232937
          5  |   .1221633   .0118259    10.33   0.000     .0989831    .1453436
          6  |   .1348357   .0133026    10.14   0.000     .1087609    .1609104
          7  |    .143038   .0147542     9.69   0.000     .1141178    .1719582
          8  |   .1589194   .0163222     9.74   0.000     .1269257    .1909131
          9  |   .1598106   .0178394     8.96   0.000     .1248431    .1947782
         10  |   .1621913   .0194048     8.36   0.000     .1241555    .2002272
         11  |    .171016   .0209589     8.16   0.000     .1299339    .2120982
         12  |   .1731574   .0225245     7.69   0.000     .1290065    .2173084
         13  |   .1847189   .0242031     7.63   0.000     .1372778      .23216
         14  |    .195659   .0259278     7.55   0.000     .1448373    .2464808
         15  |   .2042743   .0275472     7.42   0.000     .1502782    .2582704
         16  |   .2080927   .0292013     7.13   0.000     .1508545    .2653309
         17  |   .2120713   .0307573     6.89   0.000     .1517831    .2723596
         18  |   .2193838   .0326045     6.73   0.000     .1554748    .2832928
         19  |   .2078756   .0345289     6.02   0.000     .1401945    .2755567
         20  |   .2196803   .0373749     5.88   0.000     .1464208    .2929398
         25  |   .2421116   .0433619     5.58   0.000     .1571168    .3271063
         30  |   .2330028    .063901     3.65   0.000     .1077487    .3582569
         40  |   .2209807    .072129     3.06   0.002     .0795987    .3623628
         50  |   .1493951   .0772793     1.93   0.053    -.0020822    .3008724
             |
       _cons |   .1986027   .0149884    13.25   0.000     .1692235    .2279818
-------------+----------------------------------------------------------------
     sigma_u |  .36697268
     sigma_e |   .2860321
         rho |  .62207544   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. local fmt "%10.5f"

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }
key: R2_within
value: .0523963309631238

. 
. estimates

--------------------------------------------------------------------------------------------------------------------------------
active results
--------------------------------------------------------------------------------------------------------------------------------

Fixed-effects (within) regression               Number of obs     =    229,907
Group variable: id                              Number of groups  =     14,529

R-sq:                                           Obs per group:
     within  = 0.0524                                         min =          1
     between = 0.0729                                         avg =       15.8
     overall = 0.0612                                         max =        140

                                                F(75,14528)       =      26.87
corr(u_i, Xb)  = 0.1035                         Prob > F          =     0.0000

                                (Std. Err. adjusted for 14,529 clusters in id)
------------------------------------------------------------------------------
             |               Robust
    exporter |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0179814   .0137893     1.30   0.192    -.0090474    .0450101
       expat |   .0346767   .0093965     3.69   0.000     .0162584    .0530951
             |
    ind_year |
          2  |  -.0171675   .0105284    -1.63   0.103    -.0378045    .0034695
          3  |  -.0344893   .0128728    -2.68   0.007    -.0597216   -.0092571
          4  |  -.0424306   .0134029    -3.17   0.002     -.068702   -.0161591
          5  |  -.0333243   .0147896    -2.25   0.024    -.0623138   -.0043348
          6  |  -.0425596   .0157175    -2.71   0.007    -.0733679   -.0117513
          7  |  -.0482559   .0168533    -2.86   0.004    -.0812905   -.0152213
          8  |  -.0596053    .017882    -3.33   0.001    -.0946563   -.0245543
          9  |  -.0621511   .0192558    -3.23   0.001     -.099895   -.0244073
         10  |    -.06022   .0204953    -2.94   0.003    -.1003934   -.0200467
         11  |  -.0667439   .0218097    -3.06   0.002    -.1094937   -.0239942
         12  |  -.0687362   .0230303    -2.98   0.003    -.1138786   -.0235939
         13  |  -.0644347   .0244754    -2.63   0.008    -.1124095   -.0164599
         14  |  -.0549787   .0259158    -2.12   0.034    -.1057769   -.0041805
         15  |  -.0430328   .0273724    -1.57   0.116    -.0966861    .0106205
         16  |  -.0329674   .0287894    -1.15   0.252    -.0893983    .0234636
         17  |  -.0192402   .0302722    -0.64   0.525    -.0785775    .0400971
         18  |  -.0189902   .0319364    -0.59   0.552    -.0815896    .0436091
         19  |  -.0129248   .0334553    -0.39   0.699    -.0785014    .0526518
         20  |  -.0064297   .0348821    -0.18   0.854    -.0748031    .0619438
         21  |  -.0064884   .0362421    -0.18   0.858    -.0775274    .0645507
         22  |  -.0048746   .0375812    -0.13   0.897    -.0785386    .0687894
         23  |  -.0080302   .0389352    -0.21   0.837    -.0843482    .0682877
         24  |  -.1210757   .0402482    -3.01   0.003    -.1999673    -.042184
         25  |  -.1563054   .0418629    -3.73   0.000     -.238362   -.0742487
         26  |  -.0139555   .0260662    -0.54   0.592    -.0650487    .0371376
         27  |  -.0098649   .0229839    -0.43   0.668    -.0549163    .0351864
         28  |   .0115525   .0223381     0.52   0.605     -.032233     .055338
         29  |   .0085981   .0219665     0.39   0.695    -.0344589    .0516552
         30  |   .0284085   .0219884     1.29   0.196    -.0146916    .0715086
         31  |   .0217209   .0219684     0.99   0.323    -.0213399    .0647817
         32  |   .0229457   .0224473     1.02   0.307    -.0210539    .0669453
         33  |   .0139126     .02305     0.60   0.546    -.0312683    .0590936
         34  |   .0190332   .0236931     0.80   0.422    -.0274083    .0654747
         35  |    .024108   .0245568     0.98   0.326    -.0240264    .0722424
         36  |   .0266605   .0257452     1.04   0.300    -.0238034    .0771243
         37  |   .0153889   .0268916     0.57   0.567    -.0373221    .0680998
         38  |   .0131946   .0278286     0.47   0.635     -.041353    .0677422
         39  |    .018085   .0291101     0.62   0.534    -.0389745    .0751445
         40  |   .0278305    .030145     0.92   0.356    -.0312575    .0869185
         41  |    .048171   .0314294     1.53   0.125    -.0134346    .1097766
         42  |   .0557908   .0326663     1.71   0.088    -.0082394     .119821
         43  |    .056554   .0342194     1.65   0.098    -.0105205    .1236284
         44  |   .0757821   .0357208     2.12   0.034     .0057648    .1457994
         45  |   .0811597   .0370207     2.19   0.028     .0085944     .153725
         46  |   .0840474   .0385591     2.18   0.029     .0084666    .1596282
         47  |   .0984254   .0398462     2.47   0.014     .0203218    .1765291
         48  |    .087342   .0407308     2.14   0.032     .0075044    .1671796
         49  |   -.206943   .0423258    -4.89   0.000    -.2899071    -.123979
         50  |   -.261799   .0438901    -5.96   0.000    -.3478292   -.1757688
             |
     age_cat |
          1  |   .0434855   .0072887     5.97   0.000     .0291986    .0577723
          2  |   .0634244   .0082392     7.70   0.000     .0472746    .0795742
          3  |   .0808972   .0092892     8.71   0.000     .0626891    .0991053
          4  |   .1026464   .0105336     9.74   0.000     .0819992    .1232937
          5  |   .1221633   .0118259    10.33   0.000     .0989831    .1453436
          6  |   .1348357   .0133026    10.14   0.000     .1087609    .1609104
          7  |    .143038   .0147542     9.69   0.000     .1141178    .1719582
          8  |   .1589194   .0163222     9.74   0.000     .1269257    .1909131
          9  |   .1598106   .0178394     8.96   0.000     .1248431    .1947782
         10  |   .1621913   .0194048     8.36   0.000     .1241555    .2002272
         11  |    .171016   .0209589     8.16   0.000     .1299339    .2120982
         12  |   .1731574   .0225245     7.69   0.000     .1290065    .2173084
         13  |   .1847189   .0242031     7.63   0.000     .1372778      .23216
         14  |    .195659   .0259278     7.55   0.000     .1448373    .2464808
         15  |   .2042743   .0275472     7.42   0.000     .1502782    .2582704
         16  |   .2080927   .0292013     7.13   0.000     .1508545    .2653309
         17  |   .2120713   .0307573     6.89   0.000     .1517831    .2723596
         18  |   .2193838   .0326045     6.73   0.000     .1554748    .2832928
         19  |   .2078756   .0345289     6.02   0.000     .1401945    .2755567
         20  |   .2196803   .0373749     5.88   0.000     .1464208    .2929398
         25  |   .2421116   .0433619     5.58   0.000     .1571168    .3271063
         30  |   .2330028    .063901     3.65   0.000     .1077487    .3582569
         40  |   .2209807    .072129     3.06   0.002     .0795987    .3623628
         50  |   .1493951   .0772793     1.93   0.053    -.0020822    .3008724
             |
       _cons |   .1986027   .0149884    13.25   0.000     .1692235    .2279818
-------------+----------------------------------------------------------------
     sigma_u |  .36697268
     sigma_e |   .2860321
         rho |  .62207544   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text replace

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b', "`fmt'")) _newline
  6.         file write `output' ("   standard_error: " + string(`se', "`fmt'")) _newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se', "`fmt'")) _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',"pvalue"),colnumb(`coefs',"`X'")]), "`fmt'") _
> newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file

. 
end of do-file

. 
. log close
      name:  <unnamed>
       log:  /Users/koren/Google Drive/Research/expat/research_design/talk/output/estimate_descriptive.log
  log type:  text
 closed on:   4 Dec 2018, 17:15:03
--------------------------------------------------------------------------------------------------------------------------------
