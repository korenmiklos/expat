----------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/koren/Google Drive/Research/expat/research_design/talk/output/
> estimate_descriptive.log
  log type:  text
 opened on:  12 Jan 2019, 12:36:15

. 
. 
. use temp/analysis_sample

. 
. *Dinamika
. scalar Tbefore = 4

. scalar Tduring = 6

. scalar Tafter = 4

. 
. gen byte analysis_window = (tenure>=-Tbefore-1)&(year-first_exit_year<=Tafter)

. 
. global sample_baseline (analysis_window==1)

. global sample_manufacturing $sample_baseline & (manufacturing==1)

. global sample_acquisitions $sample_baseline & (greenfield==0)

. global sample_1990s $sample_acquisitions & (enter_year>=1994 & enter_year<=1999)

. global sample_2000s $sample_acquisitions & (enter_year>=2000)

. global sample_ever_foreign $sample_acquisitions & (ever_foreign==1)

. 
. global samples baseline acquisitions

. 
. global outcomes lnL lnKL lnQL exporter

. global controls foreign i.ind_year i.age_cat

. 
. label var lnL "Employment (log)"

. label var lnKL "Capital per worker (log)"

. label var lnQL "Revenue per worker (log)"

. label var exporter "Firm is an exporter (dummy)"

. 
. egen person_tag = tag(frame_id manager_id)

. egen N = sum(person_tag), by(frame_id)

. gen inverse_weight = 1/N

. 
. * verify founders are not in analysis sample
. foreach X of var during* after* {
  2.         replace `X'=0 if founder==1
  3. }
(0 real changes made)
(156,736 real changes made)
(65,411 real changes made)
(81,861 real changes made)
(90,563 real changes made)
(55,334 real changes made)
(105,536 real changes made)
(120,373 real changes made)
(113,200 real changes made)
(17,142 real changes made)
(8,638 real changes made)
(11,993 real changes made)
(11,964 real changes made)
(13,320 real changes made)
(10,192 real changes made)
(11,047 real changes made)
(14,421 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(113,142 real changes made)
(60,285 real changes made)
(57,025 real changes made)
(57,563 real changes made)
(52,066 real changes made)
(74,086 real changes made)
(95,636 real changes made)
(49,280 real changes made)
(20,382 real changes made)
(11,540 real changes made)
(15,163 real changes made)
(13,699 real changes made)
(15,828 real changes made)
(12,017 real changes made)
(15,255 real changes made)
(9,788 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)

. 
. xtset firm_person year
       panel variable:  firm_person (unbalanced)
        time variable:  year, 1992 to 2016, but with gaps
                delta:  1 unit

. 
. do est_`1'

. local i = 1

. foreach X of var $outcomes {
  2.         foreach sample in $samples {
  3.                 * simple, descriptive regressions first, including founders, 
> but not before/after years
.                 reg `X' foreign expat i.ind_year i.age_cat if ${sample_`sample'}
>  & year>=enter_year & year<=first_exit_year [aw=inverse_weight], vce(cluster id)
  4.                 do regram output/regression/`sample'_OLS `i' `X'
  5. 
.                 xtreg `X' foreign expat i.ind_year i.age_cat if ${sample_`sample
> '} & year>=enter_year & year<=first_exit_year [aw=inverse_weight], i(id) fe vce(
> cluster id)
  6.                 local r2_w = `e(r2_w)'
  7.                 do regram output/regression/`sample'_FE `i' `X' R2_within "`r
> 2_w'"
  8.         }
  9.         local i = `i' + 1
 10. }
(sum of wgt is   1.3350e+05)

Linear regression                               Number of obs     =    368,493
                                                F(75, 22579)      =      44.31
                                                Prob > F          =     0.0000
                                                R-squared         =     0.0692
                                                Root MSE          =     1.0157

                                (Std. Err. adjusted for 22,580 clusters in id)
------------------------------------------------------------------------------
             |               Robust
         lnL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .4014351   .0205645    19.52   0.000     .3611273    .4417429
       expat |   .0164249   .0253936     0.65   0.518    -.0333483    .0661982
             |
    ind_year |
          2  |  -.1637905   .0217094    -7.54   0.000    -.2063425   -.1212385
          3  |  -.2734364   .0254309   -10.75   0.000    -.3232828     -.22359
          4  |   -.386475   .0273185   -14.15   0.000    -.4400212   -.3329288
          5  |  -.4495798    .028022   -16.04   0.000    -.5045048   -.3946548
          6  |  -.5220744   .0285272   -18.30   0.000    -.5779898   -.4661591
          7  |   -.537977   .0290514   -18.52   0.000    -.5949197   -.4810343
          8  |  -.5153425   .0292726   -17.60   0.000    -.5727187   -.4579662
          9  |  -.5014934   .0293504   -17.09   0.000    -.5590221   -.4439646
         10  |  -.5004757   .0294539   -16.99   0.000    -.5582074    -.442744
         11  |  -.5070983   .0297194   -17.06   0.000    -.5653503   -.4488462
         12  |    -.50246   .0296367   -16.95   0.000    -.5605499   -.4443701
         13  |   -.456834   .0294826   -15.50   0.000    -.5146219   -.3990461
         14  |  -.4455668   .0294614   -15.12   0.000    -.5033132   -.3878203
         15  |   -.419142   .0293807   -14.27   0.000    -.4767301   -.3615539
         16  |  -.4082758   .0293405   -13.92   0.000    -.4657851   -.3507665
         17  |  -.3861846   .0296024   -13.05   0.000    -.4442074   -.3281619
         18  |  -.4220623   .0295972   -14.26   0.000    -.4800749   -.3640497
         19  |  -.4183438   .0298105   -14.03   0.000    -.4767743   -.3599132
         20  |  -.4051258   .0299223   -13.54   0.000    -.4637755   -.3464761
         21  |  -.4079681    .030156   -13.53   0.000    -.4670759   -.3488603
         22  |  -.4024524   .0302733   -13.29   0.000    -.4617902   -.3431146
         23  |  -.3827705   .0304072   -12.59   0.000    -.4423707   -.3231703
         24  |  -.3254299    .031303   -10.40   0.000     -.386786   -.2640738
         25  |  -.2843254   .0318142    -8.94   0.000    -.3466835   -.2219673
         26  |   .3293623   .0421938     7.81   0.000     .2466594    .4120651
         27  |   .1300742   .0365578     3.56   0.000     .0584184    .2017301
         28  |   .0295976   .0345719     0.86   0.392    -.0381658     .097361
         29  |  -.0585271   .0344002    -1.70   0.089    -.1259539    .0088998
         30  |  -.1124653   .0334967    -3.36   0.001    -.1781211   -.0468096
         31  |   -.125871   .0326942    -3.85   0.000     -.189954    -.061788
         32  |  -.1470853    .032113    -4.58   0.000    -.2100289   -.0841416
         33  |  -.1649369   .0315636    -5.23   0.000    -.2268037   -.1030701
         34  |  -.1909467   .0313353    -6.09   0.000     -.252366   -.1295274
         35  |   -.197845   .0311112    -6.36   0.000    -.2588251   -.1368649
         36  |   -.233106   .0310467    -7.51   0.000    -.2939597   -.1722522
         37  |  -.2293255   .0311657    -7.36   0.000    -.2904123   -.1682386
         38  |  -.2288264    .031515    -7.26   0.000     -.290598   -.1670548
         39  |  -.2353903    .031379    -7.50   0.000    -.2968953   -.1738852
         40  |  -.2319847   .0318267    -7.29   0.000    -.2943671   -.1696022
         41  |  -.1995706   .0315299    -6.33   0.000    -.2613714   -.1377698
         42  |  -.1936542   .0317424    -6.10   0.000    -.2558715   -.1314368
         43  |  -.2789782   .0321716    -8.67   0.000    -.3420367   -.2159197
         44  |  -.2684946   .0326287    -8.23   0.000    -.3324491   -.2045401
         45  |  -.2290165    .032812    -6.98   0.000    -.2933302   -.1647028
         46  |  -.1857311   .0328494    -5.65   0.000    -.2501182   -.1213441
         47  |  -.1588272   .0334965    -4.74   0.000    -.2244826   -.0931717
         48  |  -.1193288   .0338115    -3.53   0.000    -.1856017   -.0530559
         49  |    -.03691   .0347989    -1.06   0.289    -.1051184    .0312983
         50  |  -.0033757   .0356203    -0.09   0.924    -.0731939    .0664425
             |
     age_cat |
          1  |   .2840562   .0200589    14.16   0.000     .2447393     .323373
          2  |   .4456106   .0209306    21.29   0.000     .4045852     .486636
          3  |   .5367708   .0215029    24.96   0.000     .4946236    .5789179
          4  |   .6171943   .0220676    27.97   0.000     .5739403    .6604482
          5  |   .6886029   .0225847    30.49   0.000     .6443353    .7328704
          6  |   .7404862   .0228969    32.34   0.000     .6956068    .7853657
          7  |   .7817357   .0232979    33.55   0.000     .7360703    .8274012
          8  |   .8044577   .0236793    33.97   0.000     .7580446    .8508708
          9  |   .8057047   .0240325    33.53   0.000     .7585993    .8528101
         10  |   .8079525   .0242462    33.32   0.000     .7604283    .8554766
         11  |   .8109595   .0246326    32.92   0.000     .7626779    .8592412
         12  |    .818442   .0248552    32.93   0.000     .7697242    .8671599
         13  |    .812122   .0251553    32.28   0.000     .7628159    .8614281
         14  |   .7896826   .0255634    30.89   0.000     .7395765    .8397887
         15  |   .7775052   .0260355    29.86   0.000     .7264739    .8285365
         16  |   .7568653    .026606    28.45   0.000     .7047158    .8090148
         17  |   .7318063   .0273695    26.74   0.000     .6781601    .7854524
         18  |   .7123448   .0279721    25.47   0.000     .6575175     .767172
         19  |   .6851765   .0289503    23.67   0.000     .6284318    .7419211
         20  |   .6257442   .0305512    20.48   0.000     .5658617    .6856266
         25  |   .5480828   .0427149    12.83   0.000     .4643586     .631807
         30  |   .6801941   .0663753    10.25   0.000     .5500939    .8102943
         40  |   .8912452   .0583074    15.29   0.000     .7769586    1.005532
         50  |    .471149   .0844436     5.58   0.000     .3056337    .6366643
             |
       _cons |   3.236911   .0308146   105.04   0.000     3.176513     3.29731
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. local fmt "%10.5f"

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }

. 
. estimates

----------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------

Linear regression                               Number of obs     =    368,493
                                                F(75, 22579)      =      44.31
                                                Prob > F          =     0.0000
                                                R-squared         =     0.0692
                                                Root MSE          =     1.0157

                                (Std. Err. adjusted for 22,580 clusters in id)
------------------------------------------------------------------------------
             |               Robust
         lnL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .4014351   .0205645    19.52   0.000     .3611273    .4417429
       expat |   .0164249   .0253936     0.65   0.518    -.0333483    .0661982
             |
    ind_year |
          2  |  -.1637905   .0217094    -7.54   0.000    -.2063425   -.1212385
          3  |  -.2734364   .0254309   -10.75   0.000    -.3232828     -.22359
          4  |   -.386475   .0273185   -14.15   0.000    -.4400212   -.3329288
          5  |  -.4495798    .028022   -16.04   0.000    -.5045048   -.3946548
          6  |  -.5220744   .0285272   -18.30   0.000    -.5779898   -.4661591
          7  |   -.537977   .0290514   -18.52   0.000    -.5949197   -.4810343
          8  |  -.5153425   .0292726   -17.60   0.000    -.5727187   -.4579662
          9  |  -.5014934   .0293504   -17.09   0.000    -.5590221   -.4439646
         10  |  -.5004757   .0294539   -16.99   0.000    -.5582074    -.442744
         11  |  -.5070983   .0297194   -17.06   0.000    -.5653503   -.4488462
         12  |    -.50246   .0296367   -16.95   0.000    -.5605499   -.4443701
         13  |   -.456834   .0294826   -15.50   0.000    -.5146219   -.3990461
         14  |  -.4455668   .0294614   -15.12   0.000    -.5033132   -.3878203
         15  |   -.419142   .0293807   -14.27   0.000    -.4767301   -.3615539
         16  |  -.4082758   .0293405   -13.92   0.000    -.4657851   -.3507665
         17  |  -.3861846   .0296024   -13.05   0.000    -.4442074   -.3281619
         18  |  -.4220623   .0295972   -14.26   0.000    -.4800749   -.3640497
         19  |  -.4183438   .0298105   -14.03   0.000    -.4767743   -.3599132
         20  |  -.4051258   .0299223   -13.54   0.000    -.4637755   -.3464761
         21  |  -.4079681    .030156   -13.53   0.000    -.4670759   -.3488603
         22  |  -.4024524   .0302733   -13.29   0.000    -.4617902   -.3431146
         23  |  -.3827705   .0304072   -12.59   0.000    -.4423707   -.3231703
         24  |  -.3254299    .031303   -10.40   0.000     -.386786   -.2640738
         25  |  -.2843254   .0318142    -8.94   0.000    -.3466835   -.2219673
         26  |   .3293623   .0421938     7.81   0.000     .2466594    .4120651
         27  |   .1300742   .0365578     3.56   0.000     .0584184    .2017301
         28  |   .0295976   .0345719     0.86   0.392    -.0381658     .097361
         29  |  -.0585271   .0344002    -1.70   0.089    -.1259539    .0088998
         30  |  -.1124653   .0334967    -3.36   0.001    -.1781211   -.0468096
         31  |   -.125871   .0326942    -3.85   0.000     -.189954    -.061788
         32  |  -.1470853    .032113    -4.58   0.000    -.2100289   -.0841416
         33  |  -.1649369   .0315636    -5.23   0.000    -.2268037   -.1030701
         34  |  -.1909467   .0313353    -6.09   0.000     -.252366   -.1295274
         35  |   -.197845   .0311112    -6.36   0.000    -.2588251   -.1368649
         36  |   -.233106   .0310467    -7.51   0.000    -.2939597   -.1722522
         37  |  -.2293255   .0311657    -7.36   0.000    -.2904123   -.1682386
         38  |  -.2288264    .031515    -7.26   0.000     -.290598   -.1670548
         39  |  -.2353903    .031379    -7.50   0.000    -.2968953   -.1738852
         40  |  -.2319847   .0318267    -7.29   0.000    -.2943671   -.1696022
         41  |  -.1995706   .0315299    -6.33   0.000    -.2613714   -.1377698
         42  |  -.1936542   .0317424    -6.10   0.000    -.2558715   -.1314368
         43  |  -.2789782   .0321716    -8.67   0.000    -.3420367   -.2159197
         44  |  -.2684946   .0326287    -8.23   0.000    -.3324491   -.2045401
         45  |  -.2290165    .032812    -6.98   0.000    -.2933302   -.1647028
         46  |  -.1857311   .0328494    -5.65   0.000    -.2501182   -.1213441
         47  |  -.1588272   .0334965    -4.74   0.000    -.2244826   -.0931717
         48  |  -.1193288   .0338115    -3.53   0.000    -.1856017   -.0530559
         49  |    -.03691   .0347989    -1.06   0.289    -.1051184    .0312983
         50  |  -.0033757   .0356203    -0.09   0.924    -.0731939    .0664425
             |
     age_cat |
          1  |   .2840562   .0200589    14.16   0.000     .2447393     .323373
          2  |   .4456106   .0209306    21.29   0.000     .4045852     .486636
          3  |   .5367708   .0215029    24.96   0.000     .4946236    .5789179
          4  |   .6171943   .0220676    27.97   0.000     .5739403    .6604482
          5  |   .6886029   .0225847    30.49   0.000     .6443353    .7328704
          6  |   .7404862   .0228969    32.34   0.000     .6956068    .7853657
          7  |   .7817357   .0232979    33.55   0.000     .7360703    .8274012
          8  |   .8044577   .0236793    33.97   0.000     .7580446    .8508708
          9  |   .8057047   .0240325    33.53   0.000     .7585993    .8528101
         10  |   .8079525   .0242462    33.32   0.000     .7604283    .8554766
         11  |   .8109595   .0246326    32.92   0.000     .7626779    .8592412
         12  |    .818442   .0248552    32.93   0.000     .7697242    .8671599
         13  |    .812122   .0251553    32.28   0.000     .7628159    .8614281
         14  |   .7896826   .0255634    30.89   0.000     .7395765    .8397887
         15  |   .7775052   .0260355    29.86   0.000     .7264739    .8285365
         16  |   .7568653    .026606    28.45   0.000     .7047158    .8090148
         17  |   .7318063   .0273695    26.74   0.000     .6781601    .7854524
         18  |   .7123448   .0279721    25.47   0.000     .6575175     .767172
         19  |   .6851765   .0289503    23.67   0.000     .6284318    .7419211
         20  |   .6257442   .0305512    20.48   0.000     .5658617    .6856266
         25  |   .5480828   .0427149    12.83   0.000     .4643586     .631807
         30  |   .6801941   .0663753    10.25   0.000     .5500939    .8102943
         40  |   .8912452   .0583074    15.29   0.000     .7769586    1.005532
         50  |    .471149   .0844436     5.58   0.000     .3056337    .6366643
             |
       _cons |   3.236911   .0308146   105.04   0.000     3.176513     3.29731
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text repla
> ce

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b', "`fmt'")) _newline
  6.         file write `output' ("   standard_error: " + string(`se', "`fmt'")) _
> newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se', "`fmt'")) 
> _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',
> "pvalue"),colnumb(`coefs',"`X'")]), "`fmt'") _newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file
warning: existing panel variable is not id

Fixed-effects (within) regression               Number of obs     =    368,493
Group variable: id                              Number of groups  =     22,580

R-sq:                                           Obs per group:
     within  = 0.1073                                         min =          1
     between = 0.0171                                         avg =       16.3
     overall = 0.0239                                         max =        181

                                                F(75,22579)       =      60.49
corr(u_i, Xb)  = -0.3501                        Prob > F          =     0.0000

                                (Std. Err. adjusted for 22,580 clusters in id)
------------------------------------------------------------------------------
             |               Robust
         lnL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |  -.0308833   .0288701    -1.07   0.285    -.0874708    .0257041
       expat |  -.0389235    .012291    -3.17   0.002    -.0630147   -.0148322
             |
    ind_year |
          2  |  -.1461143   .0189409    -7.71   0.000    -.1832398   -.1089889
          3  |  -.3008656   .0246803   -12.19   0.000    -.3492406   -.2524905
          4  |  -.4578595   .0286807   -15.96   0.000    -.5140756   -.4016434
          5  |  -.5634373   .0324098   -17.38   0.000    -.6269627   -.4999118
          6  |  -.6620956   .0358054   -18.49   0.000    -.7322767   -.5919146
          7  |  -.7201831    .039229   -18.36   0.000    -.7970747   -.6432914
          8  |  -.7594598   .0423709   -17.92   0.000    -.8425097   -.6764098
          9  |  -.8102668   .0457079   -17.73   0.000    -.8998573   -.7206762
         10  |  -.8741916   .0489159   -17.87   0.000    -.9700702    -.778313
         11  |   -.944759   .0520801   -18.14   0.000     -1.04684   -.8426784
         12  |   -.994067   .0552712   -17.99   0.000    -1.102402   -.8857317
         13  |  -1.029002   .0585283   -17.58   0.000    -1.143721   -.9142822
         14  |  -1.078096   .0618185   -17.44   0.000    -1.199264   -.9569272
         15  |  -1.107228   .0650549   -17.02   0.000     -1.23474   -.9797154
         16  |  -1.156699   .0683276   -16.93   0.000    -1.290626   -1.022772
         17  |  -1.206139   .0718404   -16.79   0.000    -1.346952   -1.065327
         18  |  -1.309786   .0751576   -17.43   0.000      -1.4571   -1.162472
         19  |   -1.38701   .0782981   -17.71   0.000     -1.54048   -1.233541
         20  |   -1.44351   .0812975   -17.76   0.000    -1.602859   -1.284161
         21  |  -1.514298   .0841802   -17.99   0.000    -1.679297   -1.349299
         22  |  -1.562217   .0869724   -17.96   0.000    -1.732688   -1.391745
         23  |  -1.605972   .0897872   -17.89   0.000    -1.781961   -1.429982
         24  |  -1.647544    .092967   -17.72   0.000    -1.829766   -1.465323
         25  |  -1.684363   .0962655   -17.50   0.000     -1.87305   -1.495676
         26  |   .4874704   .0559981     8.71   0.000     .3777102    .5972306
         27  |   .2997244   .0535749     5.59   0.000     .1947138     .404735
         28  |   .1571559   .0519917     3.02   0.003     .0552485    .2590633
         29  |   .0197238   .0516917     0.38   0.703    -.0815955    .1210431
         30  |  -.0845516   .0513157    -1.65   0.099     -.185134    .0160308
         31  |  -.1573827   .0518611    -3.03   0.002    -.2590339   -.0557314
         32  |  -.2190356   .0525861    -4.17   0.000     -.322108   -.1159633
         33  |   -.296428   .0539883    -5.49   0.000    -.4022488   -.1906071
         34  |  -.3648101   .0557589    -6.54   0.000    -.4741014   -.2555189
         35  |   -.433152   .0577937    -7.49   0.000    -.5464316   -.3198724
         36  |  -.5309448   .0599759    -8.85   0.000    -.6485016    -.413388
         37  |  -.6022498    .062153    -9.69   0.000    -.7240739   -.4804257
         38  |  -.6907868   .0647778   -10.66   0.000    -.8177557   -.5638179
         39  |    -.76031   .0677204   -11.23   0.000    -.8930467   -.6275733
         40  |  -.8059048   .0709397   -11.36   0.000    -.9449516    -.666858
         41  |  -.8341573   .0737266   -11.31   0.000    -.9786665   -.6896481
         42  |  -.8893031   .0766934   -11.60   0.000    -1.039627   -.7389788
         43  |  -1.036945   .0800639   -12.95   0.000    -1.193876   -.8800146
         44  |  -1.097183   .0837036   -13.11   0.000    -1.261247   -.9331177
         45  |  -1.114093   .0869438   -12.81   0.000    -1.284508   -.9436767
         46  |  -1.146505   .0898931   -12.75   0.000    -1.322702   -.9703084
         47  |  -1.175786   .0926191   -12.69   0.000    -1.357326   -.9942466
         48  |  -1.196635    .095546   -12.52   0.000    -1.383912   -1.009359
         49  |   -1.21838   .0984479   -12.38   0.000    -1.411345   -1.025416
         50  |  -1.253206   .1009615   -12.41   0.000    -1.451097   -1.055314
             |
     age_cat |
          1  |   .4250742    .016603    25.60   0.000     .3925313    .4576172
          2  |   .7256213   .0191367    37.92   0.000     .6881122    .7631305
          3  |   .9425073   .0220065    42.83   0.000     .8993732    .9856415
          4  |   1.124086   .0250303    44.91   0.000     1.075025    1.173147
          5  |   1.274952   .0283241    45.01   0.000     1.219435     1.33047
          6  |   1.406266   .0316579    44.42   0.000     1.344214    1.468317
          7  |   1.513395   .0351805    43.02   0.000     1.444439    1.582351
          8  |   1.613844   .0387352    41.66   0.000     1.537921    1.689768
          9  |   1.694195   .0422955    40.06   0.000     1.611293    1.777097
         10  |   1.768114   .0458318    38.58   0.000      1.67828    1.857947
         11  |   1.839061   .0494559    37.19   0.000     1.742124    1.935998
         12  |    1.91489   .0530759    36.08   0.000     1.810858    2.018923
         13  |   1.975828   .0566926    34.85   0.000     1.864707     2.08695
         14  |   2.025257    .060448    33.50   0.000     1.906775     2.14374
         15  |   2.075032   .0641639    32.34   0.000     1.949266    2.200798
         16  |   2.116253    .067921    31.16   0.000     1.983123    2.249383
         17  |   2.157244   .0717714    30.06   0.000     2.016567    2.297921
         18  |   2.208847   .0754541    29.27   0.000     2.060952    2.356743
         19  |   2.245661   .0793391    28.30   0.000      2.09015    2.401171
         20  |   2.332884   .0865789    26.95   0.000     2.163184    2.502585
         25  |   2.466867   .0983739    25.08   0.000     2.274047    2.659686
         30  |   2.151431   .1351703    15.92   0.000     1.886488    2.416374
         40  |   1.992692   .1526495    13.05   0.000     1.693488    2.291895
         50  |   1.874687   .1618616    11.58   0.000     1.557427    2.191947
             |
       _cons |   3.035896   .0352798    86.05   0.000     2.966745    3.105046
-------------+----------------------------------------------------------------
     sigma_u |  1.0760155
     sigma_e |  .64980026
         rho |  .73276768   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. local fmt "%10.5f"

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }
key: R2_within
value: .1072888638832374

. 
. estimates

----------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------

Fixed-effects (within) regression               Number of obs     =    368,493
Group variable: id                              Number of groups  =     22,580

R-sq:                                           Obs per group:
     within  = 0.1073                                         min =          1
     between = 0.0171                                         avg =       16.3
     overall = 0.0239                                         max =        181

                                                F(75,22579)       =      60.49
corr(u_i, Xb)  = -0.3501                        Prob > F          =     0.0000

                                (Std. Err. adjusted for 22,580 clusters in id)
------------------------------------------------------------------------------
             |               Robust
         lnL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |  -.0308833   .0288701    -1.07   0.285    -.0874708    .0257041
       expat |  -.0389235    .012291    -3.17   0.002    -.0630147   -.0148322
             |
    ind_year |
          2  |  -.1461143   .0189409    -7.71   0.000    -.1832398   -.1089889
          3  |  -.3008656   .0246803   -12.19   0.000    -.3492406   -.2524905
          4  |  -.4578595   .0286807   -15.96   0.000    -.5140756   -.4016434
          5  |  -.5634373   .0324098   -17.38   0.000    -.6269627   -.4999118
          6  |  -.6620956   .0358054   -18.49   0.000    -.7322767   -.5919146
          7  |  -.7201831    .039229   -18.36   0.000    -.7970747   -.6432914
          8  |  -.7594598   .0423709   -17.92   0.000    -.8425097   -.6764098
          9  |  -.8102668   .0457079   -17.73   0.000    -.8998573   -.7206762
         10  |  -.8741916   .0489159   -17.87   0.000    -.9700702    -.778313
         11  |   -.944759   .0520801   -18.14   0.000     -1.04684   -.8426784
         12  |   -.994067   .0552712   -17.99   0.000    -1.102402   -.8857317
         13  |  -1.029002   .0585283   -17.58   0.000    -1.143721   -.9142822
         14  |  -1.078096   .0618185   -17.44   0.000    -1.199264   -.9569272
         15  |  -1.107228   .0650549   -17.02   0.000     -1.23474   -.9797154
         16  |  -1.156699   .0683276   -16.93   0.000    -1.290626   -1.022772
         17  |  -1.206139   .0718404   -16.79   0.000    -1.346952   -1.065327
         18  |  -1.309786   .0751576   -17.43   0.000      -1.4571   -1.162472
         19  |   -1.38701   .0782981   -17.71   0.000     -1.54048   -1.233541
         20  |   -1.44351   .0812975   -17.76   0.000    -1.602859   -1.284161
         21  |  -1.514298   .0841802   -17.99   0.000    -1.679297   -1.349299
         22  |  -1.562217   .0869724   -17.96   0.000    -1.732688   -1.391745
         23  |  -1.605972   .0897872   -17.89   0.000    -1.781961   -1.429982
         24  |  -1.647544    .092967   -17.72   0.000    -1.829766   -1.465323
         25  |  -1.684363   .0962655   -17.50   0.000     -1.87305   -1.495676
         26  |   .4874704   .0559981     8.71   0.000     .3777102    .5972306
         27  |   .2997244   .0535749     5.59   0.000     .1947138     .404735
         28  |   .1571559   .0519917     3.02   0.003     .0552485    .2590633
         29  |   .0197238   .0516917     0.38   0.703    -.0815955    .1210431
         30  |  -.0845516   .0513157    -1.65   0.099     -.185134    .0160308
         31  |  -.1573827   .0518611    -3.03   0.002    -.2590339   -.0557314
         32  |  -.2190356   .0525861    -4.17   0.000     -.322108   -.1159633
         33  |   -.296428   .0539883    -5.49   0.000    -.4022488   -.1906071
         34  |  -.3648101   .0557589    -6.54   0.000    -.4741014   -.2555189
         35  |   -.433152   .0577937    -7.49   0.000    -.5464316   -.3198724
         36  |  -.5309448   .0599759    -8.85   0.000    -.6485016    -.413388
         37  |  -.6022498    .062153    -9.69   0.000    -.7240739   -.4804257
         38  |  -.6907868   .0647778   -10.66   0.000    -.8177557   -.5638179
         39  |    -.76031   .0677204   -11.23   0.000    -.8930467   -.6275733
         40  |  -.8059048   .0709397   -11.36   0.000    -.9449516    -.666858
         41  |  -.8341573   .0737266   -11.31   0.000    -.9786665   -.6896481
         42  |  -.8893031   .0766934   -11.60   0.000    -1.039627   -.7389788
         43  |  -1.036945   .0800639   -12.95   0.000    -1.193876   -.8800146
         44  |  -1.097183   .0837036   -13.11   0.000    -1.261247   -.9331177
         45  |  -1.114093   .0869438   -12.81   0.000    -1.284508   -.9436767
         46  |  -1.146505   .0898931   -12.75   0.000    -1.322702   -.9703084
         47  |  -1.175786   .0926191   -12.69   0.000    -1.357326   -.9942466
         48  |  -1.196635    .095546   -12.52   0.000    -1.383912   -1.009359
         49  |   -1.21838   .0984479   -12.38   0.000    -1.411345   -1.025416
         50  |  -1.253206   .1009615   -12.41   0.000    -1.451097   -1.055314
             |
     age_cat |
          1  |   .4250742    .016603    25.60   0.000     .3925313    .4576172
          2  |   .7256213   .0191367    37.92   0.000     .6881122    .7631305
          3  |   .9425073   .0220065    42.83   0.000     .8993732    .9856415
          4  |   1.124086   .0250303    44.91   0.000     1.075025    1.173147
          5  |   1.274952   .0283241    45.01   0.000     1.219435     1.33047
          6  |   1.406266   .0316579    44.42   0.000     1.344214    1.468317
          7  |   1.513395   .0351805    43.02   0.000     1.444439    1.582351
          8  |   1.613844   .0387352    41.66   0.000     1.537921    1.689768
          9  |   1.694195   .0422955    40.06   0.000     1.611293    1.777097
         10  |   1.768114   .0458318    38.58   0.000      1.67828    1.857947
         11  |   1.839061   .0494559    37.19   0.000     1.742124    1.935998
         12  |    1.91489   .0530759    36.08   0.000     1.810858    2.018923
         13  |   1.975828   .0566926    34.85   0.000     1.864707     2.08695
         14  |   2.025257    .060448    33.50   0.000     1.906775     2.14374
         15  |   2.075032   .0641639    32.34   0.000     1.949266    2.200798
         16  |   2.116253    .067921    31.16   0.000     1.983123    2.249383
         17  |   2.157244   .0717714    30.06   0.000     2.016567    2.297921
         18  |   2.208847   .0754541    29.27   0.000     2.060952    2.356743
         19  |   2.245661   .0793391    28.30   0.000      2.09015    2.401171
         20  |   2.332884   .0865789    26.95   0.000     2.163184    2.502585
         25  |   2.466867   .0983739    25.08   0.000     2.274047    2.659686
         30  |   2.151431   .1351703    15.92   0.000     1.886488    2.416374
         40  |   1.992692   .1526495    13.05   0.000     1.693488    2.291895
         50  |   1.874687   .1618616    11.58   0.000     1.557427    2.191947
             |
       _cons |   3.035896   .0352798    86.05   0.000     2.966745    3.105046
-------------+----------------------------------------------------------------
     sigma_u |  1.0760155
     sigma_e |  .64980026
         rho |  .73276768   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text repla
> ce

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b', "`fmt'")) _newline
  6.         file write `output' ("   standard_error: " + string(`se', "`fmt'")) _
> newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se', "`fmt'")) 
> _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',
> "pvalue"),colnumb(`coefs',"`X'")]), "`fmt'") _newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file
(sum of wgt is   1.1357e+05)

Linear regression                               Number of obs     =    288,264
                                                F(75, 18612)      =      29.61
                                                Prob > F          =     0.0000
                                                R-squared         =     0.0487
                                                Root MSE          =     .99382

                                (Std. Err. adjusted for 18,613 clusters in id)
------------------------------------------------------------------------------
             |               Robust
         lnL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .4379676   .0380249    11.52   0.000     .3634353    .5124999
       expat |  -.0773881   .0653974    -1.18   0.237     -.205573    .0507967
             |
    ind_year |
          2  |  -.1703607   .0221828    -7.68   0.000     -.213841   -.1268805
          3  |  -.2870629   .0262415   -10.94   0.000    -.3384987   -.2356272
          4  |  -.3975862   .0282315   -14.08   0.000    -.4529226   -.3422498
          5  |  -.4696777   .0289668   -16.21   0.000    -.5264553   -.4129001
          6  |  -.5490988   .0296059   -18.55   0.000    -.6071291   -.4910685
          7  |  -.5715354   .0303048   -18.86   0.000    -.6309355   -.5121353
          8  |  -.5513193   .0305041   -18.07   0.000    -.6111101   -.4915284
          9  |   -.537498   .0306484   -17.54   0.000    -.5975716   -.4774243
         10  |  -.5448912   .0306621   -17.77   0.000    -.6049917   -.4847908
         11  |  -.5497086   .0309727   -17.75   0.000    -.6104179   -.4889993
         12  |  -.5414754   .0308374   -17.56   0.000    -.6019196   -.4810313
         13  |  -.5001794   .0307086   -16.29   0.000    -.5603711   -.4399877
         14  |  -.4902501   .0306761   -15.98   0.000     -.550378   -.4301222
         15  |  -.4648239   .0305321   -15.22   0.000    -.5246696   -.4049781
         16  |  -.4610878   .0305208   -15.11   0.000    -.5209114   -.4012642
         17  |  -.4527927    .030748   -14.73   0.000    -.5130616   -.3925238
         18  |  -.4788537   .0307301   -15.58   0.000    -.5390875   -.4186199
         19  |  -.4767011   .0309164   -15.42   0.000    -.5373001   -.4161021
         20  |  -.4607885   .0310403   -14.84   0.000    -.5216302   -.3999467
         21  |   -.457669   .0313503   -14.60   0.000    -.5191186   -.3962195
         22  |  -.4462076   .0314523   -14.19   0.000    -.5078569   -.3845582
         23  |  -.4334413   .0315838   -13.72   0.000    -.4953484   -.3715341
         24  |  -.3886474   .0326261   -11.91   0.000    -.4525976   -.3246973
         25  |  -.3453079   .0331141   -10.43   0.000    -.4102145   -.2804013
         26  |   .3156354   .0449106     7.03   0.000     .2276065    .4036642
         27  |    .121563   .0386924     3.14   0.002     .0457224    .1974035
         28  |   .0221057   .0366003     0.60   0.546    -.0496343    .0938458
         29  |  -.0743311   .0369901    -2.01   0.044    -.1468351   -.0018272
         30  |  -.1321104   .0359486    -3.67   0.000    -.2025729   -.0616479
         31  |  -.1646531   .0349852    -4.71   0.000    -.2332273    -.096079
         32  |  -.1954308   .0340732    -5.74   0.000    -.2622173   -.1286442
         33  |   -.224904   .0333889    -6.74   0.000    -.2903492   -.1594588
         34  |  -.2640266   .0333265    -7.92   0.000    -.3293495   -.1987037
         35  |  -.2772237   .0330512    -8.39   0.000    -.3420071   -.2124402
         36  |  -.3059194   .0327708    -9.34   0.000    -.3701533   -.2416856
         37  |  -.3022228   .0329473    -9.17   0.000    -.3668025    -.237643
         38  |  -.2964104   .0332913    -8.90   0.000    -.3616645   -.2311564
         39  |  -.3015416    .033165    -9.09   0.000    -.3665481   -.2365352
         40  |  -.2989115   .0336601    -8.88   0.000    -.3648885   -.2329345
         41  |  -.2785674   .0332316    -8.38   0.000    -.3437044   -.2134304
         42  |  -.2785828   .0334451    -8.33   0.000    -.3441382   -.2130274
         43  |  -.3619956   .0340377   -10.64   0.000    -.4287127   -.2952786
         44  |  -.3477995   .0343868   -10.11   0.000    -.4152008   -.2803982
         45  |  -.3216869   .0347147    -9.27   0.000    -.3897309   -.2536429
         46  |  -.2839416   .0347114    -8.18   0.000    -.3519791   -.2159041
         47  |  -.2543611   .0356404    -7.14   0.000    -.3242195   -.1845026
         48  |  -.2132358    .035914    -5.94   0.000    -.2836305    -.142841
         49  |  -.1715725   .0375065    -4.57   0.000    -.2450887   -.0980563
         50  |  -.1400702   .0383435    -3.65   0.000    -.2152271   -.0649134
             |
     age_cat |
          1  |   .2695025   .0214488    12.56   0.000     .2274608    .3115442
          2  |   .4121602   .0224588    18.35   0.000     .3681388    .4561816
          3  |     .49666   .0231802    21.43   0.000     .4512247    .5420953
          4  |   .5724096   .0238343    24.02   0.000     .5256921     .619127
          5  |   .6431646   .0244198    26.34   0.000     .5952995    .6910296
          6  |   .6917183   .0248081    27.88   0.000     .6430922    .7403444
          7  |   .7351184   .0252482    29.12   0.000     .6856296    .7846072
          8  |   .7526769   .0256631    29.33   0.000     .7023748    .8029789
          9  |   .7512335   .0260817    28.80   0.000     .7001109    .8023561
         10  |   .7552915   .0262152    28.81   0.000     .7039073    .8066757
         11  |   .7627236   .0266223    28.65   0.000     .7105413    .8149058
         12  |   .7692082   .0268387    28.66   0.000     .7166018    .8218146
         13  |   .7605867   .0271759    27.99   0.000     .7073193     .813854
         14  |   .7365669   .0276401    26.65   0.000     .6823897    .7907441
         15  |   .7256109   .0280983    25.82   0.000     .6705356    .7806861
         16  |   .7024764   .0286782    24.50   0.000     .6462645    .7586883
         17  |   .6805471   .0294757    23.09   0.000      .622772    .7383222
         18  |   .6580713   .0301412    21.83   0.000     .5989918    .7171508
         19  |   .6301531   .0312268    20.18   0.000     .5689456    .6913605
         20  |    .563928    .032855    17.16   0.000     .4995292    .6283269
         25  |   .4826099   .0456935    10.56   0.000     .3930464    .5721734
         30  |   .6143279   .0667486     9.20   0.000     .4834946    .7451612
         40  |   .8273944    .058828    14.06   0.000     .7120861    .9427028
         50  |   .4348233   .0858488     5.06   0.000     .2665519    .6030948
             |
       _cons |   3.333205   .0320007   104.16   0.000      3.27048    3.395929
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. local fmt "%10.5f"

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }

. 
. estimates

----------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------

Linear regression                               Number of obs     =    288,264
                                                F(75, 18612)      =      29.61
                                                Prob > F          =     0.0000
                                                R-squared         =     0.0487
                                                Root MSE          =     .99382

                                (Std. Err. adjusted for 18,613 clusters in id)
------------------------------------------------------------------------------
             |               Robust
         lnL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .4379676   .0380249    11.52   0.000     .3634353    .5124999
       expat |  -.0773881   .0653974    -1.18   0.237     -.205573    .0507967
             |
    ind_year |
          2  |  -.1703607   .0221828    -7.68   0.000     -.213841   -.1268805
          3  |  -.2870629   .0262415   -10.94   0.000    -.3384987   -.2356272
          4  |  -.3975862   .0282315   -14.08   0.000    -.4529226   -.3422498
          5  |  -.4696777   .0289668   -16.21   0.000    -.5264553   -.4129001
          6  |  -.5490988   .0296059   -18.55   0.000    -.6071291   -.4910685
          7  |  -.5715354   .0303048   -18.86   0.000    -.6309355   -.5121353
          8  |  -.5513193   .0305041   -18.07   0.000    -.6111101   -.4915284
          9  |   -.537498   .0306484   -17.54   0.000    -.5975716   -.4774243
         10  |  -.5448912   .0306621   -17.77   0.000    -.6049917   -.4847908
         11  |  -.5497086   .0309727   -17.75   0.000    -.6104179   -.4889993
         12  |  -.5414754   .0308374   -17.56   0.000    -.6019196   -.4810313
         13  |  -.5001794   .0307086   -16.29   0.000    -.5603711   -.4399877
         14  |  -.4902501   .0306761   -15.98   0.000     -.550378   -.4301222
         15  |  -.4648239   .0305321   -15.22   0.000    -.5246696   -.4049781
         16  |  -.4610878   .0305208   -15.11   0.000    -.5209114   -.4012642
         17  |  -.4527927    .030748   -14.73   0.000    -.5130616   -.3925238
         18  |  -.4788537   .0307301   -15.58   0.000    -.5390875   -.4186199
         19  |  -.4767011   .0309164   -15.42   0.000    -.5373001   -.4161021
         20  |  -.4607885   .0310403   -14.84   0.000    -.5216302   -.3999467
         21  |   -.457669   .0313503   -14.60   0.000    -.5191186   -.3962195
         22  |  -.4462076   .0314523   -14.19   0.000    -.5078569   -.3845582
         23  |  -.4334413   .0315838   -13.72   0.000    -.4953484   -.3715341
         24  |  -.3886474   .0326261   -11.91   0.000    -.4525976   -.3246973
         25  |  -.3453079   .0331141   -10.43   0.000    -.4102145   -.2804013
         26  |   .3156354   .0449106     7.03   0.000     .2276065    .4036642
         27  |    .121563   .0386924     3.14   0.002     .0457224    .1974035
         28  |   .0221057   .0366003     0.60   0.546    -.0496343    .0938458
         29  |  -.0743311   .0369901    -2.01   0.044    -.1468351   -.0018272
         30  |  -.1321104   .0359486    -3.67   0.000    -.2025729   -.0616479
         31  |  -.1646531   .0349852    -4.71   0.000    -.2332273    -.096079
         32  |  -.1954308   .0340732    -5.74   0.000    -.2622173   -.1286442
         33  |   -.224904   .0333889    -6.74   0.000    -.2903492   -.1594588
         34  |  -.2640266   .0333265    -7.92   0.000    -.3293495   -.1987037
         35  |  -.2772237   .0330512    -8.39   0.000    -.3420071   -.2124402
         36  |  -.3059194   .0327708    -9.34   0.000    -.3701533   -.2416856
         37  |  -.3022228   .0329473    -9.17   0.000    -.3668025    -.237643
         38  |  -.2964104   .0332913    -8.90   0.000    -.3616645   -.2311564
         39  |  -.3015416    .033165    -9.09   0.000    -.3665481   -.2365352
         40  |  -.2989115   .0336601    -8.88   0.000    -.3648885   -.2329345
         41  |  -.2785674   .0332316    -8.38   0.000    -.3437044   -.2134304
         42  |  -.2785828   .0334451    -8.33   0.000    -.3441382   -.2130274
         43  |  -.3619956   .0340377   -10.64   0.000    -.4287127   -.2952786
         44  |  -.3477995   .0343868   -10.11   0.000    -.4152008   -.2803982
         45  |  -.3216869   .0347147    -9.27   0.000    -.3897309   -.2536429
         46  |  -.2839416   .0347114    -8.18   0.000    -.3519791   -.2159041
         47  |  -.2543611   .0356404    -7.14   0.000    -.3242195   -.1845026
         48  |  -.2132358    .035914    -5.94   0.000    -.2836305    -.142841
         49  |  -.1715725   .0375065    -4.57   0.000    -.2450887   -.0980563
         50  |  -.1400702   .0383435    -3.65   0.000    -.2152271   -.0649134
             |
     age_cat |
          1  |   .2695025   .0214488    12.56   0.000     .2274608    .3115442
          2  |   .4121602   .0224588    18.35   0.000     .3681388    .4561816
          3  |     .49666   .0231802    21.43   0.000     .4512247    .5420953
          4  |   .5724096   .0238343    24.02   0.000     .5256921     .619127
          5  |   .6431646   .0244198    26.34   0.000     .5952995    .6910296
          6  |   .6917183   .0248081    27.88   0.000     .6430922    .7403444
          7  |   .7351184   .0252482    29.12   0.000     .6856296    .7846072
          8  |   .7526769   .0256631    29.33   0.000     .7023748    .8029789
          9  |   .7512335   .0260817    28.80   0.000     .7001109    .8023561
         10  |   .7552915   .0262152    28.81   0.000     .7039073    .8066757
         11  |   .7627236   .0266223    28.65   0.000     .7105413    .8149058
         12  |   .7692082   .0268387    28.66   0.000     .7166018    .8218146
         13  |   .7605867   .0271759    27.99   0.000     .7073193     .813854
         14  |   .7365669   .0276401    26.65   0.000     .6823897    .7907441
         15  |   .7256109   .0280983    25.82   0.000     .6705356    .7806861
         16  |   .7024764   .0286782    24.50   0.000     .6462645    .7586883
         17  |   .6805471   .0294757    23.09   0.000      .622772    .7383222
         18  |   .6580713   .0301412    21.83   0.000     .5989918    .7171508
         19  |   .6301531   .0312268    20.18   0.000     .5689456    .6913605
         20  |    .563928    .032855    17.16   0.000     .4995292    .6283269
         25  |   .4826099   .0456935    10.56   0.000     .3930464    .5721734
         30  |   .6143279   .0667486     9.20   0.000     .4834946    .7451612
         40  |   .8273944    .058828    14.06   0.000     .7120861    .9427028
         50  |   .4348233   .0858488     5.06   0.000     .2665519    .6030948
             |
       _cons |   3.333205   .0320007   104.16   0.000      3.27048    3.395929
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text repla
> ce

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b', "`fmt'")) _newline
  6.         file write `output' ("   standard_error: " + string(`se', "`fmt'")) _
> newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se', "`fmt'")) 
> _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',
> "pvalue"),colnumb(`coefs',"`X'")]), "`fmt'") _newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file

Fixed-effects (within) regression               Number of obs     =    288,264
Group variable: id                              Number of groups  =     18,613

R-sq:                                           Obs per group:
     within  = 0.1010                                         min =          1
     between = 0.0205                                         avg =       15.5
     overall = 0.0251                                         max =        181

                                                F(75,18612)       =      45.93
corr(u_i, Xb)  = -0.3662                        Prob > F          =     0.0000

                                (Std. Err. adjusted for 18,613 clusters in id)
------------------------------------------------------------------------------
             |               Robust
         lnL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   -.003849   .0366325    -0.11   0.916     -.075652     .067954
       expat |  -.0021614   .0354777    -0.06   0.951    -.0717009     .067378
             |
    ind_year |
          2  |  -.1527686   .0196416    -7.78   0.000     -.191268   -.1142693
          3  |   -.321375   .0259676   -12.38   0.000    -.3722738   -.2704762
          4  |   -.486456   .0302431   -16.08   0.000    -.5457352   -.4271767
          5  |  -.6040045    .034181   -17.67   0.000    -.6710023   -.5370066
          6  |  -.7148205    .037938   -18.84   0.000    -.7891824   -.6404585
          7  |  -.7791057   .0417245   -18.67   0.000    -.8608895    -.697322
          8  |  -.8246682   .0450443   -18.31   0.000    -.9129591   -.7363774
          9  |  -.8805523   .0486226   -18.11   0.000    -.9758571   -.7852475
         10  |  -.9483491    .051967   -18.25   0.000    -1.050209   -.8464889
         11  |  -1.018512   .0552562   -18.43   0.000     -1.12682   -.9102051
         12  |  -1.067016   .0585914   -18.21   0.000    -1.181861   -.9521715
         13  |  -1.105243    .061991   -17.83   0.000    -1.226751   -.9837352
         14  |  -1.157508   .0654335   -17.69   0.000    -1.285764   -1.029252
         15  |  -1.187432   .0687836   -17.26   0.000    -1.322254    -1.05261
         16  |  -1.247198   .0721913   -17.28   0.000      -1.3887   -1.105697
         17  |  -1.303272   .0758536   -17.18   0.000    -1.451952   -1.154592
         18  |  -1.401182   .0792783   -17.67   0.000    -1.556575    -1.24579
         19  |  -1.476131    .082492   -17.89   0.000    -1.637823   -1.314439
         20  |  -1.531576   .0855772   -17.90   0.000    -1.699315   -1.363837
         21  |  -1.598345   .0885571   -18.05   0.000    -1.771925   -1.424764
         22  |  -1.643989   .0914477   -17.98   0.000    -1.823235   -1.464743
         23  |  -1.690044   .0943573   -17.91   0.000    -1.874993   -1.505095
         24  |   -1.73626   .0976726   -17.78   0.000    -1.927708   -1.544813
         25  |  -1.770558   .1011168   -17.51   0.000    -1.968756    -1.57236
         26  |   .4611179   .0615265     7.49   0.000     .3405203    .5817154
         27  |   .2640811   .0586906     4.50   0.000     .1490421      .37912
         28  |   .1133123   .0568333     1.99   0.046     .0019138    .2247107
         29  |  -.0399158   .0566599    -0.70   0.481    -.1509743    .0711428
         30  |  -.1567333   .0561626    -2.79   0.005    -.2668171   -.0466496
         31  |  -.2392603   .0564825    -4.24   0.000    -.3499712   -.1285494
         32  |  -.3108448   .0570541    -5.45   0.000    -.4226762   -.1990135
         33  |   -.394693   .0584194    -6.76   0.000    -.5092004   -.2801855
         34  |  -.4763072    .060217    -7.91   0.000    -.5943379   -.3582764
         35  |  -.5456166   .0622919    -8.76   0.000    -.6677144   -.4235188
         36  |  -.6323333   .0643868    -9.82   0.000    -.7585374   -.5061293
         37  |  -.7037073    .066544   -10.58   0.000    -.8341395   -.5732751
         38  |  -.7854087   .0691805   -11.35   0.000    -.9210088   -.6498085
         39  |  -.8557776   .0722351   -11.85   0.000     -.997365   -.7141902
         40  |  -.9022188   .0755867   -11.94   0.000    -1.050376   -.7540621
         41  |  -.9371936   .0784223   -11.95   0.000    -1.090909   -.7834786
         42  |    -.99507   .0813218   -12.24   0.000    -1.154468   -.8356719
         43  |  -1.137956   .0847845   -13.42   0.000    -1.304141   -.9717701
         44  |  -1.192316   .0884871   -13.47   0.000    -1.365759   -1.018874
         45  |  -1.218343   .0919425   -13.25   0.000    -1.398558   -1.038127
         46  |   -1.24755   .0949835   -13.13   0.000    -1.433727   -1.061374
         47  |  -1.281594    .097775   -13.11   0.000    -1.473242   -1.089946
         48  |  -1.303625   .1008404   -12.93   0.000    -1.501281   -1.105969
         49  |  -1.342456   .1038883   -12.92   0.000    -1.546086   -1.138825
         50  |  -1.380471   .1063968   -12.97   0.000    -1.589019   -1.171924
             |
     age_cat |
          1  |   .4271883   .0180666    23.65   0.000     .3917761    .4626005
          2  |   .7145006   .0208128    34.33   0.000     .6737056    .7552956
          3  |   .9305308     .02393    38.89   0.000     .8836258    .9774357
          4  |   1.114077   .0271037    41.10   0.000     1.060951    1.167203
          5  |   1.266996   .0305761    41.44   0.000     1.207064    1.326928
          6  |   1.400122   .0340976    41.06   0.000     1.333287    1.466956
          7  |   1.511436   .0378162    39.97   0.000     1.437313    1.585559
          8  |   1.609747   .0415417    38.75   0.000     1.528321    1.691172
          9  |   1.688905   .0452414    37.33   0.000     1.600228    1.777582
         10  |   1.762129   .0488869    36.04   0.000     1.666306    1.857952
         11  |   1.834263   .0526349    34.85   0.000     1.731093    1.937432
         12  |    1.91064   .0563928    33.88   0.000     1.800105    2.021175
         13  |   1.969034   .0601325    32.74   0.000     1.851169    2.086899
         14  |   2.017879   .0640709    31.49   0.000     1.892294    2.143464
         15  |   2.065722   .0679074    30.42   0.000     1.932617    2.198826
         16  |   2.106814   .0718193    29.33   0.000     1.966042    2.247586
         17  |   2.147669   .0758144    28.33   0.000     1.999066    2.296272
         18  |   2.198358   .0796272    27.61   0.000     2.042281    2.354434
         19  |   2.232467   .0837412    26.66   0.000     2.068326    2.396607
         20  |   2.317225   .0912342    25.40   0.000     2.138397    2.496052
         25  |   2.450478   .1035804    23.66   0.000     2.247451    2.653505
         30  |   2.153668    .140714    15.31   0.000     1.877855     2.42948
         40  |   2.009635   .1589599    12.64   0.000     1.698059    2.321211
         50  |   1.906285   .1687702    11.30   0.000      1.57548    2.237089
             |
       _cons |   3.050806   .0366159    83.32   0.000     2.979035    3.122576
-------------+----------------------------------------------------------------
     sigma_u |  1.0513605
     sigma_e |  .65182516
         rho |  .72234587   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. local fmt "%10.5f"

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }
key: R2_within
value: .1009956959665474

. 
. estimates

----------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------

Fixed-effects (within) regression               Number of obs     =    288,264
Group variable: id                              Number of groups  =     18,613

R-sq:                                           Obs per group:
     within  = 0.1010                                         min =          1
     between = 0.0205                                         avg =       15.5
     overall = 0.0251                                         max =        181

                                                F(75,18612)       =      45.93
corr(u_i, Xb)  = -0.3662                        Prob > F          =     0.0000

                                (Std. Err. adjusted for 18,613 clusters in id)
------------------------------------------------------------------------------
             |               Robust
         lnL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   -.003849   .0366325    -0.11   0.916     -.075652     .067954
       expat |  -.0021614   .0354777    -0.06   0.951    -.0717009     .067378
             |
    ind_year |
          2  |  -.1527686   .0196416    -7.78   0.000     -.191268   -.1142693
          3  |   -.321375   .0259676   -12.38   0.000    -.3722738   -.2704762
          4  |   -.486456   .0302431   -16.08   0.000    -.5457352   -.4271767
          5  |  -.6040045    .034181   -17.67   0.000    -.6710023   -.5370066
          6  |  -.7148205    .037938   -18.84   0.000    -.7891824   -.6404585
          7  |  -.7791057   .0417245   -18.67   0.000    -.8608895    -.697322
          8  |  -.8246682   .0450443   -18.31   0.000    -.9129591   -.7363774
          9  |  -.8805523   .0486226   -18.11   0.000    -.9758571   -.7852475
         10  |  -.9483491    .051967   -18.25   0.000    -1.050209   -.8464889
         11  |  -1.018512   .0552562   -18.43   0.000     -1.12682   -.9102051
         12  |  -1.067016   .0585914   -18.21   0.000    -1.181861   -.9521715
         13  |  -1.105243    .061991   -17.83   0.000    -1.226751   -.9837352
         14  |  -1.157508   .0654335   -17.69   0.000    -1.285764   -1.029252
         15  |  -1.187432   .0687836   -17.26   0.000    -1.322254    -1.05261
         16  |  -1.247198   .0721913   -17.28   0.000      -1.3887   -1.105697
         17  |  -1.303272   .0758536   -17.18   0.000    -1.451952   -1.154592
         18  |  -1.401182   .0792783   -17.67   0.000    -1.556575    -1.24579
         19  |  -1.476131    .082492   -17.89   0.000    -1.637823   -1.314439
         20  |  -1.531576   .0855772   -17.90   0.000    -1.699315   -1.363837
         21  |  -1.598345   .0885571   -18.05   0.000    -1.771925   -1.424764
         22  |  -1.643989   .0914477   -17.98   0.000    -1.823235   -1.464743
         23  |  -1.690044   .0943573   -17.91   0.000    -1.874993   -1.505095
         24  |   -1.73626   .0976726   -17.78   0.000    -1.927708   -1.544813
         25  |  -1.770558   .1011168   -17.51   0.000    -1.968756    -1.57236
         26  |   .4611179   .0615265     7.49   0.000     .3405203    .5817154
         27  |   .2640811   .0586906     4.50   0.000     .1490421      .37912
         28  |   .1133123   .0568333     1.99   0.046     .0019138    .2247107
         29  |  -.0399158   .0566599    -0.70   0.481    -.1509743    .0711428
         30  |  -.1567333   .0561626    -2.79   0.005    -.2668171   -.0466496
         31  |  -.2392603   .0564825    -4.24   0.000    -.3499712   -.1285494
         32  |  -.3108448   .0570541    -5.45   0.000    -.4226762   -.1990135
         33  |   -.394693   .0584194    -6.76   0.000    -.5092004   -.2801855
         34  |  -.4763072    .060217    -7.91   0.000    -.5943379   -.3582764
         35  |  -.5456166   .0622919    -8.76   0.000    -.6677144   -.4235188
         36  |  -.6323333   .0643868    -9.82   0.000    -.7585374   -.5061293
         37  |  -.7037073    .066544   -10.58   0.000    -.8341395   -.5732751
         38  |  -.7854087   .0691805   -11.35   0.000    -.9210088   -.6498085
         39  |  -.8557776   .0722351   -11.85   0.000     -.997365   -.7141902
         40  |  -.9022188   .0755867   -11.94   0.000    -1.050376   -.7540621
         41  |  -.9371936   .0784223   -11.95   0.000    -1.090909   -.7834786
         42  |    -.99507   .0813218   -12.24   0.000    -1.154468   -.8356719
         43  |  -1.137956   .0847845   -13.42   0.000    -1.304141   -.9717701
         44  |  -1.192316   .0884871   -13.47   0.000    -1.365759   -1.018874
         45  |  -1.218343   .0919425   -13.25   0.000    -1.398558   -1.038127
         46  |   -1.24755   .0949835   -13.13   0.000    -1.433727   -1.061374
         47  |  -1.281594    .097775   -13.11   0.000    -1.473242   -1.089946
         48  |  -1.303625   .1008404   -12.93   0.000    -1.501281   -1.105969
         49  |  -1.342456   .1038883   -12.92   0.000    -1.546086   -1.138825
         50  |  -1.380471   .1063968   -12.97   0.000    -1.589019   -1.171924
             |
     age_cat |
          1  |   .4271883   .0180666    23.65   0.000     .3917761    .4626005
          2  |   .7145006   .0208128    34.33   0.000     .6737056    .7552956
          3  |   .9305308     .02393    38.89   0.000     .8836258    .9774357
          4  |   1.114077   .0271037    41.10   0.000     1.060951    1.167203
          5  |   1.266996   .0305761    41.44   0.000     1.207064    1.326928
          6  |   1.400122   .0340976    41.06   0.000     1.333287    1.466956
          7  |   1.511436   .0378162    39.97   0.000     1.437313    1.585559
          8  |   1.609747   .0415417    38.75   0.000     1.528321    1.691172
          9  |   1.688905   .0452414    37.33   0.000     1.600228    1.777582
         10  |   1.762129   .0488869    36.04   0.000     1.666306    1.857952
         11  |   1.834263   .0526349    34.85   0.000     1.731093    1.937432
         12  |    1.91064   .0563928    33.88   0.000     1.800105    2.021175
         13  |   1.969034   .0601325    32.74   0.000     1.851169    2.086899
         14  |   2.017879   .0640709    31.49   0.000     1.892294    2.143464
         15  |   2.065722   .0679074    30.42   0.000     1.932617    2.198826
         16  |   2.106814   .0718193    29.33   0.000     1.966042    2.247586
         17  |   2.147669   .0758144    28.33   0.000     1.999066    2.296272
         18  |   2.198358   .0796272    27.61   0.000     2.042281    2.354434
         19  |   2.232467   .0837412    26.66   0.000     2.068326    2.396607
         20  |   2.317225   .0912342    25.40   0.000     2.138397    2.496052
         25  |   2.450478   .1035804    23.66   0.000     2.247451    2.653505
         30  |   2.153668    .140714    15.31   0.000     1.877855     2.42948
         40  |   2.009635   .1589599    12.64   0.000     1.698059    2.321211
         50  |   1.906285   .1687702    11.30   0.000      1.57548    2.237089
             |
       _cons |   3.050806   .0366159    83.32   0.000     2.979035    3.122576
-------------+----------------------------------------------------------------
     sigma_u |  1.0513605
     sigma_e |  .65182516
         rho |  .72234587   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text repla
> ce

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b', "`fmt'")) _newline
  6.         file write `output' ("   standard_error: " + string(`se', "`fmt'")) _
> newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se', "`fmt'")) 
> _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',
> "pvalue"),colnumb(`coefs',"`X'")]), "`fmt'") _newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file
(sum of wgt is   1.3350e+05)

Linear regression                               Number of obs     =    368,493
                                                F(75, 22579)      =     180.95
                                                Prob > F          =     0.0000
                                                R-squared         =     0.1659
                                                Root MSE          =     1.6761

                                (Std. Err. adjusted for 22,580 clusters in id)
------------------------------------------------------------------------------
             |               Robust
        lnKL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .6019788   .0318333    18.91   0.000     .5395834    .6643743
       expat |   .0733702   .0412012     1.78   0.075    -.0073871    .1541274
             |
    ind_year |
          2  |    .185675   .0301525     6.16   0.000      .126574    .2447759
          3  |    .783923   .0341184    22.98   0.000     .7170485    .8507974
          4  |   .9728841   .0369289    26.34   0.000     .9005008    1.045267
          5  |   1.131543   .0378458    29.90   0.000     1.057363    1.205724
          6  |   1.393457       .039    35.73   0.000     1.317014    1.469899
          7  |   1.602531    .039542    40.53   0.000     1.525026    1.680035
          8  |   1.778821   .0397688    44.73   0.000     1.700872    1.856771
          9  |   1.898487   .0397722    47.73   0.000     1.820531    1.976443
         10  |   2.039878   .0397551    51.31   0.000     1.961955      2.1178
         11  |   2.123637   .0400234    53.06   0.000     2.045188    2.202086
         12  |   2.139174   .0405543    52.75   0.000     2.059685    2.218664
         13  |   2.136358   .0407958    52.37   0.000     2.056395     2.21632
         14  |   2.118085   .0412836    51.31   0.000     2.037167    2.199004
         15  |   2.049309   .0420291    48.76   0.000     1.966929    2.131689
         16  |   2.043286   .0425056    48.07   0.000     1.959972      2.1266
         17  |   2.028477   .0432607    46.89   0.000     1.943683    2.113271
         18  |   2.005034   .0441131    45.45   0.000     1.918569    2.091499
         19  |   1.934811   .0446073    43.37   0.000     1.847378    2.022244
         20  |    1.86375   .0455652    40.90   0.000     1.774439    1.953061
         21  |   1.853436   .0467282    39.66   0.000     1.761845    1.945026
         22  |   1.853246   .0476376    38.90   0.000     1.759873    1.946619
         23  |   1.874713   .0481512    38.93   0.000     1.780333    1.969093
         24  |   1.681827    .050213    33.49   0.000     1.583406    1.780248
         25  |   1.695861   .0516349    32.84   0.000     1.594653    1.797069
         26  |   .5531406   .0544968    10.15   0.000     .4463232     .659958
         27  |   .6824467   .0490048    13.93   0.000      .586394    .7784994
         28  |   .9732812   .0462216    21.06   0.000     .8826838    1.063879
         29  |   1.076868   .0452517    23.80   0.000      .988171    1.165564
         30  |   1.187055   .0450499    26.35   0.000     1.098754    1.275356
         31  |   1.320056   .0448738    29.42   0.000       1.2321    1.408011
         32  |   1.492049    .044401    33.60   0.000      1.40502    1.579078
         33  |   1.627018   .0438539    37.10   0.000     1.541061    1.712974
         34  |   1.745098   .0439397    39.72   0.000     1.658973    1.831223
         35  |    1.81947   .0449257    40.50   0.000     1.731412    1.907527
         36  |   1.933991   .0452907    42.70   0.000     1.845218    2.022764
         37  |   2.031017   .0459743    44.18   0.000     1.940904     2.12113
         38  |   2.114048   .0458811    46.08   0.000     2.024117    2.203978
         39  |   2.141301   .0466185    45.93   0.000     2.049926    2.232677
         40  |   2.139239    .047812    44.74   0.000     2.045524    2.232954
         41  |   2.154037   .0482903    44.61   0.000     2.059385     2.24869
         42  |   2.168452   .0491384    44.13   0.000     2.072137    2.264767
         43  |   2.201272   .0503782    43.69   0.000     2.102528    2.300017
         44  |    2.16389    .051246    42.23   0.000     2.063444    2.264335
         45  |   2.138139   .0519865    41.13   0.000     2.036241    2.240036
         46  |   2.129915   .0531472    40.08   0.000     2.025742    2.234087
         47  |   2.132362   .0560208    38.06   0.000     2.022558    2.242167
         48  |   2.205574   .0564207    39.09   0.000     2.094986    2.316163
         49  |   2.148224   .0566159    37.94   0.000     2.037253    2.259195
         50  |   2.173806   .0573993    37.87   0.000     2.061299    2.286313
             |
     age_cat |
          1  |   .1570113   .0342837     4.58   0.000      .089813    .2242097
          2  |   .2622963   .0359262     7.30   0.000     .1918784    .3327142
          3  |   .3830171   .0369392    10.37   0.000     .3106137    .4554204
          4  |   .5253977   .0377995    13.90   0.000     .4513081    .5994874
          5  |   .5976854   .0385628    15.50   0.000     .5220997    .6732712
          6  |   .6582511   .0393175    16.74   0.000     .5811861    .7353162
          7  |   .7106194   .0399949    17.77   0.000     .6322267     .789012
          8  |   .7718301   .0406546    18.99   0.000     .6921442     .851516
          9  |   .8281083   .0412682    20.07   0.000     .7472198    .9089967
         10  |   .8657275   .0418476    20.69   0.000     .7837033    .9477517
         11  |   .9104452   .0425921    21.38   0.000     .8269617    .9939288
         12  |   .9765315   .0432348    22.59   0.000     .8917884    1.061275
         13  |    1.00702   .0442012    22.78   0.000     .9203831    1.093658
         14  |   1.058781   .0450374    23.51   0.000     .9705046    1.147057
         15  |   1.113624   .0458319    24.30   0.000      1.02379    1.203458
         16  |   1.143038   .0470394    24.30   0.000     1.050837    1.235238
         17  |   1.161072   .0481256    24.13   0.000     1.066743    1.255402
         18  |   1.194401   .0492238    24.26   0.000     1.097919    1.290883
         19  |   1.222992   .0507424    24.10   0.000     1.123533     1.32245
         20  |   1.300162   .0538627    24.14   0.000     1.194587    1.405736
         25  |   1.186578   .0671814    17.66   0.000     1.054898    1.318258
         30  |   .9895613   .0828506    11.94   0.000     .8271683    1.151954
         40  |   .8173125    .081887     9.98   0.000     .6568083    .9778167
         50  |    .692855   .1157801     5.98   0.000      .465918     .919792
             |
       _cons |   3.483004   .0445735    78.14   0.000     3.395637    3.570371
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. local fmt "%10.5f"

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }

. 
. estimates

----------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------

Linear regression                               Number of obs     =    368,493
                                                F(75, 22579)      =     180.95
                                                Prob > F          =     0.0000
                                                R-squared         =     0.1659
                                                Root MSE          =     1.6761

                                (Std. Err. adjusted for 22,580 clusters in id)
------------------------------------------------------------------------------
             |               Robust
        lnKL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .6019788   .0318333    18.91   0.000     .5395834    .6643743
       expat |   .0733702   .0412012     1.78   0.075    -.0073871    .1541274
             |
    ind_year |
          2  |    .185675   .0301525     6.16   0.000      .126574    .2447759
          3  |    .783923   .0341184    22.98   0.000     .7170485    .8507974
          4  |   .9728841   .0369289    26.34   0.000     .9005008    1.045267
          5  |   1.131543   .0378458    29.90   0.000     1.057363    1.205724
          6  |   1.393457       .039    35.73   0.000     1.317014    1.469899
          7  |   1.602531    .039542    40.53   0.000     1.525026    1.680035
          8  |   1.778821   .0397688    44.73   0.000     1.700872    1.856771
          9  |   1.898487   .0397722    47.73   0.000     1.820531    1.976443
         10  |   2.039878   .0397551    51.31   0.000     1.961955      2.1178
         11  |   2.123637   .0400234    53.06   0.000     2.045188    2.202086
         12  |   2.139174   .0405543    52.75   0.000     2.059685    2.218664
         13  |   2.136358   .0407958    52.37   0.000     2.056395     2.21632
         14  |   2.118085   .0412836    51.31   0.000     2.037167    2.199004
         15  |   2.049309   .0420291    48.76   0.000     1.966929    2.131689
         16  |   2.043286   .0425056    48.07   0.000     1.959972      2.1266
         17  |   2.028477   .0432607    46.89   0.000     1.943683    2.113271
         18  |   2.005034   .0441131    45.45   0.000     1.918569    2.091499
         19  |   1.934811   .0446073    43.37   0.000     1.847378    2.022244
         20  |    1.86375   .0455652    40.90   0.000     1.774439    1.953061
         21  |   1.853436   .0467282    39.66   0.000     1.761845    1.945026
         22  |   1.853246   .0476376    38.90   0.000     1.759873    1.946619
         23  |   1.874713   .0481512    38.93   0.000     1.780333    1.969093
         24  |   1.681827    .050213    33.49   0.000     1.583406    1.780248
         25  |   1.695861   .0516349    32.84   0.000     1.594653    1.797069
         26  |   .5531406   .0544968    10.15   0.000     .4463232     .659958
         27  |   .6824467   .0490048    13.93   0.000      .586394    .7784994
         28  |   .9732812   .0462216    21.06   0.000     .8826838    1.063879
         29  |   1.076868   .0452517    23.80   0.000      .988171    1.165564
         30  |   1.187055   .0450499    26.35   0.000     1.098754    1.275356
         31  |   1.320056   .0448738    29.42   0.000       1.2321    1.408011
         32  |   1.492049    .044401    33.60   0.000      1.40502    1.579078
         33  |   1.627018   .0438539    37.10   0.000     1.541061    1.712974
         34  |   1.745098   .0439397    39.72   0.000     1.658973    1.831223
         35  |    1.81947   .0449257    40.50   0.000     1.731412    1.907527
         36  |   1.933991   .0452907    42.70   0.000     1.845218    2.022764
         37  |   2.031017   .0459743    44.18   0.000     1.940904     2.12113
         38  |   2.114048   .0458811    46.08   0.000     2.024117    2.203978
         39  |   2.141301   .0466185    45.93   0.000     2.049926    2.232677
         40  |   2.139239    .047812    44.74   0.000     2.045524    2.232954
         41  |   2.154037   .0482903    44.61   0.000     2.059385     2.24869
         42  |   2.168452   .0491384    44.13   0.000     2.072137    2.264767
         43  |   2.201272   .0503782    43.69   0.000     2.102528    2.300017
         44  |    2.16389    .051246    42.23   0.000     2.063444    2.264335
         45  |   2.138139   .0519865    41.13   0.000     2.036241    2.240036
         46  |   2.129915   .0531472    40.08   0.000     2.025742    2.234087
         47  |   2.132362   .0560208    38.06   0.000     2.022558    2.242167
         48  |   2.205574   .0564207    39.09   0.000     2.094986    2.316163
         49  |   2.148224   .0566159    37.94   0.000     2.037253    2.259195
         50  |   2.173806   .0573993    37.87   0.000     2.061299    2.286313
             |
     age_cat |
          1  |   .1570113   .0342837     4.58   0.000      .089813    .2242097
          2  |   .2622963   .0359262     7.30   0.000     .1918784    .3327142
          3  |   .3830171   .0369392    10.37   0.000     .3106137    .4554204
          4  |   .5253977   .0377995    13.90   0.000     .4513081    .5994874
          5  |   .5976854   .0385628    15.50   0.000     .5220997    .6732712
          6  |   .6582511   .0393175    16.74   0.000     .5811861    .7353162
          7  |   .7106194   .0399949    17.77   0.000     .6322267     .789012
          8  |   .7718301   .0406546    18.99   0.000     .6921442     .851516
          9  |   .8281083   .0412682    20.07   0.000     .7472198    .9089967
         10  |   .8657275   .0418476    20.69   0.000     .7837033    .9477517
         11  |   .9104452   .0425921    21.38   0.000     .8269617    .9939288
         12  |   .9765315   .0432348    22.59   0.000     .8917884    1.061275
         13  |    1.00702   .0442012    22.78   0.000     .9203831    1.093658
         14  |   1.058781   .0450374    23.51   0.000     .9705046    1.147057
         15  |   1.113624   .0458319    24.30   0.000      1.02379    1.203458
         16  |   1.143038   .0470394    24.30   0.000     1.050837    1.235238
         17  |   1.161072   .0481256    24.13   0.000     1.066743    1.255402
         18  |   1.194401   .0492238    24.26   0.000     1.097919    1.290883
         19  |   1.222992   .0507424    24.10   0.000     1.123533     1.32245
         20  |   1.300162   .0538627    24.14   0.000     1.194587    1.405736
         25  |   1.186578   .0671814    17.66   0.000     1.054898    1.318258
         30  |   .9895613   .0828506    11.94   0.000     .8271683    1.151954
         40  |   .8173125    .081887     9.98   0.000     .6568083    .9778167
         50  |    .692855   .1157801     5.98   0.000      .465918     .919792
             |
       _cons |   3.483004   .0445735    78.14   0.000     3.395637    3.570371
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text repla
> ce

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b', "`fmt'")) _newline
  6.         file write `output' ("   standard_error: " + string(`se', "`fmt'")) _
> newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se', "`fmt'")) 
> _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',
> "pvalue"),colnumb(`coefs',"`X'")]), "`fmt'") _newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file

Fixed-effects (within) regression               Number of obs     =    368,493
Group variable: id                              Number of groups  =     22,580

R-sq:                                           Obs per group:
     within  = 0.1843                                         min =          1
     between = 0.1304                                         avg =       16.3
     overall = 0.1210                                         max =        181

                                                F(75,22579)       =     111.57
corr(u_i, Xb)  = 0.0560                         Prob > F          =     0.0000

                                (Std. Err. adjusted for 22,580 clusters in id)
------------------------------------------------------------------------------
             |               Robust
        lnKL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .1415735   .0373426     3.79   0.000     .0683795    .2147675
       expat |   .0211414   .0141629     1.49   0.136    -.0066188    .0489017
             |
    ind_year |
          2  |   .1497073   .0272646     5.49   0.000     .0962668    .2031479
          3  |   .7351146   .0339832    21.63   0.000     .6685053     .801724
          4  |   .8819861     .03874    22.77   0.000      .806053    .9579192
          5  |   1.036829   .0430342    24.09   0.000     .9524795     1.12118
          6  |   1.290084   .0470977    27.39   0.000     1.197769    1.382399
          7  |   1.560499   .0514694    30.32   0.000     1.459615    1.661382
          8  |    1.76544   .0560201    31.51   0.000     1.655637    1.875243
          9  |   1.902635   .0607935    31.30   0.000     1.783475    2.021794
         10  |   2.046441   .0657232    31.14   0.000     1.917619    2.175263
         11  |    2.19648    .070484    31.16   0.000     2.058326    2.334633
         12  |   2.253413   .0755747    29.82   0.000     2.105281    2.401545
         13  |    2.30071   .0808139    28.47   0.000     2.142309     2.45911
         14  |   2.314808   .0860409    26.90   0.000     2.146162    2.483454
         15  |   2.283007   .0915605    24.93   0.000     2.103543    2.462472
         16  |   2.310154   .0968799    23.85   0.000     2.120263    2.500045
         17  |   2.329513   .1026209    22.70   0.000     2.128368    2.530657
         18  |   2.328624   .1082845    21.50   0.000     2.116379    2.540869
         19  |   2.281317    .113748    20.06   0.000     2.058363    2.504271
         20  |   2.277278   .1190369    19.13   0.000     2.043957    2.510598
         21  |   2.297275   .1236433    18.58   0.000     2.054926    2.539625
         22  |   2.326195   .1281476    18.15   0.000     2.075017    2.577373
         23  |   2.427899    .132589    18.31   0.000     2.168016    2.687783
         24  |   2.200481   .1379237    15.95   0.000     1.930141    2.470821
         25  |   2.195085   .1432329    15.33   0.000     1.914338    2.475831
         26  |   .4697505    .063718     7.37   0.000     .3448588    .5946422
         27  |   .6036134   .0586452    10.29   0.000     .4886647     .718562
         28  |   .9016725   .0556223    16.21   0.000     .7926491    1.010696
         29  |   1.025351   .0552065    18.57   0.000     .9171429     1.13356
         30  |   1.144682    .056529    20.25   0.000     1.033881    1.255482
         31  |   1.308057   .0583122    22.43   0.000     1.193761    1.422353
         32  |   1.508351   .0608338    24.79   0.000     1.389113     1.62759
         33  |   1.668659   .0641155    26.03   0.000     1.542988     1.79433
         34  |   1.789903   .0678196    26.39   0.000     1.656972    1.922834
         35  |   1.885719   .0719982    26.19   0.000     1.744597     2.02684
         36  |   1.993021   .0765008    26.05   0.000     1.843074    2.142967
         37  |   2.080805   .0810818    25.66   0.000      1.92188    2.239731
         38  |   2.168726   .0854846    25.37   0.000      2.00117    2.336282
         39  |   2.185132   .0904307    24.16   0.000     2.007882    2.362383
         40  |   2.191401   .0954648    22.96   0.000     2.004283    2.378519
         41  |   2.212466   .1006419    21.98   0.000     2.015201    2.409731
         42  |   2.267577   .1061771    21.36   0.000     2.059463    2.475691
         43  |   2.308654   .1119392    20.62   0.000     2.089245    2.528062
         44  |   2.286007   .1177809    19.41   0.000     2.055148    2.516865
         45  |   2.306558   .1229013    18.77   0.000     2.065663    2.547453
         46  |   2.316636   .1281537    18.08   0.000     2.065446    2.567827
         47  |   2.348095   .1328151    17.68   0.000     2.087768    2.608421
         48  |    2.42994   .1370823    17.73   0.000     2.161249    2.698631
         49  |    2.32224   .1421813    16.33   0.000     2.043554    2.600925
         50  |   2.337834   .1467031    15.94   0.000     2.050286    2.625383
             |
     age_cat |
          1  |    .081608    .026675     3.06   0.002     .0293231    .1338928
          2  |   .1111849    .030022     3.70   0.000     .0523397    .1700301
          3  |   .1281167   .0336171     3.81   0.000     .0622248    .1940085
          4  |   .1597023   .0377139     4.23   0.000     .0857804    .2336242
          5  |   .1467331   .0422434     3.47   0.001     .0639332    .2295331
          6  |   .1294906   .0470557     2.75   0.006     .0372582    .2217229
          7  |   .1182489   .0520436     2.27   0.023     .0162399    .2202578
          8  |   .1182962   .0572961     2.06   0.039     .0059918    .2306005
          9  |   .1177054   .0626141     1.88   0.060    -.0050226    .2404334
         10  |   .1084685   .0680448     1.59   0.111    -.0249041     .241841
         11  |   .1060798   .0734952     1.44   0.149    -.0379759    .2501355
         12  |   .1136151   .0789176     1.44   0.150    -.0410688    .2682991
         13  |    .111181   .0844433     1.32   0.188    -.0543337    .2766957
         14  |   .1253427    .090053     1.39   0.164    -.0511674    .3018528
         15  |   .1389665    .095693     1.45   0.146    -.0485983    .3265313
         16  |   .1393548   .1016692     1.37   0.170    -.0599238    .3386333
         17  |   .1445334    .107599     1.34   0.179     -.066368    .3554348
         18  |   .1530164   .1134382     1.35   0.177    -.0693304    .3753632
         19  |   .1476029    .119703     1.23   0.218    -.0870233     .382229
         20  |   .1313013   .1316756     1.00   0.319     -.126792    .3893945
         25  |   .0666575   .1514143     0.44   0.660    -.2301249    .3634399
         30  |   .1458356   .1919185     0.76   0.447     -.230338    .5220091
         40  |   .2615494   .2274908     1.15   0.250    -.1843482    .7074471
         50  |   .2368631   .2645123     0.90   0.371    -.2815993    .7553254
             |
       _cons |   4.032238   .0452678    89.08   0.000      3.94351    4.120966
-------------+----------------------------------------------------------------
     sigma_u |  1.7157702
     sigma_e |   .8816198
         rho |  .79112384   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. local fmt "%10.5f"

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }
key: R2_within
value: .1843306955910378

. 
. estimates

----------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------

Fixed-effects (within) regression               Number of obs     =    368,493
Group variable: id                              Number of groups  =     22,580

R-sq:                                           Obs per group:
     within  = 0.1843                                         min =          1
     between = 0.1304                                         avg =       16.3
     overall = 0.1210                                         max =        181

                                                F(75,22579)       =     111.57
corr(u_i, Xb)  = 0.0560                         Prob > F          =     0.0000

                                (Std. Err. adjusted for 22,580 clusters in id)
------------------------------------------------------------------------------
             |               Robust
        lnKL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .1415735   .0373426     3.79   0.000     .0683795    .2147675
       expat |   .0211414   .0141629     1.49   0.136    -.0066188    .0489017
             |
    ind_year |
          2  |   .1497073   .0272646     5.49   0.000     .0962668    .2031479
          3  |   .7351146   .0339832    21.63   0.000     .6685053     .801724
          4  |   .8819861     .03874    22.77   0.000      .806053    .9579192
          5  |   1.036829   .0430342    24.09   0.000     .9524795     1.12118
          6  |   1.290084   .0470977    27.39   0.000     1.197769    1.382399
          7  |   1.560499   .0514694    30.32   0.000     1.459615    1.661382
          8  |    1.76544   .0560201    31.51   0.000     1.655637    1.875243
          9  |   1.902635   .0607935    31.30   0.000     1.783475    2.021794
         10  |   2.046441   .0657232    31.14   0.000     1.917619    2.175263
         11  |    2.19648    .070484    31.16   0.000     2.058326    2.334633
         12  |   2.253413   .0755747    29.82   0.000     2.105281    2.401545
         13  |    2.30071   .0808139    28.47   0.000     2.142309     2.45911
         14  |   2.314808   .0860409    26.90   0.000     2.146162    2.483454
         15  |   2.283007   .0915605    24.93   0.000     2.103543    2.462472
         16  |   2.310154   .0968799    23.85   0.000     2.120263    2.500045
         17  |   2.329513   .1026209    22.70   0.000     2.128368    2.530657
         18  |   2.328624   .1082845    21.50   0.000     2.116379    2.540869
         19  |   2.281317    .113748    20.06   0.000     2.058363    2.504271
         20  |   2.277278   .1190369    19.13   0.000     2.043957    2.510598
         21  |   2.297275   .1236433    18.58   0.000     2.054926    2.539625
         22  |   2.326195   .1281476    18.15   0.000     2.075017    2.577373
         23  |   2.427899    .132589    18.31   0.000     2.168016    2.687783
         24  |   2.200481   .1379237    15.95   0.000     1.930141    2.470821
         25  |   2.195085   .1432329    15.33   0.000     1.914338    2.475831
         26  |   .4697505    .063718     7.37   0.000     .3448588    .5946422
         27  |   .6036134   .0586452    10.29   0.000     .4886647     .718562
         28  |   .9016725   .0556223    16.21   0.000     .7926491    1.010696
         29  |   1.025351   .0552065    18.57   0.000     .9171429     1.13356
         30  |   1.144682    .056529    20.25   0.000     1.033881    1.255482
         31  |   1.308057   .0583122    22.43   0.000     1.193761    1.422353
         32  |   1.508351   .0608338    24.79   0.000     1.389113     1.62759
         33  |   1.668659   .0641155    26.03   0.000     1.542988     1.79433
         34  |   1.789903   .0678196    26.39   0.000     1.656972    1.922834
         35  |   1.885719   .0719982    26.19   0.000     1.744597     2.02684
         36  |   1.993021   .0765008    26.05   0.000     1.843074    2.142967
         37  |   2.080805   .0810818    25.66   0.000      1.92188    2.239731
         38  |   2.168726   .0854846    25.37   0.000      2.00117    2.336282
         39  |   2.185132   .0904307    24.16   0.000     2.007882    2.362383
         40  |   2.191401   .0954648    22.96   0.000     2.004283    2.378519
         41  |   2.212466   .1006419    21.98   0.000     2.015201    2.409731
         42  |   2.267577   .1061771    21.36   0.000     2.059463    2.475691
         43  |   2.308654   .1119392    20.62   0.000     2.089245    2.528062
         44  |   2.286007   .1177809    19.41   0.000     2.055148    2.516865
         45  |   2.306558   .1229013    18.77   0.000     2.065663    2.547453
         46  |   2.316636   .1281537    18.08   0.000     2.065446    2.567827
         47  |   2.348095   .1328151    17.68   0.000     2.087768    2.608421
         48  |    2.42994   .1370823    17.73   0.000     2.161249    2.698631
         49  |    2.32224   .1421813    16.33   0.000     2.043554    2.600925
         50  |   2.337834   .1467031    15.94   0.000     2.050286    2.625383
             |
     age_cat |
          1  |    .081608    .026675     3.06   0.002     .0293231    .1338928
          2  |   .1111849    .030022     3.70   0.000     .0523397    .1700301
          3  |   .1281167   .0336171     3.81   0.000     .0622248    .1940085
          4  |   .1597023   .0377139     4.23   0.000     .0857804    .2336242
          5  |   .1467331   .0422434     3.47   0.001     .0639332    .2295331
          6  |   .1294906   .0470557     2.75   0.006     .0372582    .2217229
          7  |   .1182489   .0520436     2.27   0.023     .0162399    .2202578
          8  |   .1182962   .0572961     2.06   0.039     .0059918    .2306005
          9  |   .1177054   .0626141     1.88   0.060    -.0050226    .2404334
         10  |   .1084685   .0680448     1.59   0.111    -.0249041     .241841
         11  |   .1060798   .0734952     1.44   0.149    -.0379759    .2501355
         12  |   .1136151   .0789176     1.44   0.150    -.0410688    .2682991
         13  |    .111181   .0844433     1.32   0.188    -.0543337    .2766957
         14  |   .1253427    .090053     1.39   0.164    -.0511674    .3018528
         15  |   .1389665    .095693     1.45   0.146    -.0485983    .3265313
         16  |   .1393548   .1016692     1.37   0.170    -.0599238    .3386333
         17  |   .1445334    .107599     1.34   0.179     -.066368    .3554348
         18  |   .1530164   .1134382     1.35   0.177    -.0693304    .3753632
         19  |   .1476029    .119703     1.23   0.218    -.0870233     .382229
         20  |   .1313013   .1316756     1.00   0.319     -.126792    .3893945
         25  |   .0666575   .1514143     0.44   0.660    -.2301249    .3634399
         30  |   .1458356   .1919185     0.76   0.447     -.230338    .5220091
         40  |   .2615494   .2274908     1.15   0.250    -.1843482    .7074471
         50  |   .2368631   .2645123     0.90   0.371    -.2815993    .7553254
             |
       _cons |   4.032238   .0452678    89.08   0.000      3.94351    4.120966
-------------+----------------------------------------------------------------
     sigma_u |  1.7157702
     sigma_e |   .8816198
         rho |  .79112384   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text repla
> ce

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b', "`fmt'")) _newline
  6.         file write `output' ("   standard_error: " + string(`se', "`fmt'")) _
> newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se', "`fmt'")) 
> _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',
> "pvalue"),colnumb(`coefs',"`X'")]), "`fmt'") _newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file
(sum of wgt is   1.1357e+05)

Linear regression                               Number of obs     =    288,264
                                                F(75, 18612)      =     163.81
                                                Prob > F          =     0.0000
                                                R-squared         =     0.1731
                                                Root MSE          =     1.6536

                                (Std. Err. adjusted for 18,613 clusters in id)
------------------------------------------------------------------------------
             |               Robust
        lnKL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .5462134   .0472799    11.55   0.000     .4535405    .6388862
       expat |   .0457748    .082481     0.55   0.579    -.1158955    .2074451
             |
    ind_year |
          2  |   .1685915   .0314136     5.37   0.000      .107018     .230165
          3  |    .769312    .035411    21.73   0.000     .6999033    .8387207
          4  |   .9616611   .0386036    24.91   0.000     .8859946    1.037328
          5  |   1.110545   .0396062    28.04   0.000     1.032913    1.188176
          6  |   1.378381   .0408661    33.73   0.000      1.29828    1.458482
          7  |   1.594343   .0414853    38.43   0.000     1.513029    1.675658
          8  |   1.772423   .0415579    42.65   0.000     1.690966     1.85388
          9  |   1.896889   .0415512    45.65   0.000     1.815444    1.978333
         10  |   2.034616   .0416171    48.89   0.000     1.953043    2.116189
         11  |   2.122421   .0419617    50.58   0.000     2.040172    2.204669
         12  |   2.148817   .0424433    50.63   0.000     2.065624    2.232009
         13  |   2.144822   .0428053    50.11   0.000      2.06092    2.228725
         14  |   2.118671   .0434717    48.74   0.000     2.033462    2.203879
         15  |   2.060014   .0442366    46.57   0.000     1.973306    2.146722
         16  |   2.060233   .0447633    46.03   0.000     1.972493    2.147973
         17  |   2.050176   .0455585    45.00   0.000     1.960877    2.139475
         18  |   2.024871   .0465712    43.48   0.000     1.933587    2.116155
         19  |   1.964009   .0470322    41.76   0.000     1.871821    2.056196
         20  |   1.890124   .0480357    39.35   0.000      1.79597    1.984279
         21  |   1.890551   .0495797    38.13   0.000      1.79337    1.987731
         22  |   1.894177   .0505049    37.50   0.000     1.795182    1.993171
         23  |   1.935671   .0511002    37.88   0.000      1.83551    2.035832
         24  |   1.750967   .0535017    32.73   0.000     1.646099    1.855835
         25  |   1.763954   .0551667    31.97   0.000     1.655822    1.872086
         26  |   .5153079   .0570312     9.04   0.000     .4035215    .6270944
         27  |   .6461392   .0513759    12.58   0.000     .5454376    .7468407
         28  |   .9389228   .0489299    19.19   0.000     .8430158     1.03483
         29  |   1.050214   .0482317    21.77   0.000     .9556753    1.144752
         30  |   1.162206   .0482562    24.08   0.000     1.067619    1.256792
         31  |   1.310573   .0478504    27.39   0.000     1.216782    1.404364
         32  |   1.495583   .0471558    31.72   0.000     1.403153    1.588012
         33  |   1.604457   .0469341    34.19   0.000     1.512462    1.696452
         34  |   1.735605   .0468071    37.08   0.000     1.643859    1.827352
         35  |   1.826215   .0482823    37.82   0.000     1.731577    1.920853
         36  |   1.962362   .0486277    40.35   0.000     1.867047    2.057677
         37  |   2.062472   .0493091    41.83   0.000     1.965822    2.159122
         38  |   2.124144   .0490541    43.30   0.000     2.027993    2.220294
         39  |   2.135531   .0500789    42.64   0.000     2.037371     2.23369
         40  |   2.117917   .0518584    40.84   0.000      2.01627    2.219564
         41  |   2.128781   .0523827    40.64   0.000     2.026106    2.231455
         42  |   2.138423   .0529812    40.36   0.000     2.034575    2.242271
         43  |   2.155515    .054644    39.45   0.000     2.048408    2.262623
         44  |   2.126122   .0558241    38.09   0.000     2.016701    2.235542
         45  |   2.110417   .0566476    37.26   0.000     1.999382    2.221451
         46  |   2.088971   .0581918    35.90   0.000      1.97491    2.203032
         47  |   2.112346   .0608157    34.73   0.000     1.993141     2.23155
         48  |   2.191823    .061124    35.86   0.000     2.072014    2.311632
         49  |   2.145395    .061731    34.75   0.000     2.024397    2.266394
         50  |    2.18209   .0630413    34.61   0.000     2.058524    2.305657
             |
     age_cat |
          1  |   .1133856   .0366634     3.09   0.002      .041522    .1852492
          2  |   .2378528   .0385326     6.17   0.000     .1623254    .3133801
          3  |   .3675162   .0396744     9.26   0.000     .2897507    .4452817
          4  |    .506024   .0406746    12.44   0.000     .4262981    .5857499
          5  |   .5846635    .041531    14.08   0.000      .503259     .666068
          6  |   .6510163   .0423287    15.38   0.000     .5680482    .7339843
          7  |   .7203863   .0430855    16.72   0.000     .6359348    .8048377
          8  |   .7947678   .0437839    18.15   0.000     .7089473    .8805882
          9  |   .8642015   .0444326    19.45   0.000     .7771097    .9512934
         10  |   .9107061   .0450464    20.22   0.000     .8224111    .9990011
         11  |   .9629091   .0459233    20.97   0.000     .8728953    1.052923
         12  |   1.032359   .0465699    22.17   0.000     .9410779     1.12364
         13  |   1.068278   .0477175    22.39   0.000     .9747473    1.161809
         14  |   1.120087   .0487004    23.00   0.000      1.02463    1.215544
         15  |   1.176534   .0496579    23.69   0.000     1.079199    1.273868
         16  |   1.197527   .0511081    23.43   0.000      1.09735    1.297703
         17  |   1.215145   .0522391    23.26   0.000     1.112751    1.317538
         18  |   1.251236   .0533987    23.43   0.000      1.14657    1.355902
         19  |   1.275352   .0550975    23.15   0.000     1.167356    1.383348
         20  |   1.339068   .0585682    22.86   0.000     1.224269    1.453867
         25  |   1.195876   .0727503    16.44   0.000     1.053279    1.338474
         30  |   1.012349   .0847434    11.95   0.000     .8462445    1.178454
         40  |   .8414148   .0830384    10.13   0.000     .6786519    1.004178
         50  |   .6979126   .1175188     5.94   0.000     .4675651    .9282601
             |
       _cons |   3.458241   .0468544    73.81   0.000     3.366402     3.55008
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. local fmt "%10.5f"

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }

. 
. estimates

----------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------

Linear regression                               Number of obs     =    288,264
                                                F(75, 18612)      =     163.81
                                                Prob > F          =     0.0000
                                                R-squared         =     0.1731
                                                Root MSE          =     1.6536

                                (Std. Err. adjusted for 18,613 clusters in id)
------------------------------------------------------------------------------
             |               Robust
        lnKL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .5462134   .0472799    11.55   0.000     .4535405    .6388862
       expat |   .0457748    .082481     0.55   0.579    -.1158955    .2074451
             |
    ind_year |
          2  |   .1685915   .0314136     5.37   0.000      .107018     .230165
          3  |    .769312    .035411    21.73   0.000     .6999033    .8387207
          4  |   .9616611   .0386036    24.91   0.000     .8859946    1.037328
          5  |   1.110545   .0396062    28.04   0.000     1.032913    1.188176
          6  |   1.378381   .0408661    33.73   0.000      1.29828    1.458482
          7  |   1.594343   .0414853    38.43   0.000     1.513029    1.675658
          8  |   1.772423   .0415579    42.65   0.000     1.690966     1.85388
          9  |   1.896889   .0415512    45.65   0.000     1.815444    1.978333
         10  |   2.034616   .0416171    48.89   0.000     1.953043    2.116189
         11  |   2.122421   .0419617    50.58   0.000     2.040172    2.204669
         12  |   2.148817   .0424433    50.63   0.000     2.065624    2.232009
         13  |   2.144822   .0428053    50.11   0.000      2.06092    2.228725
         14  |   2.118671   .0434717    48.74   0.000     2.033462    2.203879
         15  |   2.060014   .0442366    46.57   0.000     1.973306    2.146722
         16  |   2.060233   .0447633    46.03   0.000     1.972493    2.147973
         17  |   2.050176   .0455585    45.00   0.000     1.960877    2.139475
         18  |   2.024871   .0465712    43.48   0.000     1.933587    2.116155
         19  |   1.964009   .0470322    41.76   0.000     1.871821    2.056196
         20  |   1.890124   .0480357    39.35   0.000      1.79597    1.984279
         21  |   1.890551   .0495797    38.13   0.000      1.79337    1.987731
         22  |   1.894177   .0505049    37.50   0.000     1.795182    1.993171
         23  |   1.935671   .0511002    37.88   0.000      1.83551    2.035832
         24  |   1.750967   .0535017    32.73   0.000     1.646099    1.855835
         25  |   1.763954   .0551667    31.97   0.000     1.655822    1.872086
         26  |   .5153079   .0570312     9.04   0.000     .4035215    .6270944
         27  |   .6461392   .0513759    12.58   0.000     .5454376    .7468407
         28  |   .9389228   .0489299    19.19   0.000     .8430158     1.03483
         29  |   1.050214   .0482317    21.77   0.000     .9556753    1.144752
         30  |   1.162206   .0482562    24.08   0.000     1.067619    1.256792
         31  |   1.310573   .0478504    27.39   0.000     1.216782    1.404364
         32  |   1.495583   .0471558    31.72   0.000     1.403153    1.588012
         33  |   1.604457   .0469341    34.19   0.000     1.512462    1.696452
         34  |   1.735605   .0468071    37.08   0.000     1.643859    1.827352
         35  |   1.826215   .0482823    37.82   0.000     1.731577    1.920853
         36  |   1.962362   .0486277    40.35   0.000     1.867047    2.057677
         37  |   2.062472   .0493091    41.83   0.000     1.965822    2.159122
         38  |   2.124144   .0490541    43.30   0.000     2.027993    2.220294
         39  |   2.135531   .0500789    42.64   0.000     2.037371     2.23369
         40  |   2.117917   .0518584    40.84   0.000      2.01627    2.219564
         41  |   2.128781   .0523827    40.64   0.000     2.026106    2.231455
         42  |   2.138423   .0529812    40.36   0.000     2.034575    2.242271
         43  |   2.155515    .054644    39.45   0.000     2.048408    2.262623
         44  |   2.126122   .0558241    38.09   0.000     2.016701    2.235542
         45  |   2.110417   .0566476    37.26   0.000     1.999382    2.221451
         46  |   2.088971   .0581918    35.90   0.000      1.97491    2.203032
         47  |   2.112346   .0608157    34.73   0.000     1.993141     2.23155
         48  |   2.191823    .061124    35.86   0.000     2.072014    2.311632
         49  |   2.145395    .061731    34.75   0.000     2.024397    2.266394
         50  |    2.18209   .0630413    34.61   0.000     2.058524    2.305657
             |
     age_cat |
          1  |   .1133856   .0366634     3.09   0.002      .041522    .1852492
          2  |   .2378528   .0385326     6.17   0.000     .1623254    .3133801
          3  |   .3675162   .0396744     9.26   0.000     .2897507    .4452817
          4  |    .506024   .0406746    12.44   0.000     .4262981    .5857499
          5  |   .5846635    .041531    14.08   0.000      .503259     .666068
          6  |   .6510163   .0423287    15.38   0.000     .5680482    .7339843
          7  |   .7203863   .0430855    16.72   0.000     .6359348    .8048377
          8  |   .7947678   .0437839    18.15   0.000     .7089473    .8805882
          9  |   .8642015   .0444326    19.45   0.000     .7771097    .9512934
         10  |   .9107061   .0450464    20.22   0.000     .8224111    .9990011
         11  |   .9629091   .0459233    20.97   0.000     .8728953    1.052923
         12  |   1.032359   .0465699    22.17   0.000     .9410779     1.12364
         13  |   1.068278   .0477175    22.39   0.000     .9747473    1.161809
         14  |   1.120087   .0487004    23.00   0.000      1.02463    1.215544
         15  |   1.176534   .0496579    23.69   0.000     1.079199    1.273868
         16  |   1.197527   .0511081    23.43   0.000      1.09735    1.297703
         17  |   1.215145   .0522391    23.26   0.000     1.112751    1.317538
         18  |   1.251236   .0533987    23.43   0.000      1.14657    1.355902
         19  |   1.275352   .0550975    23.15   0.000     1.167356    1.383348
         20  |   1.339068   .0585682    22.86   0.000     1.224269    1.453867
         25  |   1.195876   .0727503    16.44   0.000     1.053279    1.338474
         30  |   1.012349   .0847434    11.95   0.000     .8462445    1.178454
         40  |   .8414148   .0830384    10.13   0.000     .6786519    1.004178
         50  |   .6979126   .1175188     5.94   0.000     .4675651    .9282601
             |
       _cons |   3.458241   .0468544    73.81   0.000     3.366402     3.55008
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text repla
> ce

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b', "`fmt'")) _newline
  6.         file write `output' ("   standard_error: " + string(`se', "`fmt'")) _
> newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se', "`fmt'")) 
> _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',
> "pvalue"),colnumb(`coefs',"`X'")]), "`fmt'") _newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file

Fixed-effects (within) regression               Number of obs     =    288,264
Group variable: id                              Number of groups  =     18,613

R-sq:                                           Obs per group:
     within  = 0.2101                                         min =          1
     between = 0.1340                                         avg =       15.5
     overall = 0.1361                                         max =        181

                                                F(75,18612)       =     107.37
corr(u_i, Xb)  = 0.0405                         Prob > F          =     0.0000

                                (Std. Err. adjusted for 18,613 clusters in id)
------------------------------------------------------------------------------
             |               Robust
        lnKL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0087947   .0460822     0.19   0.849    -.0815306    .0991201
       expat |   .0036263   .0387729     0.09   0.925     -.072372    .0796247
             |
    ind_year |
          2  |   .1397649   .0286571     4.88   0.000     .0835944    .1959353
          3  |   .7213338   .0358047    20.15   0.000     .6511532    .7915144
          4  |   .8708554   .0409358    21.27   0.000     .7906175    .9510933
          5  |   1.016091   .0454695    22.35   0.000     .9269664    1.105215
          6  |   1.265334   .0496852    25.47   0.000     1.167947    1.362722
          7  |   1.541194   .0543388    28.36   0.000     1.434685    1.647703
          8  |   1.750023   .0590805    29.62   0.000      1.63422    1.865826
          9  |   1.886788   .0640087    29.48   0.000     1.761325     2.01225
         10  |   2.030788   .0692522    29.32   0.000     1.895047    2.166528
         11  |   2.184349   .0742495    29.42   0.000     2.038813    2.329885
         12  |   2.242142    .079592    28.17   0.000     2.086134     2.39815
         13  |   2.293387   .0851438    26.94   0.000     2.126498    2.460277
         14  |   2.306551   .0906448    25.45   0.000     2.128879    2.484224
         15  |   2.278474   .0964223    23.63   0.000     2.089478    2.467471
         16  |   2.313797   .1019935    22.69   0.000     2.113881    2.513714
         17  |   2.338996   .1080684    21.64   0.000     2.127172     2.55082
         18  |   2.334688   .1139966    20.48   0.000     2.111244    2.558132
         19  |   2.284895   .1196061    19.10   0.000     2.050456    2.519334
         20  |   2.277022   .1251737    18.19   0.000      2.03167    2.522373
         21  |   2.299089    .129933    17.69   0.000     2.044408    2.553769
         22  |   2.334532   .1346668    17.34   0.000     2.070573    2.598491
         23  |    2.44744   .1393215    17.57   0.000     2.174357    2.720523
         24  |   2.245058   .1448612    15.50   0.000     1.961116    2.528999
         25  |   2.236466   .1504513    14.87   0.000     1.941568    2.531364
         26  |   .4304498   .0691103     6.23   0.000     .2949872    .5659124
         27  |   .5503519   .0631633     8.71   0.000     .4265461    .6741578
         28  |   .8384978   .0599246    13.99   0.000     .7210401    .9559556
         29  |   .9641158    .059408    16.23   0.000     .8476707    1.080561
         30  |   1.081595   .0606439    17.84   0.000     .9627273    1.200462
         31  |   1.241706   .0624301    19.89   0.000     1.119337    1.364075
         32  |   1.442449   .0649358    22.21   0.000     1.315169    1.569729
         33  |   1.591454   .0686306    23.19   0.000     1.456932    1.725977
         34  |   1.722435   .0723312    23.81   0.000     1.580659    1.864211
         35  |   1.828786    .076808    23.81   0.000     1.678235    1.979337
         36  |   1.963097   .0814647    24.10   0.000     1.803419    2.122776
         37  |   2.073747   .0861537    24.07   0.000     1.904878    2.242616
         38  |   2.150298   .0907269    23.70   0.000     1.972465    2.328131
         39  |   2.171764   .0958406    22.66   0.000     1.983907     2.35962
         40  |     2.1745   .1009937    21.53   0.000     1.976544    2.372457
         41  |   2.203113   .1064813    20.69   0.000       1.9944    2.411826
         42  |   2.261949   .1122557    20.15   0.000     2.041918    2.481981
         43  |   2.288616   .1184185    19.33   0.000     2.056504    2.520727
         44  |   2.265745   .1246203    18.18   0.000     2.021478    2.510012
         45  |   2.286377   .1300542    17.58   0.000     2.031459    2.541295
         46  |   2.283874   .1356001    16.84   0.000     2.018085    2.549662
         47  |   2.312081    .140433    16.46   0.000     2.036819    2.587342
         48  |   2.397142    .144733    16.56   0.000     2.113452    2.680832
         49  |   2.317769    .150077    15.44   0.000     2.023605    2.611934
         50  |   2.336817   .1547995    15.10   0.000     2.033395    2.640238
             |
     age_cat |
          1  |   .0811426   .0291149     2.79   0.005     .0240747    .1382104
          2  |   .1364115   .0327776     4.16   0.000     .0721645    .2006586
          3  |   .1703737   .0365392     4.66   0.000     .0987535    .2419939
          4  |   .2069425   .0408127     5.07   0.000     .1269458    .2869392
          5  |   .2043642   .0454966     4.49   0.000     .1151867    .2935418
          6  |   .1903599   .0504872     3.77   0.000     .0914004    .2893193
          7  |    .191849   .0556868     3.45   0.001     .0826977    .3010003
          8  |   .2008697   .0611819     3.28   0.001     .0809475    .3207919
          9  |   .2118683   .0666795     3.18   0.001     .0811703    .3425663
         10  |   .2117914   .0723558     2.93   0.003     .0699675    .3536153
         11  |   .2119522   .0780848     2.71   0.007     .0588988    .3650057
         12  |   .2212588   .0837152     2.64   0.008     .0571694    .3853482
         13  |   .2214004   .0895075     2.47   0.013     .0459575    .3968433
         14  |   .2369754   .0953958     2.48   0.013     .0499909    .4239598
         15  |   .2515771   .1013111     2.48   0.013     .0529981    .4501561
         16  |   .2484888   .1075942     2.31   0.021     .0375942    .4593833
         17  |   .2512493   .1137875     2.21   0.027     .0282154    .4742831
         18  |   .2669552   .1199122     2.23   0.026     .0319163    .5019942
         19  |   .2591333   .1264207     2.05   0.040     .0113372    .5069294
         20  |    .248326   .1389779     1.79   0.074    -.0240835    .5207354
         25  |   .1854632   .1597978     1.16   0.246    -.1277551    .4986814
         30  |   .2852935   .2016383     1.41   0.157    -.1099361    .6805231
         40  |   .3973412   .2379399     1.67   0.095    -.0690427    .8637251
         50  |   .3488557   .2764049     1.26   0.207    -.1929232    .8906347
             |
       _cons |    3.90659   .0469927    83.13   0.000      3.81448      3.9987
-------------+----------------------------------------------------------------
     sigma_u |  1.6736238
     sigma_e |  .87705819
         rho |  .78454405   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. local fmt "%10.5f"

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }
key: R2_within
value: .2100519788751093

. 
. estimates

----------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------

Fixed-effects (within) regression               Number of obs     =    288,264
Group variable: id                              Number of groups  =     18,613

R-sq:                                           Obs per group:
     within  = 0.2101                                         min =          1
     between = 0.1340                                         avg =       15.5
     overall = 0.1361                                         max =        181

                                                F(75,18612)       =     107.37
corr(u_i, Xb)  = 0.0405                         Prob > F          =     0.0000

                                (Std. Err. adjusted for 18,613 clusters in id)
------------------------------------------------------------------------------
             |               Robust
        lnKL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0087947   .0460822     0.19   0.849    -.0815306    .0991201
       expat |   .0036263   .0387729     0.09   0.925     -.072372    .0796247
             |
    ind_year |
          2  |   .1397649   .0286571     4.88   0.000     .0835944    .1959353
          3  |   .7213338   .0358047    20.15   0.000     .6511532    .7915144
          4  |   .8708554   .0409358    21.27   0.000     .7906175    .9510933
          5  |   1.016091   .0454695    22.35   0.000     .9269664    1.105215
          6  |   1.265334   .0496852    25.47   0.000     1.167947    1.362722
          7  |   1.541194   .0543388    28.36   0.000     1.434685    1.647703
          8  |   1.750023   .0590805    29.62   0.000      1.63422    1.865826
          9  |   1.886788   .0640087    29.48   0.000     1.761325     2.01225
         10  |   2.030788   .0692522    29.32   0.000     1.895047    2.166528
         11  |   2.184349   .0742495    29.42   0.000     2.038813    2.329885
         12  |   2.242142    .079592    28.17   0.000     2.086134     2.39815
         13  |   2.293387   .0851438    26.94   0.000     2.126498    2.460277
         14  |   2.306551   .0906448    25.45   0.000     2.128879    2.484224
         15  |   2.278474   .0964223    23.63   0.000     2.089478    2.467471
         16  |   2.313797   .1019935    22.69   0.000     2.113881    2.513714
         17  |   2.338996   .1080684    21.64   0.000     2.127172     2.55082
         18  |   2.334688   .1139966    20.48   0.000     2.111244    2.558132
         19  |   2.284895   .1196061    19.10   0.000     2.050456    2.519334
         20  |   2.277022   .1251737    18.19   0.000      2.03167    2.522373
         21  |   2.299089    .129933    17.69   0.000     2.044408    2.553769
         22  |   2.334532   .1346668    17.34   0.000     2.070573    2.598491
         23  |    2.44744   .1393215    17.57   0.000     2.174357    2.720523
         24  |   2.245058   .1448612    15.50   0.000     1.961116    2.528999
         25  |   2.236466   .1504513    14.87   0.000     1.941568    2.531364
         26  |   .4304498   .0691103     6.23   0.000     .2949872    .5659124
         27  |   .5503519   .0631633     8.71   0.000     .4265461    .6741578
         28  |   .8384978   .0599246    13.99   0.000     .7210401    .9559556
         29  |   .9641158    .059408    16.23   0.000     .8476707    1.080561
         30  |   1.081595   .0606439    17.84   0.000     .9627273    1.200462
         31  |   1.241706   .0624301    19.89   0.000     1.119337    1.364075
         32  |   1.442449   .0649358    22.21   0.000     1.315169    1.569729
         33  |   1.591454   .0686306    23.19   0.000     1.456932    1.725977
         34  |   1.722435   .0723312    23.81   0.000     1.580659    1.864211
         35  |   1.828786    .076808    23.81   0.000     1.678235    1.979337
         36  |   1.963097   .0814647    24.10   0.000     1.803419    2.122776
         37  |   2.073747   .0861537    24.07   0.000     1.904878    2.242616
         38  |   2.150298   .0907269    23.70   0.000     1.972465    2.328131
         39  |   2.171764   .0958406    22.66   0.000     1.983907     2.35962
         40  |     2.1745   .1009937    21.53   0.000     1.976544    2.372457
         41  |   2.203113   .1064813    20.69   0.000       1.9944    2.411826
         42  |   2.261949   .1122557    20.15   0.000     2.041918    2.481981
         43  |   2.288616   .1184185    19.33   0.000     2.056504    2.520727
         44  |   2.265745   .1246203    18.18   0.000     2.021478    2.510012
         45  |   2.286377   .1300542    17.58   0.000     2.031459    2.541295
         46  |   2.283874   .1356001    16.84   0.000     2.018085    2.549662
         47  |   2.312081    .140433    16.46   0.000     2.036819    2.587342
         48  |   2.397142    .144733    16.56   0.000     2.113452    2.680832
         49  |   2.317769    .150077    15.44   0.000     2.023605    2.611934
         50  |   2.336817   .1547995    15.10   0.000     2.033395    2.640238
             |
     age_cat |
          1  |   .0811426   .0291149     2.79   0.005     .0240747    .1382104
          2  |   .1364115   .0327776     4.16   0.000     .0721645    .2006586
          3  |   .1703737   .0365392     4.66   0.000     .0987535    .2419939
          4  |   .2069425   .0408127     5.07   0.000     .1269458    .2869392
          5  |   .2043642   .0454966     4.49   0.000     .1151867    .2935418
          6  |   .1903599   .0504872     3.77   0.000     .0914004    .2893193
          7  |    .191849   .0556868     3.45   0.001     .0826977    .3010003
          8  |   .2008697   .0611819     3.28   0.001     .0809475    .3207919
          9  |   .2118683   .0666795     3.18   0.001     .0811703    .3425663
         10  |   .2117914   .0723558     2.93   0.003     .0699675    .3536153
         11  |   .2119522   .0780848     2.71   0.007     .0588988    .3650057
         12  |   .2212588   .0837152     2.64   0.008     .0571694    .3853482
         13  |   .2214004   .0895075     2.47   0.013     .0459575    .3968433
         14  |   .2369754   .0953958     2.48   0.013     .0499909    .4239598
         15  |   .2515771   .1013111     2.48   0.013     .0529981    .4501561
         16  |   .2484888   .1075942     2.31   0.021     .0375942    .4593833
         17  |   .2512493   .1137875     2.21   0.027     .0282154    .4742831
         18  |   .2669552   .1199122     2.23   0.026     .0319163    .5019942
         19  |   .2591333   .1264207     2.05   0.040     .0113372    .5069294
         20  |    .248326   .1389779     1.79   0.074    -.0240835    .5207354
         25  |   .1854632   .1597978     1.16   0.246    -.1277551    .4986814
         30  |   .2852935   .2016383     1.41   0.157    -.1099361    .6805231
         40  |   .3973412   .2379399     1.67   0.095    -.0690427    .8637251
         50  |   .3488557   .2764049     1.26   0.207    -.1929232    .8906347
             |
       _cons |    3.90659   .0469927    83.13   0.000      3.81448      3.9987
-------------+----------------------------------------------------------------
     sigma_u |  1.6736238
     sigma_e |  .87705819
         rho |  .78454405   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text repla
> ce

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b', "`fmt'")) _newline
  6.         file write `output' ("   standard_error: " + string(`se', "`fmt'")) _
> newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se', "`fmt'")) 
> _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',
> "pvalue"),colnumb(`coefs',"`X'")]), "`fmt'") _newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file
(sum of wgt is   1.3350e+05)

Linear regression                               Number of obs     =    368,493
                                                F(75, 22579)      =     258.16
                                                Prob > F          =     0.0000
                                                R-squared         =     0.2348
                                                Root MSE          =     1.1467

                                (Std. Err. adjusted for 22,580 clusters in id)
------------------------------------------------------------------------------
             |               Robust
        lnQL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .6641039   .0233422    28.45   0.000     .6183516    .7098562
       expat |  -.0762539   .0284942    -2.68   0.007    -.1321046   -.0204033
             |
    ind_year |
          2  |   .1337671   .0224068     5.97   0.000     .0898481     .177686
          3  |   .3431765   .0259649    13.22   0.000     .2922834    .3940695
          4  |   .5655051   .0275487    20.53   0.000     .5115079    .6195024
          5  |   .7549266   .0286422    26.36   0.000     .6987858    .8110673
          6  |    .946746   .0293813    32.22   0.000     .8891567    1.004335
          7  |   1.061389   .0299622    35.42   0.000     1.002661    1.120117
          8  |   1.141149   .0300138    38.02   0.000      1.08232    1.199978
          9  |   1.251685   .0300715    41.62   0.000     1.192743    1.310627
         10  |    1.35695   .0301929    44.94   0.000     1.297769     1.41613
         11  |   1.364878   .0307112    44.44   0.000     1.304682    1.425074
         12  |   1.379622   .0310929    44.37   0.000     1.318678    1.440566
         13  |   1.397646   .0312611    44.71   0.000     1.336372     1.45892
         14  |    1.41224   .0317383    44.50   0.000     1.350031     1.47445
         15  |   1.463943   .0319197    45.86   0.000     1.401378    1.526508
         16  |   1.472914   .0316729    46.50   0.000     1.410833    1.534995
         17  |   1.509956    .032012    47.17   0.000      1.44721    1.572702
         18  |   1.430335   .0324487    44.08   0.000     1.366733    1.493937
         19  |   1.442068    .032369    44.55   0.000     1.378623    1.505514
         20  |   1.487262   .0329667    45.11   0.000     1.422645    1.551879
         21  |   1.490053   .0337184    44.19   0.000     1.423962    1.556143
         22  |   1.511137   .0342686    44.10   0.000     1.443968    1.578306
         23  |   1.567867   .0343996    45.58   0.000     1.500441    1.635292
         24  |   1.630865    .035356    46.13   0.000     1.561565    1.700166
         25  |   1.648233   .0358512    45.97   0.000     1.577962    1.718503
         26  |  -.5276383   .0368308   -14.33   0.000    -.5998293   -.4554474
         27  |  -.3860549   .0346823   -11.13   0.000    -.4540346   -.3180751
         28  |  -.1935598   .0338712    -5.71   0.000    -.2599497   -.1271698
         29  |   .0562996   .0337878     1.67   0.096    -.0099269    .1225261
         30  |   .1955196   .0344692     5.67   0.000     .1279577    .2630816
         31  |   .3527659   .0339642    10.39   0.000     .2861937    .4193381
         32  |   .4743691   .0330723    14.34   0.000     .4095452     .539193
         33  |   .5259185   .0327217    16.07   0.000     .4617818    .5900553
         34  |   .6627054   .0332072    19.96   0.000     .5976171    .7277938
         35  |   .7371934   .0330486    22.31   0.000     .6724158     .801971
         36  |   .8109284   .0330521    24.53   0.000      .746144    .8757128
         37  |   .8701615   .0335249    25.96   0.000     .8044504    .9358726
         38  |    .944149   .0335658    28.13   0.000     .8783577     1.00994
         39  |    1.00027   .0339378    29.47   0.000     .9337496    1.066791
         40  |   1.087718   .0349499    31.12   0.000     1.019214    1.156223
         41  |   1.147707   .0345713    33.20   0.000     1.079945    1.215469
         42  |   1.211088   .0345532    35.05   0.000     1.143362    1.278815
         43  |   1.197843   .0352479    33.98   0.000     1.128754    1.266931
         44  |   1.239021   .0358348    34.58   0.000     1.168782     1.30926
         45  |   1.298373   .0365797    35.49   0.000     1.226674    1.370072
         46  |   1.318412   .0369494    35.68   0.000     1.245989    1.390836
         47  |   1.340611    .037452    35.80   0.000     1.267202    1.414019
         48  |   1.408325   .0376161    37.44   0.000     1.334595    1.482056
         49  |   1.467235   .0388419    37.77   0.000     1.391102    1.543368
         50  |   1.498815   .0386861    38.74   0.000     1.422987    1.574642
             |
     age_cat |
          1  |   .2996796   .0224455    13.35   0.000      .255685    .3436743
          2  |   .3688279   .0233367    15.80   0.000     .3230863    .4145695
          3  |   .4182363   .0238997    17.50   0.000     .3713913    .4650813
          4  |   .4618431   .0245785    18.79   0.000     .4136675    .5100187
          5  |   .4949952   .0251244    19.70   0.000     .4457497    .5442408
          6  |    .518961   .0256264    20.25   0.000     .4687314    .5691906
          7  |   .5529018   .0261698    21.13   0.000     .5016072    .6041964
          8  |   .5750609   .0266024    21.62   0.000     .5229183    .6272035
          9  |   .6102749    .027194    22.44   0.000     .5569727    .6635771
         10  |   .6244563   .0276176    22.61   0.000     .5703238    .6785888
         11  |    .662213   .0281896    23.49   0.000     .6069595    .7174666
         12  |   .6835556   .0287934    23.74   0.000     .6271185    .7399926
         13  |   .7119884   .0294054    24.21   0.000     .6543518    .7696249
         14  |   .7428184   .0298948    24.85   0.000     .6842225    .8014143
         15  |   .7684475   .0305983    25.11   0.000     .7084728    .8284222
         16  |   .7835364   .0311573    25.15   0.000      .722466    .8446068
         17  |   .7831656   .0319809    24.49   0.000     .7204808    .8458503
         18  |   .7970707   .0325256    24.51   0.000     .7333183     .860823
         19  |   .7992029   .0335345    23.83   0.000      .733473    .8649328
         20  |   .8130869   .0356312    22.82   0.000     .7432473    .8829266
         25  |   .7288632   .0445583    16.36   0.000     .6415258    .8162006
         30  |   .1456881    .054788     2.66   0.008     .0382998    .2530764
         40  |   .0411098   .0468042     0.88   0.380    -.0506296    .1328492
         50  |   .2907048   .0618429     4.70   0.000     .1694885    .4119211
             |
       _cons |   7.246955    .032177   225.22   0.000     7.183886    7.310024
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. local fmt "%10.5f"

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }

. 
. estimates

----------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------

Linear regression                               Number of obs     =    368,493
                                                F(75, 22579)      =     258.16
                                                Prob > F          =     0.0000
                                                R-squared         =     0.2348
                                                Root MSE          =     1.1467

                                (Std. Err. adjusted for 22,580 clusters in id)
------------------------------------------------------------------------------
             |               Robust
        lnQL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .6641039   .0233422    28.45   0.000     .6183516    .7098562
       expat |  -.0762539   .0284942    -2.68   0.007    -.1321046   -.0204033
             |
    ind_year |
          2  |   .1337671   .0224068     5.97   0.000     .0898481     .177686
          3  |   .3431765   .0259649    13.22   0.000     .2922834    .3940695
          4  |   .5655051   .0275487    20.53   0.000     .5115079    .6195024
          5  |   .7549266   .0286422    26.36   0.000     .6987858    .8110673
          6  |    .946746   .0293813    32.22   0.000     .8891567    1.004335
          7  |   1.061389   .0299622    35.42   0.000     1.002661    1.120117
          8  |   1.141149   .0300138    38.02   0.000      1.08232    1.199978
          9  |   1.251685   .0300715    41.62   0.000     1.192743    1.310627
         10  |    1.35695   .0301929    44.94   0.000     1.297769     1.41613
         11  |   1.364878   .0307112    44.44   0.000     1.304682    1.425074
         12  |   1.379622   .0310929    44.37   0.000     1.318678    1.440566
         13  |   1.397646   .0312611    44.71   0.000     1.336372     1.45892
         14  |    1.41224   .0317383    44.50   0.000     1.350031     1.47445
         15  |   1.463943   .0319197    45.86   0.000     1.401378    1.526508
         16  |   1.472914   .0316729    46.50   0.000     1.410833    1.534995
         17  |   1.509956    .032012    47.17   0.000      1.44721    1.572702
         18  |   1.430335   .0324487    44.08   0.000     1.366733    1.493937
         19  |   1.442068    .032369    44.55   0.000     1.378623    1.505514
         20  |   1.487262   .0329667    45.11   0.000     1.422645    1.551879
         21  |   1.490053   .0337184    44.19   0.000     1.423962    1.556143
         22  |   1.511137   .0342686    44.10   0.000     1.443968    1.578306
         23  |   1.567867   .0343996    45.58   0.000     1.500441    1.635292
         24  |   1.630865    .035356    46.13   0.000     1.561565    1.700166
         25  |   1.648233   .0358512    45.97   0.000     1.577962    1.718503
         26  |  -.5276383   .0368308   -14.33   0.000    -.5998293   -.4554474
         27  |  -.3860549   .0346823   -11.13   0.000    -.4540346   -.3180751
         28  |  -.1935598   .0338712    -5.71   0.000    -.2599497   -.1271698
         29  |   .0562996   .0337878     1.67   0.096    -.0099269    .1225261
         30  |   .1955196   .0344692     5.67   0.000     .1279577    .2630816
         31  |   .3527659   .0339642    10.39   0.000     .2861937    .4193381
         32  |   .4743691   .0330723    14.34   0.000     .4095452     .539193
         33  |   .5259185   .0327217    16.07   0.000     .4617818    .5900553
         34  |   .6627054   .0332072    19.96   0.000     .5976171    .7277938
         35  |   .7371934   .0330486    22.31   0.000     .6724158     .801971
         36  |   .8109284   .0330521    24.53   0.000      .746144    .8757128
         37  |   .8701615   .0335249    25.96   0.000     .8044504    .9358726
         38  |    .944149   .0335658    28.13   0.000     .8783577     1.00994
         39  |    1.00027   .0339378    29.47   0.000     .9337496    1.066791
         40  |   1.087718   .0349499    31.12   0.000     1.019214    1.156223
         41  |   1.147707   .0345713    33.20   0.000     1.079945    1.215469
         42  |   1.211088   .0345532    35.05   0.000     1.143362    1.278815
         43  |   1.197843   .0352479    33.98   0.000     1.128754    1.266931
         44  |   1.239021   .0358348    34.58   0.000     1.168782     1.30926
         45  |   1.298373   .0365797    35.49   0.000     1.226674    1.370072
         46  |   1.318412   .0369494    35.68   0.000     1.245989    1.390836
         47  |   1.340611    .037452    35.80   0.000     1.267202    1.414019
         48  |   1.408325   .0376161    37.44   0.000     1.334595    1.482056
         49  |   1.467235   .0388419    37.77   0.000     1.391102    1.543368
         50  |   1.498815   .0386861    38.74   0.000     1.422987    1.574642
             |
     age_cat |
          1  |   .2996796   .0224455    13.35   0.000      .255685    .3436743
          2  |   .3688279   .0233367    15.80   0.000     .3230863    .4145695
          3  |   .4182363   .0238997    17.50   0.000     .3713913    .4650813
          4  |   .4618431   .0245785    18.79   0.000     .4136675    .5100187
          5  |   .4949952   .0251244    19.70   0.000     .4457497    .5442408
          6  |    .518961   .0256264    20.25   0.000     .4687314    .5691906
          7  |   .5529018   .0261698    21.13   0.000     .5016072    .6041964
          8  |   .5750609   .0266024    21.62   0.000     .5229183    .6272035
          9  |   .6102749    .027194    22.44   0.000     .5569727    .6635771
         10  |   .6244563   .0276176    22.61   0.000     .5703238    .6785888
         11  |    .662213   .0281896    23.49   0.000     .6069595    .7174666
         12  |   .6835556   .0287934    23.74   0.000     .6271185    .7399926
         13  |   .7119884   .0294054    24.21   0.000     .6543518    .7696249
         14  |   .7428184   .0298948    24.85   0.000     .6842225    .8014143
         15  |   .7684475   .0305983    25.11   0.000     .7084728    .8284222
         16  |   .7835364   .0311573    25.15   0.000      .722466    .8446068
         17  |   .7831656   .0319809    24.49   0.000     .7204808    .8458503
         18  |   .7970707   .0325256    24.51   0.000     .7333183     .860823
         19  |   .7992029   .0335345    23.83   0.000      .733473    .8649328
         20  |   .8130869   .0356312    22.82   0.000     .7432473    .8829266
         25  |   .7288632   .0445583    16.36   0.000     .6415258    .8162006
         30  |   .1456881    .054788     2.66   0.008     .0382998    .2530764
         40  |   .0411098   .0468042     0.88   0.380    -.0506296    .1328492
         50  |   .2907048   .0618429     4.70   0.000     .1694885    .4119211
             |
       _cons |   7.246955    .032177   225.22   0.000     7.183886    7.310024
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text repla
> ce

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b', "`fmt'")) _newline
  6.         file write `output' ("   standard_error: " + string(`se', "`fmt'")) _
> newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se', "`fmt'")) 
> _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',
> "pvalue"),colnumb(`coefs',"`X'")]), "`fmt'") _newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file

Fixed-effects (within) regression               Number of obs     =    368,493
Group variable: id                              Number of groups  =     22,580

R-sq:                                           Obs per group:
     within  = 0.2853                                         min =          1
     between = 0.2418                                         avg =       16.3
     overall = 0.1799                                         max =        181

                                                F(75,22579)       =     191.55
corr(u_i, Xb)  = 0.0642                         Prob > F          =     0.0000

                                (Std. Err. adjusted for 22,580 clusters in id)
------------------------------------------------------------------------------
             |               Robust
        lnQL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0799945   .0209102     3.83   0.000     .0390089      .12098
       expat |    .014696   .0091009     1.61   0.106    -.0031424    .0325344
             |
    ind_year |
          2  |   .0926739    .016765     5.53   0.000     .0598134    .1255345
          3  |   .2547099   .0201766    12.62   0.000     .2151624    .2942574
          4  |   .4250318   .0223761    18.99   0.000     .3811731    .4688906
          5  |   .5934229   .0244709    24.25   0.000     .5454583    .6413876
          6  |   .7855013   .0266256    29.50   0.000     .7333133    .8376893
          7  |   .9218826   .0288697    31.93   0.000      .865296    .9784692
          8  |   1.008968   .0309385    32.61   0.000     .9483269     1.06961
          9  |   1.123609   .0332581    33.78   0.000     1.058421    1.188797
         10  |   1.247247   .0356883    34.95   0.000     1.177296    1.317199
         11  |    1.31387   .0381152    34.47   0.000     1.239161    1.388578
         12  |   1.347672   .0408046    33.03   0.000     1.267692    1.427651
         13  |    1.39646   .0432111    32.32   0.000     1.311763    1.481157
         14  |   1.445782   .0455234    31.76   0.000     1.356553    1.535011
         15  |   1.516947   .0482766    31.42   0.000     1.422321    1.611572
         16  |   1.551377   .0506434    30.63   0.000     1.452112    1.650642
         17  |   1.607234   .0535069    30.04   0.000     1.502357    1.712112
         18  |   1.545836   .0561257    27.54   0.000     1.435826    1.655846
         19  |   1.572738   .0585943    26.84   0.000     1.457889    1.687587
         20  |   1.633778   .0611408    26.72   0.000     1.513938    1.753619
         21  |   1.655228   .0635948    26.03   0.000     1.530578    1.779878
         22  |   1.706019    .065796    25.93   0.000     1.577054    1.834983
         23  |   1.761676   .0680871    25.87   0.000     1.628221    1.895132
         24  |   1.788846   .0707107    25.30   0.000     1.650248    1.927444
         25  |   1.796025   .0729999    24.60   0.000     1.652941     1.93911
         26  |  -.2961314   .0371958    -7.96   0.000    -.3690378    -.223225
         27  |  -.1718103   .0355108    -4.84   0.000     -.241414   -.1022067
         28  |   .0057384   .0342049     0.17   0.867    -.0613056    .0727823
         29  |   .2455409    .034482     7.12   0.000     .1779538     .313128
         30  |   .3996033   .0348719    11.46   0.000      .331252    .4679546
         31  |   .5714925   .0355349    16.08   0.000     .5018416    .6411433
         32  |   .7165352   .0362652    19.76   0.000     .6454529    .7876174
         33  |    .798658   .0374126    21.35   0.000     .7253268    .8719891
         34  |   .9512298   .0391171    24.32   0.000     .8745575    1.027902
         35  |   1.043893   .0406536    25.68   0.000     .9642093    1.123577
         36  |   1.103638   .0429493    25.70   0.000     1.019454    1.187822
         37  |    1.17119   .0449398    26.06   0.000     1.083105    1.259275
         38  |   1.249253    .047187    26.47   0.000     1.156763    1.341743
         39  |   1.302391   .0494314    26.35   0.000     1.205502    1.399279
         40  |    1.40549   .0524703    26.79   0.000     1.302645    1.508335
         41  |   1.472632   .0543139    27.11   0.000     1.366173    1.579091
         42  |   1.547998   .0564569    27.42   0.000     1.437339    1.658658
         43  |   1.527874   .0591698    25.82   0.000     1.411897    1.643851
         44  |   1.588083   .0617916    25.70   0.000     1.466967    1.709199
         45  |   1.662404   .0642695    25.87   0.000     1.536432    1.788377
         46  |   1.675817   .0665726    25.17   0.000      1.54533    1.806304
         47  |   1.708935     .06861    24.91   0.000     1.574455    1.843415
         48  |   1.780307   .0705985    25.22   0.000     1.641929    1.918685
         49  |   1.801137   .0732525    24.59   0.000     1.657557    1.944717
         50  |   1.831814   .0755633    24.24   0.000     1.683705    1.979923
             |
     age_cat |
          1  |   .2493564   .0156188    15.97   0.000     .2187425    .2799703
          2  |   .2727515   .0171961    15.86   0.000     .2390459    .3064571
          3  |   .2628509   .0189287    13.89   0.000     .2257493    .2999524
          4  |   .2510376   .0208212    12.06   0.000     .2102267    .2918485
          5  |   .2378948   .0229202    10.38   0.000     .1929697      .28282
          6  |   .2263685   .0251842     8.99   0.000     .1770057    .2757312
          7  |   .2267002   .0276011     8.21   0.000     .1726002    .2808002
          8  |   .2061035   .0300979     6.85   0.000     .1471096    .2650974
          9  |   .1974202   .0326879     6.04   0.000     .1333498    .2614907
         10  |   .1822139   .0353266     5.16   0.000     .1129713    .2514565
         11  |   .1832895   .0380441     4.82   0.000     .1087204    .2578587
         12  |   .1692222   .0408257     4.14   0.000     .0892009    .2492434
         13  |   .1654355    .043528     3.80   0.000     .0801177    .2507534
         14  |   .1649242    .046312     3.56   0.000     .0741495    .2556988
         15  |   .1640635   .0491127     3.34   0.001     .0677991    .2603278
         16  |   .1563787   .0518582     3.02   0.003      .054733    .2580244
         17  |   .1398642    .054883     2.55   0.011     .0322897    .2474388
         18  |   .1390989   .0577194     2.41   0.016     .0259649    .2522328
         19  |   .1152638      .0608     1.90   0.058    -.0039084     .234436
         20  |   .0901971   .0664985     1.36   0.175    -.0401446    .2205388
         25  |   .0421133   .0762429     0.55   0.581    -.1073281    .1915547
         30  |   .1062659   .1041828     1.02   0.308    -.0979395    .3104714
         40  |    .151407   .1194433     1.27   0.205    -.0827101    .3855241
         50  |   .1470122   .1343385     1.09   0.274    -.1163005    .4103248
             |
       _cons |   7.575115    .026912   281.48   0.000     7.522365    7.627864
-------------+----------------------------------------------------------------
     sigma_u |  1.1758608
     sigma_e |  .52942848
         rho |  .83144672   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. local fmt "%10.5f"

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }
key: R2_within
value: .2852793957531494

. 
. estimates

----------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------

Fixed-effects (within) regression               Number of obs     =    368,493
Group variable: id                              Number of groups  =     22,580

R-sq:                                           Obs per group:
     within  = 0.2853                                         min =          1
     between = 0.2418                                         avg =       16.3
     overall = 0.1799                                         max =        181

                                                F(75,22579)       =     191.55
corr(u_i, Xb)  = 0.0642                         Prob > F          =     0.0000

                                (Std. Err. adjusted for 22,580 clusters in id)
------------------------------------------------------------------------------
             |               Robust
        lnQL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0799945   .0209102     3.83   0.000     .0390089      .12098
       expat |    .014696   .0091009     1.61   0.106    -.0031424    .0325344
             |
    ind_year |
          2  |   .0926739    .016765     5.53   0.000     .0598134    .1255345
          3  |   .2547099   .0201766    12.62   0.000     .2151624    .2942574
          4  |   .4250318   .0223761    18.99   0.000     .3811731    .4688906
          5  |   .5934229   .0244709    24.25   0.000     .5454583    .6413876
          6  |   .7855013   .0266256    29.50   0.000     .7333133    .8376893
          7  |   .9218826   .0288697    31.93   0.000      .865296    .9784692
          8  |   1.008968   .0309385    32.61   0.000     .9483269     1.06961
          9  |   1.123609   .0332581    33.78   0.000     1.058421    1.188797
         10  |   1.247247   .0356883    34.95   0.000     1.177296    1.317199
         11  |    1.31387   .0381152    34.47   0.000     1.239161    1.388578
         12  |   1.347672   .0408046    33.03   0.000     1.267692    1.427651
         13  |    1.39646   .0432111    32.32   0.000     1.311763    1.481157
         14  |   1.445782   .0455234    31.76   0.000     1.356553    1.535011
         15  |   1.516947   .0482766    31.42   0.000     1.422321    1.611572
         16  |   1.551377   .0506434    30.63   0.000     1.452112    1.650642
         17  |   1.607234   .0535069    30.04   0.000     1.502357    1.712112
         18  |   1.545836   .0561257    27.54   0.000     1.435826    1.655846
         19  |   1.572738   .0585943    26.84   0.000     1.457889    1.687587
         20  |   1.633778   .0611408    26.72   0.000     1.513938    1.753619
         21  |   1.655228   .0635948    26.03   0.000     1.530578    1.779878
         22  |   1.706019    .065796    25.93   0.000     1.577054    1.834983
         23  |   1.761676   .0680871    25.87   0.000     1.628221    1.895132
         24  |   1.788846   .0707107    25.30   0.000     1.650248    1.927444
         25  |   1.796025   .0729999    24.60   0.000     1.652941     1.93911
         26  |  -.2961314   .0371958    -7.96   0.000    -.3690378    -.223225
         27  |  -.1718103   .0355108    -4.84   0.000     -.241414   -.1022067
         28  |   .0057384   .0342049     0.17   0.867    -.0613056    .0727823
         29  |   .2455409    .034482     7.12   0.000     .1779538     .313128
         30  |   .3996033   .0348719    11.46   0.000      .331252    .4679546
         31  |   .5714925   .0355349    16.08   0.000     .5018416    .6411433
         32  |   .7165352   .0362652    19.76   0.000     .6454529    .7876174
         33  |    .798658   .0374126    21.35   0.000     .7253268    .8719891
         34  |   .9512298   .0391171    24.32   0.000     .8745575    1.027902
         35  |   1.043893   .0406536    25.68   0.000     .9642093    1.123577
         36  |   1.103638   .0429493    25.70   0.000     1.019454    1.187822
         37  |    1.17119   .0449398    26.06   0.000     1.083105    1.259275
         38  |   1.249253    .047187    26.47   0.000     1.156763    1.341743
         39  |   1.302391   .0494314    26.35   0.000     1.205502    1.399279
         40  |    1.40549   .0524703    26.79   0.000     1.302645    1.508335
         41  |   1.472632   .0543139    27.11   0.000     1.366173    1.579091
         42  |   1.547998   .0564569    27.42   0.000     1.437339    1.658658
         43  |   1.527874   .0591698    25.82   0.000     1.411897    1.643851
         44  |   1.588083   .0617916    25.70   0.000     1.466967    1.709199
         45  |   1.662404   .0642695    25.87   0.000     1.536432    1.788377
         46  |   1.675817   .0665726    25.17   0.000      1.54533    1.806304
         47  |   1.708935     .06861    24.91   0.000     1.574455    1.843415
         48  |   1.780307   .0705985    25.22   0.000     1.641929    1.918685
         49  |   1.801137   .0732525    24.59   0.000     1.657557    1.944717
         50  |   1.831814   .0755633    24.24   0.000     1.683705    1.979923
             |
     age_cat |
          1  |   .2493564   .0156188    15.97   0.000     .2187425    .2799703
          2  |   .2727515   .0171961    15.86   0.000     .2390459    .3064571
          3  |   .2628509   .0189287    13.89   0.000     .2257493    .2999524
          4  |   .2510376   .0208212    12.06   0.000     .2102267    .2918485
          5  |   .2378948   .0229202    10.38   0.000     .1929697      .28282
          6  |   .2263685   .0251842     8.99   0.000     .1770057    .2757312
          7  |   .2267002   .0276011     8.21   0.000     .1726002    .2808002
          8  |   .2061035   .0300979     6.85   0.000     .1471096    .2650974
          9  |   .1974202   .0326879     6.04   0.000     .1333498    .2614907
         10  |   .1822139   .0353266     5.16   0.000     .1129713    .2514565
         11  |   .1832895   .0380441     4.82   0.000     .1087204    .2578587
         12  |   .1692222   .0408257     4.14   0.000     .0892009    .2492434
         13  |   .1654355    .043528     3.80   0.000     .0801177    .2507534
         14  |   .1649242    .046312     3.56   0.000     .0741495    .2556988
         15  |   .1640635   .0491127     3.34   0.001     .0677991    .2603278
         16  |   .1563787   .0518582     3.02   0.003      .054733    .2580244
         17  |   .1398642    .054883     2.55   0.011     .0322897    .2474388
         18  |   .1390989   .0577194     2.41   0.016     .0259649    .2522328
         19  |   .1152638      .0608     1.90   0.058    -.0039084     .234436
         20  |   .0901971   .0664985     1.36   0.175    -.0401446    .2205388
         25  |   .0421133   .0762429     0.55   0.581    -.1073281    .1915547
         30  |   .1062659   .1041828     1.02   0.308    -.0979395    .3104714
         40  |    .151407   .1194433     1.27   0.205    -.0827101    .3855241
         50  |   .1470122   .1343385     1.09   0.274    -.1163005    .4103248
             |
       _cons |   7.575115    .026912   281.48   0.000     7.522365    7.627864
-------------+----------------------------------------------------------------
     sigma_u |  1.1758608
     sigma_e |  .52942848
         rho |  .83144672   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text repla
> ce

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b', "`fmt'")) _newline
  6.         file write `output' ("   standard_error: " + string(`se', "`fmt'")) _
> newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se', "`fmt'")) 
> _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',
> "pvalue"),colnumb(`coefs',"`X'")]), "`fmt'") _newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file
(sum of wgt is   1.1357e+05)

Linear regression                               Number of obs     =    288,264
                                                F(75, 18612)      =     204.90
                                                Prob > F          =     0.0000
                                                R-squared         =     0.2157
                                                Root MSE          =      1.133

                                (Std. Err. adjusted for 18,613 clusters in id)
------------------------------------------------------------------------------
             |               Robust
        lnQL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .6011078   .0364075    16.51   0.000     .5297458    .6724697
       expat |   .0224148    .057102     0.39   0.695    -.0895104      .13434
             |
    ind_year |
          2  |   .1245405   .0232008     5.37   0.000     .0790648    .1700162
          3  |   .3423647   .0269532    12.70   0.000     .2895339    .3951955
          4  |   .5753001   .0286964    20.05   0.000     .5190527    .6315476
          5  |   .7565252   .0297127    25.46   0.000     .6982856    .8147649
          6  |   .9485293   .0306504    30.95   0.000     .8884516    1.008607
          7  |   1.060593   .0312852    33.90   0.000     .9992709    1.121915
          8  |   1.140804   .0312956    36.45   0.000     1.079462    1.202146
          9  |   1.251576   .0314127    39.84   0.000     1.190004    1.313148
         10  |   1.354774   .0315505    42.94   0.000     1.292932    1.416615
         11  |   1.358633   .0321662    42.24   0.000     1.295585    1.421682
         12  |   1.373621   .0326272    42.10   0.000     1.309668    1.437573
         13  |    1.38122     .03279    42.12   0.000     1.316948    1.445491
         14  |   1.392152   .0331931    41.94   0.000      1.32709    1.457213
         15  |   1.447038   .0335681    43.11   0.000     1.381242    1.512835
         16  |   1.455124   .0332515    43.76   0.000     1.389948      1.5203
         17  |   1.494251   .0337158    44.32   0.000     1.428165    1.560337
         18  |   1.409861   .0341678    41.26   0.000     1.342889    1.476833
         19  |   1.414032   .0341159    41.45   0.000     1.347162    1.480902
         20  |   1.457221   .0346977    42.00   0.000      1.38921    1.525232
         21  |   1.459678   .0356675    40.92   0.000     1.389767     1.52959
         22  |   1.491352   .0362394    41.15   0.000      1.42032    1.562385
         23  |   1.552793   .0363247    42.75   0.000     1.481594    1.623993
         24  |   1.601089    .037505    42.69   0.000     1.527576    1.674602
         25  |   1.615219   .0380461    42.45   0.000     1.540645    1.689792
         26  |  -.4871407   .0385715   -12.63   0.000    -.5627444    -.411537
         27  |  -.3208252   .0362437    -8.85   0.000    -.3918662   -.2497842
         28  |  -.1282455   .0357277    -3.59   0.000    -.1982751   -.0582159
         29  |    .126717   .0357348     3.55   0.000     .0566735    .1967605
         30  |   .2844012   .0367806     7.73   0.000     .2123079    .3564946
         31  |   .4445231   .0361982    12.28   0.000     .3735713    .5154748
         32  |   .5732451   .0351182    16.32   0.000     .5044102      .64208
         33  |   .6102231   .0348174    17.53   0.000     .5419778    .6784683
         34  |   .7522296   .0353217    21.30   0.000     .6829958    .8214635
         35  |   .8239044   .0352294    23.39   0.000     .7548516    .8929572
         36  |   .8942111   .0351555    25.44   0.000     .8253031    .9631192
         37  |   .9217127   .0357264    25.80   0.000     .8516856    .9917398
         38  |   .9814684   .0357742    27.44   0.000     .9113478    1.051589
         39  |   1.020263   .0361642    28.21   0.000     .9493782    1.091149
         40  |   1.092285   .0374335    29.18   0.000     1.018911    1.165658
         41  |   1.159799   .0369899    31.35   0.000     1.087295    1.232302
         42  |   1.219037   .0368837    33.05   0.000     1.146741    1.291332
         43  |   1.193843    .037739    31.63   0.000     1.119871    1.267815
         44  |    1.23352    .038563    31.99   0.000     1.157933    1.309107
         45  |   1.288261   .0393198    32.76   0.000     1.211191    1.365332
         46  |   1.303395   .0398086    32.74   0.000     1.225366    1.381423
         47  |   1.330153   .0402017    33.09   0.000     1.251354    1.408952
         48  |   1.403372    .039975    35.11   0.000     1.325018    1.481727
         49  |   1.441807   .0417801    34.51   0.000     1.359914      1.5237
         50  |   1.479732   .0413411    35.79   0.000     1.398699    1.560764
             |
     age_cat |
          1  |   .2760003   .0239963    11.50   0.000     .2289654    .3230353
          2  |   .3283479   .0250126    13.13   0.000     .2793209    .3773749
          3  |   .3691989   .0256822    14.38   0.000     .3188595    .4195383
          4  |    .410112   .0265107    15.47   0.000     .3581486    .4620753
          5  |   .4410499   .0271448    16.25   0.000     .3878436    .4942562
          6  |   .4572548   .0277616    16.47   0.000     .4028396      .51167
          7  |   .4950646   .0283801    17.44   0.000      .439437    .5506923
          8  |   .5241978   .0289004    18.14   0.000     .4675503    .5808452
          9  |    .561769   .0295944    18.98   0.000     .5037612    .6197768
         10  |   .5757374   .0300712    19.15   0.000     .5167951    .6346797
         11  |   .6240511   .0307524    20.29   0.000     .5637735    .6843286
         12  |   .6527514   .0314167    20.78   0.000     .5911718     .714331
         13  |   .6840043   .0321252    21.29   0.000      .621036    .7469726
         14  |   .7198291   .0326767    22.03   0.000     .6557798    .7838783
         15  |   .7450907   .0334995    22.24   0.000     .6794287    .8107527
         16  |   .7638951   .0341587    22.36   0.000     .6969409    .8308493
         17  |     .76454   .0350873    21.79   0.000     .6957657    .8333142
         18  |   .7789976    .035656    21.85   0.000     .7091085    .8488866
         19  |   .7835114    .036775    21.31   0.000      .711429    .8555938
         20  |   .7869408   .0390127    20.17   0.000     .7104723    .8634093
         25  |   .6787608   .0484275    14.02   0.000     .5838386    .7736831
         30  |   .1014008   .0562276     1.80   0.071    -.0088104    .2116121
         40  |  -.0068081   .0484268    -0.14   0.888    -.1017292    .0881129
         50  |   .2599179   .0633008     4.11   0.000     .1358425    .3839933
             |
       _cons |   7.276471   .0336607   216.17   0.000     7.210493    7.342449
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. local fmt "%10.5f"

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }

. 
. estimates

----------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------

Linear regression                               Number of obs     =    288,264
                                                F(75, 18612)      =     204.90
                                                Prob > F          =     0.0000
                                                R-squared         =     0.2157
                                                Root MSE          =      1.133

                                (Std. Err. adjusted for 18,613 clusters in id)
------------------------------------------------------------------------------
             |               Robust
        lnQL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .6011078   .0364075    16.51   0.000     .5297458    .6724697
       expat |   .0224148    .057102     0.39   0.695    -.0895104      .13434
             |
    ind_year |
          2  |   .1245405   .0232008     5.37   0.000     .0790648    .1700162
          3  |   .3423647   .0269532    12.70   0.000     .2895339    .3951955
          4  |   .5753001   .0286964    20.05   0.000     .5190527    .6315476
          5  |   .7565252   .0297127    25.46   0.000     .6982856    .8147649
          6  |   .9485293   .0306504    30.95   0.000     .8884516    1.008607
          7  |   1.060593   .0312852    33.90   0.000     .9992709    1.121915
          8  |   1.140804   .0312956    36.45   0.000     1.079462    1.202146
          9  |   1.251576   .0314127    39.84   0.000     1.190004    1.313148
         10  |   1.354774   .0315505    42.94   0.000     1.292932    1.416615
         11  |   1.358633   .0321662    42.24   0.000     1.295585    1.421682
         12  |   1.373621   .0326272    42.10   0.000     1.309668    1.437573
         13  |    1.38122     .03279    42.12   0.000     1.316948    1.445491
         14  |   1.392152   .0331931    41.94   0.000      1.32709    1.457213
         15  |   1.447038   .0335681    43.11   0.000     1.381242    1.512835
         16  |   1.455124   .0332515    43.76   0.000     1.389948      1.5203
         17  |   1.494251   .0337158    44.32   0.000     1.428165    1.560337
         18  |   1.409861   .0341678    41.26   0.000     1.342889    1.476833
         19  |   1.414032   .0341159    41.45   0.000     1.347162    1.480902
         20  |   1.457221   .0346977    42.00   0.000      1.38921    1.525232
         21  |   1.459678   .0356675    40.92   0.000     1.389767     1.52959
         22  |   1.491352   .0362394    41.15   0.000      1.42032    1.562385
         23  |   1.552793   .0363247    42.75   0.000     1.481594    1.623993
         24  |   1.601089    .037505    42.69   0.000     1.527576    1.674602
         25  |   1.615219   .0380461    42.45   0.000     1.540645    1.689792
         26  |  -.4871407   .0385715   -12.63   0.000    -.5627444    -.411537
         27  |  -.3208252   .0362437    -8.85   0.000    -.3918662   -.2497842
         28  |  -.1282455   .0357277    -3.59   0.000    -.1982751   -.0582159
         29  |    .126717   .0357348     3.55   0.000     .0566735    .1967605
         30  |   .2844012   .0367806     7.73   0.000     .2123079    .3564946
         31  |   .4445231   .0361982    12.28   0.000     .3735713    .5154748
         32  |   .5732451   .0351182    16.32   0.000     .5044102      .64208
         33  |   .6102231   .0348174    17.53   0.000     .5419778    .6784683
         34  |   .7522296   .0353217    21.30   0.000     .6829958    .8214635
         35  |   .8239044   .0352294    23.39   0.000     .7548516    .8929572
         36  |   .8942111   .0351555    25.44   0.000     .8253031    .9631192
         37  |   .9217127   .0357264    25.80   0.000     .8516856    .9917398
         38  |   .9814684   .0357742    27.44   0.000     .9113478    1.051589
         39  |   1.020263   .0361642    28.21   0.000     .9493782    1.091149
         40  |   1.092285   .0374335    29.18   0.000     1.018911    1.165658
         41  |   1.159799   .0369899    31.35   0.000     1.087295    1.232302
         42  |   1.219037   .0368837    33.05   0.000     1.146741    1.291332
         43  |   1.193843    .037739    31.63   0.000     1.119871    1.267815
         44  |    1.23352    .038563    31.99   0.000     1.157933    1.309107
         45  |   1.288261   .0393198    32.76   0.000     1.211191    1.365332
         46  |   1.303395   .0398086    32.74   0.000     1.225366    1.381423
         47  |   1.330153   .0402017    33.09   0.000     1.251354    1.408952
         48  |   1.403372    .039975    35.11   0.000     1.325018    1.481727
         49  |   1.441807   .0417801    34.51   0.000     1.359914      1.5237
         50  |   1.479732   .0413411    35.79   0.000     1.398699    1.560764
             |
     age_cat |
          1  |   .2760003   .0239963    11.50   0.000     .2289654    .3230353
          2  |   .3283479   .0250126    13.13   0.000     .2793209    .3773749
          3  |   .3691989   .0256822    14.38   0.000     .3188595    .4195383
          4  |    .410112   .0265107    15.47   0.000     .3581486    .4620753
          5  |   .4410499   .0271448    16.25   0.000     .3878436    .4942562
          6  |   .4572548   .0277616    16.47   0.000     .4028396      .51167
          7  |   .4950646   .0283801    17.44   0.000      .439437    .5506923
          8  |   .5241978   .0289004    18.14   0.000     .4675503    .5808452
          9  |    .561769   .0295944    18.98   0.000     .5037612    .6197768
         10  |   .5757374   .0300712    19.15   0.000     .5167951    .6346797
         11  |   .6240511   .0307524    20.29   0.000     .5637735    .6843286
         12  |   .6527514   .0314167    20.78   0.000     .5911718     .714331
         13  |   .6840043   .0321252    21.29   0.000      .621036    .7469726
         14  |   .7198291   .0326767    22.03   0.000     .6557798    .7838783
         15  |   .7450907   .0334995    22.24   0.000     .6794287    .8107527
         16  |   .7638951   .0341587    22.36   0.000     .6969409    .8308493
         17  |     .76454   .0350873    21.79   0.000     .6957657    .8333142
         18  |   .7789976    .035656    21.85   0.000     .7091085    .8488866
         19  |   .7835114    .036775    21.31   0.000      .711429    .8555938
         20  |   .7869408   .0390127    20.17   0.000     .7104723    .8634093
         25  |   .6787608   .0484275    14.02   0.000     .5838386    .7736831
         30  |   .1014008   .0562276     1.80   0.071    -.0088104    .2116121
         40  |  -.0068081   .0484268    -0.14   0.888    -.1017292    .0881129
         50  |   .2599179   .0633008     4.11   0.000     .1358425    .3839933
             |
       _cons |   7.276471   .0336607   216.17   0.000     7.210493    7.342449
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text repla
> ce

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b', "`fmt'")) _newline
  6.         file write `output' ("   standard_error: " + string(`se', "`fmt'")) _
> newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se', "`fmt'")) 
> _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',
> "pvalue"),colnumb(`coefs',"`X'")]), "`fmt'") _newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file

Fixed-effects (within) regression               Number of obs     =    288,264
Group variable: id                              Number of groups  =     18,613

R-sq:                                           Obs per group:
     within  = 0.2834                                         min =          1
     between = 0.2269                                         avg =       15.5
     overall = 0.1705                                         max =        181

                                                F(75,18612)       =     154.19
corr(u_i, Xb)  = 0.0316                         Prob > F          =     0.0000

                                (Std. Err. adjusted for 18,613 clusters in id)
------------------------------------------------------------------------------
             |               Robust
        lnQL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0620617   .0260995     2.38   0.017     .0109042    .1132191
       expat |   .1231878   .0237078     5.20   0.000     .0767183    .1696572
             |
    ind_year |
          2  |   .0922393   .0173205     5.33   0.000     .0582896    .1261889
          3  |   .2635252   .0211375    12.47   0.000     .2220938    .3049566
          4  |   .4413166   .0234879    18.79   0.000     .3952782    .4873551
          5  |   .6060408   .0256981    23.58   0.000     .5556702    .6564114
          6  |   .7972458   .0280827    28.39   0.000     .7422012    .8522904
          7  |   .9349802   .0305013    30.65   0.000     .8751949    .9947656
          8  |   1.027557    .032629    31.49   0.000     .9636015    1.091513
          9  |   1.147957   .0351093    32.70   0.000      1.07914    1.216775
         10  |   1.276311   .0376596    33.89   0.000     1.202494    1.350127
         11  |   1.344314      .0402    33.44   0.000     1.265519     1.42311
         12  |   1.378144   .0430399    32.02   0.000     1.293782    1.462506
         13  |   1.421834   .0455258    31.23   0.000     1.332599    1.511068
         14  |   1.472562   .0479418    30.72   0.000     1.378592    1.566533
         15  |   1.549175   .0508348    30.47   0.000     1.449535    1.648816
         16  |   1.588352   .0532268    29.84   0.000     1.484023    1.692682
         17  |   1.650488   .0562519    29.34   0.000     1.540229    1.760747
         18  |   1.587534    .058962    26.92   0.000     1.471963    1.703105
         19  |    1.60957   .0614849    26.18   0.000     1.489054    1.730086
         20  |   1.670702   .0641152    26.06   0.000     1.545031    1.796374
         21  |   1.694454   .0666962    25.41   0.000     1.563723    1.825185
         22  |   1.748953    .068966    25.36   0.000     1.613773    1.884133
         23  |   1.805431   .0713174    25.32   0.000     1.665642    1.945219
         24  |   1.837396   .0740905    24.80   0.000     1.692172     1.98262
         25  |   1.838376   .0764225    24.06   0.000     1.688581    1.988171
         26  |  -.2452831   .0404082    -6.07   0.000    -.3244869   -.1660793
         27  |   -.118292   .0383788    -3.08   0.002    -.1935179   -.0430661
         28  |   .0397041   .0371909     1.07   0.286    -.0331935    .1126017
         29  |   .2739235   .0374973     7.31   0.000     .2004254    .3474215
         30  |   .4415956   .0377536    11.70   0.000      .367595    .5155961
         31  |   .6073693   .0384912    15.78   0.000     .5319231    .6828155
         32  |   .7551358   .0392355    19.25   0.000     .6782307    .8320409
         33  |   .8257102   .0404018    20.44   0.000     .7465189    .9049016
         34  |   .9815062   .0420846    23.32   0.000     .8990165    1.063996
         35  |   1.077657   .0435945    24.72   0.000     .9922076    1.163106
         36  |   1.142407   .0460681    24.80   0.000     1.052109    1.232704
         37  |   1.202869   .0481514    24.98   0.000     1.108488     1.29725
         38  |   1.282097   .0504193    25.43   0.000      1.18327    1.380923
         39  |   1.326789   .0526713    25.19   0.000     1.223549     1.43003
         40  |   1.423659   .0558197    25.50   0.000     1.314247     1.53307
         41  |   1.502534   .0575772    26.10   0.000     1.389678    1.615391
         42  |   1.577882   .0597806    26.39   0.000     1.460706    1.695057
         43  |   1.554048    .062621    24.82   0.000     1.431305    1.676791
         44  |   1.605416   .0653686    24.56   0.000     1.477288    1.733545
         45  |   1.679823   .0679606    24.72   0.000     1.546614    1.813032
         46  |      1.687   .0703795    23.97   0.000     1.549049     1.82495
         47  |   1.717965   .0723539    23.74   0.000     1.576145    1.859785
         48  |   1.792781   .0743355    24.12   0.000     1.647077    1.938486
         49  |   1.808804   .0772062    23.43   0.000     1.657473    1.960135
         50  |   1.840938   .0795458    23.14   0.000     1.685021    1.996855
             |
     age_cat |
          1  |   .2314402   .0165244    14.01   0.000     .1990509    .2638295
          2  |   .2332883   .0182106    12.81   0.000     .1975939    .2689827
          3  |   .2110822   .0201221    10.49   0.000     .1716409    .2505234
          4  |   .1950351     .02213     8.81   0.000     .1516582     .238412
          5  |   .1827663   .0243296     7.51   0.000     .1350779    .2304546
          6  |   .1649486   .0267587     6.16   0.000     .1124991    .2173981
          7  |   .1647421   .0293034     5.62   0.000     .1073048    .2221794
          8  |   .1463492   .0319388     4.58   0.000     .0837463    .2089522
          9  |   .1350727   .0346477     3.90   0.000       .06716    .2029855
         10  |    .118524   .0373951     3.17   0.002     .0452262    .1918218
         11  |   .1207075   .0402174     3.00   0.003     .0418777    .1995373
         12  |    .108794   .0431183     2.52   0.012     .0242782    .1933099
         13  |   .1026818   .0459187     2.24   0.025     .0126769    .1926867
         14  |   .1046353    .048808     2.14   0.032     .0089671    .2003035
         15  |   .1001307   .0517364     1.94   0.053    -.0012773    .2015387
         16  |   .0934202   .0545791     1.71   0.087    -.0135599    .2004002
         17  |   .0751441   .0577779     1.30   0.193    -.0381059    .1883941
         18  |   .0739573   .0607221     1.22   0.223    -.0450636    .1929781
         19  |   .0511362   .0639829     0.80   0.424    -.0742762    .1765485
         20  |   .0250923   .0699374     0.36   0.720    -.1119913    .1621759
         25  |  -.0230593   .0801437    -0.29   0.774    -.1801484    .1340298
         30  |   .0500554   .1086741     0.46   0.645    -.1629557    .2630665
         40  |   .0980332   .1236314     0.79   0.428    -.1442957    .3403621
         50  |   .0863293   .1392274     0.62   0.535    -.1865691    .3592277
             |
       _cons |   7.533869    .027788   271.12   0.000     7.479402    7.588336
-------------+----------------------------------------------------------------
     sigma_u |  1.1389456
     sigma_e |  .52675995
         rho |  .82378815   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. local fmt "%10.5f"

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }
key: R2_within
value: .2833848334147637

. 
. estimates

----------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------

Fixed-effects (within) regression               Number of obs     =    288,264
Group variable: id                              Number of groups  =     18,613

R-sq:                                           Obs per group:
     within  = 0.2834                                         min =          1
     between = 0.2269                                         avg =       15.5
     overall = 0.1705                                         max =        181

                                                F(75,18612)       =     154.19
corr(u_i, Xb)  = 0.0316                         Prob > F          =     0.0000

                                (Std. Err. adjusted for 18,613 clusters in id)
------------------------------------------------------------------------------
             |               Robust
        lnQL |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0620617   .0260995     2.38   0.017     .0109042    .1132191
       expat |   .1231878   .0237078     5.20   0.000     .0767183    .1696572
             |
    ind_year |
          2  |   .0922393   .0173205     5.33   0.000     .0582896    .1261889
          3  |   .2635252   .0211375    12.47   0.000     .2220938    .3049566
          4  |   .4413166   .0234879    18.79   0.000     .3952782    .4873551
          5  |   .6060408   .0256981    23.58   0.000     .5556702    .6564114
          6  |   .7972458   .0280827    28.39   0.000     .7422012    .8522904
          7  |   .9349802   .0305013    30.65   0.000     .8751949    .9947656
          8  |   1.027557    .032629    31.49   0.000     .9636015    1.091513
          9  |   1.147957   .0351093    32.70   0.000      1.07914    1.216775
         10  |   1.276311   .0376596    33.89   0.000     1.202494    1.350127
         11  |   1.344314      .0402    33.44   0.000     1.265519     1.42311
         12  |   1.378144   .0430399    32.02   0.000     1.293782    1.462506
         13  |   1.421834   .0455258    31.23   0.000     1.332599    1.511068
         14  |   1.472562   .0479418    30.72   0.000     1.378592    1.566533
         15  |   1.549175   .0508348    30.47   0.000     1.449535    1.648816
         16  |   1.588352   .0532268    29.84   0.000     1.484023    1.692682
         17  |   1.650488   .0562519    29.34   0.000     1.540229    1.760747
         18  |   1.587534    .058962    26.92   0.000     1.471963    1.703105
         19  |    1.60957   .0614849    26.18   0.000     1.489054    1.730086
         20  |   1.670702   .0641152    26.06   0.000     1.545031    1.796374
         21  |   1.694454   .0666962    25.41   0.000     1.563723    1.825185
         22  |   1.748953    .068966    25.36   0.000     1.613773    1.884133
         23  |   1.805431   .0713174    25.32   0.000     1.665642    1.945219
         24  |   1.837396   .0740905    24.80   0.000     1.692172     1.98262
         25  |   1.838376   .0764225    24.06   0.000     1.688581    1.988171
         26  |  -.2452831   .0404082    -6.07   0.000    -.3244869   -.1660793
         27  |   -.118292   .0383788    -3.08   0.002    -.1935179   -.0430661
         28  |   .0397041   .0371909     1.07   0.286    -.0331935    .1126017
         29  |   .2739235   .0374973     7.31   0.000     .2004254    .3474215
         30  |   .4415956   .0377536    11.70   0.000      .367595    .5155961
         31  |   .6073693   .0384912    15.78   0.000     .5319231    .6828155
         32  |   .7551358   .0392355    19.25   0.000     .6782307    .8320409
         33  |   .8257102   .0404018    20.44   0.000     .7465189    .9049016
         34  |   .9815062   .0420846    23.32   0.000     .8990165    1.063996
         35  |   1.077657   .0435945    24.72   0.000     .9922076    1.163106
         36  |   1.142407   .0460681    24.80   0.000     1.052109    1.232704
         37  |   1.202869   .0481514    24.98   0.000     1.108488     1.29725
         38  |   1.282097   .0504193    25.43   0.000      1.18327    1.380923
         39  |   1.326789   .0526713    25.19   0.000     1.223549     1.43003
         40  |   1.423659   .0558197    25.50   0.000     1.314247     1.53307
         41  |   1.502534   .0575772    26.10   0.000     1.389678    1.615391
         42  |   1.577882   .0597806    26.39   0.000     1.460706    1.695057
         43  |   1.554048    .062621    24.82   0.000     1.431305    1.676791
         44  |   1.605416   .0653686    24.56   0.000     1.477288    1.733545
         45  |   1.679823   .0679606    24.72   0.000     1.546614    1.813032
         46  |      1.687   .0703795    23.97   0.000     1.549049     1.82495
         47  |   1.717965   .0723539    23.74   0.000     1.576145    1.859785
         48  |   1.792781   .0743355    24.12   0.000     1.647077    1.938486
         49  |   1.808804   .0772062    23.43   0.000     1.657473    1.960135
         50  |   1.840938   .0795458    23.14   0.000     1.685021    1.996855
             |
     age_cat |
          1  |   .2314402   .0165244    14.01   0.000     .1990509    .2638295
          2  |   .2332883   .0182106    12.81   0.000     .1975939    .2689827
          3  |   .2110822   .0201221    10.49   0.000     .1716409    .2505234
          4  |   .1950351     .02213     8.81   0.000     .1516582     .238412
          5  |   .1827663   .0243296     7.51   0.000     .1350779    .2304546
          6  |   .1649486   .0267587     6.16   0.000     .1124991    .2173981
          7  |   .1647421   .0293034     5.62   0.000     .1073048    .2221794
          8  |   .1463492   .0319388     4.58   0.000     .0837463    .2089522
          9  |   .1350727   .0346477     3.90   0.000       .06716    .2029855
         10  |    .118524   .0373951     3.17   0.002     .0452262    .1918218
         11  |   .1207075   .0402174     3.00   0.003     .0418777    .1995373
         12  |    .108794   .0431183     2.52   0.012     .0242782    .1933099
         13  |   .1026818   .0459187     2.24   0.025     .0126769    .1926867
         14  |   .1046353    .048808     2.14   0.032     .0089671    .2003035
         15  |   .1001307   .0517364     1.94   0.053    -.0012773    .2015387
         16  |   .0934202   .0545791     1.71   0.087    -.0135599    .2004002
         17  |   .0751441   .0577779     1.30   0.193    -.0381059    .1883941
         18  |   .0739573   .0607221     1.22   0.223    -.0450636    .1929781
         19  |   .0511362   .0639829     0.80   0.424    -.0742762    .1765485
         20  |   .0250923   .0699374     0.36   0.720    -.1119913    .1621759
         25  |  -.0230593   .0801437    -0.29   0.774    -.1801484    .1340298
         30  |   .0500554   .1086741     0.46   0.645    -.1629557    .2630665
         40  |   .0980332   .1236314     0.79   0.428    -.1442957    .3403621
         50  |   .0863293   .1392274     0.62   0.535    -.1865691    .3592277
             |
       _cons |   7.533869    .027788   271.12   0.000     7.479402    7.588336
-------------+----------------------------------------------------------------
     sigma_u |  1.1389456
     sigma_e |  .52675995
         rho |  .82378815   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text repla
> ce

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b', "`fmt'")) _newline
  6.         file write `output' ("   standard_error: " + string(`se', "`fmt'")) _
> newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se', "`fmt'")) 
> _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',
> "pvalue"),colnumb(`coefs',"`X'")]), "`fmt'") _newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file
(sum of wgt is   1.3350e+05)

Linear regression                               Number of obs     =    368,493
                                                F(75, 22579)      =     177.15
                                                Prob > F          =     0.0000
                                                R-squared         =     0.1900
                                                Root MSE          =     .43791

                                (Std. Err. adjusted for 22,580 clusters in id)
------------------------------------------------------------------------------
             |               Robust
    exporter |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |    .349571   .0074968    46.63   0.000     .3348768    .3642652
       expat |   .0503172   .0083291     6.04   0.000     .0339916    .0666429
             |
    ind_year |
          2  |  -.0317496   .0082516    -3.85   0.000    -.0479233   -.0155758
          3  |  -.0549557   .0095512    -5.75   0.000    -.0736767   -.0362346
          4  |  -.0650886   .0099047    -6.57   0.000    -.0845025   -.0456747
          5  |  -.0569085   .0103135    -5.52   0.000    -.0771236   -.0366934
          6  |  -.0740736   .0104266    -7.10   0.000    -.0945105   -.0536367
          7  |    -.07276   .0105307    -6.91   0.000    -.0934008   -.0521192
          8  |  -.0908429   .0106101    -8.56   0.000    -.1116395   -.0700464
          9  |  -.0979443   .0106733    -9.18   0.000    -.1188647   -.0770239
         10  |  -.0940184   .0107864    -8.72   0.000    -.1151604   -.0728764
         11  |  -.1063573   .0106903    -9.95   0.000    -.1273109   -.0854036
         12  |  -.1123474   .0106986   -10.50   0.000    -.1333175   -.0913773
         13  |   -.109885   .0107115   -10.26   0.000    -.1308803   -.0888897
         14  |   -.101034   .0108203    -9.34   0.000    -.1222425   -.0798254
         15  |   -.092617   .0109082    -8.49   0.000    -.1139979   -.0712362
         16  |  -.0820089    .011056    -7.42   0.000    -.1036795   -.0603384
         17  |  -.0688121   .0111677    -6.16   0.000    -.0907015   -.0469227
         18  |  -.0676686   .0112674    -6.01   0.000    -.0897535   -.0455836
         19  |  -.0665492   .0113912    -5.84   0.000    -.0888767   -.0442216
         20  |  -.0536215   .0115645    -4.64   0.000    -.0762888   -.0309543
         21  |  -.0449072   .0117135    -3.83   0.000    -.0678665    -.021948
         22  |  -.0447648   .0119795    -3.74   0.000    -.0682455   -.0212841
         23  |  -.0445931   .0120737    -3.69   0.000    -.0682583   -.0209278
         24  |  -.1387757    .011837   -11.72   0.000    -.1619769   -.1155745
         25  |  -.1684862    .012082   -13.95   0.000    -.1921677   -.1448047
         26  |   .2214606   .0161039    13.75   0.000     .1898958    .2530254
         27  |   .1765263   .0142164    12.42   0.000     .1486611    .2043915
         28  |   .1756489   .0137035    12.82   0.000     .1487891    .2025087
         29  |   .1792542   .0135821    13.20   0.000     .1526324    .2058761
         30  |   .1900309   .0134616    14.12   0.000     .1636453    .2164165
         31  |   .1855917   .0132925    13.96   0.000     .1595375    .2116458
         32  |   .1838631   .0130737    14.06   0.000     .1582377    .2094886
         33  |   .1728323   .0129829    13.31   0.000     .1473849    .1982798
         34  |   .1762596   .0129893    13.57   0.000     .1507997    .2017195
         35  |   .1777489   .0130243    13.65   0.000     .1522204    .2032775
         36  |   .1811292    .013019    13.91   0.000      .155611    .2066474
         37  |   .1731585   .0130122    13.31   0.000     .1476537    .1986632
         38  |   .1690578    .012928    13.08   0.000      .143718    .1943976
         39  |   .1691611   .0129972    13.02   0.000     .1436857    .1946364
         40  |   .1675439   .0130845    12.80   0.000     .1418975    .1931903
         41  |   .1873613   .0131942    14.20   0.000     .1614998    .2132228
         42  |   .1908946    .013287    14.37   0.000     .1648511    .2169381
         43  |   .1935082   .0135037    14.33   0.000     .1670399    .2199764
         44  |   .2069766   .0136595    15.15   0.000      .180203    .2337502
         45  |   .2076414   .0138464    15.00   0.000     .1805016    .2347812
         46  |   .2146434    .013955    15.38   0.000     .1872908    .2419961
         47  |   .2253171   .0142954    15.76   0.000      .197297    .2533372
         48  |   .2162405   .0144196    15.00   0.000     .1879771    .2445039
         49  |  -.0299472   .0144604    -2.07   0.038    -.0582906   -.0016039
         50  |  -.0745215   .0147125    -5.07   0.000     -.103359   -.0456841
             |
     age_cat |
          1  |   .0545546   .0066048     8.26   0.000     .0416088    .0675004
          2  |   .0827888   .0069607    11.89   0.000     .0691453    .0964323
          3  |   .0992672   .0071424    13.90   0.000     .0852675    .1132669
          4  |   .1275339   .0073696    17.31   0.000      .113089    .1419787
          5  |   .1428882   .0075717    18.87   0.000     .1280471    .1577293
          6  |    .156211   .0078167    19.98   0.000     .1408897    .1715323
          7  |   .1657648   .0080351    20.63   0.000     .1500156    .1815141
          8  |   .1827878   .0083036    22.01   0.000     .1665121    .1990635
          9  |     .18927   .0084835    22.31   0.000     .1726416    .2058983
         10  |   .1926928    .008652    22.27   0.000     .1757343    .2096514
         11  |   .2011945    .008826    22.80   0.000     .1838948    .2184941
         12  |   .2044761   .0090195    22.67   0.000     .1867973     .222155
         13  |   .2147367   .0092858    23.13   0.000      .196536    .2329375
         14  |   .2236489   .0096453    23.19   0.000     .2047434    .2425543
         15  |   .2366908   .0099129    23.88   0.000     .2172608    .2561208
         16  |   .2443108   .0102601    23.81   0.000     .2242002    .2644214
         17  |   .2444051   .0106148    23.02   0.000     .2235992    .2652109
         18  |   .2509801   .0110019    22.81   0.000     .2294156    .2725446
         19  |   .2432929   .0113642    21.41   0.000     .2210182    .2655676
         20  |   .2518408   .0117761    21.39   0.000     .2287589    .2749227
         25  |   .2538762   .0156878    16.18   0.000     .2231269    .2846254
         30  |   .0823337    .017704     4.65   0.000     .0476327    .1170347
         40  |   .1209489   .0174602     6.93   0.000     .0867256    .1551721
         50  |   .0928315    .020793     4.46   0.000     .0520757    .1335872
             |
       _cons |   .1461201   .0105514    13.85   0.000     .1254385    .1668016
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. local fmt "%10.5f"

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }

. 
. estimates

----------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------

Linear regression                               Number of obs     =    368,493
                                                F(75, 22579)      =     177.15
                                                Prob > F          =     0.0000
                                                R-squared         =     0.1900
                                                Root MSE          =     .43791

                                (Std. Err. adjusted for 22,580 clusters in id)
------------------------------------------------------------------------------
             |               Robust
    exporter |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |    .349571   .0074968    46.63   0.000     .3348768    .3642652
       expat |   .0503172   .0083291     6.04   0.000     .0339916    .0666429
             |
    ind_year |
          2  |  -.0317496   .0082516    -3.85   0.000    -.0479233   -.0155758
          3  |  -.0549557   .0095512    -5.75   0.000    -.0736767   -.0362346
          4  |  -.0650886   .0099047    -6.57   0.000    -.0845025   -.0456747
          5  |  -.0569085   .0103135    -5.52   0.000    -.0771236   -.0366934
          6  |  -.0740736   .0104266    -7.10   0.000    -.0945105   -.0536367
          7  |    -.07276   .0105307    -6.91   0.000    -.0934008   -.0521192
          8  |  -.0908429   .0106101    -8.56   0.000    -.1116395   -.0700464
          9  |  -.0979443   .0106733    -9.18   0.000    -.1188647   -.0770239
         10  |  -.0940184   .0107864    -8.72   0.000    -.1151604   -.0728764
         11  |  -.1063573   .0106903    -9.95   0.000    -.1273109   -.0854036
         12  |  -.1123474   .0106986   -10.50   0.000    -.1333175   -.0913773
         13  |   -.109885   .0107115   -10.26   0.000    -.1308803   -.0888897
         14  |   -.101034   .0108203    -9.34   0.000    -.1222425   -.0798254
         15  |   -.092617   .0109082    -8.49   0.000    -.1139979   -.0712362
         16  |  -.0820089    .011056    -7.42   0.000    -.1036795   -.0603384
         17  |  -.0688121   .0111677    -6.16   0.000    -.0907015   -.0469227
         18  |  -.0676686   .0112674    -6.01   0.000    -.0897535   -.0455836
         19  |  -.0665492   .0113912    -5.84   0.000    -.0888767   -.0442216
         20  |  -.0536215   .0115645    -4.64   0.000    -.0762888   -.0309543
         21  |  -.0449072   .0117135    -3.83   0.000    -.0678665    -.021948
         22  |  -.0447648   .0119795    -3.74   0.000    -.0682455   -.0212841
         23  |  -.0445931   .0120737    -3.69   0.000    -.0682583   -.0209278
         24  |  -.1387757    .011837   -11.72   0.000    -.1619769   -.1155745
         25  |  -.1684862    .012082   -13.95   0.000    -.1921677   -.1448047
         26  |   .2214606   .0161039    13.75   0.000     .1898958    .2530254
         27  |   .1765263   .0142164    12.42   0.000     .1486611    .2043915
         28  |   .1756489   .0137035    12.82   0.000     .1487891    .2025087
         29  |   .1792542   .0135821    13.20   0.000     .1526324    .2058761
         30  |   .1900309   .0134616    14.12   0.000     .1636453    .2164165
         31  |   .1855917   .0132925    13.96   0.000     .1595375    .2116458
         32  |   .1838631   .0130737    14.06   0.000     .1582377    .2094886
         33  |   .1728323   .0129829    13.31   0.000     .1473849    .1982798
         34  |   .1762596   .0129893    13.57   0.000     .1507997    .2017195
         35  |   .1777489   .0130243    13.65   0.000     .1522204    .2032775
         36  |   .1811292    .013019    13.91   0.000      .155611    .2066474
         37  |   .1731585   .0130122    13.31   0.000     .1476537    .1986632
         38  |   .1690578    .012928    13.08   0.000      .143718    .1943976
         39  |   .1691611   .0129972    13.02   0.000     .1436857    .1946364
         40  |   .1675439   .0130845    12.80   0.000     .1418975    .1931903
         41  |   .1873613   .0131942    14.20   0.000     .1614998    .2132228
         42  |   .1908946    .013287    14.37   0.000     .1648511    .2169381
         43  |   .1935082   .0135037    14.33   0.000     .1670399    .2199764
         44  |   .2069766   .0136595    15.15   0.000      .180203    .2337502
         45  |   .2076414   .0138464    15.00   0.000     .1805016    .2347812
         46  |   .2146434    .013955    15.38   0.000     .1872908    .2419961
         47  |   .2253171   .0142954    15.76   0.000      .197297    .2533372
         48  |   .2162405   .0144196    15.00   0.000     .1879771    .2445039
         49  |  -.0299472   .0144604    -2.07   0.038    -.0582906   -.0016039
         50  |  -.0745215   .0147125    -5.07   0.000     -.103359   -.0456841
             |
     age_cat |
          1  |   .0545546   .0066048     8.26   0.000     .0416088    .0675004
          2  |   .0827888   .0069607    11.89   0.000     .0691453    .0964323
          3  |   .0992672   .0071424    13.90   0.000     .0852675    .1132669
          4  |   .1275339   .0073696    17.31   0.000      .113089    .1419787
          5  |   .1428882   .0075717    18.87   0.000     .1280471    .1577293
          6  |    .156211   .0078167    19.98   0.000     .1408897    .1715323
          7  |   .1657648   .0080351    20.63   0.000     .1500156    .1815141
          8  |   .1827878   .0083036    22.01   0.000     .1665121    .1990635
          9  |     .18927   .0084835    22.31   0.000     .1726416    .2058983
         10  |   .1926928    .008652    22.27   0.000     .1757343    .2096514
         11  |   .2011945    .008826    22.80   0.000     .1838948    .2184941
         12  |   .2044761   .0090195    22.67   0.000     .1867973     .222155
         13  |   .2147367   .0092858    23.13   0.000      .196536    .2329375
         14  |   .2236489   .0096453    23.19   0.000     .2047434    .2425543
         15  |   .2366908   .0099129    23.88   0.000     .2172608    .2561208
         16  |   .2443108   .0102601    23.81   0.000     .2242002    .2644214
         17  |   .2444051   .0106148    23.02   0.000     .2235992    .2652109
         18  |   .2509801   .0110019    22.81   0.000     .2294156    .2725446
         19  |   .2432929   .0113642    21.41   0.000     .2210182    .2655676
         20  |   .2518408   .0117761    21.39   0.000     .2287589    .2749227
         25  |   .2538762   .0156878    16.18   0.000     .2231269    .2846254
         30  |   .0823337    .017704     4.65   0.000     .0476327    .1170347
         40  |   .1209489   .0174602     6.93   0.000     .0867256    .1551721
         50  |   .0928315    .020793     4.46   0.000     .0520757    .1335872
             |
       _cons |   .1461201   .0105514    13.85   0.000     .1254385    .1668016
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text repla
> ce

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b', "`fmt'")) _newline
  6.         file write `output' ("   standard_error: " + string(`se', "`fmt'")) _
> newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se', "`fmt'")) 
> _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',
> "pvalue"),colnumb(`coefs',"`X'")]), "`fmt'") _newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file

Fixed-effects (within) regression               Number of obs     =    368,493
Group variable: id                              Number of groups  =     22,580

R-sq:                                           Obs per group:
     within  = 0.0465                                         min =          1
     between = 0.1308                                         avg =       16.3
     overall = 0.0880                                         max =        181

                                                F(75,22579)       =      36.49
corr(u_i, Xb)  = 0.1885                         Prob > F          =     0.0000

                                (Std. Err. adjusted for 22,580 clusters in id)
------------------------------------------------------------------------------
             |               Robust
    exporter |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0302947   .0113765     2.66   0.008     .0079959    .0525934
       expat |   .0096734   .0035418     2.73   0.006     .0027312    .0166155
             |
    ind_year |
          2  |  -.0259038   .0075763    -3.42   0.001    -.0407538   -.0110538
          3  |  -.0436375     .00919    -4.75   0.000    -.0616504   -.0256245
          4  |  -.0549996   .0099854    -5.51   0.000    -.0745716   -.0354277
          5  |  -.0486516   .0111027    -4.38   0.000    -.0704136   -.0268895
          6  |  -.0627967   .0119468    -5.26   0.000    -.0862133   -.0393801
          7  |  -.0596835   .0129144    -4.62   0.000    -.0849965   -.0343705
          8  |  -.0751734   .0138888    -5.41   0.000    -.1023964   -.0479505
          9  |  -.0751012   .0150508    -4.99   0.000    -.1046017   -.0456007
         10  |  -.0703325   .0161103    -4.37   0.000    -.1019099   -.0387552
         11  |  -.0755129    .017254    -4.38   0.000    -.1093319   -.0416939
         12  |  -.0775353   .0182922    -4.24   0.000    -.1133892   -.0416814
         13  |  -.0706842   .0194729    -3.63   0.000    -.1088525   -.0325159
         14  |  -.0609252   .0206661    -2.95   0.003    -.1014321   -.0204183
         15  |  -.0498101   .0218665    -2.28   0.023    -.0926699   -.0069502
         16  |  -.0382589   .0230602    -1.66   0.097    -.0834583    .0069406
         17  |   -.023163   .0242739    -0.95   0.340    -.0707414    .0244155
         18  |  -.0214146   .0256055    -0.84   0.403    -.0716031    .0287738
         19  |  -.0213968    .026834    -0.80   0.425    -.0739933    .0311998
         20  |  -.0126494   .0280034    -0.45   0.651     -.067538    .0422392
         21  |    -.00809    .029098    -0.28   0.781    -.0651241    .0489441
         22  |  -.0049352   .0301685    -0.16   0.870    -.0640675    .0541972
         23  |  -.0070508   .0312254    -0.23   0.821    -.0682548    .0541532
         24  |  -.1201732   .0322826    -3.72   0.000    -.1834493   -.0568972
         25  |  -.1541216   .0335446    -4.59   0.000    -.2198712   -.0883719
         26  |   .0344018   .0188915     1.82   0.069    -.0026269    .0714305
         27  |   .0129269   .0171541     0.75   0.451    -.0206962    .0465501
         28  |   .0176076   .0167868     1.05   0.294    -.0152956    .0505109
         29  |   .0216422   .0165164     1.31   0.190    -.0107311    .0540155
         30  |   .0235763   .0166051     1.42   0.156    -.0089708    .0561235
         31  |   .0181694   .0167057     1.09   0.277    -.0145748    .0509137
         32  |   .0212794   .0170958     1.24   0.213    -.0122295    .0547883
         33  |   .0164332   .0176932     0.93   0.353    -.0182466     .051113
         34  |   .0172217   .0183452     0.94   0.348    -.0187361    .0531796
         35  |   .0165728   .0191602     0.86   0.387    -.0209826    .0541282
         36  |   .0142958   .0201461     0.71   0.478    -.0251919    .0537836
         37  |   .0107569    .021063     0.51   0.610     -.030528    .0520418
         38  |   .0086463   .0219371     0.39   0.693    -.0343519    .0516445
         39  |   .0124006   .0229892     0.54   0.590    -.0326597     .057461
         40  |   .0128649   .0238795     0.54   0.590    -.0339407    .0596704
         41  |    .032084   .0249524     1.29   0.199    -.0168244    .0809924
         42  |   .0383272   .0260682     1.47   0.142    -.0127682    .0894226
         43  |   .0403281    .027329     1.48   0.140    -.0132385    .0938948
         44  |    .054225   .0285221     1.90   0.057    -.0016802    .1101303
         45  |    .057113   .0296308     1.93   0.054    -.0009654    .1151914
         46  |   .0588919   .0308109     1.91   0.056    -.0014997    .1192835
         47  |    .069623   .0318845     2.18   0.029     .0071271    .1321188
         48  |   .0606997   .0326564     1.86   0.063    -.0033092    .1247086
         49  |  -.2130889   .0339515    -6.28   0.000    -.2796362   -.1465415
         50  |  -.2678028   .0351807    -7.61   0.000    -.3367594   -.1988461
             |
     age_cat |
          1  |   .0482293   .0062926     7.66   0.000     .0358955    .0605632
          2  |   .0724231   .0070926    10.21   0.000     .0585211    .0863252
          3  |   .0876965    .007894    11.11   0.000     .0722238    .1031693
          4  |   .1108862   .0088817    12.48   0.000     .0934775    .1282949
          5  |    .124423    .009909    12.56   0.000     .1050007    .1438454
          6  |    .136323   .0110812    12.30   0.000     .1146031    .1580428
          7  |   .1429808   .0122459    11.68   0.000     .1189781    .1669835
          8  |   .1572924   .0134796    11.67   0.000     .1308714    .1837133
          9  |   .1600229   .0147246    10.87   0.000     .1311617     .188884
         10  |   .1623106   .0159608    10.17   0.000     .1310262    .1935949
         11  |   .1703185   .0172046     9.90   0.000     .1365963    .2040407
         12  |   .1697972   .0184683     9.19   0.000      .133598    .2059964
         13  |    .178952   .0198066     9.03   0.000     .1401297    .2177743
         14  |   .1886955   .0211914     8.90   0.000     .1471588    .2302322
         15  |   .1976657   .0224717     8.80   0.000     .1536196    .2417117
         16  |   .2043623   .0238005     8.59   0.000     .1577117    .2510128
         17  |    .204297   .0250725     8.15   0.000     .1551532    .2534408
         18  |   .2117478   .0265285     7.98   0.000       .15975    .2637455
         19  |   .2035404   .0280801     7.25   0.000     .1485014    .2585794
         20  |   .2113859   .0302993     6.98   0.000     .1519971    .2707747
         25  |   .2237615   .0349801     6.40   0.000      .155198    .2923249
         30  |    .198963   .0512559     3.88   0.000     .0984979    .2994281
         40  |   .1800951   .0576303     3.13   0.002     .0671357    .2930545
         50  |   .1012937   .0631587     1.60   0.109    -.0225018    .2250891
             |
       _cons |   .2638287   .0115081    22.93   0.000     .2412719    .2863854
-------------+----------------------------------------------------------------
     sigma_u |  .39310239
     sigma_e |  .28510825
         rho |  .65529631   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. local fmt "%10.5f"

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }
key: R2_within
value: .0465000141495682

. 
. estimates

----------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------

Fixed-effects (within) regression               Number of obs     =    368,493
Group variable: id                              Number of groups  =     22,580

R-sq:                                           Obs per group:
     within  = 0.0465                                         min =          1
     between = 0.1308                                         avg =       16.3
     overall = 0.0880                                         max =        181

                                                F(75,22579)       =      36.49
corr(u_i, Xb)  = 0.1885                         Prob > F          =     0.0000

                                (Std. Err. adjusted for 22,580 clusters in id)
------------------------------------------------------------------------------
             |               Robust
    exporter |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0302947   .0113765     2.66   0.008     .0079959    .0525934
       expat |   .0096734   .0035418     2.73   0.006     .0027312    .0166155
             |
    ind_year |
          2  |  -.0259038   .0075763    -3.42   0.001    -.0407538   -.0110538
          3  |  -.0436375     .00919    -4.75   0.000    -.0616504   -.0256245
          4  |  -.0549996   .0099854    -5.51   0.000    -.0745716   -.0354277
          5  |  -.0486516   .0111027    -4.38   0.000    -.0704136   -.0268895
          6  |  -.0627967   .0119468    -5.26   0.000    -.0862133   -.0393801
          7  |  -.0596835   .0129144    -4.62   0.000    -.0849965   -.0343705
          8  |  -.0751734   .0138888    -5.41   0.000    -.1023964   -.0479505
          9  |  -.0751012   .0150508    -4.99   0.000    -.1046017   -.0456007
         10  |  -.0703325   .0161103    -4.37   0.000    -.1019099   -.0387552
         11  |  -.0755129    .017254    -4.38   0.000    -.1093319   -.0416939
         12  |  -.0775353   .0182922    -4.24   0.000    -.1133892   -.0416814
         13  |  -.0706842   .0194729    -3.63   0.000    -.1088525   -.0325159
         14  |  -.0609252   .0206661    -2.95   0.003    -.1014321   -.0204183
         15  |  -.0498101   .0218665    -2.28   0.023    -.0926699   -.0069502
         16  |  -.0382589   .0230602    -1.66   0.097    -.0834583    .0069406
         17  |   -.023163   .0242739    -0.95   0.340    -.0707414    .0244155
         18  |  -.0214146   .0256055    -0.84   0.403    -.0716031    .0287738
         19  |  -.0213968    .026834    -0.80   0.425    -.0739933    .0311998
         20  |  -.0126494   .0280034    -0.45   0.651     -.067538    .0422392
         21  |    -.00809    .029098    -0.28   0.781    -.0651241    .0489441
         22  |  -.0049352   .0301685    -0.16   0.870    -.0640675    .0541972
         23  |  -.0070508   .0312254    -0.23   0.821    -.0682548    .0541532
         24  |  -.1201732   .0322826    -3.72   0.000    -.1834493   -.0568972
         25  |  -.1541216   .0335446    -4.59   0.000    -.2198712   -.0883719
         26  |   .0344018   .0188915     1.82   0.069    -.0026269    .0714305
         27  |   .0129269   .0171541     0.75   0.451    -.0206962    .0465501
         28  |   .0176076   .0167868     1.05   0.294    -.0152956    .0505109
         29  |   .0216422   .0165164     1.31   0.190    -.0107311    .0540155
         30  |   .0235763   .0166051     1.42   0.156    -.0089708    .0561235
         31  |   .0181694   .0167057     1.09   0.277    -.0145748    .0509137
         32  |   .0212794   .0170958     1.24   0.213    -.0122295    .0547883
         33  |   .0164332   .0176932     0.93   0.353    -.0182466     .051113
         34  |   .0172217   .0183452     0.94   0.348    -.0187361    .0531796
         35  |   .0165728   .0191602     0.86   0.387    -.0209826    .0541282
         36  |   .0142958   .0201461     0.71   0.478    -.0251919    .0537836
         37  |   .0107569    .021063     0.51   0.610     -.030528    .0520418
         38  |   .0086463   .0219371     0.39   0.693    -.0343519    .0516445
         39  |   .0124006   .0229892     0.54   0.590    -.0326597     .057461
         40  |   .0128649   .0238795     0.54   0.590    -.0339407    .0596704
         41  |    .032084   .0249524     1.29   0.199    -.0168244    .0809924
         42  |   .0383272   .0260682     1.47   0.142    -.0127682    .0894226
         43  |   .0403281    .027329     1.48   0.140    -.0132385    .0938948
         44  |    .054225   .0285221     1.90   0.057    -.0016802    .1101303
         45  |    .057113   .0296308     1.93   0.054    -.0009654    .1151914
         46  |   .0588919   .0308109     1.91   0.056    -.0014997    .1192835
         47  |    .069623   .0318845     2.18   0.029     .0071271    .1321188
         48  |   .0606997   .0326564     1.86   0.063    -.0033092    .1247086
         49  |  -.2130889   .0339515    -6.28   0.000    -.2796362   -.1465415
         50  |  -.2678028   .0351807    -7.61   0.000    -.3367594   -.1988461
             |
     age_cat |
          1  |   .0482293   .0062926     7.66   0.000     .0358955    .0605632
          2  |   .0724231   .0070926    10.21   0.000     .0585211    .0863252
          3  |   .0876965    .007894    11.11   0.000     .0722238    .1031693
          4  |   .1108862   .0088817    12.48   0.000     .0934775    .1282949
          5  |    .124423    .009909    12.56   0.000     .1050007    .1438454
          6  |    .136323   .0110812    12.30   0.000     .1146031    .1580428
          7  |   .1429808   .0122459    11.68   0.000     .1189781    .1669835
          8  |   .1572924   .0134796    11.67   0.000     .1308714    .1837133
          9  |   .1600229   .0147246    10.87   0.000     .1311617     .188884
         10  |   .1623106   .0159608    10.17   0.000     .1310262    .1935949
         11  |   .1703185   .0172046     9.90   0.000     .1365963    .2040407
         12  |   .1697972   .0184683     9.19   0.000      .133598    .2059964
         13  |    .178952   .0198066     9.03   0.000     .1401297    .2177743
         14  |   .1886955   .0211914     8.90   0.000     .1471588    .2302322
         15  |   .1976657   .0224717     8.80   0.000     .1536196    .2417117
         16  |   .2043623   .0238005     8.59   0.000     .1577117    .2510128
         17  |    .204297   .0250725     8.15   0.000     .1551532    .2534408
         18  |   .2117478   .0265285     7.98   0.000       .15975    .2637455
         19  |   .2035404   .0280801     7.25   0.000     .1485014    .2585794
         20  |   .2113859   .0302993     6.98   0.000     .1519971    .2707747
         25  |   .2237615   .0349801     6.40   0.000      .155198    .2923249
         30  |    .198963   .0512559     3.88   0.000     .0984979    .2994281
         40  |   .1800951   .0576303     3.13   0.002     .0671357    .2930545
         50  |   .1012937   .0631587     1.60   0.109    -.0225018    .2250891
             |
       _cons |   .2638287   .0115081    22.93   0.000     .2412719    .2863854
-------------+----------------------------------------------------------------
     sigma_u |  .39310239
     sigma_e |  .28510825
         rho |  .65529631   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text repla
> ce

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b', "`fmt'")) _newline
  6.         file write `output' ("   standard_error: " + string(`se', "`fmt'")) _
> newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se', "`fmt'")) 
> _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',
> "pvalue"),colnumb(`coefs',"`X'")]), "`fmt'") _newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file
(sum of wgt is   1.1357e+05)

Linear regression                               Number of obs     =    288,264
                                                F(75, 18612)      =      61.42
                                                Prob > F          =     0.0000
                                                R-squared         =     0.1094
                                                Root MSE          =     .44109

                                (Std. Err. adjusted for 18,613 clusters in id)
------------------------------------------------------------------------------
             |               Robust
    exporter |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .2506935   .0135584    18.49   0.000     .2241178    .2772691
       expat |   .0705939   .0221933     3.18   0.001     .0270931    .1140947
             |
    ind_year |
          2  |  -.0319552    .008483    -3.77   0.000    -.0485827   -.0153276
          3  |  -.0538419   .0099329    -5.42   0.000    -.0733112   -.0343726
          4  |  -.0628828   .0102802    -6.12   0.000    -.0830329   -.0427327
          5  |  -.0572122   .0107073    -5.34   0.000    -.0781995    -.036225
          6  |  -.0693204   .0108737    -6.38   0.000    -.0906338    -.048007
          7  |  -.0721045   .0110179    -6.54   0.000    -.0937006   -.0505084
          8  |  -.0882444   .0110785    -7.97   0.000    -.1099594   -.0665295
          9  |  -.0929904   .0111697    -8.33   0.000    -.1148841   -.0710967
         10  |  -.0903832   .0112799    -8.01   0.000    -.1124929   -.0682735
         11  |  -.1029921   .0111774    -9.21   0.000    -.1249008   -.0810834
         12  |  -.1101461   .0111873    -9.85   0.000    -.1320742   -.0882179
         13  |  -.1089838   .0111999    -9.73   0.000    -.1309365   -.0870311
         14  |  -.1027889   .0113201    -9.08   0.000    -.1249773   -.0806006
         15  |   -.095289   .0114217    -8.34   0.000    -.1176765   -.0729015
         16  |  -.0850427   .0115651    -7.35   0.000    -.1077113   -.0623741
         17  |  -.0707544   .0117322    -6.03   0.000    -.0937506   -.0477581
         18  |  -.0705304   .0118517    -5.95   0.000    -.0937607      -.0473
         19  |  -.0666881   .0120038    -5.56   0.000    -.0902167   -.0431594
         20  |  -.0544391   .0121943    -4.46   0.000     -.078341   -.0305372
         21  |  -.0496012   .0123893    -4.00   0.000    -.0738855    -.025317
         22  |  -.0488094   .0126637    -3.85   0.000    -.0736315   -.0239873
         23  |  -.0501656   .0127989    -3.92   0.000    -.0752525   -.0250786
         24  |  -.1503936   .0124211   -12.11   0.000    -.1747401    -.126047
         25  |  -.1815125   .0126818   -14.31   0.000      -.20637   -.1566551
         26  |   .2164868   .0175423    12.34   0.000     .1821022    .2508713
         27  |   .1756792   .0154107    11.40   0.000     .1454729    .2058855
         28  |   .1766862   .0149217    11.84   0.000     .1474382    .2059342
         29  |   .1755093   .0149233    11.76   0.000     .1462584    .2047603
         30  |   .1868882   .0148802    12.56   0.000     .1577218    .2160547
         31  |   .1826322   .0147286    12.40   0.000     .1537628    .2115015
         32  |   .1827819   .0144995    12.61   0.000     .1543616    .2112022
         33  |   .1667689   .0144163    11.57   0.000     .1385116    .1950262
         34  |   .1726039   .0143916    11.99   0.000      .144395    .2008127
         35  |   .1766439    .014397    12.27   0.000     .1484245    .2048633
         36  |   .1830747   .0143743    12.74   0.000     .1548997    .2112496
         37  |   .1671576   .0143906    11.62   0.000     .1389508    .1953644
         38  |   .1615266   .0142782    11.31   0.000       .13354    .1895133
         39  |    .164521     .01436    11.46   0.000      .136374    .1926679
         40  |   .1683285   .0144326    11.66   0.000     .1400393    .1966177
         41  |   .1866854   .0146946    12.70   0.000     .1578827    .2154881
         42  |   .1910448   .0148182    12.89   0.000     .1619997    .2200899
         43  |   .1957741   .0151123    12.95   0.000     .1661526    .2253955
         44  |   .2133969   .0153402    13.91   0.000     .1833287    .2434651
         45  |   .2139596   .0155747    13.74   0.000     .1834317    .2444875
         46  |   .2228538   .0157708    14.13   0.000     .1919415    .2537661
         47  |   .2429109   .0160847    15.10   0.000     .2113835    .2744383
         48  |   .2369714   .0161422    14.68   0.000     .2053313    .2686115
         49  |  -.0446001   .0159034    -2.80   0.005    -.0757723    -.013428
         50  |  -.0856731   .0160924    -5.32   0.000    -.1172157   -.0541305
             |
     age_cat |
          1  |   .0508873   .0069258     7.35   0.000     .0373121    .0644625
          2  |   .0759216   .0072986    10.40   0.000     .0616157    .0902275
          3  |   .0908559   .0075434    12.04   0.000     .0760701    .1056417
          4  |   .1182641   .0077899    15.18   0.000     .1029952     .133533
          5  |    .135091   .0080304    16.82   0.000     .1193507    .1508314
          6  |   .1492836   .0083368    17.91   0.000     .1329427    .1656245
          7  |   .1582975   .0085718    18.47   0.000     .1414959    .1750991
          8  |   .1761165   .0088738    19.85   0.000      .158723      .19351
          9  |   .1816636   .0090961    19.97   0.000     .1638345    .1994928
         10  |   .1851313   .0092886    19.93   0.000     .1669249    .2033378
         11  |   .1939505   .0094961    20.42   0.000     .1753372    .2125637
         12  |   .1997341   .0097131    20.56   0.000     .1806955    .2187727
         13  |   .2103989   .0100424    20.95   0.000     .1907148     .230083
         14  |   .2176714    .010446    20.84   0.000     .1971963    .2381466
         15  |   .2314286   .0107742    21.48   0.000     .2103101    .2525471
         16  |   .2360866   .0111931    21.09   0.000     .2141471    .2580261
         17  |   .2399547   .0115747    20.73   0.000     .2172673    .2626422
         18  |     .24615   .0120459    20.43   0.000      .222539     .269761
         19  |   .2382154   .0124684    19.11   0.000     .2137762    .2626546
         20  |   .2459563   .0129045    19.06   0.000     .2206623    .2712503
         25  |   .2457534   .0168933    14.55   0.000     .2126409    .2788659
         30  |   .0793013   .0179912     4.41   0.000     .0440368    .1145657
         40  |   .1194395   .0176726     6.76   0.000     .0847996    .1540793
         50  |   .0949656   .0210819     4.50   0.000     .0536432     .136288
             |
       _cons |    .149322    .010949    13.64   0.000     .1278609    .1707832
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. local fmt "%10.5f"

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }

. 
. estimates

----------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------

Linear regression                               Number of obs     =    288,264
                                                F(75, 18612)      =      61.42
                                                Prob > F          =     0.0000
                                                R-squared         =     0.1094
                                                Root MSE          =     .44109

                                (Std. Err. adjusted for 18,613 clusters in id)
------------------------------------------------------------------------------
             |               Robust
    exporter |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .2506935   .0135584    18.49   0.000     .2241178    .2772691
       expat |   .0705939   .0221933     3.18   0.001     .0270931    .1140947
             |
    ind_year |
          2  |  -.0319552    .008483    -3.77   0.000    -.0485827   -.0153276
          3  |  -.0538419   .0099329    -5.42   0.000    -.0733112   -.0343726
          4  |  -.0628828   .0102802    -6.12   0.000    -.0830329   -.0427327
          5  |  -.0572122   .0107073    -5.34   0.000    -.0781995    -.036225
          6  |  -.0693204   .0108737    -6.38   0.000    -.0906338    -.048007
          7  |  -.0721045   .0110179    -6.54   0.000    -.0937006   -.0505084
          8  |  -.0882444   .0110785    -7.97   0.000    -.1099594   -.0665295
          9  |  -.0929904   .0111697    -8.33   0.000    -.1148841   -.0710967
         10  |  -.0903832   .0112799    -8.01   0.000    -.1124929   -.0682735
         11  |  -.1029921   .0111774    -9.21   0.000    -.1249008   -.0810834
         12  |  -.1101461   .0111873    -9.85   0.000    -.1320742   -.0882179
         13  |  -.1089838   .0111999    -9.73   0.000    -.1309365   -.0870311
         14  |  -.1027889   .0113201    -9.08   0.000    -.1249773   -.0806006
         15  |   -.095289   .0114217    -8.34   0.000    -.1176765   -.0729015
         16  |  -.0850427   .0115651    -7.35   0.000    -.1077113   -.0623741
         17  |  -.0707544   .0117322    -6.03   0.000    -.0937506   -.0477581
         18  |  -.0705304   .0118517    -5.95   0.000    -.0937607      -.0473
         19  |  -.0666881   .0120038    -5.56   0.000    -.0902167   -.0431594
         20  |  -.0544391   .0121943    -4.46   0.000     -.078341   -.0305372
         21  |  -.0496012   .0123893    -4.00   0.000    -.0738855    -.025317
         22  |  -.0488094   .0126637    -3.85   0.000    -.0736315   -.0239873
         23  |  -.0501656   .0127989    -3.92   0.000    -.0752525   -.0250786
         24  |  -.1503936   .0124211   -12.11   0.000    -.1747401    -.126047
         25  |  -.1815125   .0126818   -14.31   0.000      -.20637   -.1566551
         26  |   .2164868   .0175423    12.34   0.000     .1821022    .2508713
         27  |   .1756792   .0154107    11.40   0.000     .1454729    .2058855
         28  |   .1766862   .0149217    11.84   0.000     .1474382    .2059342
         29  |   .1755093   .0149233    11.76   0.000     .1462584    .2047603
         30  |   .1868882   .0148802    12.56   0.000     .1577218    .2160547
         31  |   .1826322   .0147286    12.40   0.000     .1537628    .2115015
         32  |   .1827819   .0144995    12.61   0.000     .1543616    .2112022
         33  |   .1667689   .0144163    11.57   0.000     .1385116    .1950262
         34  |   .1726039   .0143916    11.99   0.000      .144395    .2008127
         35  |   .1766439    .014397    12.27   0.000     .1484245    .2048633
         36  |   .1830747   .0143743    12.74   0.000     .1548997    .2112496
         37  |   .1671576   .0143906    11.62   0.000     .1389508    .1953644
         38  |   .1615266   .0142782    11.31   0.000       .13354    .1895133
         39  |    .164521     .01436    11.46   0.000      .136374    .1926679
         40  |   .1683285   .0144326    11.66   0.000     .1400393    .1966177
         41  |   .1866854   .0146946    12.70   0.000     .1578827    .2154881
         42  |   .1910448   .0148182    12.89   0.000     .1619997    .2200899
         43  |   .1957741   .0151123    12.95   0.000     .1661526    .2253955
         44  |   .2133969   .0153402    13.91   0.000     .1833287    .2434651
         45  |   .2139596   .0155747    13.74   0.000     .1834317    .2444875
         46  |   .2228538   .0157708    14.13   0.000     .1919415    .2537661
         47  |   .2429109   .0160847    15.10   0.000     .2113835    .2744383
         48  |   .2369714   .0161422    14.68   0.000     .2053313    .2686115
         49  |  -.0446001   .0159034    -2.80   0.005    -.0757723    -.013428
         50  |  -.0856731   .0160924    -5.32   0.000    -.1172157   -.0541305
             |
     age_cat |
          1  |   .0508873   .0069258     7.35   0.000     .0373121    .0644625
          2  |   .0759216   .0072986    10.40   0.000     .0616157    .0902275
          3  |   .0908559   .0075434    12.04   0.000     .0760701    .1056417
          4  |   .1182641   .0077899    15.18   0.000     .1029952     .133533
          5  |    .135091   .0080304    16.82   0.000     .1193507    .1508314
          6  |   .1492836   .0083368    17.91   0.000     .1329427    .1656245
          7  |   .1582975   .0085718    18.47   0.000     .1414959    .1750991
          8  |   .1761165   .0088738    19.85   0.000      .158723      .19351
          9  |   .1816636   .0090961    19.97   0.000     .1638345    .1994928
         10  |   .1851313   .0092886    19.93   0.000     .1669249    .2033378
         11  |   .1939505   .0094961    20.42   0.000     .1753372    .2125637
         12  |   .1997341   .0097131    20.56   0.000     .1806955    .2187727
         13  |   .2103989   .0100424    20.95   0.000     .1907148     .230083
         14  |   .2176714    .010446    20.84   0.000     .1971963    .2381466
         15  |   .2314286   .0107742    21.48   0.000     .2103101    .2525471
         16  |   .2360866   .0111931    21.09   0.000     .2141471    .2580261
         17  |   .2399547   .0115747    20.73   0.000     .2172673    .2626422
         18  |     .24615   .0120459    20.43   0.000      .222539     .269761
         19  |   .2382154   .0124684    19.11   0.000     .2137762    .2626546
         20  |   .2459563   .0129045    19.06   0.000     .2206623    .2712503
         25  |   .2457534   .0168933    14.55   0.000     .2126409    .2788659
         30  |   .0793013   .0179912     4.41   0.000     .0440368    .1145657
         40  |   .1194395   .0176726     6.76   0.000     .0847996    .1540793
         50  |   .0949656   .0210819     4.50   0.000     .0536432     .136288
             |
       _cons |    .149322    .010949    13.64   0.000     .1278609    .1707832
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text repla
> ce

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b', "`fmt'")) _newline
  6.         file write `output' ("   standard_error: " + string(`se', "`fmt'")) _
> newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se', "`fmt'")) 
> _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',
> "pvalue"),colnumb(`coefs',"`X'")]), "`fmt'") _newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file

Fixed-effects (within) regression               Number of obs     =    288,264
Group variable: id                              Number of groups  =     18,613

R-sq:                                           Obs per group:
     within  = 0.0499                                         min =          1
     between = 0.0635                                         avg =       15.5
     overall = 0.0565                                         max =        181

                                                F(75,18612)       =      31.18
corr(u_i, Xb)  = 0.0967                         Prob > F          =     0.0000

                                (Std. Err. adjusted for 18,613 clusters in id)
------------------------------------------------------------------------------
             |               Robust
    exporter |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0099545   .0122729     0.81   0.417    -.0141014    .0340104
       expat |   .0324177   .0102137     3.17   0.002     .0123979    .0524375
             |
    ind_year |
          2  |    -.02526   .0078276    -3.23   0.001    -.0406029   -.0099172
          3  |  -.0431071   .0096456    -4.47   0.000    -.0620133   -.0242009
          4  |  -.0544406   .0104328    -5.22   0.000    -.0748898   -.0339914
          5  |   -.050695   .0116095    -4.37   0.000    -.0734508   -.0279392
          6  |  -.0633571   .0125559    -5.05   0.000    -.0879679   -.0387463
          7  |  -.0670443   .0136308    -4.92   0.000    -.0937619   -.0403268
          8  |  -.0812105    .014606    -5.56   0.000    -.1098395   -.0525815
          9  |  -.0810502   .0158419    -5.12   0.000    -.1121018   -.0499986
         10  |  -.0778669    .016937    -4.60   0.000     -.111065   -.0446689
         11  |  -.0834755   .0181247    -4.61   0.000    -.1190015   -.0479495
         12  |  -.0881203   .0192254    -4.58   0.000    -.1258039   -.0504367
         13  |  -.0828914   .0204562    -4.05   0.000    -.1229874   -.0427953
         14  |  -.0752161   .0217079    -3.46   0.001    -.1177655   -.0326666
         15  |  -.0638758    .022955    -2.78   0.005    -.1088697   -.0188819
         16  |  -.0526598    .024177    -2.18   0.029     -.100049   -.0052706
         17  |  -.0369433   .0254529    -1.45   0.147    -.0868332    .0129466
         18  |   -.036617   .0268574    -1.36   0.173      -.08926    .0160259
         19  |   -.033873    .028126    -1.20   0.228    -.0890024    .0212565
         20  |  -.0259803   .0293442    -0.89   0.376    -.0834977    .0315371
         21  |  -.0251882   .0304684    -0.83   0.408     -.084909    .0345326
         22  |  -.0234985   .0315838    -0.74   0.457    -.0854057    .0384086
         23  |   -.027577   .0326946    -0.84   0.399    -.0916614    .0365073
         24  |  -.1372804   .0337635    -4.07   0.000    -.2034598   -.0711009
         25  |  -.1739009   .0351003    -4.95   0.000    -.2427008   -.1051011
         26  |   .0091984   .0208698     0.44   0.659    -.0317083    .0501051
         27  |  -.0081401   .0189429    -0.43   0.667    -.0452699    .0289897
         28  |   .0023087   .0185361     0.12   0.901    -.0340238    .0386411
         29  |  -.0009335   .0182972    -0.05   0.959    -.0367977    .0349307
         30  |   .0039887   .0183701     0.22   0.828    -.0320184    .0399959
         31  |   .0001206   .0183858     0.01   0.995    -.0359172    .0361584
         32  |   .0064685   .0187491     0.35   0.730    -.0302814    .0432185
         33  |  -.0024519   .0193013    -0.13   0.899    -.0402843    .0353805
         34  |   .0015461   .0199329     0.08   0.938    -.0375243    .0406164
         35  |    .002458   .0206733     0.12   0.905    -.0380636    .0429796
         36  |   .0043383   .0217129     0.20   0.842     -.038221    .0468977
         37  |  -.0082208   .0227219    -0.36   0.718    -.0527577    .0363161
         38  |  -.0118421   .0235488    -0.50   0.615    -.0579998    .0343157
         39  |  -.0036427   .0247041    -0.15   0.883     -.052065    .0447797
         40  |   .0048633   .0255342     0.19   0.849    -.0451859    .0549126
         41  |   .0231473   .0266677     0.87   0.385    -.0291238    .0754185
         42  |   .0299724   .0277549     1.08   0.280    -.0244297    .0843745
         43  |   .0343754   .0290646     1.18   0.237    -.0225939    .0913448
         44  |   .0513572   .0303018     1.69   0.090     -.008037    .1107515
         45  |   .0552936   .0314401     1.76   0.079     -.006332    .1169191
         46  |   .0570101   .0326815     1.74   0.081    -.0070487    .1210688
         47  |   .0734978   .0337409     2.18   0.029     .0073625    .1396332
         48  |   .0645987   .0344452     1.88   0.061     -.002917    .1321144
         49  |  -.2352229   .0358254    -6.57   0.000    -.3054439   -.1650019
         50  |  -.2889764   .0371355    -7.78   0.000    -.3617652   -.2161875
             |
     age_cat |
          1  |   .0482072   .0066539     7.24   0.000     .0351649    .0612495
          2  |   .0710579   .0074972     9.48   0.000     .0563626    .0857532
          3  |   .0871444   .0083763    10.40   0.000      .070726    .1035627
          4  |   .1116979   .0094215    11.86   0.000     .0932309    .1301648
          5  |   .1288874   .0105028    12.27   0.000     .1083009    .1494739
          6  |   .1425402   .0117506    12.13   0.000     .1195079    .1655725
          7  |   .1502177   .0129544    11.60   0.000     .1248259    .1756094
          8  |   .1664321   .0142546    11.68   0.000     .1384918    .1943725
          9  |   .1693632   .0155308    10.91   0.000     .1389215     .199805
         10  |   .1717823   .0168362    10.20   0.000     .1387819    .2047828
         11  |   .1812861    .018143     9.99   0.000     .1457242    .2168481
         12  |   .1836681   .0194546     9.44   0.000     .1455353    .2218009
         13  |   .1931587   .0208543     9.26   0.000     .1522824    .2340349
         14  |   .2029385   .0223022     9.10   0.000     .1592241    .2466529
         15  |   .2129196   .0236502     9.00   0.000     .1665632    .2592761
         16  |   .2164919   .0250361     8.65   0.000     .1674189     .265565
         17  |   .2208484   .0263251     8.39   0.000     .1692487     .272448
         18  |   .2287772   .0278536     8.21   0.000     .1741815    .2833728
         19  |    .220598   .0294765     7.48   0.000     .1628213    .2783748
         20  |   .2301527   .0317714     7.24   0.000     .1678779    .2924276
         25  |   .2423408   .0366604     6.61   0.000     .1704831    .3141984
         30  |   .2275381   .0534838     4.25   0.000      .122705    .3323713
         40  |   .2096766   .0600939     3.49   0.000      .091887    .3274661
         50  |   .1332034   .0655605     2.03   0.042     .0046988    .2617081
             |
       _cons |   .2100392   .0117589    17.86   0.000     .1869908    .2330877
-------------+----------------------------------------------------------------
     sigma_u |  .37165256
     sigma_e |  .28608153
         rho |  .62793433   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. args tablefile specname speclabel

. 
. local fmt "%10.5f"

. 
. * create directory if needed
. * FIXME: this only works with relative paths
. local list_of_dirs = subinstr("`tablefile'/columns","/"," ",.)

. local sofar "."

. foreach word in `list_of_dirs' {
  2.         local sofar "`sofar'/`word'"
  3.         capture mkdir "`sofar'"
  4. }

. 
. macro shift

. macro shift

. macro shift

. 
. local _others ""

. local _state "key"

. while "`1'"!="" {
  2.         if ("`_state'"=="key") {
  3.                 di "key: `1'"
  4.                 local _key `1'
  5.                 local _state "value"
  6.                 local _others "`_others' `1'"
  7.         }
  8.         else {
  9.                 di "value: `1'"
 10.                 local `_key' "`1'"
 11.                 local _state "key"
 12.         }
 13.         macro shift
 14. }
key: R2_within
value: .0499125267411363

. 
. estimates

----------------------------------------------------------------------------------
active results
----------------------------------------------------------------------------------

Fixed-effects (within) regression               Number of obs     =    288,264
Group variable: id                              Number of groups  =     18,613

R-sq:                                           Obs per group:
     within  = 0.0499                                         min =          1
     between = 0.0635                                         avg =       15.5
     overall = 0.0565                                         max =        181

                                                F(75,18612)       =      31.18
corr(u_i, Xb)  = 0.0967                         Prob > F          =     0.0000

                                (Std. Err. adjusted for 18,613 clusters in id)
------------------------------------------------------------------------------
             |               Robust
    exporter |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     foreign |   .0099545   .0122729     0.81   0.417    -.0141014    .0340104
       expat |   .0324177   .0102137     3.17   0.002     .0123979    .0524375
             |
    ind_year |
          2  |    -.02526   .0078276    -3.23   0.001    -.0406029   -.0099172
          3  |  -.0431071   .0096456    -4.47   0.000    -.0620133   -.0242009
          4  |  -.0544406   .0104328    -5.22   0.000    -.0748898   -.0339914
          5  |   -.050695   .0116095    -4.37   0.000    -.0734508   -.0279392
          6  |  -.0633571   .0125559    -5.05   0.000    -.0879679   -.0387463
          7  |  -.0670443   .0136308    -4.92   0.000    -.0937619   -.0403268
          8  |  -.0812105    .014606    -5.56   0.000    -.1098395   -.0525815
          9  |  -.0810502   .0158419    -5.12   0.000    -.1121018   -.0499986
         10  |  -.0778669    .016937    -4.60   0.000     -.111065   -.0446689
         11  |  -.0834755   .0181247    -4.61   0.000    -.1190015   -.0479495
         12  |  -.0881203   .0192254    -4.58   0.000    -.1258039   -.0504367
         13  |  -.0828914   .0204562    -4.05   0.000    -.1229874   -.0427953
         14  |  -.0752161   .0217079    -3.46   0.001    -.1177655   -.0326666
         15  |  -.0638758    .022955    -2.78   0.005    -.1088697   -.0188819
         16  |  -.0526598    .024177    -2.18   0.029     -.100049   -.0052706
         17  |  -.0369433   .0254529    -1.45   0.147    -.0868332    .0129466
         18  |   -.036617   .0268574    -1.36   0.173      -.08926    .0160259
         19  |   -.033873    .028126    -1.20   0.228    -.0890024    .0212565
         20  |  -.0259803   .0293442    -0.89   0.376    -.0834977    .0315371
         21  |  -.0251882   .0304684    -0.83   0.408     -.084909    .0345326
         22  |  -.0234985   .0315838    -0.74   0.457    -.0854057    .0384086
         23  |   -.027577   .0326946    -0.84   0.399    -.0916614    .0365073
         24  |  -.1372804   .0337635    -4.07   0.000    -.2034598   -.0711009
         25  |  -.1739009   .0351003    -4.95   0.000    -.2427008   -.1051011
         26  |   .0091984   .0208698     0.44   0.659    -.0317083    .0501051
         27  |  -.0081401   .0189429    -0.43   0.667    -.0452699    .0289897
         28  |   .0023087   .0185361     0.12   0.901    -.0340238    .0386411
         29  |  -.0009335   .0182972    -0.05   0.959    -.0367977    .0349307
         30  |   .0039887   .0183701     0.22   0.828    -.0320184    .0399959
         31  |   .0001206   .0183858     0.01   0.995    -.0359172    .0361584
         32  |   .0064685   .0187491     0.35   0.730    -.0302814    .0432185
         33  |  -.0024519   .0193013    -0.13   0.899    -.0402843    .0353805
         34  |   .0015461   .0199329     0.08   0.938    -.0375243    .0406164
         35  |    .002458   .0206733     0.12   0.905    -.0380636    .0429796
         36  |   .0043383   .0217129     0.20   0.842     -.038221    .0468977
         37  |  -.0082208   .0227219    -0.36   0.718    -.0527577    .0363161
         38  |  -.0118421   .0235488    -0.50   0.615    -.0579998    .0343157
         39  |  -.0036427   .0247041    -0.15   0.883     -.052065    .0447797
         40  |   .0048633   .0255342     0.19   0.849    -.0451859    .0549126
         41  |   .0231473   .0266677     0.87   0.385    -.0291238    .0754185
         42  |   .0299724   .0277549     1.08   0.280    -.0244297    .0843745
         43  |   .0343754   .0290646     1.18   0.237    -.0225939    .0913448
         44  |   .0513572   .0303018     1.69   0.090     -.008037    .1107515
         45  |   .0552936   .0314401     1.76   0.079     -.006332    .1169191
         46  |   .0570101   .0326815     1.74   0.081    -.0070487    .1210688
         47  |   .0734978   .0337409     2.18   0.029     .0073625    .1396332
         48  |   .0645987   .0344452     1.88   0.061     -.002917    .1321144
         49  |  -.2352229   .0358254    -6.57   0.000    -.3054439   -.1650019
         50  |  -.2889764   .0371355    -7.78   0.000    -.3617652   -.2161875
             |
     age_cat |
          1  |   .0482072   .0066539     7.24   0.000     .0351649    .0612495
          2  |   .0710579   .0074972     9.48   0.000     .0563626    .0857532
          3  |   .0871444   .0083763    10.40   0.000      .070726    .1035627
          4  |   .1116979   .0094215    11.86   0.000     .0932309    .1301648
          5  |   .1288874   .0105028    12.27   0.000     .1083009    .1494739
          6  |   .1425402   .0117506    12.13   0.000     .1195079    .1655725
          7  |   .1502177   .0129544    11.60   0.000     .1248259    .1756094
          8  |   .1664321   .0142546    11.68   0.000     .1384918    .1943725
          9  |   .1693632   .0155308    10.91   0.000     .1389215     .199805
         10  |   .1717823   .0168362    10.20   0.000     .1387819    .2047828
         11  |   .1812861    .018143     9.99   0.000     .1457242    .2168481
         12  |   .1836681   .0194546     9.44   0.000     .1455353    .2218009
         13  |   .1931587   .0208543     9.26   0.000     .1522824    .2340349
         14  |   .2029385   .0223022     9.10   0.000     .1592241    .2466529
         15  |   .2129196   .0236502     9.00   0.000     .1665632    .2592761
         16  |   .2164919   .0250361     8.65   0.000     .1674189     .265565
         17  |   .2208484   .0263251     8.39   0.000     .1692487     .272448
         18  |   .2287772   .0278536     8.21   0.000     .1741815    .2833728
         19  |    .220598   .0294765     7.48   0.000     .1628213    .2783748
         20  |   .2301527   .0317714     7.24   0.000     .1678779    .2924276
         25  |   .2423408   .0366604     6.61   0.000     .1704831    .3141984
         30  |   .2275381   .0534838     4.25   0.000      .122705    .3323713
         40  |   .2096766   .0600939     3.49   0.000      .091887    .3274661
         50  |   .1332034   .0655605     2.03   0.042     .0046988    .2617081
             |
       _cons |   .2100392   .0117589    17.86   0.000     .1869908    .2330877
-------------+----------------------------------------------------------------
     sigma_u |  .37165256
     sigma_e |  .28608153
         rho |  .62793433   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. tempname output coefs stats variables b se

. matrix `coefs' = r(table)

. local observations `e(N)'

. local R2 `e(r2)'

. 
. local `stats' : rownames(`coefs')

. local `variables' : colnames(`coefs')

. 
. 
. file open `output' using "`tablefile'/columns/`specname'.yaml", write text repla
> ce

. 
. file write `output' "id: " "`specname'" _newline

. file write `output' "label: " "`speclabel'" _newline

. 
. file write `output' "coefficients:" _newline

. foreach X in ``variables'' {
  2.         scalar `b' = `coefs'[rownumb(`coefs',"b"),colnumb(`coefs',"`X'")]
  3.         scalar `se' = `coefs'[rownumb(`coefs',"se"),colnumb(`coefs',"`X'")]
  4.         file write `output' (" - id: `X'") _newline
  5.         file write `output' ("   estimate: " + string(`b', "`fmt'")) _newline
  6.         file write `output' ("   standard_error: " + string(`se', "`fmt'")) _
> newline
  7.         file write `output' ("   t_statistic: " + string(`b'/`se', "`fmt'")) 
> _newline
  8.         file write `output' ("   p_value: " + string(`coefs'[rownumb(`coefs',
> "pvalue"),colnumb(`coefs',"`X'")]), "`fmt'") _newline
  9. }

. file write `output' "extra_rows:" _newline

. foreach X in R2 observations `_others'{
  2.         if ("``X''"!="") {
  3.                 file write `output' (" - id: `X'") _newline
  4.                 file write `output' ("   value: ``X''") _newline
  5.         }
  6. }

. 
. file close `output'

. 
end of do-file

. 
end of do-file

. 
. log close
      name:  <unnamed>
       log:  /Users/koren/Google Drive/Research/expat/research_design/talk/output/
> estimate_descriptive.log
  log type:  text
 closed on:  12 Jan 2019, 12:38:16
----------------------------------------------------------------------------------
