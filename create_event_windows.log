
  ___  ____  ____  ____  ____ (R)
 /__    /   ____/   /   ____/
___/   /   /___/   /   /___/   15.1   Copyright 1985-2017 StataCorp LLC
  Statistics/Data Analysis            StataCorp
                                      4905 Lakeway Drive
     MP - Parallel Edition            College Station, Texas 77845 USA
                                      800-STATA-PC        http://www.stata.com
                                      979-696-4600        stata@stata.com
                                      979-696-4601 (fax)

Single-user 2-core Stata perpetual license:
       Serial number:  501506203290
         Licensed to:  Miklos Koren
                       CEU MicroData


Notes:
      1.  Stata is running in batch mode.
      2.  Unicode is supported; see help unicode_advice.
      3.  More than 2 billion observations are allowed; see help obs_advice.
      4.  Maximum number of variables is set to 5000; see help set_maxvar.

. do create_event_windows 

. clear all

. 
. use "temp/balance-small.dta"

. keep frame_id year foreign

. tempfile sample

. save `sample', replace
(note: file /var/folders/w1/7d52g2y563517gpc7n0sv5_r0000gn/T//St56968.000001 no
> t found)
file /var/folders/w1/7d52g2y563517gpc7n0sv5_r0000gn/T//St56968.000001 saved

. 
. use "temp/firm_ceo_panel.dta", clear

. capture drop _*

. 
. scalar T1 = 1988

. scalar T2 = 2018

. expand T2-T1+1
(2,897,640 observations created)

. bys frame_id manager_id job_spell: gen year = _n-1+T1

. 
. * only keep years when the firm is alive, without merging actual balance data
. merge m:1 frame_id year using `sample', nogen keep(match)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                         1,396,105  
    -----------------------------------------

. 
. codebook frame_id

-------------------------------------------------------------------------------
frame_id_numeric                                                    (unlabeled)
-------------------------------------------------------------------------------

                  type:  numeric (long)

                 range:  [10000049,90620052]          units:  1
         unique values:  37,507                   missing .:  0/1,396,105

                  mean:   1.3e+07
              std. dev:   5.2e+06

           percentiles:        10%       25%       50%       75%       90%
                           1.0e+07   1.0e+07   1.1e+07   1.2e+07   1.5e+07

. 
. *expat before 1990
. replace expat=0 if job_begin<1990
(3,202 real changes made)

. 
. ***********************
. * time invariant vars *
. ***********************
.         egen first_year_expat = min(cond(expat==1,job_begin,.)), by(frame_id)
(979172 missing values generated)

.         egen first_year_foreign_original = min(cond(foreign==1,year,.)), by(f
> rame_id)
(906090 missing values generated)

.         
.         * which of the two happened first?
.         generate manager_after_owner = first_year_expat - first_year_foreign_
> original
(1,013,825 missing values generated)

.         * event time relative to that
.         generate event_time = year - first_year_expat
(979,172 missing values generated)

.         
.         generate first_year_foreign = first_year_foreign_original
(906,090 missing values generated)

.         
.         * if foreign manager arrives up to 2 years before 1 year later than f
> oreign owner, use foreign manager as arrival date. this is easier to implemen
> t
.         replace first_year_foreign = first_year_expat if inlist(manager_after
> _owner, -2, -1, 1)
(64,708 real changes made)

.         
.         replace foreign = 1 if (manager_after_owner == -2) & inlist(event_tim
> e, 0, 1)
(541 real changes made)

.         replace foreign = 1 if (manager_after_owner == -1) & inlist(event_tim
> e, 0)
(740 real changes made)

.         replace foreign = 0 if (manager_after_owner == +1) & inlist(event_tim
> e, -1)
(1,760 real changes made)

. 
.         * drop firms where expat arrives earlier than 2 years before owner
.         drop if manager_after_owner < -2
(14,973 observations deleted)

.         
.         drop *_year_*_original event_time manager_after_owner

. 
.         foreach X of var expat foreign {
  2.                 egen ever_`X' = max(`X'==1), by(frame_id)
  3.         }

. 
. *******************************************
. * drop entire series of firms from sample *
. *******************************************
.         drop if ever_expat==1 & ever_foreign==0
(34,900 observations deleted)

.         scalar dropped_do3_expat_firmyears = r(N_drop)

. 
.         * drop very large firms
.         egen fp_tag = tag(frame_id manager_id ) 

.         egen total_CEOs = sum(fp_tag ), by(frame_id )

.         tab total_CEOs 

 total_CEOs |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |     83,393        6.19        6.19
          2 |    186,752       13.87       20.07
          3 |    207,992       15.45       35.52
          4 |    184,781       13.73       49.24
          5 |    153,860       11.43       60.67
          6 |    124,155        9.22       69.89
          7 |     97,326        7.23       77.12
          8 |     71,503        5.31       82.43
          9 |     53,191        3.95       86.39
         10 |     41,677        3.10       89.48
         11 |     31,950        2.37       91.85
         12 |     20,845        1.55       93.40
         13 |     16,765        1.25       94.65
         14 |     16,855        1.25       95.90
         15 |      8,449        0.63       96.53
         16 |      9,664        0.72       97.25
         17 |      9,966        0.74       97.99
         18 |      6,789        0.50       98.49
         19 |      2,988        0.22       98.71
         20 |      1,132        0.08       98.80
         21 |      3,893        0.29       99.09
         22 |        990        0.07       99.16
         23 |      2,023        0.15       99.31
         24 |        648        0.05       99.36
         25 |      1,025        0.08       99.43
         26 |        702        0.05       99.49
         27 |        672        0.05       99.54
         33 |        792        0.06       99.59
         34 |        945        0.07       99.67
         39 |        507        0.04       99.70
         41 |      1,025        0.08       99.78
         42 |      1,134        0.08       99.86
         43 |        387        0.03       99.89
         56 |      1,456        0.11      100.00
------------+-----------------------------------
      Total |  1,346,232      100.00

. 
.         drop if total_CEOs>15
(46,738 observations deleted)

.         scalar dropped_too_many_CEOs = r(N_drop)

.         drop fp_tag total_CEOs

. 
. 
. * tenure at the firm in current job spell
. generate tenure = year - job_begin

. 
. * save firm-year dummy of whether there is an expat at the firm
. preserve

.         collapse (max) max_expat = expat, by(frame_id year)

.         label variable max_expat "Firm has expat CEO (dummy)"

.         save "temp/firm_year_expat.dta", replace
file temp/firm_year_expat.dta saved

. restore

. 
. * limit sample by event window
. keep if tenure >= -5 & tenure <= 10
(507,817 observations deleted)

. 
. compress
  variable year was float now int
  variable first_year_expat was float now int
  variable first_year_foreign was float now int
  variable ever_expat was float now byte
  variable ever_foreign was float now byte
  variable tenure was float now byte
  (11,875,155 bytes saved)

. save "temp/event_windows.dta", replace
file temp/event_windows.dta saved

. save_all_to_json

. 
. 
end of do-file
