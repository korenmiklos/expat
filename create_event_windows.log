
  ___  ____  ____  ____  ____ (R)
 /__    /   ____/   /   ____/
___/   /   /___/   /   /___/   15.1   Copyright 1985-2017 StataCorp LLC
  Statistics/Data Analysis            StataCorp
                                      4905 Lakeway Drive
     MP - Parallel Edition            College Station, Texas 77845 USA
                                      800-STATA-PC        http://www.stata.com
                                      979-696-4600        stata@stata.com
                                      979-696-4601 (fax)

Single-user 2-core Stata perpetual license:
       Serial number:  501506203290
         Licensed to:  Miklos Koren
                       CEU MicroData


Notes:
      1.  Stata is running in batch mode.
      2.  Unicode is supported; see help unicode_advice.
      3.  More than 2 billion observations are allowed; see help obs_advice.
      4.  Maximum number of variables is set to 5000; see help set_maxvar.

. do create_event_windows 

. clear all

. 
. use "temp/balance-small.dta"

. keep frame_id year foreign

. tempfile sample

. save `sample', replace
(note: file /var/folders/w1/7d52g2y563517gpc7n0sv5_r0000gn/T//St05060.000001 no
> t found)
file /var/folders/w1/7d52g2y563517gpc7n0sv5_r0000gn/T//St05060.000001 saved

. 
. use "temp/firm_ceo_panel.dta", clear

. capture drop _*

. 
. scalar T1 = 1988

. scalar T2 = 2018

. expand T2-T1+1
(2,925,840 observations created)

. bys frame_id manager_id job_spell: gen year = _n-1+T1

. 
. * only keep years when the firm is alive, without merging actual balance data
. merge m:1 frame_id year using `sample', nogen keep(match)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                         1,409,286  
    -----------------------------------------

. 
. codebook frame_id

-------------------------------------------------------------------------------
frame_id_numeric                                                    (unlabeled)
-------------------------------------------------------------------------------

                  type:  numeric (long)

                 range:  [10000049,90620052]          units:  1
         unique values:  36,272                   missing .:  0/1,409,286

                  mean:   1.3e+07
              std. dev:   5.4e+06

           percentiles:        10%       25%       50%       75%       90%
                           1.0e+07   1.0e+07   1.1e+07   1.2e+07   2.0e+07

. 
. *expat before 1990
. replace expat=0 if job_begin<1990
(58 real changes made)

. 
. ***********************
. * time invariant vars *
. ***********************
.         egen first_year_expat = min(cond(expat==1,job_begin,.)), by(frame_id)
(1304232 missing values generated)

.         egen first_year_foreign_original = min(cond(foreign==1,year,.)), by(f
> rame_id)
(1069127 missing values generated)

.         
.         * which of the two happened first?
.         generate manager_after_owner = first_year_expat - first_year_foreign_
> original
(1,313,130 missing values generated)

.         * event time relative to that
.         generate event_time = year - first_year_expat
(1,304,232 missing values generated)

.         
.         generate first_year_foreign = first_year_foreign_original
(1,069,127 missing values generated)

.         
.         * if foreign manager arrives up to 2 years before 1 year later than f
> oreign owner, use foreign manager as arrival date. this is easier to implemen
> t
.         replace first_year_foreign = first_year_expat if inlist(manager_after
> _owner, -2, -1, 1)
(9,817 real changes made)

.         
.         replace foreign = 1 if (manager_after_owner == -2) & inlist(event_tim
> e, 0, 1)
(52 real changes made)

.         replace foreign = 1 if (manager_after_owner == -1) & inlist(event_tim
> e, 0)
(102 real changes made)

.         replace foreign = 0 if (manager_after_owner == +1) & inlist(event_tim
> e, -1)
(321 real changes made)

. 
.         * drop firms where expat arrives earlier than 2 years before owner
.         drop if manager_after_owner < -2
(2,348 observations deleted)

.         
.         drop *_year_*_original event_time manager_after_owner

. 
.         foreach X of var expat foreign {
  2.                 egen ever_`X' = max(`X'==1), by(frame_id)
  3.         }

. 
. *******************************************
. * drop entire series of firms from sample *
. *******************************************
.         drop if ever_expat==1 & ever_foreign==0
(8,973 observations deleted)

.         scalar dropped_do3_expat_firmyears = r(N_drop)

. 
.         * drop very large firms
.         egen fp_tag = tag(frame_id manager_id ) 

.         egen total_CEOs = sum(fp_tag ), by(frame_id )

.         tab total_CEOs 

 total_CEOs |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |     86,445        6.18        6.18
          2 |    185,546       13.27       19.46
          3 |    192,969       13.80       33.26
          4 |    168,147       12.03       45.29
          5 |    142,122       10.17       55.45
          6 |    129,205        9.24       64.70
          7 |    107,836        7.71       72.41
          8 |     81,528        5.83       78.24
          9 |     62,588        4.48       82.72
         10 |     50,563        3.62       86.34
         11 |     42,585        3.05       89.38
         12 |     29,025        2.08       91.46
         13 |     28,419        2.03       93.49
         14 |     19,135        1.37       94.86
         15 |     10,357        0.74       95.60
         16 |     13,820        0.99       96.59
         17 |      7,847        0.56       97.15
         18 |      6,988        0.50       97.65
         19 |      8,608        0.62       98.27
         20 |      3,288        0.24       98.50
         21 |      2,499        0.18       98.68
         22 |      6,258        0.45       99.13
         23 |      2,665        0.19       99.32
         24 |      2,199        0.16       99.48
         25 |      1,654        0.12       99.59
         26 |      1,546        0.11       99.71
         27 |        672        0.05       99.75
         30 |        768        0.05       99.81
         32 |        864        0.06       99.87
         37 |        925        0.07       99.94
         39 |        507        0.04       99.97
         43 |        387        0.03      100.00
------------+-----------------------------------
      Total |  1,397,965      100.00

. 
.         drop if total_CEOs>15
(61,495 observations deleted)

.         scalar dropped_too_many_CEOs = r(N_drop)

.         drop fp_tag total_CEOs

. 
. 
. * tenure at the firm in current job spell
. generate tenure = year - job_begin

. 
. * save firm-year dummy of whether there is an expat at the firm
. preserve

.         collapse (max) max_expat = expat, by(frame_id year)

.         label variable max_expat "Firm has expat CEO (dummy)"

.         save "temp/firm_year_expat.dta", replace
file temp/firm_year_expat.dta saved

. restore

. 
. * limit sample by event window
. keep if tenure >= -5 & tenure <= 10
(526,043 observations deleted)

. 
. compress
  variable year was float now int
  variable first_year_expat was float now int
  variable first_year_foreign was float now int
  variable ever_expat was float now byte
  variable ever_foreign was float now byte
  variable tenure was float now byte
  (12,156,405 bytes saved)

. save "temp/event_windows.dta", replace
file temp/event_windows.dta saved

. save_all_to_json

. 
. 
end of do-file
