
  ___  ____  ____  ____  ____ (R)
 /__    /   ____/   /   ____/
___/   /   /___/   /   /___/   15.1   Copyright 1985-2017 StataCorp LLC
  Statistics/Data Analysis            StataCorp
                                      4905 Lakeway Drive
     MP - Parallel Edition            College Station, Texas 77845 USA
                                      800-STATA-PC        http://www.stata.com
                                      979-696-4600        stata@stata.com
                                      979-696-4601 (fax)

Single-user 2-core Stata perpetual license:
       Serial number:  501506203290
         Licensed to:  Miklos Koren
                       CEU MicroData


Notes:
      1.  Stata is running in batch mode.
      2.  Unicode is supported; see help unicode_advice.
      3.  More than 2 billion observations are allowed; see help obs_advice.
      4.  Maximum number of variables is set to 5000; see help set_maxvar.

. do create_event_windows 

. clear all

. 
. use "temp/balance-small.dta"

. keep frame_id year foreign

. tempfile sample

. save `sample', replace
(note: file /var/folders/w1/7d52g2y563517gpc7n0sv5_r0000gn/T//St56216.000001 no
> t found)
file /var/folders/w1/7d52g2y563517gpc7n0sv5_r0000gn/T//St56216.000001 saved

. 
. use "temp/firm_ceo_panel.dta", clear

. capture drop _*

. 
. scalar T1 = 1988

. scalar T2 = 2018

. expand T2-T1+1
(2,280,030 observations created)

. bys frame_id manager_id job_spell: gen year = _n-1+T1

. 
. * only keep years when the firm is alive, without merging actual balance data
. merge m:1 frame_id year using `sample', nogen keep(match)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                         1,220,269  
    -----------------------------------------

. 
. codebook frame_id

-------------------------------------------------------------------------------
frame_id_numeric                                                    (unlabeled)
-------------------------------------------------------------------------------

                  type:  numeric (long)

                 range:  [10000238,90620052]          units:  1
         unique values:  26,712                   missing .:  0/1,220,269

                  mean:   1.2e+07
              std. dev:   4.9e+06

           percentiles:        10%       25%       50%       75%       90%
                           1.0e+07   1.0e+07   1.1e+07   1.2e+07   1.4e+07

. 
. *expat before 1990
. replace expat=0 if job_begin<1990
(2,828 real changes made)

. 
. ***********************
. * time invariant vars *
. ***********************
.         foreach X of var expat foreign {
  2.                 egen ever_`X' = max(`X'==1), by(frame_id)
  3.         }

. 
.         egen first_year_expat_original = min(cond(expat==1,job_begin,.)), by(
> frame_id)
(847221 missing values generated)

.         egen first_year_foreign_original = min(cond(foreign==1,year,.)), by(f
> rame_id)
(778101 missing values generated)

. 
.         *foreign visszahúzása expatba, valaha expat-tal, de soha foreign-mal 
> bíró cégek teljes kidobása
.         replace foreign = 1 if (first_year_expat_original == (year - 1) | fir
> st_year_expat_original == year) & foreign == 0 & ever_foreign == 1
(2,056 real changes made)

.         egen first_year_foreign = min(cond(foreign == 1, year, .)), by(frame_
> id)
(778101 missing values generated)

. 
.         clonevar enter_year_original = job_begin

.         * NB: this was buggy, also replaced later expats
.         * FIXME: do foreign/expat synchronization in firm_ceo_panel instead
.         replace job_begin = first_year_foreign_original if (enter_year_origin
> al == first_year_foreign - 2) & expat == 1 & ever_foreign == 1
(1,652 real changes made)

.         egen first_year_expat = min(cond(expat == 1, job_begin, .)), by(frame
> _id)
(847221 missing values generated)

. 
.         drop *_year_*_original

. 
. *******************************************
. * drop entire series of firms from sample *
. *******************************************
.         drop if ever_expat==1 & ever_foreign==0
(28,612 observations deleted)

.         scalar dropped_do3_expat_firmyears = r(N_drop)

. 
.         * drop very large firms
.         egen fp_tag = tag(frame_id manager_id ) 

.         egen total_CEOs = sum(fp_tag ), by(frame_id )

.         tab total_CEOs 

 total_CEOs |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |     75,903        6.37        6.37
          2 |    186,148       15.62       21.99
          3 |    198,924       16.69       38.68
          4 |    166,756       13.99       52.68
          5 |    129,012       10.83       63.50
          6 |    100,932        8.47       71.97
          7 |     82,168        6.90       78.87
          8 |     58,842        4.94       83.81
          9 |     42,455        3.56       87.37
         10 |     31,950        2.68       90.05
         11 |     21,614        1.81       91.86
         12 |     19,426        1.63       93.49
         13 |     12,850        1.08       94.57
         14 |     14,952        1.25       95.83
         15 |      6,646        0.56       96.38
         16 |      9,962        0.84       97.22
         17 |      6,686        0.56       97.78
         18 |      6,267        0.53       98.31
         19 |      2,904        0.24       98.55
         20 |      1,652        0.14       98.69
         21 |      3,215        0.27       98.96
         22 |        968        0.08       99.04
         23 |      1,952        0.16       99.21
         24 |        912        0.08       99.28
         25 |      1,025        0.09       99.37
         26 |        702        0.06       99.43
         27 |        644        0.05       99.48
         33 |        792        0.07       99.55
         34 |        945        0.08       99.63
         39 |        507        0.04       99.67
         41 |      1,025        0.09       99.75
         42 |      1,134        0.10       99.85
         43 |        387        0.03       99.88
         56 |      1,400        0.12      100.00
------------+-----------------------------------
      Total |  1,191,657      100.00

. 
.         drop if total_CEOs>15
(43,079 observations deleted)

.         scalar dropped_too_many_CEOs = r(N_drop)

.         drop fp_tag total_CEOs

. 
. 
. * tenure at the firm in current job spell
. generate tenure = year - job_begin

. 
. * save firm-year dummy of whether there is an expat at the firm
. preserve

.         collapse (max) max_expat = expat, by(frame_id year)

.         label variable max_expat "Firm has expat CEO (dummy)"

.         save "temp/firm_year_expat.dta", replace
(note: file temp/firm_year_expat.dta not found)
file temp/firm_year_expat.dta saved

. restore

. 
. * limit sample by event window
. keep if tenure >= -5 & tenure <= 10
(454,833 observations deleted)

. 
. compress
  variable year was float now int
  variable ever_expat was float now byte
  variable ever_foreign was float now byte
  variable first_year_foreign was float now int
  variable first_year_expat was float now int
  variable tenure was float now byte
  (10,406,175 bytes saved)

. save "temp/event_windows.dta", replace
(note: file temp/event_windows.dta not found)
file temp/event_windows.dta saved

. save_all_to_json

. 
. 
end of do-file
