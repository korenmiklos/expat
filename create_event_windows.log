
  ___  ____  ____  ____  ____ (R)
 /__    /   ____/   /   ____/
___/   /   /___/   /   /___/   16.1   Copyright 1985-2019 StataCorp LLC
  Statistics/Data Analysis            StataCorp
                                      4905 Lakeway Drive
     MP - Parallel Edition            College Station, Texas 77845 USA
                                      800-STATA-PC        http://www.stata.com
                                      979-696-4600        stata@stata.com
                                      979-696-4601 (fax)

Single-user 2-core Stata perpetual license:
       Serial number:  501606204617
         Licensed to:  Miklos Koren
                       CEU MicroData

Notes:
      1.  Stata is running in batch mode.
      2.  Unicode is supported; see help unicode_advice.
      3.  More than 2 billion observations are allowed; see help obs_advice.
      4.  Maximum number of variables is set to 5000; see help set_maxvar.

. do create_event_windows.do 

. clear all

. 
. use "temp/balance-small.dta"

. keep frame_id year foreign

. tempfile sample

. save `sample', replace
(note: file /var/folders/w1/7d52g2y563517gpc7n0sv5_r0000gn/T//St26527.000001 no
> t found)
file /var/folders/w1/7d52g2y563517gpc7n0sv5_r0000gn/T//St26527.000001 saved

. 
. use "temp/firm_ceo_panel.dta", clear

. capture drop _*

. 
. scalar T1 = 1985

. scalar T2 = 2018

. expand T2-T1+1
(195,624 observations created)

. bys frame_id manager_id job_spell: gen year = _n-1+T1

. 
. * only keep years when the firm is alive, without merging actual balance data
. merge m:1 frame_id year using `sample', nogen keep(match)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                            98,897  
    -----------------------------------------

. 
. codebook frame_id

-------------------------------------------------------------------------------
frame_id_numeric                                                    (unlabeled)
-------------------------------------------------------------------------------

                  type:  numeric (long)

                 range:  [10000850,54671371]          units:  1
         unique values:  3,784                    missing .:  0/98,897

                  mean:   1.2e+07
              std. dev:   4.7e+06

           percentiles:        10%       25%       50%       75%       90%
                           1.0e+07   1.0e+07   1.0e+07   1.1e+07   1.4e+07

. 
. *expat before 1990
. replace expat=0 if job_begin<1990
(2,490 real changes made)

. 
. ***********************
. * time invariant vars *
. ***********************
.         egen first_year_expat = min(cond(expat==1,job_begin,.)), by(frame_id)
(85097 missing values generated)

.         egen first_year_foreign_original = min(cond(foreign==1,year,.)), by(f
> rame_id)
(76563 missing values generated)

.         
.         * which of the two happened first?
.         generate manager_after_owner = first_year_expat - first_year_foreign_
> original
(86,421 missing values generated)

.         * event time relative to that
.         generate event_time = year - first_year_expat
(85,097 missing values generated)

.         
.         generate first_year_foreign = first_year_foreign_original
(76,563 missing values generated)

.         
.         * if foreign manager arrives up to 2 years before 1 year later than f
> oreign owner, use foreign manager as arrival date. this is easier to implemen
> t
.         replace first_year_foreign = first_year_expat if inlist(manager_after
> _owner, -2, -1, 1)
(1,762 real changes made)

.         
.         replace foreign = 1 if (manager_after_owner == -2) & inlist(event_tim
> e, 0, 1)
(12 real changes made)

.         replace foreign = 1 if (manager_after_owner == -1) & inlist(event_tim
> e, 0)
(10 real changes made)

.         replace foreign = 0 if (manager_after_owner == +1) & inlist(event_tim
> e, -1)
(56 real changes made)

. 
.         * drop firms where expat arrives earlier than 2 years before owner
.         drop if manager_after_owner < -2
(0 observations deleted)

.         
.         drop *_year_*_original event_time manager_after_owner

. 
.         foreach X of var expat foreign {
  2.                 egen ever_`X' = max(`X'==1), by(frame_id)
  3.         }

. 
. *******************************************
. * drop entire series of firms from sample *
. *******************************************
.         drop if ever_expat==1 & ever_foreign==0
(1,324 observations deleted)

.         scalar dropped_do3_expat_firmyears = r(N_drop)

. 
.         * drop very large firms
.         egen fp_tag = tag(frame_id manager_id ) 

.         egen total_CEOs = sum(fp_tag ), by(frame_id )

.         tab total_CEOs 

 total_CEOs |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |     45,918       47.06       47.06
          2 |     13,569       13.91       60.97
          3 |     15,276       15.66       76.62
          4 |      4,430        4.54       81.16
          5 |      5,272        5.40       86.57
          6 |      3,237        3.32       89.88
          7 |      1,585        1.62       91.51
          8 |      1,645        1.69       93.19
          9 |      1,242        1.27       94.47
         10 |      1,100        1.13       95.59
         11 |        521        0.53       96.13
         12 |        984        1.01       97.14
         13 |        143        0.15       97.28
         14 |        405        0.42       97.70
         15 |        870        0.89       98.59
         17 |        442        0.45       99.04
         19 |        494        0.51       99.55
         22 |        440        0.45      100.00
------------+-----------------------------------
      Total |     97,573      100.00

. 
.         drop if total_CEOs>15
(1,376 observations deleted)

.         scalar dropped_too_many_CEOs = r(N_drop)

.         drop fp_tag total_CEOs

. 
. 
. * tenure at the firm in current job spell
. generate tenure = year - job_begin

. 
. * save firm-year dummy of whether there is an expat at the firm
. preserve

.         do "create_firm_events.do"

. keep if (year >= job_begin) & (year <= job_end)
(80,978 observations deleted)

. 
. * hired ceo since last observed year of firm
. tempvar last_year

. generate last_year = .
(15,219 missing values generated)

. forval t = 1985/2018 {
  2.         egen `last_year' = max(cond(year < `t', year, .)), by(frame_id)
  3.         replace last_year = `last_year' if year == `t'
  4.         drop `last_year'
  5. }
(15219 missing values generated)
(0 real changes made)
(15219 missing values generated)
(0 real changes made)
(15219 missing values generated)
(0 real changes made)
(14924 missing values generated)
(98 real changes made)
(12239 missing values generated)
(51 real changes made)
(11824 missing values generated)
(76 real changes made)
(11078 missing values generated)
(131 real changes made)
(9635 missing values generated)
(222 real changes made)
(8102 missing values generated)
(310 real changes made)
(7079 missing values generated)
(353 real changes made)
(6244 missing values generated)
(350 real changes made)
(5902 missing values generated)
(356 real changes made)
(5253 missing values generated)
(357 real changes made)
(4740 missing values generated)
(373 real changes made)
(4224 missing values generated)
(378 real changes made)
(3723 missing values generated)
(392 real changes made)
(3281 missing values generated)
(426 real changes made)
(2889 missing values generated)
(443 real changes made)
(2525 missing values generated)
(441 real changes made)
(2341 missing values generated)
(439 real changes made)
(2154 missing values generated)
(439 real changes made)
(1929 missing values generated)
(443 real changes made)
(1682 missing values generated)
(448 real changes made)
(1524 missing values generated)
(457 real changes made)
(1354 missing values generated)
(451 real changes made)
(1206 missing values generated)
(448 real changes made)
(1147 missing values generated)
(431 real changes made)
(1063 missing values generated)
(427 real changes made)
(1027 missing values generated)
(435 real changes made)
(915 missing values generated)
(430 real changes made)
(821 missing values generated)
(439 real changes made)
(563 missing values generated)
(490 real changes made)
(283 missing values generated)
(563 real changes made)
(61 missing values generated)
(655 real changes made)

. egen first_year = min(year), by(frame_id)

. bysort frame_id (year): generate byte change = cond(first_year == year, 1, (j
> ob_begin <= year) & (job_begin > last_year))

. tabulate change

     change |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     10,668       70.10       70.10
          1 |      4,551       29.90      100.00
------------+-----------------------------------
      Total |     15,219      100.00

. 
. generate N = 1

. collapse (sum) N (firstnm) foreign (max) change, by(frame_id year manager_cat
> egory expat)

. egen hires_new_ceo = max(change), by(frame_id year)

. drop change

. 
. reshape wide N, i(frame_id year expat) j(manager_category)
(note: j = 1 2 3)

Data                               long   ->   wide
-----------------------------------------------------------------------------
Number of obs.                    12477   ->   11591
Number of variables                   7   ->       8
j variable (3 values)  manager_category   ->   (dropped)
xij variables:
                                      N   ->   N1 N2 N3
-----------------------------------------------------------------------------

. reshape wide N1 N2 N3, i(frame_id year) j(expat)
(note: j = 0 1)

Data                               long   ->   wide
-----------------------------------------------------------------------------
Number of obs.                    11591   ->   11146
Number of variables                   8   ->      10
j variable (2 values)             expat   ->   (dropped)
xij variables:
                                     N1   ->   N10 N11
                                     N2   ->   N20 N21
                                     N3   ->   N30 N31
-----------------------------------------------------------------------------

. mvencode N??, mv(0)
         N10: 7041 missing values recoded
         N20: 10175 missing values recoded
         N30: 5073 missing values recoded
         N11: 10845 missing values recoded
         N21: 11044 missing values recoded
         N31: 10221 missing values recoded

. 
. egen number_ceos = rsum(N??)

. 
. generate has_expat = (N11>0)|(N21>0)|(N31>0)

. generate has_local = (N10>0)|(N20>0)|(N30>0)

. generate has_founder = (N10>0)|(N11>0)

. generate has_insider = (N20>0)|(N21>0)

. generate has_outsider = (N30>0)|(N31>0)

. drop N??

. 
. * managers in first year not classified as new hires
. bysort frame_id (year): replace hires_new_ceo = 0 if (_n==1)
(2832 real changes made)

. bysort frame_id (year): generate owner_spell = sum(foreign != foreign[_n-1])

. bysort frame_id (year): generate manager_spell = sum(hires_new_ceo)

. * so that index start from 1
. replace manager_spell = 1 + manager_spell
(11,146 real changes made)

. 
. egen start_as_domestic = max((owner_spell==1) & (foreign==0)), by(frame_id)

. * only keep D, D-F owner spells
. keep if start_as_domestic & owner_spell <= 2
(1,692 observations deleted)

. 
. compress
  variable year was float now int
  variable hires_new_ceo was float now byte
  variable number_ceos was float now byte
  variable has_expat was float now byte
  variable has_local was float now byte
  variable has_founder was float now byte
  variable has_insider was float now byte
  variable has_outsider was float now byte
  variable owner_spell was float now byte
  variable manager_spell was float now byte
  variable start_as_domestic was float now byte
  (302,528 bytes saved)

. save "temp/firm_events.dta", replace
file temp/firm_events.dta saved

. 
. 
end of do-file

. restore

. 
. * limit sample by event window
. keep if tenure >= -5 & tenure <= 10
(44,300 observations deleted)

. 
. compress
  variable year was float now int
  variable first_year_expat was float now int
  variable first_year_foreign was float now int
  variable ever_expat was float now byte
  variable ever_foreign was float now byte
  variable tenure was float now byte
  (778,455 bytes saved)

. save "temp/event_windows.dta", replace
file temp/event_windows.dta saved

. save_all_to_json

. 
. 
end of do-file
