
  ___  ____  ____  ____  ____ (R)
 /__    /   ____/   /   ____/
___/   /   /___/   /   /___/   15.1   Copyright 1985-2017 StataCorp LLC
  Statistics/Data Analysis            StataCorp
                                      4905 Lakeway Drive
     MP - Parallel Edition            College Station, Texas 77845 USA
                                      800-STATA-PC        http://www.stata.com
                                      979-696-4600        stata@stata.com
                                      979-696-4601 (fax)

Single-user 2-core Stata perpetual license:
       Serial number:  501506203290
         Licensed to:  Miklos Koren
                       CEU MicroData


Notes:
      1.  Stata is running in batch mode.
      2.  Unicode is supported; see help unicode_advice.
      3.  More than 2 billion observations are allowed; see help obs_advice.
      4.  Maximum number of variables is set to 5000; see help set_maxvar.

. do create_event_windows 

. clear all

. 
. use "temp/balance-small.dta"

. keep frame_id year foreign

. tempfile sample

. save `sample', replace
(note: file /var/folders/w1/7d52g2y563517gpc7n0sv5_r0000gn/T//St62411.000001 no
> t found)
file /var/folders/w1/7d52g2y563517gpc7n0sv5_r0000gn/T//St62411.000001 saved

. 
. use "temp/firm_ceo_panel.dta", clear

. capture drop _*

. 
. scalar T1 = 1988

. scalar T2 = 2018

. expand T2-T1+1
(2,664,570 observations created)

. bys frame_id manager_id job_spell: gen year = _n-1+T1

. 
. * only keep years when the firm is alive, without merging actual balance data
. merge m:1 frame_id year using `sample', nogen keep(match)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                         1,268,884  
    -----------------------------------------

. 
. codebook frame_id

-------------------------------------------------------------------------------
frame_id_numeric                                                    (unlabeled)
-------------------------------------------------------------------------------

                  type:  numeric (long)

                 range:  [10000238,90620052]          units:  1
         unique values:  36,740                   missing .:  0/1,268,884

                  mean:   1.3e+07
              std. dev:   5.3e+06

           percentiles:        10%       25%       50%       75%       90%
                           1.0e+07   1.0e+07   1.1e+07   1.2e+07   1.5e+07

. 
. *expat before 1990
. replace expat=0 if job_begin<1990
(2,833 real changes made)

. 
. ***********************
. * time invariant vars *
. ***********************
.         egen first_year_expat = min(cond(expat==1,job_begin,.)), by(frame_id)
(888311 missing values generated)

.         egen first_year_foreign_original = min(cond(foreign==1,year,.)), by(f
> rame_id)
(816287 missing values generated)

.         
.         * which of the two happened first?
.         generate manager_after_owner = first_year_expat - first_year_foreign_
> original
(917,499 missing values generated)

.         * event time relative to that
.         generate event_time = year - first_year_expat
(888,311 missing values generated)

.         
.         generate first_year_foreign = first_year_foreign_original
(816,287 missing values generated)

.         
.         * if foreign manager arrives up to 2 years before 1 year later than f
> oreign owner, use foreign manager as arrival date. this is easier to implemen
> t
.         replace first_year_foreign = first_year_expat if inlist(manager_after
> _owner, -2, -1, 1)
(120,374 real changes made)

.         
.         replace foreign = 1 if (manager_after_owner == -2) & inlist(event_tim
> e, 0, 1)
(352 real changes made)

.         replace foreign = 1 if (manager_after_owner == -1) & inlist(event_tim
> e, 0)
(387 real changes made)

.         replace foreign = 0 if (manager_after_owner == +1) & inlist(event_tim
> e, -1)
(6,152 real changes made)

. 
.         drop *_year_*_original event_time manager_after_owner

. 
.         foreach X of var expat foreign {
  2.                 egen ever_`X' = max(`X'==1), by(frame_id)
  3.         }

. 
. *******************************************
. * drop entire series of firms from sample *
. *******************************************
.         drop if ever_expat==1 & ever_foreign==0
(30,063 observations deleted)

.         scalar dropped_do3_expat_firmyears = r(N_drop)

. 
.         * drop very large firms
.         egen fp_tag = tag(frame_id manager_id ) 

.         egen total_CEOs = sum(fp_tag ), by(frame_id )

.         tab total_CEOs 

 total_CEOs |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |     94,500        7.63        7.63
          2 |    200,789       16.21       23.84
          3 |    206,358       16.66       40.49
          4 |    170,692       13.78       54.27
          5 |    130,415       10.53       64.80
          6 |    100,809        8.14       72.94
          7 |     82,085        6.63       79.56
          8 |     59,342        4.79       84.35
          9 |     42,875        3.46       87.81
         10 |     32,899        2.66       90.47
         11 |     21,827        1.76       92.23
         12 |     18,553        1.50       93.73
         13 |     13,139        1.06       94.79
         14 |     14,702        1.19       95.98
         15 |      6,768        0.55       96.52
         16 |      9,755        0.79       97.31
         17 |      6,519        0.53       97.84
         18 |      6,304        0.51       98.35
         19 |      2,923        0.24       98.58
         20 |      1,652        0.13       98.72
         21 |      3,321        0.27       98.98
         22 |        990        0.08       99.06
         23 |      2,023        0.16       99.23
         24 |        936        0.08       99.30
         25 |      1,025        0.08       99.38
         26 |        702        0.06       99.44
         27 |        672        0.05       99.50
         33 |        792        0.06       99.56
         34 |        945        0.08       99.64
         39 |        507        0.04       99.68
         41 |      1,025        0.08       99.76
         42 |      1,134        0.09       99.85
         43 |        387        0.03       99.88
         56 |      1,456        0.12      100.00
------------+-----------------------------------
      Total |  1,238,821      100.00

. 
.         drop if total_CEOs>15
(43,068 observations deleted)

.         scalar dropped_too_many_CEOs = r(N_drop)

.         drop fp_tag total_CEOs

. 
. 
. * tenure at the firm in current job spell
. generate tenure = year - job_begin

. 
. * save firm-year dummy of whether there is an expat at the firm
. preserve

.         collapse (max) max_expat = expat, by(frame_id year)

.         label variable max_expat "Firm has expat CEO (dummy)"

.         save "temp/firm_year_expat.dta", replace
file temp/firm_year_expat.dta saved

. restore

. 
. * limit sample by event window
. keep if tenure >= -5 & tenure <= 10
(460,359 observations deleted)

. 
. compress
  variable year was float now int
  variable first_year_expat was float now int
  variable first_year_foreign was float now int
  variable ever_expat was float now byte
  variable ever_foreign was float now byte
  variable tenure was float now byte
  (11,030,910 bytes saved)

. save "temp/event_windows.dta", replace
file temp/event_windows.dta saved

. save_all_to_json

. 
. 
end of do-file
