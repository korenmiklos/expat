
  ___  ____  ____  ____  ____ (R)
 /__    /   ____/   /   ____/
___/   /   /___/   /   /___/   15.1   Copyright 1985-2017 StataCorp LLC
  Statistics/Data Analysis            StataCorp
                                      4905 Lakeway Drive
     MP - Parallel Edition            College Station, Texas 77845 USA
                                      800-STATA-PC        http://www.stata.com
                                      979-696-4600        stata@stata.com
                                      979-696-4601 (fax)

Single-user 2-core Stata perpetual license:
       Serial number:  501506203290
         Licensed to:  Miklos Koren
                       CEU MicroData


Notes:
      1.  Stata is running in batch mode.
      2.  Unicode is supported; see help unicode_advice.
      3.  More than 2 billion observations are allowed; see help obs_advice.
      4.  Maximum number of variables is set to 5000; see help set_maxvar.

. do create_analysis_sample 

. clear all

. 
. use "temp/firm_ceo_panel.dta"

. capture drop _*

. 
. scalar T1 = 1988

. scalar T2 = 2018

. expand T2-T1+1
(2,280,030 observations created)

. bys frame_id manager_id job_spell: gen year = _n-1+T1

. 
. tempfile expand

. save `expand', replace
(note: file /var/folders/w1/7d52g2y563517gpc7n0sv5_r0000gn/T//St55391.000001 no
> t found)
file /var/folders/w1/7d52g2y563517gpc7n0sv5_r0000gn/T//St55391.000001 saved

. merge m:1 frame_id year using "temp/balance-small.dta", nogen keep(match)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                         1,220,269  
    -----------------------------------------

. merge m:1 frame_id year using "temp/N_ceos.dta", nogen keep(match)

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                         1,123,163  
    -----------------------------------------

. * drop very large firms
. egen fp_tag = tag(frame_id manager_id ) 

. egen total_CEOs = sum(fp_tag ), by(frame_id )

. tab total_CEOs 

 total_CEOs |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |     62,698        5.58        5.58
          2 |    167,588       14.92       20.50
          3 |    184,916       16.46       36.97
          4 |    157,954       14.06       51.03
          5 |    124,132       11.05       62.08
          6 |     98,236        8.75       70.83
          7 |     78,861        7.02       77.85
          8 |     57,667        5.13       82.98
          9 |     41,684        3.71       86.70
         10 |     32,030        2.85       89.55
         11 |     21,753        1.94       91.48
         12 |     18,548        1.65       93.14
         13 |     12,324        1.10       94.23
         14 |     14,820        1.32       95.55
         15 |      6,231        0.55       96.11
         16 |      9,763        0.87       96.98
         17 |      6,598        0.59       97.56
         18 |      6,103        0.54       98.11
         19 |      2,808        0.25       98.36
         20 |      1,588        0.14       98.50
         21 |      3,215        0.29       98.79
         22 |        968        0.09       98.87
         23 |      1,952        0.17       99.05
         24 |        912        0.08       99.13
         25 |        975        0.09       99.21
         26 |      1,323        0.12       99.33
         27 |        644        0.06       99.39
         33 |        792        0.07       99.46
         34 |        945        0.08       99.54
         39 |        507        0.05       99.59
         41 |      1,025        0.09       99.68
         42 |      1,134        0.10       99.78
         43 |        387        0.03       99.81
         56 |      1,400        0.12       99.94
         62 |        682        0.06      100.00
------------+-----------------------------------
      Total |  1,123,163      100.00

. 
. drop if total_CEOs>15
(43,721 observations deleted)

. scalar dropped_too_many_CEOs = r(N_drop)

. 
. * create sample splits based on data in founder years
. local continuous lnL lnKL lnQL

. local dummy exporter

. foreach X of var `continuous' {
  2.         egen mean_`X' = mean(cond(spell==1,`X',.)), by(frame_id)
  3.         egen median_`X' = median(mean_`X'), by(industry_mode)
  4.         gen byte H_`X' = mean_`X' > median_`X'
  5.         tab H_`X'
  6. }
(3717 missing values generated)

      H_lnL |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |    541,157       50.13       50.13
          1 |    538,285       49.87      100.00
------------+-----------------------------------
      Total |  1,079,442      100.00
(4408 missing values generated)

     H_lnKL |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |    541,589       50.17       50.17
          1 |    537,853       49.83      100.00
------------+-----------------------------------
      Total |  1,079,442      100.00
(3813 missing values generated)

     H_lnQL |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |    541,417       50.16       50.16
          1 |    538,025       49.84      100.00
------------+-----------------------------------
      Total |  1,079,442      100.00

. foreach X of var `dummy' {
  2.         egen mean_`X' = mean(cond(spell==1,`X',.)), by(frame_id)
  3.         gen byte H_`X' = mean_`X' > 0.5
  4.         tab H_`X'
  5. }

 H_exporter |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |    618,830       57.33       57.33
          1 |    460,612       42.67      100.00
------------+-----------------------------------
      Total |  1,079,442      100.00

. codebook frame_id

-------------------------------------------------------------------------------
frame_id_numeric                                                    (unlabeled)
-------------------------------------------------------------------------------

                  type:  numeric (long)

                 range:  [10000238,90620052]          units:  1
         unique values:  26,539                   missing .:  0/1,079,442

                  mean:   1.2e+07
              std. dev:   5.1e+06

           percentiles:        10%       25%       50%       75%       90%
                           1.0e+07   1.0e+07   1.1e+07   1.2e+07   1.4e+07

. 
. *expat before 1990
. replace expat=0 if job_begin<1990
(2,275 real changes made)

. 
. * time invariant vars
. foreach X of var expat foreign {
  2.         egen ever_`X' = max(`X'==1), by(frame_id)
  3. }

. 
. egen first_year_expat_original = min(cond(expat==1,job_begin,.)), by(frame_id
> )
(764451 missing values generated)

. egen first_year_foreign_original = min(cond(foreign==1,year,.)), by(frame_id)
(706173 missing values generated)

. 
. *foreign visszahúzása expatba, valaha expat-tal, de soha foreign-mal bíró cég
> ek teljes kidobása
. replace foreign = 1 if (first_year_expat_original == (year - 1) | first_year_
> expat_original == year) & foreign == 0 & ever_foreign == 1
(1,929 real changes made)

. egen first_year_foreign = min(cond(foreign == 1, year, .)), by(frame_id)
(706173 missing values generated)

. 
. clonevar enter_year_original = job_begin

. * NB: this was buggy, also replaced later expats
. * FIXME: do foreign/expat synchronization in firm_ceo_panel instead
. replace job_begin = first_year_foreign_original if (enter_year_original == fi
> rst_year_foreign - 2) & expat == 1 & ever_foreign == 1
(1,512 real changes made)

. egen first_year_expat = min(cond(expat == 1, job_begin, .)), by(frame_id)
(764451 missing values generated)

. 
. gen tenure_foreign = year - first_year_foreign
(706,173 missing values generated)

. 
. drop if ever_expat==1 & ever_foreign==0
(25,514 observations deleted)

. scalar dropped_do3_expat_firmyears = r(N_drop)

. 
. * spell relation dummies
. gen tenure = year - job_begin

. gen byte before = tenure < 0

. gen byte during = tenure >= 0

. * NB: missing after years now
. gen byte after = 0

. 
. * spell-to-spell transition
. gen byte DD = (lag_expat==0)&(expat==0)

. gen byte DE = (lag_expat==0)&(expat==1)

. gen byte ED = (lag_expat==1)&(expat==0)

. gen byte EE = (lag_expat==1)&(expat==1)

. 
. * newly arriving CEOs
. * FIXME: review these dummies
. local T 4

. gen byte domestic = (expat==0)

. foreach X of var domestic expat DD DE ED EE {
  2.         gen byte new_`X' = (tenure <=`T') & (tenure>=0) & (`X'==1)
  3.         
.         * new managers at foreign firms
.         gen byte fnew_`X' = new_`X' & foreign==1
  4.         * only include managers joining in years [-1,...) since foreign
.         replace fnew_`X' = 0 if tenure > tenure_foreign+1
  5. 
.         foreach Y of var tenure before during after {
  6.                 gen `Y'_`X' = (`X'==1)*`Y'
  7.                 foreach Z of var H_* {
  8.                         gen `Y'_`X'_`Z' = (`X'==1)*`Y'*(`Z'==1)
  9.                 }
 10.         }
 11. }
(2,347 real changes made)
(110 real changes made)
(788 real changes made)
(10 real changes made)
(32 real changes made)
(15 real changes made)

. gen fold_expat = expat==1 & tenure>`T'

. gen byte new = new_domestic | new_expat

. gen byte fnew = fnew_domestic | fnew_expat

. 
. *foreign_switch interakció létrehozása
. gen byte foreign_new = foreign & new

. 
. ** do stats here
. tempvar tag

. foreach X of var foreign new expat new_expat fnew fnew_expat {
  2.         count if `X'==1
  3.         scalar N_it_`X' = r(N)
  4.         
.         * by firms
.         egen `tag' = tag(frame_id `X')
  5.         count if `X'==1 & `tag'==1
  6.         scalar N_i_`X' = r(N)
  7.         drop `tag'
  8. }
  292,972
  5,726
  282,962
  25,769
  158,752
  3,573
  41,791
  3,561
  75,697
  5,280
  39,931
  3,533

. 
. *Firm_tag
. egen firm_tag=tag(frame_id)

. egen firm_person = group(frame_id manager_id)

. 
. *Foreign hire
. gen byte foreign_hire = 1 if first_year_foreign <= job_begin
(746,357 missing values generated)

. recode foreign_hire (. = 0)
(foreign_hire: 746357 changes made)

. gen during_foreign = during*foreign_hire

. 
. * zero out all treatment dummies for founders. they are alwyas just control
. foreach X of var before during after DD DE ED EE {
  2.         replace `X' = 0 if manager_category == 1
  3. }
(23,888 real changes made)
(245,669 real changes made)
(0 real changes made)
(62,929 real changes made)
(1,799 real changes made)
(859 real changes made)
(2,041 real changes made)

. 
. *Cégév szerinti szűrés
. drop if missing(lnL,lnQ,exporter)
(50,603 observations deleted)

. 
. *Tfp
. tab year, gen(year_d)

       year |      Freq.     Percent        Cum.
------------+-----------------------------------
       1988 |      4,771        0.48        0.48
       1989 |      4,892        0.49        0.96
       1990 |      9,677        0.96        1.93
       1991 |     14,661        1.46        3.39
       1992 |     18,650        1.86        5.25
       1993 |     26,144        2.61        7.85
       1994 |     29,968        2.99       10.84
       1995 |     31,737        3.16       14.00
       1996 |     33,607        3.35       17.35
       1997 |     35,944        3.58       20.94
       1998 |     37,754        3.76       24.70
       1999 |     38,747        3.86       28.56
       2000 |     39,895        3.98       32.54
       2001 |     40,935        4.08       36.62
       2002 |     41,448        4.13       40.75
       2003 |     41,454        4.13       44.88
       2004 |     41,587        4.14       49.02
       2005 |     41,378        4.12       53.15
       2006 |     41,436        4.13       57.28
       2007 |     40,646        4.05       61.33
       2008 |     41,243        4.11       65.44
       2009 |     40,771        4.06       69.50
       2010 |     40,537        4.04       73.54
       2011 |     40,011        3.99       77.53
       2012 |     39,290        3.92       81.45
       2013 |     39,249        3.91       85.36
       2014 |     38,211        3.81       89.17
       2015 |     37,780        3.77       92.93
       2016 |     36,718        3.66       96.59
       2017 |     34,184        3.41      100.00
------------+-----------------------------------
      Total |  1,003,325      100.00

. egen firmyear_tag=tag(frame_id year)

. bysort frame_id: egen teaor_mode = mode(teaor08_2d), maxmode

. recode teaor_mode (6 75 = .)
(teaor_mode: 230 changes made)

. gen lnVA = ln(sales-ranyag)
(92,618 missing values generated)

. 
. /*
> FIXME: this is wrong for sure. only saves first stage. 
> levelsof teaor_mode, local(levels)
> foreach l of local levels {
>   disp `l'
>   qui prodest lnVA if teaor_mode == `l' & firmyear_tag, ///
>             free(lnL) state(lnK) proxy(lnM)  ///
>             met(lp) va control (year_d*) id(firm_person) t(year) fsres(tfp_lp
> _`l')
> }
> 
> * Q: what is x?
> gen  x =  .
> levelsof teaor_mode, local(levels)
> foreach l of local levels {
> 
>                 replace x = tfp_lp_`l' if x == .
> }
> 
> bysort frame_id year: egen  tfp_lp = max(x)
> 
> drop tfp_lp_* x year_d*
> */
. *Teljes minta elmentése a kontrollokkal
. compress
  variable year was float now int
  variable foundyear was float now int
  variable exporter_5 was float now byte
  variable divest was float now byte
  variable relative_year was float now byte
  variable foreign_infirst was float now byte
  variable industry_year was float now int
  variable ind_year was float now byte
  variable manufacturing was float now byte
  variable age was float now byte
  variable age_cat was float now byte
  variable N_ceos was long now byte
  variable total_CEOs was float now byte
  variable ever_expat was float now byte
  variable ever_foreign was float now byte
  variable first_year_expat_original was float now int
  variable first_year_foreign_original was float now int
  variable first_year_foreign was float now int
  variable first_year_expat was float now int
  variable tenure_foreign was float now byte
  variable tenure was float now byte
  variable tenure_domestic was float now byte
  variable tenure_domestic_H_lnL was float now byte
  variable tenure_domestic_H_lnKL was float now byte
  variable tenure_domestic_H_lnQL was float now byte
  variable tenure_domestic_H_exporter was float now byte
  variable before_domestic was float now byte
  variable before_domestic_H_lnL was float now byte
  variable before_domestic_H_lnKL was float now byte
  variable before_domestic_H_lnQL was float now byte
  variable before_domestic_H_exporter was float now byte
  variable during_domestic was float now byte
  variable during_domestic_H_lnL was float now byte
  variable during_domestic_H_lnKL was float now byte
  variable during_domestic_H_lnQL was float now byte
  variable during_domestic_H_exporter was float now byte
  variable after_domestic was float now byte
  variable after_domestic_H_lnL was float now byte
  variable after_domestic_H_lnKL was float now byte
  variable after_domestic_H_lnQL was float now byte
  variable after_domestic_H_exporter was float now byte
  variable tenure_expat was float now byte
  variable tenure_expat_H_lnL was float now byte
  variable tenure_expat_H_lnKL was float now byte
  variable tenure_expat_H_lnQL was float now byte
  variable tenure_expat_H_exporter was float now byte
  variable before_expat was float now byte
  variable before_expat_H_lnL was float now byte
  variable before_expat_H_lnKL was float now byte
  variable before_expat_H_lnQL was float now byte
  variable before_expat_H_exporter was float now byte
  variable during_expat was float now byte
  variable during_expat_H_lnL was float now byte
  variable during_expat_H_lnKL was float now byte
  variable during_expat_H_lnQL was float now byte
  variable during_expat_H_exporter was float now byte
  variable after_expat was float now byte
  variable after_expat_H_lnL was float now byte
  variable after_expat_H_lnKL was float now byte
  variable after_expat_H_lnQL was float now byte
  variable after_expat_H_exporter was float now byte
  variable tenure_DD was float now byte
  variable tenure_DD_H_lnL was float now byte
  variable tenure_DD_H_lnKL was float now byte
  variable tenure_DD_H_lnQL was float now byte
  variable tenure_DD_H_exporter was float now byte
  variable before_DD was float now byte
  variable before_DD_H_lnL was float now byte
  variable before_DD_H_lnKL was float now byte
  variable before_DD_H_lnQL was float now byte
  variable before_DD_H_exporter was float now byte
  variable during_DD was float now byte
  variable during_DD_H_lnL was float now byte
  variable during_DD_H_lnKL was float now byte
  variable during_DD_H_lnQL was float now byte
  variable during_DD_H_exporter was float now byte
  variable after_DD was float now byte
  variable after_DD_H_lnL was float now byte
  variable after_DD_H_lnKL was float now byte
  variable after_DD_H_lnQL was float now byte
  variable after_DD_H_exporter was float now byte
  variable tenure_DE was float now byte
  variable tenure_DE_H_lnL was float now byte
  variable tenure_DE_H_lnKL was float now byte
  variable tenure_DE_H_lnQL was float now byte
  variable tenure_DE_H_exporter was float now byte
  variable before_DE was float now byte
  variable before_DE_H_lnL was float now byte
  variable before_DE_H_lnKL was float now byte
  variable before_DE_H_lnQL was float now byte
  variable before_DE_H_exporter was float now byte
  variable during_DE was float now byte
  variable during_DE_H_lnL was float now byte
  variable during_DE_H_lnKL was float now byte
  variable during_DE_H_lnQL was float now byte
  variable during_DE_H_exporter was float now byte
  variable after_DE was float now byte
  variable after_DE_H_lnL was float now byte
  variable after_DE_H_lnKL was float now byte
  variable after_DE_H_lnQL was float now byte
  variable after_DE_H_exporter was float now byte
  variable tenure_ED was float now byte
  variable tenure_ED_H_lnL was float now byte
  variable tenure_ED_H_lnKL was float now byte
  variable tenure_ED_H_lnQL was float now byte
  variable tenure_ED_H_exporter was float now byte
  variable before_ED was float now byte
  variable before_ED_H_lnL was float now byte
  variable before_ED_H_lnKL was float now byte
  variable before_ED_H_lnQL was float now byte
  variable before_ED_H_exporter was float now byte
  variable during_ED was float now byte
  variable during_ED_H_lnL was float now byte
  variable during_ED_H_lnKL was float now byte
  variable during_ED_H_lnQL was float now byte
  variable during_ED_H_exporter was float now byte
  variable after_ED was float now byte
  variable after_ED_H_lnL was float now byte
  variable after_ED_H_lnKL was float now byte
  variable after_ED_H_lnQL was float now byte
  variable after_ED_H_exporter was float now byte
  variable tenure_EE was float now byte
  variable tenure_EE_H_lnL was float now byte
  variable tenure_EE_H_lnKL was float now byte
  variable tenure_EE_H_lnQL was float now byte
  variable tenure_EE_H_exporter was float now byte
  variable before_EE was float now byte
  variable before_EE_H_lnL was float now byte
  variable before_EE_H_lnKL was float now byte
  variable before_EE_H_lnQL was float now byte
  variable before_EE_H_exporter was float now byte
  variable during_EE was float now byte
  variable during_EE_H_lnL was float now byte
  variable during_EE_H_lnKL was float now byte
  variable during_EE_H_lnQL was float now byte
  variable during_EE_H_exporter was float now byte
  variable after_EE was float now byte
  variable after_EE_H_lnL was float now byte
  variable after_EE_H_lnKL was float now byte
  variable after_EE_H_lnQL was float now byte
  variable after_EE_H_exporter was float now byte
  variable fold_expat was float now byte
  variable during_foreign was float now byte
  variable jetok was double now long
  variable export was double now long
  variable final_netgep was double now long
  (435,443,050 bytes saved)

. save "temp/analysis_sample.dta", replace
file temp/analysis_sample.dta saved

. save_all_to_json

. 
. 
end of do-file
